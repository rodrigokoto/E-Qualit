/*! jQuery v1.12.4 | (c) jQuery Foundation | jquery.org/license */
!function (a, b) { "object" == typeof module && "object" == typeof module.exports ? module.exports = a.document ? b(a, !0) : function (a) { if (!a.document) throw new Error("jQuery requires a window with a document"); return b(a) } : b(a) }("undefined" != typeof window ? window : this, function (a, b) {
    var c = [], d = a.document, e = c.slice, f = c.concat, g = c.push, h = c.indexOf, i = {}, j = i.toString, k = i.hasOwnProperty, l = {}, m = "1.12.4", n = function (a, b) { return new n.fn.init(a, b) }, o = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, p = /^-ms-/, q = /-([\da-z])/gi, r = function (a, b) { return b.toUpperCase() }; n.fn = n.prototype = { jquery: m, constructor: n, selector: "", length: 0, toArray: function () { return e.call(this) }, get: function (a) { return null != a ? 0 > a ? this[a + this.length] : this[a] : e.call(this) }, pushStack: function (a) { var b = n.merge(this.constructor(), a); return b.prevObject = this, b.context = this.context, b }, each: function (a) { return n.each(this, a) }, map: function (a) { return this.pushStack(n.map(this, function (b, c) { return a.call(b, c, b) })) }, slice: function () { return this.pushStack(e.apply(this, arguments)) }, first: function () { return this.eq(0) }, last: function () { return this.eq(-1) }, eq: function (a) { var b = this.length, c = +a + (0 > a ? b : 0); return this.pushStack(c >= 0 && b > c ? [this[c]] : []) }, end: function () { return this.prevObject || this.constructor() }, push: g, sort: c.sort, splice: c.splice }, n.extend = n.fn.extend = function () { var a, b, c, d, e, f, g = arguments[0] || {}, h = 1, i = arguments.length, j = !1; for ("boolean" == typeof g && (j = g, g = arguments[h] || {}, h++), "object" == typeof g || n.isFunction(g) || (g = {}), h === i && (g = this, h--); i > h; h++)if (null != (e = arguments[h])) for (d in e) a = g[d], c = e[d], g !== c && (j && c && (n.isPlainObject(c) || (b = n.isArray(c))) ? (b ? (b = !1, f = a && n.isArray(a) ? a : []) : f = a && n.isPlainObject(a) ? a : {}, g[d] = n.extend(j, f, c)) : void 0 !== c && (g[d] = c)); return g }, n.extend({ expando: "jQuery" + (m + Math.random()).replace(/\D/g, ""), isReady: !0, error: function (a) { throw new Error(a) }, noop: function () { }, isFunction: function (a) { return "function" === n.type(a) }, isArray: Array.isArray || function (a) { return "array" === n.type(a) }, isWindow: function (a) { return null != a && a == a.window }, isNumeric: function (a) { var b = a && a.toString(); return !n.isArray(a) && b - parseFloat(b) + 1 >= 0 }, isEmptyObject: function (a) { var b; for (b in a) return !1; return !0 }, isPlainObject: function (a) { var b; if (!a || "object" !== n.type(a) || a.nodeType || n.isWindow(a)) return !1; try { if (a.constructor && !k.call(a, "constructor") && !k.call(a.constructor.prototype, "isPrototypeOf")) return !1 } catch (c) { return !1 } if (!l.ownFirst) for (b in a) return k.call(a, b); for (b in a); return void 0 === b || k.call(a, b) }, type: function (a) { return null == a ? a + "" : "object" == typeof a || "function" == typeof a ? i[j.call(a)] || "object" : typeof a }, globalEval: function (b) { b && n.trim(b) && (a.execScript || function (b) { a.eval.call(a, b) })(b) }, camelCase: function (a) { return a.replace(p, "ms-").replace(q, r) }, nodeName: function (a, b) { return a.nodeName && a.nodeName.toLowerCase() === b.toLowerCase() }, each: function (a, b) { var c, d = 0; if (s(a)) { for (c = a.length; c > d; d++)if (b.call(a[d], d, a[d]) === !1) break } else for (d in a) if (b.call(a[d], d, a[d]) === !1) break; return a }, trim: function (a) { return null == a ? "" : (a + "").replace(o, "") }, makeArray: function (a, b) { var c = b || []; return null != a && (s(Object(a)) ? n.merge(c, "string" == typeof a ? [a] : a) : g.call(c, a)), c }, inArray: function (a, b, c) { var d; if (b) { if (h) return h.call(b, a, c); for (d = b.length, c = c ? 0 > c ? Math.max(0, d + c) : c : 0; d > c; c++)if (c in b && b[c] === a) return c } return -1 }, merge: function (a, b) { var c = +b.length, d = 0, e = a.length; while (c > d) a[e++] = b[d++]; if (c !== c) while (void 0 !== b[d]) a[e++] = b[d++]; return a.length = e, a }, grep: function (a, b, c) { for (var d, e = [], f = 0, g = a.length, h = !c; g > f; f++)d = !b(a[f], f), d !== h && e.push(a[f]); return e }, map: function (a, b, c) { var d, e, g = 0, h = []; if (s(a)) for (d = a.length; d > g; g++)e = b(a[g], g, c), null != e && h.push(e); else for (g in a) e = b(a[g], g, c), null != e && h.push(e); return f.apply([], h) }, guid: 1, proxy: function (a, b) { var c, d, f; return "string" == typeof b && (f = a[b], b = a, a = f), n.isFunction(a) ? (c = e.call(arguments, 2), d = function () { return a.apply(b || this, c.concat(e.call(arguments))) }, d.guid = a.guid = a.guid || n.guid++ , d) : void 0 }, now: function () { return +new Date }, support: l }), "function" == typeof Symbol && (n.fn[Symbol.iterator] = c[Symbol.iterator]), n.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "), function (a, b) { i["[object " + b + "]"] = b.toLowerCase() }); function s(a) { var b = !!a && "length" in a && a.length, c = n.type(a); return "function" === c || n.isWindow(a) ? !1 : "array" === c || 0 === b || "number" == typeof b && b > 0 && b - 1 in a } var t = function (a) { var b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u = "sizzle" + 1 * new Date, v = a.document, w = 0, x = 0, y = ga(), z = ga(), A = ga(), B = function (a, b) { return a === b && (l = !0), 0 }, C = 1 << 31, D = {}.hasOwnProperty, E = [], F = E.pop, G = E.push, H = E.push, I = E.slice, J = function (a, b) { for (var c = 0, d = a.length; d > c; c++)if (a[c] === b) return c; return -1 }, K = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", L = "[\\x20\\t\\r\\n\\f]", M = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", N = "\\[" + L + "*(" + M + ")(?:" + L + "*([*^$|!~]?=)" + L + "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + M + "))|)" + L + "*\\]", O = ":(" + M + ")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|" + N + ")*)|.*)\\)|)", P = new RegExp(L + "+", "g"), Q = new RegExp("^" + L + "+|((?:^|[^\\\\])(?:\\\\.)*)" + L + "+$", "g"), R = new RegExp("^" + L + "*," + L + "*"), S = new RegExp("^" + L + "*([>+~]|" + L + ")" + L + "*"), T = new RegExp("=" + L + "*([^\\]'\"]*?)" + L + "*\\]", "g"), U = new RegExp(O), V = new RegExp("^" + M + "$"), W = { ID: new RegExp("^#(" + M + ")"), CLASS: new RegExp("^\\.(" + M + ")"), TAG: new RegExp("^(" + M + "|[*])"), ATTR: new RegExp("^" + N), PSEUDO: new RegExp("^" + O), CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + L + "*(even|odd|(([+-]|)(\\d*)n|)" + L + "*(?:([+-]|)" + L + "*(\\d+)|))" + L + "*\\)|)", "i"), bool: new RegExp("^(?:" + K + ")$", "i"), needsContext: new RegExp("^" + L + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + L + "*((?:-\\d)?\\d*)" + L + "*\\)|)(?=[^-]|$)", "i") }, X = /^(?:input|select|textarea|button)$/i, Y = /^h\d$/i, Z = /^[^{]+\{\s*\[native \w/, $ = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, _ = /[+~]/, aa = /'|\\/g, ba = new RegExp("\\\\([\\da-f]{1,6}" + L + "?|(" + L + ")|.)", "ig"), ca = function (a, b, c) { var d = "0x" + b - 65536; return d !== d || c ? b : 0 > d ? String.fromCharCode(d + 65536) : String.fromCharCode(d >> 10 | 55296, 1023 & d | 56320) }, da = function () { m() }; try { H.apply(E = I.call(v.childNodes), v.childNodes), E[v.childNodes.length].nodeType } catch (ea) { H = { apply: E.length ? function (a, b) { G.apply(a, I.call(b)) } : function (a, b) { var c = a.length, d = 0; while (a[c++] = b[d++]); a.length = c - 1 } } } function fa(a, b, d, e) { var f, h, j, k, l, o, r, s, w = b && b.ownerDocument, x = b ? b.nodeType : 9; if (d = d || [], "string" != typeof a || !a || 1 !== x && 9 !== x && 11 !== x) return d; if (!e && ((b ? b.ownerDocument || b : v) !== n && m(b), b = b || n, p)) { if (11 !== x && (o = $.exec(a))) if (f = o[1]) { if (9 === x) { if (!(j = b.getElementById(f))) return d; if (j.id === f) return d.push(j), d } else if (w && (j = w.getElementById(f)) && t(b, j) && j.id === f) return d.push(j), d } else { if (o[2]) return H.apply(d, b.getElementsByTagName(a)), d; if ((f = o[3]) && c.getElementsByClassName && b.getElementsByClassName) return H.apply(d, b.getElementsByClassName(f)), d } if (c.qsa && !A[a + " "] && (!q || !q.test(a))) { if (1 !== x) w = b, s = a; else if ("object" !== b.nodeName.toLowerCase()) { (k = b.getAttribute("id")) ? k = k.replace(aa, "\\$&") : b.setAttribute("id", k = u), r = g(a), h = r.length, l = V.test(k) ? "#" + k : "[id='" + k + "']"; while (h--) r[h] = l + " " + qa(r[h]); s = r.join(","), w = _.test(a) && oa(b.parentNode) || b } if (s) try { return H.apply(d, w.querySelectorAll(s)), d } catch (y) { } finally { k === u && b.removeAttribute("id") } } } return i(a.replace(Q, "$1"), b, d, e) } function ga() { var a = []; function b(c, e) { return a.push(c + " ") > d.cacheLength && delete b[a.shift()], b[c + " "] = e } return b } function ha(a) { return a[u] = !0, a } function ia(a) { var b = n.createElement("div"); try { return !!a(b) } catch (c) { return !1 } finally { b.parentNode && b.parentNode.removeChild(b), b = null } } function ja(a, b) { var c = a.split("|"), e = c.length; while (e--) d.attrHandle[c[e]] = b } function ka(a, b) { var c = b && a, d = c && 1 === a.nodeType && 1 === b.nodeType && (~b.sourceIndex || C) - (~a.sourceIndex || C); if (d) return d; if (c) while (c = c.nextSibling) if (c === b) return -1; return a ? 1 : -1 } function la(a) { return function (b) { var c = b.nodeName.toLowerCase(); return "input" === c && b.type === a } } function ma(a) { return function (b) { var c = b.nodeName.toLowerCase(); return ("input" === c || "button" === c) && b.type === a } } function na(a) { return ha(function (b) { return b = +b, ha(function (c, d) { var e, f = a([], c.length, b), g = f.length; while (g--) c[e = f[g]] && (c[e] = !(d[e] = c[e])) }) }) } function oa(a) { return a && "undefined" != typeof a.getElementsByTagName && a } c = fa.support = {}, f = fa.isXML = function (a) { var b = a && (a.ownerDocument || a).documentElement; return b ? "HTML" !== b.nodeName : !1 }, m = fa.setDocument = function (a) { var b, e, g = a ? a.ownerDocument || a : v; return g !== n && 9 === g.nodeType && g.documentElement ? (n = g, o = n.documentElement, p = !f(n), (e = n.defaultView) && e.top !== e && (e.addEventListener ? e.addEventListener("unload", da, !1) : e.attachEvent && e.attachEvent("onunload", da)), c.attributes = ia(function (a) { return a.className = "i", !a.getAttribute("className") }), c.getElementsByTagName = ia(function (a) { return a.appendChild(n.createComment("")), !a.getElementsByTagName("*").length }), c.getElementsByClassName = Z.test(n.getElementsByClassName), c.getById = ia(function (a) { return o.appendChild(a).id = u, !n.getElementsByName || !n.getElementsByName(u).length }), c.getById ? (d.find.ID = function (a, b) { if ("undefined" != typeof b.getElementById && p) { var c = b.getElementById(a); return c ? [c] : [] } }, d.filter.ID = function (a) { var b = a.replace(ba, ca); return function (a) { return a.getAttribute("id") === b } }) : (delete d.find.ID, d.filter.ID = function (a) { var b = a.replace(ba, ca); return function (a) { var c = "undefined" != typeof a.getAttributeNode && a.getAttributeNode("id"); return c && c.value === b } }), d.find.TAG = c.getElementsByTagName ? function (a, b) { return "undefined" != typeof b.getElementsByTagName ? b.getElementsByTagName(a) : c.qsa ? b.querySelectorAll(a) : void 0 } : function (a, b) { var c, d = [], e = 0, f = b.getElementsByTagName(a); if ("*" === a) { while (c = f[e++]) 1 === c.nodeType && d.push(c); return d } return f }, d.find.CLASS = c.getElementsByClassName && function (a, b) { return "undefined" != typeof b.getElementsByClassName && p ? b.getElementsByClassName(a) : void 0 }, r = [], q = [], (c.qsa = Z.test(n.querySelectorAll)) && (ia(function (a) { o.appendChild(a).innerHTML = "<a id='" + u + "'></a><select id='" + u + "-\r\\' msallowcapture=''><option selected=''></option></select>", a.querySelectorAll("[msallowcapture^='']").length && q.push("[*^$]=" + L + "*(?:''|\"\")"), a.querySelectorAll("[selected]").length || q.push("\\[" + L + "*(?:value|" + K + ")"), a.querySelectorAll("[id~=" + u + "-]").length || q.push("~="), a.querySelectorAll(":checked").length || q.push(":checked"), a.querySelectorAll("a#" + u + "+*").length || q.push(".#.+[+~]") }), ia(function (a) { var b = n.createElement("input"); b.setAttribute("type", "hidden"), a.appendChild(b).setAttribute("name", "D"), a.querySelectorAll("[name=d]").length && q.push("name" + L + "*[*^$|!~]?="), a.querySelectorAll(":enabled").length || q.push(":enabled", ":disabled"), a.querySelectorAll("*,:x"), q.push(",.*:") })), (c.matchesSelector = Z.test(s = o.matches || o.webkitMatchesSelector || o.mozMatchesSelector || o.oMatchesSelector || o.msMatchesSelector)) && ia(function (a) { c.disconnectedMatch = s.call(a, "div"), s.call(a, "[s!='']:x"), r.push("!=", O) }), q = q.length && new RegExp(q.join("|")), r = r.length && new RegExp(r.join("|")), b = Z.test(o.compareDocumentPosition), t = b || Z.test(o.contains) ? function (a, b) { var c = 9 === a.nodeType ? a.documentElement : a, d = b && b.parentNode; return a === d || !(!d || 1 !== d.nodeType || !(c.contains ? c.contains(d) : a.compareDocumentPosition && 16 & a.compareDocumentPosition(d))) } : function (a, b) { if (b) while (b = b.parentNode) if (b === a) return !0; return !1 }, B = b ? function (a, b) { if (a === b) return l = !0, 0; var d = !a.compareDocumentPosition - !b.compareDocumentPosition; return d ? d : (d = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1, 1 & d || !c.sortDetached && b.compareDocumentPosition(a) === d ? a === n || a.ownerDocument === v && t(v, a) ? -1 : b === n || b.ownerDocument === v && t(v, b) ? 1 : k ? J(k, a) - J(k, b) : 0 : 4 & d ? -1 : 1) } : function (a, b) { if (a === b) return l = !0, 0; var c, d = 0, e = a.parentNode, f = b.parentNode, g = [a], h = [b]; if (!e || !f) return a === n ? -1 : b === n ? 1 : e ? -1 : f ? 1 : k ? J(k, a) - J(k, b) : 0; if (e === f) return ka(a, b); c = a; while (c = c.parentNode) g.unshift(c); c = b; while (c = c.parentNode) h.unshift(c); while (g[d] === h[d]) d++; return d ? ka(g[d], h[d]) : g[d] === v ? -1 : h[d] === v ? 1 : 0 }, n) : n }, fa.matches = function (a, b) { return fa(a, null, null, b) }, fa.matchesSelector = function (a, b) { if ((a.ownerDocument || a) !== n && m(a), b = b.replace(T, "='$1']"), c.matchesSelector && p && !A[b + " "] && (!r || !r.test(b)) && (!q || !q.test(b))) try { var d = s.call(a, b); if (d || c.disconnectedMatch || a.document && 11 !== a.document.nodeType) return d } catch (e) { } return fa(b, n, null, [a]).length > 0 }, fa.contains = function (a, b) { return (a.ownerDocument || a) !== n && m(a), t(a, b) }, fa.attr = function (a, b) { (a.ownerDocument || a) !== n && m(a); var e = d.attrHandle[b.toLowerCase()], f = e && D.call(d.attrHandle, b.toLowerCase()) ? e(a, b, !p) : void 0; return void 0 !== f ? f : c.attributes || !p ? a.getAttribute(b) : (f = a.getAttributeNode(b)) && f.specified ? f.value : null }, fa.error = function (a) { throw new Error("Syntax error, unrecognized expression: " + a) }, fa.uniqueSort = function (a) { var b, d = [], e = 0, f = 0; if (l = !c.detectDuplicates, k = !c.sortStable && a.slice(0), a.sort(B), l) { while (b = a[f++]) b === a[f] && (e = d.push(f)); while (e--) a.splice(d[e], 1) } return k = null, a }, e = fa.getText = function (a) { var b, c = "", d = 0, f = a.nodeType; if (f) { if (1 === f || 9 === f || 11 === f) { if ("string" == typeof a.textContent) return a.textContent; for (a = a.firstChild; a; a = a.nextSibling)c += e(a) } else if (3 === f || 4 === f) return a.nodeValue } else while (b = a[d++]) c += e(b); return c }, d = fa.selectors = { cacheLength: 50, createPseudo: ha, match: W, attrHandle: {}, find: {}, relative: { ">": { dir: "parentNode", first: !0 }, " ": { dir: "parentNode" }, "+": { dir: "previousSibling", first: !0 }, "~": { dir: "previousSibling" } }, preFilter: { ATTR: function (a) { return a[1] = a[1].replace(ba, ca), a[3] = (a[3] || a[4] || a[5] || "").replace(ba, ca), "~=" === a[2] && (a[3] = " " + a[3] + " "), a.slice(0, 4) }, CHILD: function (a) { return a[1] = a[1].toLowerCase(), "nth" === a[1].slice(0, 3) ? (a[3] || fa.error(a[0]), a[4] = +(a[4] ? a[5] + (a[6] || 1) : 2 * ("even" === a[3] || "odd" === a[3])), a[5] = +(a[7] + a[8] || "odd" === a[3])) : a[3] && fa.error(a[0]), a }, PSEUDO: function (a) { var b, c = !a[6] && a[2]; return W.CHILD.test(a[0]) ? null : (a[3] ? a[2] = a[4] || a[5] || "" : c && U.test(c) && (b = g(c, !0)) && (b = c.indexOf(")", c.length - b) - c.length) && (a[0] = a[0].slice(0, b), a[2] = c.slice(0, b)), a.slice(0, 3)) } }, filter: { TAG: function (a) { var b = a.replace(ba, ca).toLowerCase(); return "*" === a ? function () { return !0 } : function (a) { return a.nodeName && a.nodeName.toLowerCase() === b } }, CLASS: function (a) { var b = y[a + " "]; return b || (b = new RegExp("(^|" + L + ")" + a + "(" + L + "|$)")) && y(a, function (a) { return b.test("string" == typeof a.className && a.className || "undefined" != typeof a.getAttribute && a.getAttribute("class") || "") }) }, ATTR: function (a, b, c) { return function (d) { var e = fa.attr(d, a); return null == e ? "!=" === b : b ? (e += "", "=" === b ? e === c : "!=" === b ? e !== c : "^=" === b ? c && 0 === e.indexOf(c) : "*=" === b ? c && e.indexOf(c) > -1 : "$=" === b ? c && e.slice(-c.length) === c : "~=" === b ? (" " + e.replace(P, " ") + " ").indexOf(c) > -1 : "|=" === b ? e === c || e.slice(0, c.length + 1) === c + "-" : !1) : !0 } }, CHILD: function (a, b, c, d, e) { var f = "nth" !== a.slice(0, 3), g = "last" !== a.slice(-4), h = "of-type" === b; return 1 === d && 0 === e ? function (a) { return !!a.parentNode } : function (b, c, i) { var j, k, l, m, n, o, p = f !== g ? "nextSibling" : "previousSibling", q = b.parentNode, r = h && b.nodeName.toLowerCase(), s = !i && !h, t = !1; if (q) { if (f) { while (p) { m = b; while (m = m[p]) if (h ? m.nodeName.toLowerCase() === r : 1 === m.nodeType) return !1; o = p = "only" === a && !o && "nextSibling" } return !0 } if (o = [g ? q.firstChild : q.lastChild], g && s) { m = q, l = m[u] || (m[u] = {}), k = l[m.uniqueID] || (l[m.uniqueID] = {}), j = k[a] || [], n = j[0] === w && j[1], t = n && j[2], m = n && q.childNodes[n]; while (m = ++n && m && m[p] || (t = n = 0) || o.pop()) if (1 === m.nodeType && ++t && m === b) { k[a] = [w, n, t]; break } } else if (s && (m = b, l = m[u] || (m[u] = {}), k = l[m.uniqueID] || (l[m.uniqueID] = {}), j = k[a] || [], n = j[0] === w && j[1], t = n), t === !1) while (m = ++n && m && m[p] || (t = n = 0) || o.pop()) if ((h ? m.nodeName.toLowerCase() === r : 1 === m.nodeType) && ++t && (s && (l = m[u] || (m[u] = {}), k = l[m.uniqueID] || (l[m.uniqueID] = {}), k[a] = [w, t]), m === b)) break; return t -= e, t === d || t % d === 0 && t / d >= 0 } } }, PSEUDO: function (a, b) { var c, e = d.pseudos[a] || d.setFilters[a.toLowerCase()] || fa.error("unsupported pseudo: " + a); return e[u] ? e(b) : e.length > 1 ? (c = [a, a, "", b], d.setFilters.hasOwnProperty(a.toLowerCase()) ? ha(function (a, c) { var d, f = e(a, b), g = f.length; while (g--) d = J(a, f[g]), a[d] = !(c[d] = f[g]) }) : function (a) { return e(a, 0, c) }) : e } }, pseudos: { not: ha(function (a) { var b = [], c = [], d = h(a.replace(Q, "$1")); return d[u] ? ha(function (a, b, c, e) { var f, g = d(a, null, e, []), h = a.length; while (h--) (f = g[h]) && (a[h] = !(b[h] = f)) }) : function (a, e, f) { return b[0] = a, d(b, null, f, c), b[0] = null, !c.pop() } }), has: ha(function (a) { return function (b) { return fa(a, b).length > 0 } }), contains: ha(function (a) { return a = a.replace(ba, ca), function (b) { return (b.textContent || b.innerText || e(b)).indexOf(a) > -1 } }), lang: ha(function (a) { return V.test(a || "") || fa.error("unsupported lang: " + a), a = a.replace(ba, ca).toLowerCase(), function (b) { var c; do if (c = p ? b.lang : b.getAttribute("xml:lang") || b.getAttribute("lang")) return c = c.toLowerCase(), c === a || 0 === c.indexOf(a + "-"); while ((b = b.parentNode) && 1 === b.nodeType); return !1 } }), target: function (b) { var c = a.location && a.location.hash; return c && c.slice(1) === b.id }, root: function (a) { return a === o }, focus: function (a) { return a === n.activeElement && (!n.hasFocus || n.hasFocus()) && !!(a.type || a.href || ~a.tabIndex) }, enabled: function (a) { return a.disabled === !1 }, disabled: function (a) { return a.disabled === !0 }, checked: function (a) { var b = a.nodeName.toLowerCase(); return "input" === b && !!a.checked || "option" === b && !!a.selected }, selected: function (a) { return a.parentNode && a.parentNode.selectedIndex, a.selected === !0 }, empty: function (a) { for (a = a.firstChild; a; a = a.nextSibling)if (a.nodeType < 6) return !1; return !0 }, parent: function (a) { return !d.pseudos.empty(a) }, header: function (a) { return Y.test(a.nodeName) }, input: function (a) { return X.test(a.nodeName) }, button: function (a) { var b = a.nodeName.toLowerCase(); return "input" === b && "button" === a.type || "button" === b }, text: function (a) { var b; return "input" === a.nodeName.toLowerCase() && "text" === a.type && (null == (b = a.getAttribute("type")) || "text" === b.toLowerCase()) }, first: na(function () { return [0] }), last: na(function (a, b) { return [b - 1] }), eq: na(function (a, b, c) { return [0 > c ? c + b : c] }), even: na(function (a, b) { for (var c = 0; b > c; c += 2)a.push(c); return a }), odd: na(function (a, b) { for (var c = 1; b > c; c += 2)a.push(c); return a }), lt: na(function (a, b, c) { for (var d = 0 > c ? c + b : c; --d >= 0;)a.push(d); return a }), gt: na(function (a, b, c) { for (var d = 0 > c ? c + b : c; ++d < b;)a.push(d); return a }) } }, d.pseudos.nth = d.pseudos.eq; for (b in { radio: !0, checkbox: !0, file: !0, password: !0, image: !0 }) d.pseudos[b] = la(b); for (b in { submit: !0, reset: !0 }) d.pseudos[b] = ma(b); function pa() { } pa.prototype = d.filters = d.pseudos, d.setFilters = new pa, g = fa.tokenize = function (a, b) { var c, e, f, g, h, i, j, k = z[a + " "]; if (k) return b ? 0 : k.slice(0); h = a, i = [], j = d.preFilter; while (h) { c && !(e = R.exec(h)) || (e && (h = h.slice(e[0].length) || h), i.push(f = [])), c = !1, (e = S.exec(h)) && (c = e.shift(), f.push({ value: c, type: e[0].replace(Q, " ") }), h = h.slice(c.length)); for (g in d.filter) !(e = W[g].exec(h)) || j[g] && !(e = j[g](e)) || (c = e.shift(), f.push({ value: c, type: g, matches: e }), h = h.slice(c.length)); if (!c) break } return b ? h.length : h ? fa.error(a) : z(a, i).slice(0) }; function qa(a) { for (var b = 0, c = a.length, d = ""; c > b; b++)d += a[b].value; return d } function ra(a, b, c) { var d = b.dir, e = c && "parentNode" === d, f = x++; return b.first ? function (b, c, f) { while (b = b[d]) if (1 === b.nodeType || e) return a(b, c, f) } : function (b, c, g) { var h, i, j, k = [w, f]; if (g) { while (b = b[d]) if ((1 === b.nodeType || e) && a(b, c, g)) return !0 } else while (b = b[d]) if (1 === b.nodeType || e) { if (j = b[u] || (b[u] = {}), i = j[b.uniqueID] || (j[b.uniqueID] = {}), (h = i[d]) && h[0] === w && h[1] === f) return k[2] = h[2]; if (i[d] = k, k[2] = a(b, c, g)) return !0 } } } function sa(a) { return a.length > 1 ? function (b, c, d) { var e = a.length; while (e--) if (!a[e](b, c, d)) return !1; return !0 } : a[0] } function ta(a, b, c) { for (var d = 0, e = b.length; e > d; d++)fa(a, b[d], c); return c } function ua(a, b, c, d, e) { for (var f, g = [], h = 0, i = a.length, j = null != b; i > h; h++)(f = a[h]) && (c && !c(f, d, e) || (g.push(f), j && b.push(h))); return g } function va(a, b, c, d, e, f) { return d && !d[u] && (d = va(d)), e && !e[u] && (e = va(e, f)), ha(function (f, g, h, i) { var j, k, l, m = [], n = [], o = g.length, p = f || ta(b || "*", h.nodeType ? [h] : h, []), q = !a || !f && b ? p : ua(p, m, a, h, i), r = c ? e || (f ? a : o || d) ? [] : g : q; if (c && c(q, r, h, i), d) { j = ua(r, n), d(j, [], h, i), k = j.length; while (k--) (l = j[k]) && (r[n[k]] = !(q[n[k]] = l)) } if (f) { if (e || a) { if (e) { j = [], k = r.length; while (k--) (l = r[k]) && j.push(q[k] = l); e(null, r = [], j, i) } k = r.length; while (k--) (l = r[k]) && (j = e ? J(f, l) : m[k]) > -1 && (f[j] = !(g[j] = l)) } } else r = ua(r === g ? r.splice(o, r.length) : r), e ? e(null, g, r, i) : H.apply(g, r) }) } function wa(a) { for (var b, c, e, f = a.length, g = d.relative[a[0].type], h = g || d.relative[" "], i = g ? 1 : 0, k = ra(function (a) { return a === b }, h, !0), l = ra(function (a) { return J(b, a) > -1 }, h, !0), m = [function (a, c, d) { var e = !g && (d || c !== j) || ((b = c).nodeType ? k(a, c, d) : l(a, c, d)); return b = null, e }]; f > i; i++)if (c = d.relative[a[i].type]) m = [ra(sa(m), c)]; else { if (c = d.filter[a[i].type].apply(null, a[i].matches), c[u]) { for (e = ++i; f > e; e++)if (d.relative[a[e].type]) break; return va(i > 1 && sa(m), i > 1 && qa(a.slice(0, i - 1).concat({ value: " " === a[i - 2].type ? "*" : "" })).replace(Q, "$1"), c, e > i && wa(a.slice(i, e)), f > e && wa(a = a.slice(e)), f > e && qa(a)) } m.push(c) } return sa(m) } function xa(a, b) { var c = b.length > 0, e = a.length > 0, f = function (f, g, h, i, k) { var l, o, q, r = 0, s = "0", t = f && [], u = [], v = j, x = f || e && d.find.TAG("*", k), y = w += null == v ? 1 : Math.random() || .1, z = x.length; for (k && (j = g === n || g || k); s !== z && null != (l = x[s]); s++) { if (e && l) { o = 0, g || l.ownerDocument === n || (m(l), h = !p); while (q = a[o++]) if (q(l, g || n, h)) { i.push(l); break } k && (w = y) } c && ((l = !q && l) && r-- , f && t.push(l)) } if (r += s, c && s !== r) { o = 0; while (q = b[o++]) q(t, u, g, h); if (f) { if (r > 0) while (s--) t[s] || u[s] || (u[s] = F.call(i)); u = ua(u) } H.apply(i, u), k && !f && u.length > 0 && r + b.length > 1 && fa.uniqueSort(i) } return k && (w = y, j = v), t }; return c ? ha(f) : f } return h = fa.compile = function (a, b) { var c, d = [], e = [], f = A[a + " "]; if (!f) { b || (b = g(a)), c = b.length; while (c--) f = wa(b[c]), f[u] ? d.push(f) : e.push(f); f = A(a, xa(e, d)), f.selector = a } return f }, i = fa.select = function (a, b, e, f) { var i, j, k, l, m, n = "function" == typeof a && a, o = !f && g(a = n.selector || a); if (e = e || [], 1 === o.length) { if (j = o[0] = o[0].slice(0), j.length > 2 && "ID" === (k = j[0]).type && c.getById && 9 === b.nodeType && p && d.relative[j[1].type]) { if (b = (d.find.ID(k.matches[0].replace(ba, ca), b) || [])[0], !b) return e; n && (b = b.parentNode), a = a.slice(j.shift().value.length) } i = W.needsContext.test(a) ? 0 : j.length; while (i--) { if (k = j[i], d.relative[l = k.type]) break; if ((m = d.find[l]) && (f = m(k.matches[0].replace(ba, ca), _.test(j[0].type) && oa(b.parentNode) || b))) { if (j.splice(i, 1), a = f.length && qa(j), !a) return H.apply(e, f), e; break } } } return (n || h(a, o))(f, b, !p, e, !b || _.test(a) && oa(b.parentNode) || b), e }, c.sortStable = u.split("").sort(B).join("") === u, c.detectDuplicates = !!l, m(), c.sortDetached = ia(function (a) { return 1 & a.compareDocumentPosition(n.createElement("div")) }), ia(function (a) { return a.innerHTML = "<a href='#'></a>", "#" === a.firstChild.getAttribute("href") }) || ja("type|href|height|width", function (a, b, c) { return c ? void 0 : a.getAttribute(b, "type" === b.toLowerCase() ? 1 : 2) }), c.attributes && ia(function (a) { return a.innerHTML = "<input/>", a.firstChild.setAttribute("value", ""), "" === a.firstChild.getAttribute("value") }) || ja("value", function (a, b, c) { return c || "input" !== a.nodeName.toLowerCase() ? void 0 : a.defaultValue }), ia(function (a) { return null == a.getAttribute("disabled") }) || ja(K, function (a, b, c) { var d; return c ? void 0 : a[b] === !0 ? b.toLowerCase() : (d = a.getAttributeNode(b)) && d.specified ? d.value : null }), fa }(a); n.find = t, n.expr = t.selectors, n.expr[":"] = n.expr.pseudos, n.uniqueSort = n.unique = t.uniqueSort, n.text = t.getText, n.isXMLDoc = t.isXML, n.contains = t.contains; var u = function (a, b, c) { var d = [], e = void 0 !== c; while ((a = a[b]) && 9 !== a.nodeType) if (1 === a.nodeType) { if (e && n(a).is(c)) break; d.push(a) } return d }, v = function (a, b) { for (var c = []; a; a = a.nextSibling)1 === a.nodeType && a !== b && c.push(a); return c }, w = n.expr.match.needsContext, x = /^<([\w-]+)\s*\/?>(?:<\/\1>|)$/, y = /^.[^:#\[\.,]*$/; function z(a, b, c) { if (n.isFunction(b)) return n.grep(a, function (a, d) { return !!b.call(a, d, a) !== c }); if (b.nodeType) return n.grep(a, function (a) { return a === b !== c }); if ("string" == typeof b) { if (y.test(b)) return n.filter(b, a, c); b = n.filter(b, a) } return n.grep(a, function (a) { return n.inArray(a, b) > -1 !== c }) } n.filter = function (a, b, c) { var d = b[0]; return c && (a = ":not(" + a + ")"), 1 === b.length && 1 === d.nodeType ? n.find.matchesSelector(d, a) ? [d] : [] : n.find.matches(a, n.grep(b, function (a) { return 1 === a.nodeType })) }, n.fn.extend({ find: function (a) { var b, c = [], d = this, e = d.length; if ("string" != typeof a) return this.pushStack(n(a).filter(function () { for (b = 0; e > b; b++)if (n.contains(d[b], this)) return !0 })); for (b = 0; e > b; b++)n.find(a, d[b], c); return c = this.pushStack(e > 1 ? n.unique(c) : c), c.selector = this.selector ? this.selector + " " + a : a, c }, filter: function (a) { return this.pushStack(z(this, a || [], !1)) }, not: function (a) { return this.pushStack(z(this, a || [], !0)) }, is: function (a) { return !!z(this, "string" == typeof a && w.test(a) ? n(a) : a || [], !1).length } }); var A, B = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/, C = n.fn.init = function (a, b, c) { var e, f; if (!a) return this; if (c = c || A, "string" == typeof a) { if (e = "<" === a.charAt(0) && ">" === a.charAt(a.length - 1) && a.length >= 3 ? [null, a, null] : B.exec(a), !e || !e[1] && b) return !b || b.jquery ? (b || c).find(a) : this.constructor(b).find(a); if (e[1]) { if (b = b instanceof n ? b[0] : b, n.merge(this, n.parseHTML(e[1], b && b.nodeType ? b.ownerDocument || b : d, !0)), x.test(e[1]) && n.isPlainObject(b)) for (e in b) n.isFunction(this[e]) ? this[e](b[e]) : this.attr(e, b[e]); return this } if (f = d.getElementById(e[2]), f && f.parentNode) { if (f.id !== e[2]) return A.find(a); this.length = 1, this[0] = f } return this.context = d, this.selector = a, this } return a.nodeType ? (this.context = this[0] = a, this.length = 1, this) : n.isFunction(a) ? "undefined" != typeof c.ready ? c.ready(a) : a(n) : (void 0 !== a.selector && (this.selector = a.selector, this.context = a.context), n.makeArray(a, this)) }; C.prototype = n.fn, A = n(d); var D = /^(?:parents|prev(?:Until|All))/, E = { children: !0, contents: !0, next: !0, prev: !0 }; n.fn.extend({ has: function (a) { var b, c = n(a, this), d = c.length; return this.filter(function () { for (b = 0; d > b; b++)if (n.contains(this, c[b])) return !0 }) }, closest: function (a, b) { for (var c, d = 0, e = this.length, f = [], g = w.test(a) || "string" != typeof a ? n(a, b || this.context) : 0; e > d; d++)for (c = this[d]; c && c !== b; c = c.parentNode)if (c.nodeType < 11 && (g ? g.index(c) > -1 : 1 === c.nodeType && n.find.matchesSelector(c, a))) { f.push(c); break } return this.pushStack(f.length > 1 ? n.uniqueSort(f) : f) }, index: function (a) { return a ? "string" == typeof a ? n.inArray(this[0], n(a)) : n.inArray(a.jquery ? a[0] : a, this) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1 }, add: function (a, b) { return this.pushStack(n.uniqueSort(n.merge(this.get(), n(a, b)))) }, addBack: function (a) { return this.add(null == a ? this.prevObject : this.prevObject.filter(a)) } }); function F(a, b) { do a = a[b]; while (a && 1 !== a.nodeType); return a } n.each({ parent: function (a) { var b = a.parentNode; return b && 11 !== b.nodeType ? b : null }, parents: function (a) { return u(a, "parentNode") }, parentsUntil: function (a, b, c) { return u(a, "parentNode", c) }, next: function (a) { return F(a, "nextSibling") }, prev: function (a) { return F(a, "previousSibling") }, nextAll: function (a) { return u(a, "nextSibling") }, prevAll: function (a) { return u(a, "previousSibling") }, nextUntil: function (a, b, c) { return u(a, "nextSibling", c) }, prevUntil: function (a, b, c) { return u(a, "previousSibling", c) }, siblings: function (a) { return v((a.parentNode || {}).firstChild, a) }, children: function (a) { return v(a.firstChild) }, contents: function (a) { return n.nodeName(a, "iframe") ? a.contentDocument || a.contentWindow.document : n.merge([], a.childNodes) } }, function (a, b) { n.fn[a] = function (c, d) { var e = n.map(this, b, c); return "Until" !== a.slice(-5) && (d = c), d && "string" == typeof d && (e = n.filter(d, e)), this.length > 1 && (E[a] || (e = n.uniqueSort(e)), D.test(a) && (e = e.reverse())), this.pushStack(e) } }); var G = /\S+/g; function H(a) { var b = {}; return n.each(a.match(G) || [], function (a, c) { b[c] = !0 }), b } n.Callbacks = function (a) { a = "string" == typeof a ? H(a) : n.extend({}, a); var b, c, d, e, f = [], g = [], h = -1, i = function () { for (e = a.once, d = b = !0; g.length; h = -1) { c = g.shift(); while (++h < f.length) f[h].apply(c[0], c[1]) === !1 && a.stopOnFalse && (h = f.length, c = !1) } a.memory || (c = !1), b = !1, e && (f = c ? [] : "") }, j = { add: function () { return f && (c && !b && (h = f.length - 1, g.push(c)), function d(b) { n.each(b, function (b, c) { n.isFunction(c) ? a.unique && j.has(c) || f.push(c) : c && c.length && "string" !== n.type(c) && d(c) }) }(arguments), c && !b && i()), this }, remove: function () { return n.each(arguments, function (a, b) { var c; while ((c = n.inArray(b, f, c)) > -1) f.splice(c, 1), h >= c && h-- }), this }, has: function (a) { return a ? n.inArray(a, f) > -1 : f.length > 0 }, empty: function () { return f && (f = []), this }, disable: function () { return e = g = [], f = c = "", this }, disabled: function () { return !f }, lock: function () { return e = !0, c || j.disable(), this }, locked: function () { return !!e }, fireWith: function (a, c) { return e || (c = c || [], c = [a, c.slice ? c.slice() : c], g.push(c), b || i()), this }, fire: function () { return j.fireWith(this, arguments), this }, fired: function () { return !!d } }; return j }, n.extend({ Deferred: function (a) { var b = [["resolve", "done", n.Callbacks("once memory"), "resolved"], ["reject", "fail", n.Callbacks("once memory"), "rejected"], ["notify", "progress", n.Callbacks("memory")]], c = "pending", d = { state: function () { return c }, always: function () { return e.done(arguments).fail(arguments), this }, then: function () { var a = arguments; return n.Deferred(function (c) { n.each(b, function (b, f) { var g = n.isFunction(a[b]) && a[b]; e[f[1]](function () { var a = g && g.apply(this, arguments); a && n.isFunction(a.promise) ? a.promise().progress(c.notify).done(c.resolve).fail(c.reject) : c[f[0] + "With"](this === d ? c.promise() : this, g ? [a] : arguments) }) }), a = null }).promise() }, promise: function (a) { return null != a ? n.extend(a, d) : d } }, e = {}; return d.pipe = d.then, n.each(b, function (a, f) { var g = f[2], h = f[3]; d[f[1]] = g.add, h && g.add(function () { c = h }, b[1 ^ a][2].disable, b[2][2].lock), e[f[0]] = function () { return e[f[0] + "With"](this === e ? d : this, arguments), this }, e[f[0] + "With"] = g.fireWith }), d.promise(e), a && a.call(e, e), e }, when: function (a) { var b = 0, c = e.call(arguments), d = c.length, f = 1 !== d || a && n.isFunction(a.promise) ? d : 0, g = 1 === f ? a : n.Deferred(), h = function (a, b, c) { return function (d) { b[a] = this, c[a] = arguments.length > 1 ? e.call(arguments) : d, c === i ? g.notifyWith(b, c) : --f || g.resolveWith(b, c) } }, i, j, k; if (d > 1) for (i = new Array(d), j = new Array(d), k = new Array(d); d > b; b++)c[b] && n.isFunction(c[b].promise) ? c[b].promise().progress(h(b, j, i)).done(h(b, k, c)).fail(g.reject) : --f; return f || g.resolveWith(k, c), g.promise() } }); var I; n.fn.ready = function (a) { return n.ready.promise().done(a), this }, n.extend({ isReady: !1, readyWait: 1, holdReady: function (a) { a ? n.readyWait++ : n.ready(!0) }, ready: function (a) { (a === !0 ? --n.readyWait : n.isReady) || (n.isReady = !0, a !== !0 && --n.readyWait > 0 || (I.resolveWith(d, [n]), n.fn.triggerHandler && (n(d).triggerHandler("ready"), n(d).off("ready")))) } }); function J() { d.addEventListener ? (d.removeEventListener("DOMContentLoaded", K), a.removeEventListener("load", K)) : (d.detachEvent("onreadystatechange", K), a.detachEvent("onload", K)) } function K() { (d.addEventListener || "load" === a.event.type || "complete" === d.readyState) && (J(), n.ready()) } n.ready.promise = function (b) { if (!I) if (I = n.Deferred(), "complete" === d.readyState || "loading" !== d.readyState && !d.documentElement.doScroll) a.setTimeout(n.ready); else if (d.addEventListener) d.addEventListener("DOMContentLoaded", K), a.addEventListener("load", K); else { d.attachEvent("onreadystatechange", K), a.attachEvent("onload", K); var c = !1; try { c = null == a.frameElement && d.documentElement } catch (e) { } c && c.doScroll && !function f() { if (!n.isReady) { try { c.doScroll("left") } catch (b) { return a.setTimeout(f, 50) } J(), n.ready() } }() } return I.promise(b) }, n.ready.promise(); var L; for (L in n(l)) break; l.ownFirst = "0" === L, l.inlineBlockNeedsLayout = !1, n(function () { var a, b, c, e; c = d.getElementsByTagName("body")[0], c && c.style && (b = d.createElement("div"), e = d.createElement("div"), e.style.cssText = "position:absolute;border:0;width:0;height:0;top:0;left:-9999px", c.appendChild(e).appendChild(b), "undefined" != typeof b.style.zoom && (b.style.cssText = "display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1", l.inlineBlockNeedsLayout = a = 3 === b.offsetWidth, a && (c.style.zoom = 1)), c.removeChild(e)) }), function () { var a = d.createElement("div"); l.deleteExpando = !0; try { delete a.test } catch (b) { l.deleteExpando = !1 } a = null }(); var M = function (a) { var b = n.noData[(a.nodeName + " ").toLowerCase()], c = +a.nodeType || 1; return 1 !== c && 9 !== c ? !1 : !b || b !== !0 && a.getAttribute("classid") === b }, N = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/, O = /([A-Z])/g; function P(a, b, c) {
        if (void 0 === c && 1 === a.nodeType) {
            var d = "data-" + b.replace(O, "-$1").toLowerCase(); if (c = a.getAttribute(d), "string" == typeof c) { try { c = "true" === c ? !0 : "false" === c ? !1 : "null" === c ? null : +c + "" === c ? +c : N.test(c) ? n.parseJSON(c) : c } catch (e) { } n.data(a, b, c) } else c = void 0;
        } return c
    } function Q(a) { var b; for (b in a) if (("data" !== b || !n.isEmptyObject(a[b])) && "toJSON" !== b) return !1; return !0 } function R(a, b, d, e) { if (M(a)) { var f, g, h = n.expando, i = a.nodeType, j = i ? n.cache : a, k = i ? a[h] : a[h] && h; if (k && j[k] && (e || j[k].data) || void 0 !== d || "string" != typeof b) return k || (k = i ? a[h] = c.pop() || n.guid++ : h), j[k] || (j[k] = i ? {} : { toJSON: n.noop }), "object" != typeof b && "function" != typeof b || (e ? j[k] = n.extend(j[k], b) : j[k].data = n.extend(j[k].data, b)), g = j[k], e || (g.data || (g.data = {}), g = g.data), void 0 !== d && (g[n.camelCase(b)] = d), "string" == typeof b ? (f = g[b], null == f && (f = g[n.camelCase(b)])) : f = g, f } } function S(a, b, c) { if (M(a)) { var d, e, f = a.nodeType, g = f ? n.cache : a, h = f ? a[n.expando] : n.expando; if (g[h]) { if (b && (d = c ? g[h] : g[h].data)) { n.isArray(b) ? b = b.concat(n.map(b, n.camelCase)) : b in d ? b = [b] : (b = n.camelCase(b), b = b in d ? [b] : b.split(" ")), e = b.length; while (e--) delete d[b[e]]; if (c ? !Q(d) : !n.isEmptyObject(d)) return } (c || (delete g[h].data, Q(g[h]))) && (f ? n.cleanData([a], !0) : l.deleteExpando || g != g.window ? delete g[h] : g[h] = void 0) } } } n.extend({ cache: {}, noData: { "applet ": !0, "embed ": !0, "object ": "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" }, hasData: function (a) { return a = a.nodeType ? n.cache[a[n.expando]] : a[n.expando], !!a && !Q(a) }, data: function (a, b, c) { return R(a, b, c) }, removeData: function (a, b) { return S(a, b) }, _data: function (a, b, c) { return R(a, b, c, !0) }, _removeData: function (a, b) { return S(a, b, !0) } }), n.fn.extend({ data: function (a, b) { var c, d, e, f = this[0], g = f && f.attributes; if (void 0 === a) { if (this.length && (e = n.data(f), 1 === f.nodeType && !n._data(f, "parsedAttrs"))) { c = g.length; while (c--) g[c] && (d = g[c].name, 0 === d.indexOf("data-") && (d = n.camelCase(d.slice(5)), P(f, d, e[d]))); n._data(f, "parsedAttrs", !0) } return e } return "object" == typeof a ? this.each(function () { n.data(this, a) }) : arguments.length > 1 ? this.each(function () { n.data(this, a, b) }) : f ? P(f, a, n.data(f, a)) : void 0 }, removeData: function (a) { return this.each(function () { n.removeData(this, a) }) } }), n.extend({ queue: function (a, b, c) { var d; return a ? (b = (b || "fx") + "queue", d = n._data(a, b), c && (!d || n.isArray(c) ? d = n._data(a, b, n.makeArray(c)) : d.push(c)), d || []) : void 0 }, dequeue: function (a, b) { b = b || "fx"; var c = n.queue(a, b), d = c.length, e = c.shift(), f = n._queueHooks(a, b), g = function () { n.dequeue(a, b) }; "inprogress" === e && (e = c.shift(), d--), e && ("fx" === b && c.unshift("inprogress"), delete f.stop, e.call(a, g, f)), !d && f && f.empty.fire() }, _queueHooks: function (a, b) { var c = b + "queueHooks"; return n._data(a, c) || n._data(a, c, { empty: n.Callbacks("once memory").add(function () { n._removeData(a, b + "queue"), n._removeData(a, c) }) }) } }), n.fn.extend({ queue: function (a, b) { var c = 2; return "string" != typeof a && (b = a, a = "fx", c--), arguments.length < c ? n.queue(this[0], a) : void 0 === b ? this : this.each(function () { var c = n.queue(this, a, b); n._queueHooks(this, a), "fx" === a && "inprogress" !== c[0] && n.dequeue(this, a) }) }, dequeue: function (a) { return this.each(function () { n.dequeue(this, a) }) }, clearQueue: function (a) { return this.queue(a || "fx", []) }, promise: function (a, b) { var c, d = 1, e = n.Deferred(), f = this, g = this.length, h = function () { --d || e.resolveWith(f, [f]) }; "string" != typeof a && (b = a, a = void 0), a = a || "fx"; while (g--) c = n._data(f[g], a + "queueHooks"), c && c.empty && (d++ , c.empty.add(h)); return h(), e.promise(b) } }), function () { var a; l.shrinkWrapBlocks = function () { if (null != a) return a; a = !1; var b, c, e; return c = d.getElementsByTagName("body")[0], c && c.style ? (b = d.createElement("div"), e = d.createElement("div"), e.style.cssText = "position:absolute;border:0;width:0;height:0;top:0;left:-9999px", c.appendChild(e).appendChild(b), "undefined" != typeof b.style.zoom && (b.style.cssText = "-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1", b.appendChild(d.createElement("div")).style.width = "5px", a = 3 !== b.offsetWidth), c.removeChild(e), a) : void 0 } }(); var T = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source, U = new RegExp("^(?:([+-])=|)(" + T + ")([a-z%]*)$", "i"), V = ["Top", "Right", "Bottom", "Left"], W = function (a, b) { return a = b || a, "none" === n.css(a, "display") || !n.contains(a.ownerDocument, a) }; function X(a, b, c, d) { var e, f = 1, g = 20, h = d ? function () { return d.cur() } : function () { return n.css(a, b, "") }, i = h(), j = c && c[3] || (n.cssNumber[b] ? "" : "px"), k = (n.cssNumber[b] || "px" !== j && +i) && U.exec(n.css(a, b)); if (k && k[3] !== j) { j = j || k[3], c = c || [], k = +i || 1; do f = f || ".5", k /= f, n.style(a, b, k + j); while (f !== (f = h() / i) && 1 !== f && --g) } return c && (k = +k || +i || 0, e = c[1] ? k + (c[1] + 1) * c[2] : +c[2], d && (d.unit = j, d.start = k, d.end = e)), e } var Y = function (a, b, c, d, e, f, g) { var h = 0, i = a.length, j = null == c; if ("object" === n.type(c)) { e = !0; for (h in c) Y(a, b, h, c[h], !0, f, g) } else if (void 0 !== d && (e = !0, n.isFunction(d) || (g = !0), j && (g ? (b.call(a, d), b = null) : (j = b, b = function (a, b, c) { return j.call(n(a), c) })), b)) for (; i > h; h++)b(a[h], c, g ? d : d.call(a[h], h, b(a[h], c))); return e ? a : j ? b.call(a) : i ? b(a[0], c) : f }, Z = /^(?:checkbox|radio)$/i, $ = /<([\w:-]+)/, _ = /^$|\/(?:java|ecma)script/i, aa = /^\s+/, ba = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video"; function ca(a) { var b = ba.split("|"), c = a.createDocumentFragment(); if (c.createElement) while (b.length) c.createElement(b.pop()); return c } !function () { var a = d.createElement("div"), b = d.createDocumentFragment(), c = d.createElement("input"); a.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", l.leadingWhitespace = 3 === a.firstChild.nodeType, l.tbody = !a.getElementsByTagName("tbody").length, l.htmlSerialize = !!a.getElementsByTagName("link").length, l.html5Clone = "<:nav></:nav>" !== d.createElement("nav").cloneNode(!0).outerHTML, c.type = "checkbox", c.checked = !0, b.appendChild(c), l.appendChecked = c.checked, a.innerHTML = "<textarea>x</textarea>", l.noCloneChecked = !!a.cloneNode(!0).lastChild.defaultValue, b.appendChild(a), c = d.createElement("input"), c.setAttribute("type", "radio"), c.setAttribute("checked", "checked"), c.setAttribute("name", "t"), a.appendChild(c), l.checkClone = a.cloneNode(!0).cloneNode(!0).lastChild.checked, l.noCloneEvent = !!a.addEventListener, a[n.expando] = 1, l.attributes = !a.getAttribute(n.expando) }(); var da = { option: [1, "<select multiple='multiple'>", "</select>"], legend: [1, "<fieldset>", "</fieldset>"], area: [1, "<map>", "</map>"], param: [1, "<object>", "</object>"], thead: [1, "<table>", "</table>"], tr: [2, "<table><tbody>", "</tbody></table>"], col: [2, "<table><tbody></tbody><colgroup>", "</colgroup></table>"], td: [3, "<table><tbody><tr>", "</tr></tbody></table>"], _default: l.htmlSerialize ? [0, "", ""] : [1, "X<div>", "</div>"] }; da.optgroup = da.option, da.tbody = da.tfoot = da.colgroup = da.caption = da.thead, da.th = da.td; function ea(a, b) { var c, d, e = 0, f = "undefined" != typeof a.getElementsByTagName ? a.getElementsByTagName(b || "*") : "undefined" != typeof a.querySelectorAll ? a.querySelectorAll(b || "*") : void 0; if (!f) for (f = [], c = a.childNodes || a; null != (d = c[e]); e++)!b || n.nodeName(d, b) ? f.push(d) : n.merge(f, ea(d, b)); return void 0 === b || b && n.nodeName(a, b) ? n.merge([a], f) : f } function fa(a, b) { for (var c, d = 0; null != (c = a[d]); d++)n._data(c, "globalEval", !b || n._data(b[d], "globalEval")) } var ga = /<|&#?\w+;/, ha = /<tbody/i; function ia(a) { Z.test(a.type) && (a.defaultChecked = a.checked) } function ja(a, b, c, d, e) { for (var f, g, h, i, j, k, m, o = a.length, p = ca(b), q = [], r = 0; o > r; r++)if (g = a[r], g || 0 === g) if ("object" === n.type(g)) n.merge(q, g.nodeType ? [g] : g); else if (ga.test(g)) { i = i || p.appendChild(b.createElement("div")), j = ($.exec(g) || ["", ""])[1].toLowerCase(), m = da[j] || da._default, i.innerHTML = m[1] + n.htmlPrefilter(g) + m[2], f = m[0]; while (f--) i = i.lastChild; if (!l.leadingWhitespace && aa.test(g) && q.push(b.createTextNode(aa.exec(g)[0])), !l.tbody) { g = "table" !== j || ha.test(g) ? "<table>" !== m[1] || ha.test(g) ? 0 : i : i.firstChild, f = g && g.childNodes.length; while (f--) n.nodeName(k = g.childNodes[f], "tbody") && !k.childNodes.length && g.removeChild(k) } n.merge(q, i.childNodes), i.textContent = ""; while (i.firstChild) i.removeChild(i.firstChild); i = p.lastChild } else q.push(b.createTextNode(g)); i && p.removeChild(i), l.appendChecked || n.grep(ea(q, "input"), ia), r = 0; while (g = q[r++]) if (d && n.inArray(g, d) > -1) e && e.push(g); else if (h = n.contains(g.ownerDocument, g), i = ea(p.appendChild(g), "script"), h && fa(i), c) { f = 0; while (g = i[f++]) _.test(g.type || "") && c.push(g) } return i = null, p } !function () { var b, c, e = d.createElement("div"); for (b in { submit: !0, change: !0, focusin: !0 }) c = "on" + b, (l[b] = c in a) || (e.setAttribute(c, "t"), l[b] = e.attributes[c].expando === !1); e = null }(); var ka = /^(?:input|select|textarea)$/i, la = /^key/, ma = /^(?:mouse|pointer|contextmenu|drag|drop)|click/, na = /^(?:focusinfocus|focusoutblur)$/, oa = /^([^.]*)(?:\.(.+)|)/; function pa() { return !0 } function qa() { return !1 } function ra() { try { return d.activeElement } catch (a) { } } function sa(a, b, c, d, e, f) { var g, h; if ("object" == typeof b) { "string" != typeof c && (d = d || c, c = void 0); for (h in b) sa(a, h, c, d, b[h], f); return a } if (null == d && null == e ? (e = c, d = c = void 0) : null == e && ("string" == typeof c ? (e = d, d = void 0) : (e = d, d = c, c = void 0)), e === !1) e = qa; else if (!e) return a; return 1 === f && (g = e, e = function (a) { return n().off(a), g.apply(this, arguments) }, e.guid = g.guid || (g.guid = n.guid++)), a.each(function () { n.event.add(this, b, e, d, c) }) } n.event = { global: {}, add: function (a, b, c, d, e) { var f, g, h, i, j, k, l, m, o, p, q, r = n._data(a); if (r) { c.handler && (i = c, c = i.handler, e = i.selector), c.guid || (c.guid = n.guid++), (g = r.events) || (g = r.events = {}), (k = r.handle) || (k = r.handle = function (a) { return "undefined" == typeof n || a && n.event.triggered === a.type ? void 0 : n.event.dispatch.apply(k.elem, arguments) }, k.elem = a), b = (b || "").match(G) || [""], h = b.length; while (h--) f = oa.exec(b[h]) || [], o = q = f[1], p = (f[2] || "").split(".").sort(), o && (j = n.event.special[o] || {}, o = (e ? j.delegateType : j.bindType) || o, j = n.event.special[o] || {}, l = n.extend({ type: o, origType: q, data: d, handler: c, guid: c.guid, selector: e, needsContext: e && n.expr.match.needsContext.test(e), namespace: p.join(".") }, i), (m = g[o]) || (m = g[o] = [], m.delegateCount = 0, j.setup && j.setup.call(a, d, p, k) !== !1 || (a.addEventListener ? a.addEventListener(o, k, !1) : a.attachEvent && a.attachEvent("on" + o, k))), j.add && (j.add.call(a, l), l.handler.guid || (l.handler.guid = c.guid)), e ? m.splice(m.delegateCount++, 0, l) : m.push(l), n.event.global[o] = !0); a = null } }, remove: function (a, b, c, d, e) { var f, g, h, i, j, k, l, m, o, p, q, r = n.hasData(a) && n._data(a); if (r && (k = r.events)) { b = (b || "").match(G) || [""], j = b.length; while (j--) if (h = oa.exec(b[j]) || [], o = q = h[1], p = (h[2] || "").split(".").sort(), o) { l = n.event.special[o] || {}, o = (d ? l.delegateType : l.bindType) || o, m = k[o] || [], h = h[2] && new RegExp("(^|\\.)" + p.join("\\.(?:.*\\.|)") + "(\\.|$)"), i = f = m.length; while (f--) g = m[f], !e && q !== g.origType || c && c.guid !== g.guid || h && !h.test(g.namespace) || d && d !== g.selector && ("**" !== d || !g.selector) || (m.splice(f, 1), g.selector && m.delegateCount-- , l.remove && l.remove.call(a, g)); i && !m.length && (l.teardown && l.teardown.call(a, p, r.handle) !== !1 || n.removeEvent(a, o, r.handle), delete k[o]) } else for (o in k) n.event.remove(a, o + b[j], c, d, !0); n.isEmptyObject(k) && (delete r.handle, n._removeData(a, "events")) } }, trigger: function (b, c, e, f) { var g, h, i, j, l, m, o, p = [e || d], q = k.call(b, "type") ? b.type : b, r = k.call(b, "namespace") ? b.namespace.split(".") : []; if (i = m = e = e || d, 3 !== e.nodeType && 8 !== e.nodeType && !na.test(q + n.event.triggered) && (q.indexOf(".") > -1 && (r = q.split("."), q = r.shift(), r.sort()), h = q.indexOf(":") < 0 && "on" + q, b = b[n.expando] ? b : new n.Event(q, "object" == typeof b && b), b.isTrigger = f ? 2 : 3, b.namespace = r.join("."), b.rnamespace = b.namespace ? new RegExp("(^|\\.)" + r.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, b.result = void 0, b.target || (b.target = e), c = null == c ? [b] : n.makeArray(c, [b]), l = n.event.special[q] || {}, f || !l.trigger || l.trigger.apply(e, c) !== !1)) { if (!f && !l.noBubble && !n.isWindow(e)) { for (j = l.delegateType || q, na.test(j + q) || (i = i.parentNode); i; i = i.parentNode)p.push(i), m = i; m === (e.ownerDocument || d) && p.push(m.defaultView || m.parentWindow || a) } o = 0; while ((i = p[o++]) && !b.isPropagationStopped()) b.type = o > 1 ? j : l.bindType || q, g = (n._data(i, "events") || {})[b.type] && n._data(i, "handle"), g && g.apply(i, c), g = h && i[h], g && g.apply && M(i) && (b.result = g.apply(i, c), b.result === !1 && b.preventDefault()); if (b.type = q, !f && !b.isDefaultPrevented() && (!l._default || l._default.apply(p.pop(), c) === !1) && M(e) && h && e[q] && !n.isWindow(e)) { m = e[h], m && (e[h] = null), n.event.triggered = q; try { e[q]() } catch (s) { } n.event.triggered = void 0, m && (e[h] = m) } return b.result } }, dispatch: function (a) { a = n.event.fix(a); var b, c, d, f, g, h = [], i = e.call(arguments), j = (n._data(this, "events") || {})[a.type] || [], k = n.event.special[a.type] || {}; if (i[0] = a, a.delegateTarget = this, !k.preDispatch || k.preDispatch.call(this, a) !== !1) { h = n.event.handlers.call(this, a, j), b = 0; while ((f = h[b++]) && !a.isPropagationStopped()) { a.currentTarget = f.elem, c = 0; while ((g = f.handlers[c++]) && !a.isImmediatePropagationStopped()) a.rnamespace && !a.rnamespace.test(g.namespace) || (a.handleObj = g, a.data = g.data, d = ((n.event.special[g.origType] || {}).handle || g.handler).apply(f.elem, i), void 0 !== d && (a.result = d) === !1 && (a.preventDefault(), a.stopPropagation())) } return k.postDispatch && k.postDispatch.call(this, a), a.result } }, handlers: function (a, b) { var c, d, e, f, g = [], h = b.delegateCount, i = a.target; if (h && i.nodeType && ("click" !== a.type || isNaN(a.button) || a.button < 1)) for (; i != this; i = i.parentNode || this)if (1 === i.nodeType && (i.disabled !== !0 || "click" !== a.type)) { for (d = [], c = 0; h > c; c++)f = b[c], e = f.selector + " ", void 0 === d[e] && (d[e] = f.needsContext ? n(e, this).index(i) > -1 : n.find(e, this, null, [i]).length), d[e] && d.push(f); d.length && g.push({ elem: i, handlers: d }) } return h < b.length && g.push({ elem: this, handlers: b.slice(h) }), g }, fix: function (a) { if (a[n.expando]) return a; var b, c, e, f = a.type, g = a, h = this.fixHooks[f]; h || (this.fixHooks[f] = h = ma.test(f) ? this.mouseHooks : la.test(f) ? this.keyHooks : {}), e = h.props ? this.props.concat(h.props) : this.props, a = new n.Event(g), b = e.length; while (b--) c = e[b], a[c] = g[c]; return a.target || (a.target = g.srcElement || d), 3 === a.target.nodeType && (a.target = a.target.parentNode), a.metaKey = !!a.metaKey, h.filter ? h.filter(a, g) : a }, props: "altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "), fixHooks: {}, keyHooks: { props: "char charCode key keyCode".split(" "), filter: function (a, b) { return null == a.which && (a.which = null != b.charCode ? b.charCode : b.keyCode), a } }, mouseHooks: { props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "), filter: function (a, b) { var c, e, f, g = b.button, h = b.fromElement; return null == a.pageX && null != b.clientX && (e = a.target.ownerDocument || d, f = e.documentElement, c = e.body, a.pageX = b.clientX + (f && f.scrollLeft || c && c.scrollLeft || 0) - (f && f.clientLeft || c && c.clientLeft || 0), a.pageY = b.clientY + (f && f.scrollTop || c && c.scrollTop || 0) - (f && f.clientTop || c && c.clientTop || 0)), !a.relatedTarget && h && (a.relatedTarget = h === a.target ? b.toElement : h), a.which || void 0 === g || (a.which = 1 & g ? 1 : 2 & g ? 3 : 4 & g ? 2 : 0), a } }, special: { load: { noBubble: !0 }, focus: { trigger: function () { if (this !== ra() && this.focus) try { return this.focus(), !1 } catch (a) { } }, delegateType: "focusin" }, blur: { trigger: function () { return this === ra() && this.blur ? (this.blur(), !1) : void 0 }, delegateType: "focusout" }, click: { trigger: function () { return n.nodeName(this, "input") && "checkbox" === this.type && this.click ? (this.click(), !1) : void 0 }, _default: function (a) { return n.nodeName(a.target, "a") } }, beforeunload: { postDispatch: function (a) { void 0 !== a.result && a.originalEvent && (a.originalEvent.returnValue = a.result) } } }, simulate: function (a, b, c) { var d = n.extend(new n.Event, c, { type: a, isSimulated: !0 }); n.event.trigger(d, null, b), d.isDefaultPrevented() && c.preventDefault() } }, n.removeEvent = d.removeEventListener ? function (a, b, c) { a.removeEventListener && a.removeEventListener(b, c) } : function (a, b, c) { var d = "on" + b; a.detachEvent && ("undefined" == typeof a[d] && (a[d] = null), a.detachEvent(d, c)) }, n.Event = function (a, b) { return this instanceof n.Event ? (a && a.type ? (this.originalEvent = a, this.type = a.type, this.isDefaultPrevented = a.defaultPrevented || void 0 === a.defaultPrevented && a.returnValue === !1 ? pa : qa) : this.type = a, b && n.extend(this, b), this.timeStamp = a && a.timeStamp || n.now(), void (this[n.expando] = !0)) : new n.Event(a, b) }, n.Event.prototype = { constructor: n.Event, isDefaultPrevented: qa, isPropagationStopped: qa, isImmediatePropagationStopped: qa, preventDefault: function () { var a = this.originalEvent; this.isDefaultPrevented = pa, a && (a.preventDefault ? a.preventDefault() : a.returnValue = !1) }, stopPropagation: function () { var a = this.originalEvent; this.isPropagationStopped = pa, a && !this.isSimulated && (a.stopPropagation && a.stopPropagation(), a.cancelBubble = !0) }, stopImmediatePropagation: function () { var a = this.originalEvent; this.isImmediatePropagationStopped = pa, a && a.stopImmediatePropagation && a.stopImmediatePropagation(), this.stopPropagation() } }, n.each({ mouseenter: "mouseover", mouseleave: "mouseout", pointerenter: "pointerover", pointerleave: "pointerout" }, function (a, b) { n.event.special[a] = { delegateType: b, bindType: b, handle: function (a) { var c, d = this, e = a.relatedTarget, f = a.handleObj; return e && (e === d || n.contains(d, e)) || (a.type = f.origType, c = f.handler.apply(this, arguments), a.type = b), c } } }), l.submit || (n.event.special.submit = { setup: function () { return n.nodeName(this, "form") ? !1 : void n.event.add(this, "click._submit keypress._submit", function (a) { var b = a.target, c = n.nodeName(b, "input") || n.nodeName(b, "button") ? n.prop(b, "form") : void 0; c && !n._data(c, "submit") && (n.event.add(c, "submit._submit", function (a) { a._submitBubble = !0 }), n._data(c, "submit", !0)) }) }, postDispatch: function (a) { a._submitBubble && (delete a._submitBubble, this.parentNode && !a.isTrigger && n.event.simulate("submit", this.parentNode, a)) }, teardown: function () { return n.nodeName(this, "form") ? !1 : void n.event.remove(this, "._submit") } }), l.change || (n.event.special.change = { setup: function () { return ka.test(this.nodeName) ? ("checkbox" !== this.type && "radio" !== this.type || (n.event.add(this, "propertychange._change", function (a) { "checked" === a.originalEvent.propertyName && (this._justChanged = !0) }), n.event.add(this, "click._change", function (a) { this._justChanged && !a.isTrigger && (this._justChanged = !1), n.event.simulate("change", this, a) })), !1) : void n.event.add(this, "beforeactivate._change", function (a) { var b = a.target; ka.test(b.nodeName) && !n._data(b, "change") && (n.event.add(b, "change._change", function (a) { !this.parentNode || a.isSimulated || a.isTrigger || n.event.simulate("change", this.parentNode, a) }), n._data(b, "change", !0)) }) }, handle: function (a) { var b = a.target; return this !== b || a.isSimulated || a.isTrigger || "radio" !== b.type && "checkbox" !== b.type ? a.handleObj.handler.apply(this, arguments) : void 0 }, teardown: function () { return n.event.remove(this, "._change"), !ka.test(this.nodeName) } }), l.focusin || n.each({ focus: "focusin", blur: "focusout" }, function (a, b) { var c = function (a) { n.event.simulate(b, a.target, n.event.fix(a)) }; n.event.special[b] = { setup: function () { var d = this.ownerDocument || this, e = n._data(d, b); e || d.addEventListener(a, c, !0), n._data(d, b, (e || 0) + 1) }, teardown: function () { var d = this.ownerDocument || this, e = n._data(d, b) - 1; e ? n._data(d, b, e) : (d.removeEventListener(a, c, !0), n._removeData(d, b)) } } }), n.fn.extend({ on: function (a, b, c, d) { return sa(this, a, b, c, d) }, one: function (a, b, c, d) { return sa(this, a, b, c, d, 1) }, off: function (a, b, c) { var d, e; if (a && a.preventDefault && a.handleObj) return d = a.handleObj, n(a.delegateTarget).off(d.namespace ? d.origType + "." + d.namespace : d.origType, d.selector, d.handler), this; if ("object" == typeof a) { for (e in a) this.off(e, b, a[e]); return this } return b !== !1 && "function" != typeof b || (c = b, b = void 0), c === !1 && (c = qa), this.each(function () { n.event.remove(this, a, c, b) }) }, trigger: function (a, b) { return this.each(function () { n.event.trigger(a, b, this) }) }, triggerHandler: function (a, b) { var c = this[0]; return c ? n.event.trigger(a, b, c, !0) : void 0 } }); var ta = / jQuery\d+="(?:null|\d+)"/g, ua = new RegExp("<(?:" + ba + ")[\\s/>]", "i"), va = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi, wa = /<script|<style|<link/i, xa = /checked\s*(?:[^=]|=\s*.checked.)/i, ya = /^true\/(.*)/, za = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g, Aa = ca(d), Ba = Aa.appendChild(d.createElement("div")); function Ca(a, b) { return n.nodeName(a, "table") && n.nodeName(11 !== b.nodeType ? b : b.firstChild, "tr") ? a.getElementsByTagName("tbody")[0] || a.appendChild(a.ownerDocument.createElement("tbody")) : a } function Da(a) { return a.type = (null !== n.find.attr(a, "type")) + "/" + a.type, a } function Ea(a) { var b = ya.exec(a.type); return b ? a.type = b[1] : a.removeAttribute("type"), a } function Fa(a, b) { if (1 === b.nodeType && n.hasData(a)) { var c, d, e, f = n._data(a), g = n._data(b, f), h = f.events; if (h) { delete g.handle, g.events = {}; for (c in h) for (d = 0, e = h[c].length; e > d; d++)n.event.add(b, c, h[c][d]) } g.data && (g.data = n.extend({}, g.data)) } } function Ga(a, b) { var c, d, e; if (1 === b.nodeType) { if (c = b.nodeName.toLowerCase(), !l.noCloneEvent && b[n.expando]) { e = n._data(b); for (d in e.events) n.removeEvent(b, d, e.handle); b.removeAttribute(n.expando) } "script" === c && b.text !== a.text ? (Da(b).text = a.text, Ea(b)) : "object" === c ? (b.parentNode && (b.outerHTML = a.outerHTML), l.html5Clone && a.innerHTML && !n.trim(b.innerHTML) && (b.innerHTML = a.innerHTML)) : "input" === c && Z.test(a.type) ? (b.defaultChecked = b.checked = a.checked, b.value !== a.value && (b.value = a.value)) : "option" === c ? b.defaultSelected = b.selected = a.defaultSelected : "input" !== c && "textarea" !== c || (b.defaultValue = a.defaultValue) } } function Ha(a, b, c, d) { b = f.apply([], b); var e, g, h, i, j, k, m = 0, o = a.length, p = o - 1, q = b[0], r = n.isFunction(q); if (r || o > 1 && "string" == typeof q && !l.checkClone && xa.test(q)) return a.each(function (e) { var f = a.eq(e); r && (b[0] = q.call(this, e, f.html())), Ha(f, b, c, d) }); if (o && (k = ja(b, a[0].ownerDocument, !1, a, d), e = k.firstChild, 1 === k.childNodes.length && (k = e), e || d)) { for (i = n.map(ea(k, "script"), Da), h = i.length; o > m; m++)g = k, m !== p && (g = n.clone(g, !0, !0), h && n.merge(i, ea(g, "script"))), c.call(a[m], g, m); if (h) for (j = i[i.length - 1].ownerDocument, n.map(i, Ea), m = 0; h > m; m++)g = i[m], _.test(g.type || "") && !n._data(g, "globalEval") && n.contains(j, g) && (g.src ? n._evalUrl && n._evalUrl(g.src) : n.globalEval((g.text || g.textContent || g.innerHTML || "").replace(za, ""))); k = e = null } return a } function Ia(a, b, c) { for (var d, e = b ? n.filter(b, a) : a, f = 0; null != (d = e[f]); f++)c || 1 !== d.nodeType || n.cleanData(ea(d)), d.parentNode && (c && n.contains(d.ownerDocument, d) && fa(ea(d, "script")), d.parentNode.removeChild(d)); return a } n.extend({ htmlPrefilter: function (a) { return a.replace(va, "<$1></$2>") }, clone: function (a, b, c) { var d, e, f, g, h, i = n.contains(a.ownerDocument, a); if (l.html5Clone || n.isXMLDoc(a) || !ua.test("<" + a.nodeName + ">") ? f = a.cloneNode(!0) : (Ba.innerHTML = a.outerHTML, Ba.removeChild(f = Ba.firstChild)), !(l.noCloneEvent && l.noCloneChecked || 1 !== a.nodeType && 11 !== a.nodeType || n.isXMLDoc(a))) for (d = ea(f), h = ea(a), g = 0; null != (e = h[g]); ++g)d[g] && Ga(e, d[g]); if (b) if (c) for (h = h || ea(a), d = d || ea(f), g = 0; null != (e = h[g]); g++)Fa(e, d[g]); else Fa(a, f); return d = ea(f, "script"), d.length > 0 && fa(d, !i && ea(a, "script")), d = h = e = null, f }, cleanData: function (a, b) { for (var d, e, f, g, h = 0, i = n.expando, j = n.cache, k = l.attributes, m = n.event.special; null != (d = a[h]); h++)if ((b || M(d)) && (f = d[i], g = f && j[f])) { if (g.events) for (e in g.events) m[e] ? n.event.remove(d, e) : n.removeEvent(d, e, g.handle); j[f] && (delete j[f], k || "undefined" == typeof d.removeAttribute ? d[i] = void 0 : d.removeAttribute(i), c.push(f)) } } }), n.fn.extend({ domManip: Ha, detach: function (a) { return Ia(this, a, !0) }, remove: function (a) { return Ia(this, a) }, text: function (a) { return Y(this, function (a) { return void 0 === a ? n.text(this) : this.empty().append((this[0] && this[0].ownerDocument || d).createTextNode(a)) }, null, a, arguments.length) }, append: function () { return Ha(this, arguments, function (a) { if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) { var b = Ca(this, a); b.appendChild(a) } }) }, prepend: function () { return Ha(this, arguments, function (a) { if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) { var b = Ca(this, a); b.insertBefore(a, b.firstChild) } }) }, before: function () { return Ha(this, arguments, function (a) { this.parentNode && this.parentNode.insertBefore(a, this) }) }, after: function () { return Ha(this, arguments, function (a) { this.parentNode && this.parentNode.insertBefore(a, this.nextSibling) }) }, empty: function () { for (var a, b = 0; null != (a = this[b]); b++) { 1 === a.nodeType && n.cleanData(ea(a, !1)); while (a.firstChild) a.removeChild(a.firstChild); a.options && n.nodeName(a, "select") && (a.options.length = 0) } return this }, clone: function (a, b) { return a = null == a ? !1 : a, b = null == b ? a : b, this.map(function () { return n.clone(this, a, b) }) }, html: function (a) { return Y(this, function (a) { var b = this[0] || {}, c = 0, d = this.length; if (void 0 === a) return 1 === b.nodeType ? b.innerHTML.replace(ta, "") : void 0; if ("string" == typeof a && !wa.test(a) && (l.htmlSerialize || !ua.test(a)) && (l.leadingWhitespace || !aa.test(a)) && !da[($.exec(a) || ["", ""])[1].toLowerCase()]) { a = n.htmlPrefilter(a); try { for (; d > c; c++)b = this[c] || {}, 1 === b.nodeType && (n.cleanData(ea(b, !1)), b.innerHTML = a); b = 0 } catch (e) { } } b && this.empty().append(a) }, null, a, arguments.length) }, replaceWith: function () { var a = []; return Ha(this, arguments, function (b) { var c = this.parentNode; n.inArray(this, a) < 0 && (n.cleanData(ea(this)), c && c.replaceChild(b, this)) }, a) } }), n.each({ appendTo: "append", prependTo: "prepend", insertBefore: "before", insertAfter: "after", replaceAll: "replaceWith" }, function (a, b) { n.fn[a] = function (a) { for (var c, d = 0, e = [], f = n(a), h = f.length - 1; h >= d; d++)c = d === h ? this : this.clone(!0), n(f[d])[b](c), g.apply(e, c.get()); return this.pushStack(e) } }); var Ja, Ka = { HTML: "block", BODY: "block" }; function La(a, b) { var c = n(b.createElement(a)).appendTo(b.body), d = n.css(c[0], "display"); return c.detach(), d } function Ma(a) { var b = d, c = Ka[a]; return c || (c = La(a, b), "none" !== c && c || (Ja = (Ja || n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement), b = (Ja[0].contentWindow || Ja[0].contentDocument).document, b.write(), b.close(), c = La(a, b), Ja.detach()), Ka[a] = c), c } var Na = /^margin/, Oa = new RegExp("^(" + T + ")(?!px)[a-z%]+$", "i"), Pa = function (a, b, c, d) { var e, f, g = {}; for (f in b) g[f] = a.style[f], a.style[f] = b[f]; e = c.apply(a, d || []); for (f in b) a.style[f] = g[f]; return e }, Qa = d.documentElement; !function () { var b, c, e, f, g, h, i = d.createElement("div"), j = d.createElement("div"); if (j.style) { j.style.cssText = "float:left;opacity:.5", l.opacity = "0.5" === j.style.opacity, l.cssFloat = !!j.style.cssFloat, j.style.backgroundClip = "content-box", j.cloneNode(!0).style.backgroundClip = "", l.clearCloneStyle = "content-box" === j.style.backgroundClip, i = d.createElement("div"), i.style.cssText = "border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute", j.innerHTML = "", i.appendChild(j), l.boxSizing = "" === j.style.boxSizing || "" === j.style.MozBoxSizing || "" === j.style.WebkitBoxSizing, n.extend(l, { reliableHiddenOffsets: function () { return null == b && k(), f }, boxSizingReliable: function () { return null == b && k(), e }, pixelMarginRight: function () { return null == b && k(), c }, pixelPosition: function () { return null == b && k(), b }, reliableMarginRight: function () { return null == b && k(), g }, reliableMarginLeft: function () { return null == b && k(), h } }); function k() { var k, l, m = d.documentElement; m.appendChild(i), j.style.cssText = "-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%", b = e = h = !1, c = g = !0, a.getComputedStyle && (l = a.getComputedStyle(j), b = "1%" !== (l || {}).top, h = "2px" === (l || {}).marginLeft, e = "4px" === (l || { width: "4px" }).width, j.style.marginRight = "50%", c = "4px" === (l || { marginRight: "4px" }).marginRight, k = j.appendChild(d.createElement("div")), k.style.cssText = j.style.cssText = "-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0", k.style.marginRight = k.style.width = "0", j.style.width = "1px", g = !parseFloat((a.getComputedStyle(k) || {}).marginRight), j.removeChild(k)), j.style.display = "none", f = 0 === j.getClientRects().length, f && (j.style.display = "", j.innerHTML = "<table><tr><td></td><td>t</td></tr></table>", j.childNodes[0].style.borderCollapse = "separate", k = j.getElementsByTagName("td"), k[0].style.cssText = "margin:0;border:0;padding:0;display:none", f = 0 === k[0].offsetHeight, f && (k[0].style.display = "", k[1].style.display = "none", f = 0 === k[0].offsetHeight)), m.removeChild(i) } } }(); var Ra, Sa, Ta = /^(top|right|bottom|left)$/; a.getComputedStyle ? (Ra = function (b) { var c = b.ownerDocument.defaultView; return c && c.opener || (c = a), c.getComputedStyle(b) }, Sa = function (a, b, c) { var d, e, f, g, h = a.style; return c = c || Ra(a), g = c ? c.getPropertyValue(b) || c[b] : void 0, "" !== g && void 0 !== g || n.contains(a.ownerDocument, a) || (g = n.style(a, b)), c && !l.pixelMarginRight() && Oa.test(g) && Na.test(b) && (d = h.width, e = h.minWidth, f = h.maxWidth, h.minWidth = h.maxWidth = h.width = g, g = c.width, h.width = d, h.minWidth = e, h.maxWidth = f), void 0 === g ? g : g + "" }) : Qa.currentStyle && (Ra = function (a) { return a.currentStyle }, Sa = function (a, b, c) { var d, e, f, g, h = a.style; return c = c || Ra(a), g = c ? c[b] : void 0, null == g && h && h[b] && (g = h[b]), Oa.test(g) && !Ta.test(b) && (d = h.left, e = a.runtimeStyle, f = e && e.left, f && (e.left = a.currentStyle.left), h.left = "fontSize" === b ? "1em" : g, g = h.pixelLeft + "px", h.left = d, f && (e.left = f)), void 0 === g ? g : g + "" || "auto" }); function Ua(a, b) { return { get: function () { return a() ? void delete this.get : (this.get = b).apply(this, arguments) } } } var Va = /alpha\([^)]*\)/i, Wa = /opacity\s*=\s*([^)]*)/i, Xa = /^(none|table(?!-c[ea]).+)/, Ya = new RegExp("^(" + T + ")(.*)$", "i"), Za = { position: "absolute", visibility: "hidden", display: "block" }, $a = { letterSpacing: "0", fontWeight: "400" }, _a = ["Webkit", "O", "Moz", "ms"], ab = d.createElement("div").style; function bb(a) { if (a in ab) return a; var b = a.charAt(0).toUpperCase() + a.slice(1), c = _a.length; while (c--) if (a = _a[c] + b, a in ab) return a } function cb(a, b) { for (var c, d, e, f = [], g = 0, h = a.length; h > g; g++)d = a[g], d.style && (f[g] = n._data(d, "olddisplay"), c = d.style.display, b ? (f[g] || "none" !== c || (d.style.display = ""), "" === d.style.display && W(d) && (f[g] = n._data(d, "olddisplay", Ma(d.nodeName)))) : (e = W(d), (c && "none" !== c || !e) && n._data(d, "olddisplay", e ? c : n.css(d, "display")))); for (g = 0; h > g; g++)d = a[g], d.style && (b && "none" !== d.style.display && "" !== d.style.display || (d.style.display = b ? f[g] || "" : "none")); return a } function db(a, b, c) { var d = Ya.exec(b); return d ? Math.max(0, d[1] - (c || 0)) + (d[2] || "px") : b } function eb(a, b, c, d, e) { for (var f = c === (d ? "border" : "content") ? 4 : "width" === b ? 1 : 0, g = 0; 4 > f; f += 2)"margin" === c && (g += n.css(a, c + V[f], !0, e)), d ? ("content" === c && (g -= n.css(a, "padding" + V[f], !0, e)), "margin" !== c && (g -= n.css(a, "border" + V[f] + "Width", !0, e))) : (g += n.css(a, "padding" + V[f], !0, e), "padding" !== c && (g += n.css(a, "border" + V[f] + "Width", !0, e))); return g } function fb(a, b, c) { var d = !0, e = "width" === b ? a.offsetWidth : a.offsetHeight, f = Ra(a), g = l.boxSizing && "border-box" === n.css(a, "boxSizing", !1, f); if (0 >= e || null == e) { if (e = Sa(a, b, f), (0 > e || null == e) && (e = a.style[b]), Oa.test(e)) return e; d = g && (l.boxSizingReliable() || e === a.style[b]), e = parseFloat(e) || 0 } return e + eb(a, b, c || (g ? "border" : "content"), d, f) + "px" } n.extend({ cssHooks: { opacity: { get: function (a, b) { if (b) { var c = Sa(a, "opacity"); return "" === c ? "1" : c } } } }, cssNumber: { animationIterationCount: !0, columnCount: !0, fillOpacity: !0, flexGrow: !0, flexShrink: !0, fontWeight: !0, lineHeight: !0, opacity: !0, order: !0, orphans: !0, widows: !0, zIndex: !0, zoom: !0 }, cssProps: { "float": l.cssFloat ? "cssFloat" : "styleFloat" }, style: function (a, b, c, d) { if (a && 3 !== a.nodeType && 8 !== a.nodeType && a.style) { var e, f, g, h = n.camelCase(b), i = a.style; if (b = n.cssProps[h] || (n.cssProps[h] = bb(h) || h), g = n.cssHooks[b] || n.cssHooks[h], void 0 === c) return g && "get" in g && void 0 !== (e = g.get(a, !1, d)) ? e : i[b]; if (f = typeof c, "string" === f && (e = U.exec(c)) && e[1] && (c = X(a, b, e), f = "number"), null != c && c === c && ("number" === f && (c += e && e[3] || (n.cssNumber[h] ? "" : "px")), l.clearCloneStyle || "" !== c || 0 !== b.indexOf("background") || (i[b] = "inherit"), !(g && "set" in g && void 0 === (c = g.set(a, c, d))))) try { i[b] = c } catch (j) { } } }, css: function (a, b, c, d) { var e, f, g, h = n.camelCase(b); return b = n.cssProps[h] || (n.cssProps[h] = bb(h) || h), g = n.cssHooks[b] || n.cssHooks[h], g && "get" in g && (f = g.get(a, !0, c)), void 0 === f && (f = Sa(a, b, d)), "normal" === f && b in $a && (f = $a[b]), "" === c || c ? (e = parseFloat(f), c === !0 || isFinite(e) ? e || 0 : f) : f } }), n.each(["height", "width"], function (a, b) { n.cssHooks[b] = { get: function (a, c, d) { return c ? Xa.test(n.css(a, "display")) && 0 === a.offsetWidth ? Pa(a, Za, function () { return fb(a, b, d) }) : fb(a, b, d) : void 0 }, set: function (a, c, d) { var e = d && Ra(a); return db(a, c, d ? eb(a, b, d, l.boxSizing && "border-box" === n.css(a, "boxSizing", !1, e), e) : 0) } } }), l.opacity || (n.cssHooks.opacity = { get: function (a, b) { return Wa.test((b && a.currentStyle ? a.currentStyle.filter : a.style.filter) || "") ? .01 * parseFloat(RegExp.$1) + "" : b ? "1" : "" }, set: function (a, b) { var c = a.style, d = a.currentStyle, e = n.isNumeric(b) ? "alpha(opacity=" + 100 * b + ")" : "", f = d && d.filter || c.filter || ""; c.zoom = 1, (b >= 1 || "" === b) && "" === n.trim(f.replace(Va, "")) && c.removeAttribute && (c.removeAttribute("filter"), "" === b || d && !d.filter) || (c.filter = Va.test(f) ? f.replace(Va, e) : f + " " + e) } }), n.cssHooks.marginRight = Ua(l.reliableMarginRight, function (a, b) { return b ? Pa(a, { display: "inline-block" }, Sa, [a, "marginRight"]) : void 0 }), n.cssHooks.marginLeft = Ua(l.reliableMarginLeft, function (a, b) {
        return b ? (parseFloat(Sa(a, "marginLeft")) || (n.contains(a.ownerDocument, a) ? a.getBoundingClientRect().left - Pa(a, {
            marginLeft: 0
        }, function () { return a.getBoundingClientRect().left }) : 0)) + "px" : void 0
    }), n.each({ margin: "", padding: "", border: "Width" }, function (a, b) { n.cssHooks[a + b] = { expand: function (c) { for (var d = 0, e = {}, f = "string" == typeof c ? c.split(" ") : [c]; 4 > d; d++)e[a + V[d] + b] = f[d] || f[d - 2] || f[0]; return e } }, Na.test(a) || (n.cssHooks[a + b].set = db) }), n.fn.extend({ css: function (a, b) { return Y(this, function (a, b, c) { var d, e, f = {}, g = 0; if (n.isArray(b)) { for (d = Ra(a), e = b.length; e > g; g++)f[b[g]] = n.css(a, b[g], !1, d); return f } return void 0 !== c ? n.style(a, b, c) : n.css(a, b) }, a, b, arguments.length > 1) }, show: function () { return cb(this, !0) }, hide: function () { return cb(this) }, toggle: function (a) { return "boolean" == typeof a ? a ? this.show() : this.hide() : this.each(function () { W(this) ? n(this).show() : n(this).hide() }) } }); function gb(a, b, c, d, e) { return new gb.prototype.init(a, b, c, d, e) } n.Tween = gb, gb.prototype = { constructor: gb, init: function (a, b, c, d, e, f) { this.elem = a, this.prop = c, this.easing = e || n.easing._default, this.options = b, this.start = this.now = this.cur(), this.end = d, this.unit = f || (n.cssNumber[c] ? "" : "px") }, cur: function () { var a = gb.propHooks[this.prop]; return a && a.get ? a.get(this) : gb.propHooks._default.get(this) }, run: function (a) { var b, c = gb.propHooks[this.prop]; return this.options.duration ? this.pos = b = n.easing[this.easing](a, this.options.duration * a, 0, 1, this.options.duration) : this.pos = b = a, this.now = (this.end - this.start) * b + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), c && c.set ? c.set(this) : gb.propHooks._default.set(this), this } }, gb.prototype.init.prototype = gb.prototype, gb.propHooks = { _default: { get: function (a) { var b; return 1 !== a.elem.nodeType || null != a.elem[a.prop] && null == a.elem.style[a.prop] ? a.elem[a.prop] : (b = n.css(a.elem, a.prop, ""), b && "auto" !== b ? b : 0) }, set: function (a) { n.fx.step[a.prop] ? n.fx.step[a.prop](a) : 1 !== a.elem.nodeType || null == a.elem.style[n.cssProps[a.prop]] && !n.cssHooks[a.prop] ? a.elem[a.prop] = a.now : n.style(a.elem, a.prop, a.now + a.unit) } } }, gb.propHooks.scrollTop = gb.propHooks.scrollLeft = { set: function (a) { a.elem.nodeType && a.elem.parentNode && (a.elem[a.prop] = a.now) } }, n.easing = { linear: function (a) { return a }, swing: function (a) { return .5 - Math.cos(a * Math.PI) / 2 }, _default: "swing" }, n.fx = gb.prototype.init, n.fx.step = {}; var hb, ib, jb = /^(?:toggle|show|hide)$/, kb = /queueHooks$/; function lb() { return a.setTimeout(function () { hb = void 0 }), hb = n.now() } function mb(a, b) { var c, d = { height: a }, e = 0; for (b = b ? 1 : 0; 4 > e; e += 2 - b)c = V[e], d["margin" + c] = d["padding" + c] = a; return b && (d.opacity = d.width = a), d } function nb(a, b, c) { for (var d, e = (qb.tweeners[b] || []).concat(qb.tweeners["*"]), f = 0, g = e.length; g > f; f++)if (d = e[f].call(c, b, a)) return d } function ob(a, b, c) { var d, e, f, g, h, i, j, k, m = this, o = {}, p = a.style, q = a.nodeType && W(a), r = n._data(a, "fxshow"); c.queue || (h = n._queueHooks(a, "fx"), null == h.unqueued && (h.unqueued = 0, i = h.empty.fire, h.empty.fire = function () { h.unqueued || i() }), h.unqueued++ , m.always(function () { m.always(function () { h.unqueued-- , n.queue(a, "fx").length || h.empty.fire() }) })), 1 === a.nodeType && ("height" in b || "width" in b) && (c.overflow = [p.overflow, p.overflowX, p.overflowY], j = n.css(a, "display"), k = "none" === j ? n._data(a, "olddisplay") || Ma(a.nodeName) : j, "inline" === k && "none" === n.css(a, "float") && (l.inlineBlockNeedsLayout && "inline" !== Ma(a.nodeName) ? p.zoom = 1 : p.display = "inline-block")), c.overflow && (p.overflow = "hidden", l.shrinkWrapBlocks() || m.always(function () { p.overflow = c.overflow[0], p.overflowX = c.overflow[1], p.overflowY = c.overflow[2] })); for (d in b) if (e = b[d], jb.exec(e)) { if (delete b[d], f = f || "toggle" === e, e === (q ? "hide" : "show")) { if ("show" !== e || !r || void 0 === r[d]) continue; q = !0 } o[d] = r && r[d] || n.style(a, d) } else j = void 0; if (n.isEmptyObject(o)) "inline" === ("none" === j ? Ma(a.nodeName) : j) && (p.display = j); else { r ? "hidden" in r && (q = r.hidden) : r = n._data(a, "fxshow", {}), f && (r.hidden = !q), q ? n(a).show() : m.done(function () { n(a).hide() }), m.done(function () { var b; n._removeData(a, "fxshow"); for (b in o) n.style(a, b, o[b]) }); for (d in o) g = nb(q ? r[d] : 0, d, m), d in r || (r[d] = g.start, q && (g.end = g.start, g.start = "width" === d || "height" === d ? 1 : 0)) } } function pb(a, b) { var c, d, e, f, g; for (c in a) if (d = n.camelCase(c), e = b[d], f = a[c], n.isArray(f) && (e = f[1], f = a[c] = f[0]), c !== d && (a[d] = f, delete a[c]), g = n.cssHooks[d], g && "expand" in g) { f = g.expand(f), delete a[d]; for (c in f) c in a || (a[c] = f[c], b[c] = e) } else b[d] = e } function qb(a, b, c) { var d, e, f = 0, g = qb.prefilters.length, h = n.Deferred().always(function () { delete i.elem }), i = function () { if (e) return !1; for (var b = hb || lb(), c = Math.max(0, j.startTime + j.duration - b), d = c / j.duration || 0, f = 1 - d, g = 0, i = j.tweens.length; i > g; g++)j.tweens[g].run(f); return h.notifyWith(a, [j, f, c]), 1 > f && i ? c : (h.resolveWith(a, [j]), !1) }, j = h.promise({ elem: a, props: n.extend({}, b), opts: n.extend(!0, { specialEasing: {}, easing: n.easing._default }, c), originalProperties: b, originalOptions: c, startTime: hb || lb(), duration: c.duration, tweens: [], createTween: function (b, c) { var d = n.Tween(a, j.opts, b, c, j.opts.specialEasing[b] || j.opts.easing); return j.tweens.push(d), d }, stop: function (b) { var c = 0, d = b ? j.tweens.length : 0; if (e) return this; for (e = !0; d > c; c++)j.tweens[c].run(1); return b ? (h.notifyWith(a, [j, 1, 0]), h.resolveWith(a, [j, b])) : h.rejectWith(a, [j, b]), this } }), k = j.props; for (pb(k, j.opts.specialEasing); g > f; f++)if (d = qb.prefilters[f].call(j, a, k, j.opts)) return n.isFunction(d.stop) && (n._queueHooks(j.elem, j.opts.queue).stop = n.proxy(d.stop, d)), d; return n.map(k, nb, j), n.isFunction(j.opts.start) && j.opts.start.call(a, j), n.fx.timer(n.extend(i, { elem: a, anim: j, queue: j.opts.queue })), j.progress(j.opts.progress).done(j.opts.done, j.opts.complete).fail(j.opts.fail).always(j.opts.always) } n.Animation = n.extend(qb, { tweeners: { "*": [function (a, b) { var c = this.createTween(a, b); return X(c.elem, a, U.exec(b), c), c }] }, tweener: function (a, b) { n.isFunction(a) ? (b = a, a = ["*"]) : a = a.match(G); for (var c, d = 0, e = a.length; e > d; d++)c = a[d], qb.tweeners[c] = qb.tweeners[c] || [], qb.tweeners[c].unshift(b) }, prefilters: [ob], prefilter: function (a, b) { b ? qb.prefilters.unshift(a) : qb.prefilters.push(a) } }), n.speed = function (a, b, c) { var d = a && "object" == typeof a ? n.extend({}, a) : { complete: c || !c && b || n.isFunction(a) && a, duration: a, easing: c && b || b && !n.isFunction(b) && b }; return d.duration = n.fx.off ? 0 : "number" == typeof d.duration ? d.duration : d.duration in n.fx.speeds ? n.fx.speeds[d.duration] : n.fx.speeds._default, null != d.queue && d.queue !== !0 || (d.queue = "fx"), d.old = d.complete, d.complete = function () { n.isFunction(d.old) && d.old.call(this), d.queue && n.dequeue(this, d.queue) }, d }, n.fn.extend({ fadeTo: function (a, b, c, d) { return this.filter(W).css("opacity", 0).show().end().animate({ opacity: b }, a, c, d) }, animate: function (a, b, c, d) { var e = n.isEmptyObject(a), f = n.speed(b, c, d), g = function () { var b = qb(this, n.extend({}, a), f); (e || n._data(this, "finish")) && b.stop(!0) }; return g.finish = g, e || f.queue === !1 ? this.each(g) : this.queue(f.queue, g) }, stop: function (a, b, c) { var d = function (a) { var b = a.stop; delete a.stop, b(c) }; return "string" != typeof a && (c = b, b = a, a = void 0), b && a !== !1 && this.queue(a || "fx", []), this.each(function () { var b = !0, e = null != a && a + "queueHooks", f = n.timers, g = n._data(this); if (e) g[e] && g[e].stop && d(g[e]); else for (e in g) g[e] && g[e].stop && kb.test(e) && d(g[e]); for (e = f.length; e--;)f[e].elem !== this || null != a && f[e].queue !== a || (f[e].anim.stop(c), b = !1, f.splice(e, 1)); !b && c || n.dequeue(this, a) }) }, finish: function (a) { return a !== !1 && (a = a || "fx"), this.each(function () { var b, c = n._data(this), d = c[a + "queue"], e = c[a + "queueHooks"], f = n.timers, g = d ? d.length : 0; for (c.finish = !0, n.queue(this, a, []), e && e.stop && e.stop.call(this, !0), b = f.length; b--;)f[b].elem === this && f[b].queue === a && (f[b].anim.stop(!0), f.splice(b, 1)); for (b = 0; g > b; b++)d[b] && d[b].finish && d[b].finish.call(this); delete c.finish }) } }), n.each(["toggle", "show", "hide"], function (a, b) { var c = n.fn[b]; n.fn[b] = function (a, d, e) { return null == a || "boolean" == typeof a ? c.apply(this, arguments) : this.animate(mb(b, !0), a, d, e) } }), n.each({ slideDown: mb("show"), slideUp: mb("hide"), slideToggle: mb("toggle"), fadeIn: { opacity: "show" }, fadeOut: { opacity: "hide" }, fadeToggle: { opacity: "toggle" } }, function (a, b) { n.fn[a] = function (a, c, d) { return this.animate(b, a, c, d) } }), n.timers = [], n.fx.tick = function () { var a, b = n.timers, c = 0; for (hb = n.now(); c < b.length; c++)a = b[c], a() || b[c] !== a || b.splice(c--, 1); b.length || n.fx.stop(), hb = void 0 }, n.fx.timer = function (a) { n.timers.push(a), a() ? n.fx.start() : n.timers.pop() }, n.fx.interval = 13, n.fx.start = function () { ib || (ib = a.setInterval(n.fx.tick, n.fx.interval)) }, n.fx.stop = function () { a.clearInterval(ib), ib = null }, n.fx.speeds = { slow: 600, fast: 200, _default: 400 }, n.fn.delay = function (b, c) { return b = n.fx ? n.fx.speeds[b] || b : b, c = c || "fx", this.queue(c, function (c, d) { var e = a.setTimeout(c, b); d.stop = function () { a.clearTimeout(e) } }) }, function () { var a, b = d.createElement("input"), c = d.createElement("div"), e = d.createElement("select"), f = e.appendChild(d.createElement("option")); c = d.createElement("div"), c.setAttribute("className", "t"), c.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", a = c.getElementsByTagName("a")[0], b.setAttribute("type", "checkbox"), c.appendChild(b), a = c.getElementsByTagName("a")[0], a.style.cssText = "top:1px", l.getSetAttribute = "t" !== c.className, l.style = /top/.test(a.getAttribute("style")), l.hrefNormalized = "/a" === a.getAttribute("href"), l.checkOn = !!b.value, l.optSelected = f.selected, l.enctype = !!d.createElement("form").enctype, e.disabled = !0, l.optDisabled = !f.disabled, b = d.createElement("input"), b.setAttribute("value", ""), l.input = "" === b.getAttribute("value"), b.value = "t", b.setAttribute("type", "radio"), l.radioValue = "t" === b.value }(); var rb = /\r/g, sb = /[\x20\t\r\n\f]+/g; n.fn.extend({ val: function (a) { var b, c, d, e = this[0]; { if (arguments.length) return d = n.isFunction(a), this.each(function (c) { var e; 1 === this.nodeType && (e = d ? a.call(this, c, n(this).val()) : a, null == e ? e = "" : "number" == typeof e ? e += "" : n.isArray(e) && (e = n.map(e, function (a) { return null == a ? "" : a + "" })), b = n.valHooks[this.type] || n.valHooks[this.nodeName.toLowerCase()], b && "set" in b && void 0 !== b.set(this, e, "value") || (this.value = e)) }); if (e) return b = n.valHooks[e.type] || n.valHooks[e.nodeName.toLowerCase()], b && "get" in b && void 0 !== (c = b.get(e, "value")) ? c : (c = e.value, "string" == typeof c ? c.replace(rb, "") : null == c ? "" : c) } } }), n.extend({ valHooks: { option: { get: function (a) { var b = n.find.attr(a, "value"); return null != b ? b : n.trim(n.text(a)).replace(sb, " ") } }, select: { get: function (a) { for (var b, c, d = a.options, e = a.selectedIndex, f = "select-one" === a.type || 0 > e, g = f ? null : [], h = f ? e + 1 : d.length, i = 0 > e ? h : f ? e : 0; h > i; i++)if (c = d[i], (c.selected || i === e) && (l.optDisabled ? !c.disabled : null === c.getAttribute("disabled")) && (!c.parentNode.disabled || !n.nodeName(c.parentNode, "optgroup"))) { if (b = n(c).val(), f) return b; g.push(b) } return g }, set: function (a, b) { var c, d, e = a.options, f = n.makeArray(b), g = e.length; while (g--) if (d = e[g], n.inArray(n.valHooks.option.get(d), f) > -1) try { d.selected = c = !0 } catch (h) { d.scrollHeight } else d.selected = !1; return c || (a.selectedIndex = -1), e } } } }), n.each(["radio", "checkbox"], function () { n.valHooks[this] = { set: function (a, b) { return n.isArray(b) ? a.checked = n.inArray(n(a).val(), b) > -1 : void 0 } }, l.checkOn || (n.valHooks[this].get = function (a) { return null === a.getAttribute("value") ? "on" : a.value }) }); var tb, ub, vb = n.expr.attrHandle, wb = /^(?:checked|selected)$/i, xb = l.getSetAttribute, yb = l.input; n.fn.extend({ attr: function (a, b) { return Y(this, n.attr, a, b, arguments.length > 1) }, removeAttr: function (a) { return this.each(function () { n.removeAttr(this, a) }) } }), n.extend({ attr: function (a, b, c) { var d, e, f = a.nodeType; if (3 !== f && 8 !== f && 2 !== f) return "undefined" == typeof a.getAttribute ? n.prop(a, b, c) : (1 === f && n.isXMLDoc(a) || (b = b.toLowerCase(), e = n.attrHooks[b] || (n.expr.match.bool.test(b) ? ub : tb)), void 0 !== c ? null === c ? void n.removeAttr(a, b) : e && "set" in e && void 0 !== (d = e.set(a, c, b)) ? d : (a.setAttribute(b, c + ""), c) : e && "get" in e && null !== (d = e.get(a, b)) ? d : (d = n.find.attr(a, b), null == d ? void 0 : d)) }, attrHooks: { type: { set: function (a, b) { if (!l.radioValue && "radio" === b && n.nodeName(a, "input")) { var c = a.value; return a.setAttribute("type", b), c && (a.value = c), b } } } }, removeAttr: function (a, b) { var c, d, e = 0, f = b && b.match(G); if (f && 1 === a.nodeType) while (c = f[e++]) d = n.propFix[c] || c, n.expr.match.bool.test(c) ? yb && xb || !wb.test(c) ? a[d] = !1 : a[n.camelCase("default-" + c)] = a[d] = !1 : n.attr(a, c, ""), a.removeAttribute(xb ? c : d) } }), ub = { set: function (a, b, c) { return b === !1 ? n.removeAttr(a, c) : yb && xb || !wb.test(c) ? a.setAttribute(!xb && n.propFix[c] || c, c) : a[n.camelCase("default-" + c)] = a[c] = !0, c } }, n.each(n.expr.match.bool.source.match(/\w+/g), function (a, b) { var c = vb[b] || n.find.attr; yb && xb || !wb.test(b) ? vb[b] = function (a, b, d) { var e, f; return d || (f = vb[b], vb[b] = e, e = null != c(a, b, d) ? b.toLowerCase() : null, vb[b] = f), e } : vb[b] = function (a, b, c) { return c ? void 0 : a[n.camelCase("default-" + b)] ? b.toLowerCase() : null } }), yb && xb || (n.attrHooks.value = { set: function (a, b, c) { return n.nodeName(a, "input") ? void (a.defaultValue = b) : tb && tb.set(a, b, c) } }), xb || (tb = { set: function (a, b, c) { var d = a.getAttributeNode(c); return d || a.setAttributeNode(d = a.ownerDocument.createAttribute(c)), d.value = b += "", "value" === c || b === a.getAttribute(c) ? b : void 0 } }, vb.id = vb.name = vb.coords = function (a, b, c) { var d; return c ? void 0 : (d = a.getAttributeNode(b)) && "" !== d.value ? d.value : null }, n.valHooks.button = { get: function (a, b) { var c = a.getAttributeNode(b); return c && c.specified ? c.value : void 0 }, set: tb.set }, n.attrHooks.contenteditable = { set: function (a, b, c) { tb.set(a, "" === b ? !1 : b, c) } }, n.each(["width", "height"], function (a, b) { n.attrHooks[b] = { set: function (a, c) { return "" === c ? (a.setAttribute(b, "auto"), c) : void 0 } } })), l.style || (n.attrHooks.style = { get: function (a) { return a.style.cssText || void 0 }, set: function (a, b) { return a.style.cssText = b + "" } }); var zb = /^(?:input|select|textarea|button|object)$/i, Ab = /^(?:a|area)$/i; n.fn.extend({ prop: function (a, b) { return Y(this, n.prop, a, b, arguments.length > 1) }, removeProp: function (a) { return a = n.propFix[a] || a, this.each(function () { try { this[a] = void 0, delete this[a] } catch (b) { } }) } }), n.extend({ prop: function (a, b, c) { var d, e, f = a.nodeType; if (3 !== f && 8 !== f && 2 !== f) return 1 === f && n.isXMLDoc(a) || (b = n.propFix[b] || b, e = n.propHooks[b]), void 0 !== c ? e && "set" in e && void 0 !== (d = e.set(a, c, b)) ? d : a[b] = c : e && "get" in e && null !== (d = e.get(a, b)) ? d : a[b] }, propHooks: { tabIndex: { get: function (a) { var b = n.find.attr(a, "tabindex"); return b ? parseInt(b, 10) : zb.test(a.nodeName) || Ab.test(a.nodeName) && a.href ? 0 : -1 } } }, propFix: { "for": "htmlFor", "class": "className" } }), l.hrefNormalized || n.each(["href", "src"], function (a, b) { n.propHooks[b] = { get: function (a) { return a.getAttribute(b, 4) } } }), l.optSelected || (n.propHooks.selected = { get: function (a) { var b = a.parentNode; return b && (b.selectedIndex, b.parentNode && b.parentNode.selectedIndex), null }, set: function (a) { var b = a.parentNode; b && (b.selectedIndex, b.parentNode && b.parentNode.selectedIndex) } }), n.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function () { n.propFix[this.toLowerCase()] = this }), l.enctype || (n.propFix.enctype = "encoding"); var Bb = /[\t\r\n\f]/g; function Cb(a) { return n.attr(a, "class") || "" } n.fn.extend({ addClass: function (a) { var b, c, d, e, f, g, h, i = 0; if (n.isFunction(a)) return this.each(function (b) { n(this).addClass(a.call(this, b, Cb(this))) }); if ("string" == typeof a && a) { b = a.match(G) || []; while (c = this[i++]) if (e = Cb(c), d = 1 === c.nodeType && (" " + e + " ").replace(Bb, " ")) { g = 0; while (f = b[g++]) d.indexOf(" " + f + " ") < 0 && (d += f + " "); h = n.trim(d), e !== h && n.attr(c, "class", h) } } return this }, removeClass: function (a) { var b, c, d, e, f, g, h, i = 0; if (n.isFunction(a)) return this.each(function (b) { n(this).removeClass(a.call(this, b, Cb(this))) }); if (!arguments.length) return this.attr("class", ""); if ("string" == typeof a && a) { b = a.match(G) || []; while (c = this[i++]) if (e = Cb(c), d = 1 === c.nodeType && (" " + e + " ").replace(Bb, " ")) { g = 0; while (f = b[g++]) while (d.indexOf(" " + f + " ") > -1) d = d.replace(" " + f + " ", " "); h = n.trim(d), e !== h && n.attr(c, "class", h) } } return this }, toggleClass: function (a, b) { var c = typeof a; return "boolean" == typeof b && "string" === c ? b ? this.addClass(a) : this.removeClass(a) : n.isFunction(a) ? this.each(function (c) { n(this).toggleClass(a.call(this, c, Cb(this), b), b) }) : this.each(function () { var b, d, e, f; if ("string" === c) { d = 0, e = n(this), f = a.match(G) || []; while (b = f[d++]) e.hasClass(b) ? e.removeClass(b) : e.addClass(b) } else void 0 !== a && "boolean" !== c || (b = Cb(this), b && n._data(this, "__className__", b), n.attr(this, "class", b || a === !1 ? "" : n._data(this, "__className__") || "")) }) }, hasClass: function (a) { var b, c, d = 0; b = " " + a + " "; while (c = this[d++]) if (1 === c.nodeType && (" " + Cb(c) + " ").replace(Bb, " ").indexOf(b) > -1) return !0; return !1 } }), n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "), function (a, b) { n.fn[b] = function (a, c) { return arguments.length > 0 ? this.on(b, null, a, c) : this.trigger(b) } }), n.fn.extend({ hover: function (a, b) { return this.mouseenter(a).mouseleave(b || a) } }); var Db = a.location, Eb = n.now(), Fb = /\?/, Gb = /(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g; n.parseJSON = function (b) { if (a.JSON && a.JSON.parse) return a.JSON.parse(b + ""); var c, d = null, e = n.trim(b + ""); return e && !n.trim(e.replace(Gb, function (a, b, e, f) { return c && b && (d = 0), 0 === d ? a : (c = e || b, d += !f - !e, "") })) ? Function("return " + e)() : n.error("Invalid JSON: " + b) }, n.parseXML = function (b) { var c, d; if (!b || "string" != typeof b) return null; try { a.DOMParser ? (d = new a.DOMParser, c = d.parseFromString(b, "text/xml")) : (c = new a.ActiveXObject("Microsoft.XMLDOM"), c.async = "false", c.loadXML(b)) } catch (e) { c = void 0 } return c && c.documentElement && !c.getElementsByTagName("parsererror").length || n.error("Invalid XML: " + b), c }; var Hb = /#.*$/, Ib = /([?&])_=[^&]*/, Jb = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm, Kb = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, Lb = /^(?:GET|HEAD)$/, Mb = /^\/\//, Nb = /^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/, Ob = {}, Pb = {}, Qb = "*/".concat("*"), Rb = Db.href, Sb = Nb.exec(Rb.toLowerCase()) || []; function Tb(a) { return function (b, c) { "string" != typeof b && (c = b, b = "*"); var d, e = 0, f = b.toLowerCase().match(G) || []; if (n.isFunction(c)) while (d = f[e++]) "+" === d.charAt(0) ? (d = d.slice(1) || "*", (a[d] = a[d] || []).unshift(c)) : (a[d] = a[d] || []).push(c) } } function Ub(a, b, c, d) { var e = {}, f = a === Pb; function g(h) { var i; return e[h] = !0, n.each(a[h] || [], function (a, h) { var j = h(b, c, d); return "string" != typeof j || f || e[j] ? f ? !(i = j) : void 0 : (b.dataTypes.unshift(j), g(j), !1) }), i } return g(b.dataTypes[0]) || !e["*"] && g("*") } function Vb(a, b) { var c, d, e = n.ajaxSettings.flatOptions || {}; for (d in b) void 0 !== b[d] && ((e[d] ? a : c || (c = {}))[d] = b[d]); return c && n.extend(!0, a, c), a } function Wb(a, b, c) { var d, e, f, g, h = a.contents, i = a.dataTypes; while ("*" === i[0]) i.shift(), void 0 === e && (e = a.mimeType || b.getResponseHeader("Content-Type")); if (e) for (g in h) if (h[g] && h[g].test(e)) { i.unshift(g); break } if (i[0] in c) f = i[0]; else { for (g in c) { if (!i[0] || a.converters[g + " " + i[0]]) { f = g; break } d || (d = g) } f = f || d } return f ? (f !== i[0] && i.unshift(f), c[f]) : void 0 } function Xb(a, b, c, d) { var e, f, g, h, i, j = {}, k = a.dataTypes.slice(); if (k[1]) for (g in a.converters) j[g.toLowerCase()] = a.converters[g]; f = k.shift(); while (f) if (a.responseFields[f] && (c[a.responseFields[f]] = b), !i && d && a.dataFilter && (b = a.dataFilter(b, a.dataType)), i = f, f = k.shift()) if ("*" === f) f = i; else if ("*" !== i && i !== f) { if (g = j[i + " " + f] || j["* " + f], !g) for (e in j) if (h = e.split(" "), h[1] === f && (g = j[i + " " + h[0]] || j["* " + h[0]])) { g === !0 ? g = j[e] : j[e] !== !0 && (f = h[0], k.unshift(h[1])); break } if (g !== !0) if (g && a["throws"]) b = g(b); else try { b = g(b) } catch (l) { return { state: "parsererror", error: g ? l : "No conversion from " + i + " to " + f } } } return { state: "success", data: b } } n.extend({ active: 0, lastModified: {}, etag: {}, ajaxSettings: { url: Rb, type: "GET", isLocal: Kb.test(Sb[1]), global: !0, processData: !0, async: !0, contentType: "application/x-www-form-urlencoded; charset=UTF-8", accepts: { "*": Qb, text: "text/plain", html: "text/html", xml: "application/xml, text/xml", json: "application/json, text/javascript" }, contents: { xml: /\bxml\b/, html: /\bhtml/, json: /\bjson\b/ }, responseFields: { xml: "responseXML", text: "responseText", json: "responseJSON" }, converters: { "* text": String, "text html": !0, "text json": n.parseJSON, "text xml": n.parseXML }, flatOptions: { url: !0, context: !0 } }, ajaxSetup: function (a, b) { return b ? Vb(Vb(a, n.ajaxSettings), b) : Vb(n.ajaxSettings, a) }, ajaxPrefilter: Tb(Ob), ajaxTransport: Tb(Pb), ajax: function (b, c) { "object" == typeof b && (c = b, b = void 0), c = c || {}; var d, e, f, g, h, i, j, k, l = n.ajaxSetup({}, c), m = l.context || l, o = l.context && (m.nodeType || m.jquery) ? n(m) : n.event, p = n.Deferred(), q = n.Callbacks("once memory"), r = l.statusCode || {}, s = {}, t = {}, u = 0, v = "canceled", w = { readyState: 0, getResponseHeader: function (a) { var b; if (2 === u) { if (!k) { k = {}; while (b = Jb.exec(g)) k[b[1].toLowerCase()] = b[2] } b = k[a.toLowerCase()] } return null == b ? null : b }, getAllResponseHeaders: function () { return 2 === u ? g : null }, setRequestHeader: function (a, b) { var c = a.toLowerCase(); return u || (a = t[c] = t[c] || a, s[a] = b), this }, overrideMimeType: function (a) { return u || (l.mimeType = a), this }, statusCode: function (a) { var b; if (a) if (2 > u) for (b in a) r[b] = [r[b], a[b]]; else w.always(a[w.status]); return this }, abort: function (a) { var b = a || v; return j && j.abort(b), y(0, b), this } }; if (p.promise(w).complete = q.add, w.success = w.done, w.error = w.fail, l.url = ((b || l.url || Rb) + "").replace(Hb, "").replace(Mb, Sb[1] + "//"), l.type = c.method || c.type || l.method || l.type, l.dataTypes = n.trim(l.dataType || "*").toLowerCase().match(G) || [""], null == l.crossDomain && (d = Nb.exec(l.url.toLowerCase()), l.crossDomain = !(!d || d[1] === Sb[1] && d[2] === Sb[2] && (d[3] || ("http:" === d[1] ? "80" : "443")) === (Sb[3] || ("http:" === Sb[1] ? "80" : "443")))), l.data && l.processData && "string" != typeof l.data && (l.data = n.param(l.data, l.traditional)), Ub(Ob, l, c, w), 2 === u) return w; i = n.event && l.global, i && 0 === n.active++ && n.event.trigger("ajaxStart"), l.type = l.type.toUpperCase(), l.hasContent = !Lb.test(l.type), f = l.url, l.hasContent || (l.data && (f = l.url += (Fb.test(f) ? "&" : "?") + l.data, delete l.data), l.cache === !1 && (l.url = Ib.test(f) ? f.replace(Ib, "$1_=" + Eb++) : f + (Fb.test(f) ? "&" : "?") + "_=" + Eb++)), l.ifModified && (n.lastModified[f] && w.setRequestHeader("If-Modified-Since", n.lastModified[f]), n.etag[f] && w.setRequestHeader("If-None-Match", n.etag[f])), (l.data && l.hasContent && l.contentType !== !1 || c.contentType) && w.setRequestHeader("Content-Type", l.contentType), w.setRequestHeader("Accept", l.dataTypes[0] && l.accepts[l.dataTypes[0]] ? l.accepts[l.dataTypes[0]] + ("*" !== l.dataTypes[0] ? ", " + Qb + "; q=0.01" : "") : l.accepts["*"]); for (e in l.headers) w.setRequestHeader(e, l.headers[e]); if (l.beforeSend && (l.beforeSend.call(m, w, l) === !1 || 2 === u)) return w.abort(); v = "abort"; for (e in { success: 1, error: 1, complete: 1 }) w[e](l[e]); if (j = Ub(Pb, l, c, w)) { if (w.readyState = 1, i && o.trigger("ajaxSend", [w, l]), 2 === u) return w; l.async && l.timeout > 0 && (h = a.setTimeout(function () { w.abort("timeout") }, l.timeout)); try { u = 1, j.send(s, y) } catch (x) { if (!(2 > u)) throw x; y(-1, x) } } else y(-1, "No Transport"); function y(b, c, d, e) { var k, s, t, v, x, y = c; 2 !== u && (u = 2, h && a.clearTimeout(h), j = void 0, g = e || "", w.readyState = b > 0 ? 4 : 0, k = b >= 200 && 300 > b || 304 === b, d && (v = Wb(l, w, d)), v = Xb(l, v, w, k), k ? (l.ifModified && (x = w.getResponseHeader("Last-Modified"), x && (n.lastModified[f] = x), x = w.getResponseHeader("etag"), x && (n.etag[f] = x)), 204 === b || "HEAD" === l.type ? y = "nocontent" : 304 === b ? y = "notmodified" : (y = v.state, s = v.data, t = v.error, k = !t)) : (t = y, !b && y || (y = "error", 0 > b && (b = 0))), w.status = b, w.statusText = (c || y) + "", k ? p.resolveWith(m, [s, y, w]) : p.rejectWith(m, [w, y, t]), w.statusCode(r), r = void 0, i && o.trigger(k ? "ajaxSuccess" : "ajaxError", [w, l, k ? s : t]), q.fireWith(m, [w, y]), i && (o.trigger("ajaxComplete", [w, l]), --n.active || n.event.trigger("ajaxStop"))) } return w }, getJSON: function (a, b, c) { return n.get(a, b, c, "json") }, getScript: function (a, b) { return n.get(a, void 0, b, "script") } }), n.each(["get", "post"], function (a, b) { n[b] = function (a, c, d, e) { return n.isFunction(c) && (e = e || d, d = c, c = void 0), n.ajax(n.extend({ url: a, type: b, dataType: e, data: c, success: d }, n.isPlainObject(a) && a)) } }), n._evalUrl = function (a) { return n.ajax({ url: a, type: "GET", dataType: "script", cache: !0, async: !1, global: !1, "throws": !0 }) }, n.fn.extend({ wrapAll: function (a) { if (n.isFunction(a)) return this.each(function (b) { n(this).wrapAll(a.call(this, b)) }); if (this[0]) { var b = n(a, this[0].ownerDocument).eq(0).clone(!0); this[0].parentNode && b.insertBefore(this[0]), b.map(function () { var a = this; while (a.firstChild && 1 === a.firstChild.nodeType) a = a.firstChild; return a }).append(this) } return this }, wrapInner: function (a) { return n.isFunction(a) ? this.each(function (b) { n(this).wrapInner(a.call(this, b)) }) : this.each(function () { var b = n(this), c = b.contents(); c.length ? c.wrapAll(a) : b.append(a) }) }, wrap: function (a) { var b = n.isFunction(a); return this.each(function (c) { n(this).wrapAll(b ? a.call(this, c) : a) }) }, unwrap: function () { return this.parent().each(function () { n.nodeName(this, "body") || n(this).replaceWith(this.childNodes) }).end() } }); function Yb(a) { return a.style && a.style.display || n.css(a, "display") } function Zb(a) { if (!n.contains(a.ownerDocument || d, a)) return !0; while (a && 1 === a.nodeType) { if ("none" === Yb(a) || "hidden" === a.type) return !0; a = a.parentNode } return !1 } n.expr.filters.hidden = function (a) { return l.reliableHiddenOffsets() ? a.offsetWidth <= 0 && a.offsetHeight <= 0 && !a.getClientRects().length : Zb(a) }, n.expr.filters.visible = function (a) { return !n.expr.filters.hidden(a) }; var $b = /%20/g, _b = /\[\]$/, ac = /\r?\n/g, bc = /^(?:submit|button|image|reset|file)$/i, cc = /^(?:input|select|textarea|keygen)/i; function dc(a, b, c, d) { var e; if (n.isArray(b)) n.each(b, function (b, e) { c || _b.test(a) ? d(a, e) : dc(a + "[" + ("object" == typeof e && null != e ? b : "") + "]", e, c, d) }); else if (c || "object" !== n.type(b)) d(a, b); else for (e in b) dc(a + "[" + e + "]", b[e], c, d) } n.param = function (a, b) { var c, d = [], e = function (a, b) { b = n.isFunction(b) ? b() : null == b ? "" : b, d[d.length] = encodeURIComponent(a) + "=" + encodeURIComponent(b) }; if (void 0 === b && (b = n.ajaxSettings && n.ajaxSettings.traditional), n.isArray(a) || a.jquery && !n.isPlainObject(a)) n.each(a, function () { e(this.name, this.value) }); else for (c in a) dc(c, a[c], b, e); return d.join("&").replace($b, "+") }, n.fn.extend({ serialize: function () { return n.param(this.serializeArray()) }, serializeArray: function () { return this.map(function () { var a = n.prop(this, "elements"); return a ? n.makeArray(a) : this }).filter(function () { var a = this.type; return this.name && !n(this).is(":disabled") && cc.test(this.nodeName) && !bc.test(a) && (this.checked || !Z.test(a)) }).map(function (a, b) { var c = n(this).val(); return null == c ? null : n.isArray(c) ? n.map(c, function (a) { return { name: b.name, value: a.replace(ac, "\r\n") } }) : { name: b.name, value: c.replace(ac, "\r\n") } }).get() } }), n.ajaxSettings.xhr = void 0 !== a.ActiveXObject ? function () { return this.isLocal ? ic() : d.documentMode > 8 ? hc() : /^(get|post|head|put|delete|options)$/i.test(this.type) && hc() || ic() } : hc; var ec = 0, fc = {}, gc = n.ajaxSettings.xhr(); a.attachEvent && a.attachEvent("onunload", function () { for (var a in fc) fc[a](void 0, !0) }), l.cors = !!gc && "withCredentials" in gc, gc = l.ajax = !!gc, gc && n.ajaxTransport(function (b) { if (!b.crossDomain || l.cors) { var c; return { send: function (d, e) { var f, g = b.xhr(), h = ++ec; if (g.open(b.type, b.url, b.async, b.username, b.password), b.xhrFields) for (f in b.xhrFields) g[f] = b.xhrFields[f]; b.mimeType && g.overrideMimeType && g.overrideMimeType(b.mimeType), b.crossDomain || d["X-Requested-With"] || (d["X-Requested-With"] = "XMLHttpRequest"); for (f in d) void 0 !== d[f] && g.setRequestHeader(f, d[f] + ""); g.send(b.hasContent && b.data || null), c = function (a, d) { var f, i, j; if (c && (d || 4 === g.readyState)) if (delete fc[h], c = void 0, g.onreadystatechange = n.noop, d) 4 !== g.readyState && g.abort(); else { j = {}, f = g.status, "string" == typeof g.responseText && (j.text = g.responseText); try { i = g.statusText } catch (k) { i = "" } f || !b.isLocal || b.crossDomain ? 1223 === f && (f = 204) : f = j.text ? 200 : 404 } j && e(f, i, j, g.getAllResponseHeaders()) }, b.async ? 4 === g.readyState ? a.setTimeout(c) : g.onreadystatechange = fc[h] = c : c() }, abort: function () { c && c(void 0, !0) } } } }); function hc() { try { return new a.XMLHttpRequest } catch (b) { } } function ic() { try { return new a.ActiveXObject("Microsoft.XMLHTTP") } catch (b) { } } n.ajaxSetup({ accepts: { script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript" }, contents: { script: /\b(?:java|ecma)script\b/ }, converters: { "text script": function (a) { return n.globalEval(a), a } } }), n.ajaxPrefilter("script", function (a) { void 0 === a.cache && (a.cache = !1), a.crossDomain && (a.type = "GET", a.global = !1) }), n.ajaxTransport("script", function (a) { if (a.crossDomain) { var b, c = d.head || n("head")[0] || d.documentElement; return { send: function (e, f) { b = d.createElement("script"), b.async = !0, a.scriptCharset && (b.charset = a.scriptCharset), b.src = a.url, b.onload = b.onreadystatechange = function (a, c) { (c || !b.readyState || /loaded|complete/.test(b.readyState)) && (b.onload = b.onreadystatechange = null, b.parentNode && b.parentNode.removeChild(b), b = null, c || f(200, "success")) }, c.insertBefore(b, c.firstChild) }, abort: function () { b && b.onload(void 0, !0) } } } }); var jc = [], kc = /(=)\?(?=&|$)|\?\?/; n.ajaxSetup({ jsonp: "callback", jsonpCallback: function () { var a = jc.pop() || n.expando + "_" + Eb++; return this[a] = !0, a } }), n.ajaxPrefilter("json jsonp", function (b, c, d) { var e, f, g, h = b.jsonp !== !1 && (kc.test(b.url) ? "url" : "string" == typeof b.data && 0 === (b.contentType || "").indexOf("application/x-www-form-urlencoded") && kc.test(b.data) && "data"); return h || "jsonp" === b.dataTypes[0] ? (e = b.jsonpCallback = n.isFunction(b.jsonpCallback) ? b.jsonpCallback() : b.jsonpCallback, h ? b[h] = b[h].replace(kc, "$1" + e) : b.jsonp !== !1 && (b.url += (Fb.test(b.url) ? "&" : "?") + b.jsonp + "=" + e), b.converters["script json"] = function () { return g || n.error(e + " was not called"), g[0] }, b.dataTypes[0] = "json", f = a[e], a[e] = function () { g = arguments }, d.always(function () { void 0 === f ? n(a).removeProp(e) : a[e] = f, b[e] && (b.jsonpCallback = c.jsonpCallback, jc.push(e)), g && n.isFunction(f) && f(g[0]), g = f = void 0 }), "script") : void 0 }), n.parseHTML = function (a, b, c) { if (!a || "string" != typeof a) return null; "boolean" == typeof b && (c = b, b = !1), b = b || d; var e = x.exec(a), f = !c && []; return e ? [b.createElement(e[1])] : (e = ja([a], b, f), f && f.length && n(f).remove(), n.merge([], e.childNodes)) }; var lc = n.fn.load; n.fn.load = function (a, b, c) { if ("string" != typeof a && lc) return lc.apply(this, arguments); var d, e, f, g = this, h = a.indexOf(" "); return h > -1 && (d = n.trim(a.slice(h, a.length)), a = a.slice(0, h)), n.isFunction(b) ? (c = b, b = void 0) : b && "object" == typeof b && (e = "POST"), g.length > 0 && n.ajax({ url: a, type: e || "GET", dataType: "html", data: b }).done(function (a) { f = arguments, g.html(d ? n("<div>").append(n.parseHTML(a)).find(d) : a) }).always(c && function (a, b) { g.each(function () { c.apply(this, f || [a.responseText, b, a]) }) }), this }, n.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function (a, b) { n.fn[b] = function (a) { return this.on(b, a) } }), n.expr.filters.animated = function (a) { return n.grep(n.timers, function (b) { return a === b.elem }).length }; function mc(a) { return n.isWindow(a) ? a : 9 === a.nodeType ? a.defaultView || a.parentWindow : !1 } n.offset = { setOffset: function (a, b, c) { var d, e, f, g, h, i, j, k = n.css(a, "position"), l = n(a), m = {}; "static" === k && (a.style.position = "relative"), h = l.offset(), f = n.css(a, "top"), i = n.css(a, "left"), j = ("absolute" === k || "fixed" === k) && n.inArray("auto", [f, i]) > -1, j ? (d = l.position(), g = d.top, e = d.left) : (g = parseFloat(f) || 0, e = parseFloat(i) || 0), n.isFunction(b) && (b = b.call(a, c, n.extend({}, h))), null != b.top && (m.top = b.top - h.top + g), null != b.left && (m.left = b.left - h.left + e), "using" in b ? b.using.call(a, m) : l.css(m) } }, n.fn.extend({ offset: function (a) { if (arguments.length) return void 0 === a ? this : this.each(function (b) { n.offset.setOffset(this, a, b) }); var b, c, d = { top: 0, left: 0 }, e = this[0], f = e && e.ownerDocument; if (f) return b = f.documentElement, n.contains(b, e) ? ("undefined" != typeof e.getBoundingClientRect && (d = e.getBoundingClientRect()), c = mc(f), { top: d.top + (c.pageYOffset || b.scrollTop) - (b.clientTop || 0), left: d.left + (c.pageXOffset || b.scrollLeft) - (b.clientLeft || 0) }) : d }, position: function () { if (this[0]) { var a, b, c = { top: 0, left: 0 }, d = this[0]; return "fixed" === n.css(d, "position") ? b = d.getBoundingClientRect() : (a = this.offsetParent(), b = this.offset(), n.nodeName(a[0], "html") || (c = a.offset()), c.top += n.css(a[0], "borderTopWidth", !0), c.left += n.css(a[0], "borderLeftWidth", !0)), { top: b.top - c.top - n.css(d, "marginTop", !0), left: b.left - c.left - n.css(d, "marginLeft", !0) } } }, offsetParent: function () { return this.map(function () { var a = this.offsetParent; while (a && !n.nodeName(a, "html") && "static" === n.css(a, "position")) a = a.offsetParent; return a || Qa }) } }), n.each({ scrollLeft: "pageXOffset", scrollTop: "pageYOffset" }, function (a, b) { var c = /Y/.test(b); n.fn[a] = function (d) { return Y(this, function (a, d, e) { var f = mc(a); return void 0 === e ? f ? b in f ? f[b] : f.document.documentElement[d] : a[d] : void (f ? f.scrollTo(c ? n(f).scrollLeft() : e, c ? e : n(f).scrollTop()) : a[d] = e) }, a, d, arguments.length, null) } }), n.each(["top", "left"], function (a, b) { n.cssHooks[b] = Ua(l.pixelPosition, function (a, c) { return c ? (c = Sa(a, b), Oa.test(c) ? n(a).position()[b] + "px" : c) : void 0 }) }), n.each({ Height: "height", Width: "width" }, function (a, b) {
        n.each({
            padding: "inner" + a, content: b, "": "outer" + a
        }, function (c, d) { n.fn[d] = function (d, e) { var f = arguments.length && (c || "boolean" != typeof d), g = c || (d === !0 || e === !0 ? "margin" : "border"); return Y(this, function (b, c, d) { var e; return n.isWindow(b) ? b.document.documentElement["client" + a] : 9 === b.nodeType ? (e = b.documentElement, Math.max(b.body["scroll" + a], e["scroll" + a], b.body["offset" + a], e["offset" + a], e["client" + a])) : void 0 === d ? n.css(b, c, g) : n.style(b, c, d, g) }, b, f ? d : void 0, f, null) } })
    }), n.fn.extend({ bind: function (a, b, c) { return this.on(a, null, b, c) }, unbind: function (a, b) { return this.off(a, null, b) }, delegate: function (a, b, c, d) { return this.on(b, a, c, d) }, undelegate: function (a, b, c) { return 1 === arguments.length ? this.off(a, "**") : this.off(b, a || "**", c) } }), n.fn.size = function () { return this.length }, n.fn.andSelf = n.fn.addBack, "function" == typeof define && define.amd && define("jquery", [], function () { return n }); var nc = a.jQuery, oc = a.$; return n.noConflict = function (b) { return a.$ === n && (a.$ = oc), b && a.jQuery === n && (a.jQuery = nc), n }, b || (a.jQuery = a.$ = n), n
});

/*! jQuery UI - v1.12.1 - 2018-01-07
* http://jqueryui.com
* Includes: widget.js, position.js, data.js, disable-selection.js, focusable.js, form-reset-mixin.js, jquery-1-7.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/draggable.js, widgets/droppable.js, widgets/resizable.js, widgets/selectable.js, widgets/sortable.js, widgets/accordion.js, widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js, widgets/menu.js, widgets/mouse.js, widgets/progressbar.js, widgets/selectmenu.js, widgets/slider.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

(function (factory) {
    if (typeof define === "function" && define.amd) {

        // AMD. Register as an anonymous module.
        define(["jquery"], factory);
    } else {

        // Browser globals
        factory(jQuery);
    }
}(function ($) {

    $.ui = $.ui || {};

    var version = $.ui.version = "1.12.1";


    /*!
     * jQuery UI Widget 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Widget
    //>>group: Core
    //>>description: Provides a factory for creating stateful widgets with a common API.
    //>>docs: http://api.jqueryui.com/jQuery.widget/
    //>>demos: http://jqueryui.com/widget/



    var widgetUuid = 0;
    var widgetSlice = Array.prototype.slice;

    $.cleanData = (function (orig) {
        return function (elems) {
            var events, elem, i;
            for (i = 0; (elem = elems[i]) != null; i++) {
                try {

                    // Only trigger remove when necessary to save time
                    events = $._data(elem, "events");
                    if (events && events.remove) {
                        $(elem).triggerHandler("remove");
                    }

                    // Http://bugs.jquery.com/ticket/8235
                } catch (e) { }
            }
            orig(elems);
        };
    })($.cleanData);

    $.widget = function (name, base, prototype) {
        var existingConstructor, constructor, basePrototype;

        // ProxiedPrototype allows the provided prototype to remain unmodified
        // so that it can be used as a mixin for multiple widgets (#8876)
        var proxiedPrototype = {};

        var namespace = name.split(".")[0];
        name = name.split(".")[1];
        var fullName = namespace + "-" + name;

        if (!prototype) {
            prototype = base;
            base = $.Widget;
        }

        if ($.isArray(prototype)) {
            prototype = $.extend.apply(null, [{}].concat(prototype));
        }

        // Create selector for plugin
        $.expr[":"][fullName.toLowerCase()] = function (elem) {
            return !!$.data(elem, fullName);
        };

        $[namespace] = $[namespace] || {};
        existingConstructor = $[namespace][name];
        constructor = $[namespace][name] = function (options, element) {

            // Allow instantiation without "new" keyword
            if (!this._createWidget) {
                return new constructor(options, element);
            }

            // Allow instantiation without initializing for simple inheritance
            // must use "new" keyword (the code above always passes args)
            if (arguments.length) {
                this._createWidget(options, element);
            }
        };

        // Extend with the existing constructor to carry over any static properties
        $.extend(constructor, existingConstructor, {
            version: prototype.version,

            // Copy the object used to create the prototype in case we need to
            // redefine the widget later
            _proto: $.extend({}, prototype),

            // Track widgets that inherit from this widget in case this widget is
            // redefined after a widget inherits from it
            _childConstructors: []
        });

        basePrototype = new base();

        // We need to make the options hash a property directly on the new instance
        // otherwise we'll modify the options hash on the prototype that we're
        // inheriting from
        basePrototype.options = $.widget.extend({}, basePrototype.options);
        $.each(prototype, function (prop, value) {
            if (!$.isFunction(value)) {
                proxiedPrototype[prop] = value;
                return;
            }
            proxiedPrototype[prop] = (function () {
                function _super() {
                    return base.prototype[prop].apply(this, arguments);
                }

                function _superApply(args) {
                    return base.prototype[prop].apply(this, args);
                }

                return function () {
                    var __super = this._super;
                    var __superApply = this._superApply;
                    var returnValue;

                    this._super = _super;
                    this._superApply = _superApply;

                    returnValue = value.apply(this, arguments);

                    this._super = __super;
                    this._superApply = __superApply;

                    return returnValue;
                };
            })();
        });
        constructor.prototype = $.widget.extend(basePrototype, {

            // TODO: remove support for widgetEventPrefix
            // always use the name + a colon as the prefix, e.g., draggable:start
            // don't prefix for widgets that aren't DOM-based
            widgetEventPrefix: existingConstructor ? (basePrototype.widgetEventPrefix || name) : name
        }, proxiedPrototype, {
                constructor: constructor,
                namespace: namespace,
                widgetName: name,
                widgetFullName: fullName
            });

        // If this widget is being redefined then we need to find all widgets that
        // are inheriting from it and redefine all of them so that they inherit from
        // the new version of this widget. We're essentially trying to replace one
        // level in the prototype chain.
        if (existingConstructor) {
            $.each(existingConstructor._childConstructors, function (i, child) {
                var childPrototype = child.prototype;

                // Redefine the child widget using the same prototype that was
                // originally used, but inherit from the new version of the base
                $.widget(childPrototype.namespace + "." + childPrototype.widgetName, constructor,
                    child._proto);
            });

            // Remove the list of existing child constructors from the old constructor
            // so the old child constructors can be garbage collected
            delete existingConstructor._childConstructors;
        } else {
            base._childConstructors.push(constructor);
        }

        $.widget.bridge(name, constructor);

        return constructor;
    };

    $.widget.extend = function (target) {
        var input = widgetSlice.call(arguments, 1);
        var inputIndex = 0;
        var inputLength = input.length;
        var key;
        var value;

        for (; inputIndex < inputLength; inputIndex++) {
            for (key in input[inputIndex]) {
                value = input[inputIndex][key];
                if (input[inputIndex].hasOwnProperty(key) && value !== undefined) {

                    // Clone objects
                    if ($.isPlainObject(value)) {
                        target[key] = $.isPlainObject(target[key]) ?
                            $.widget.extend({}, target[key], value) :

                            // Don't extend strings, arrays, etc. with objects
                            $.widget.extend({}, value);

                        // Copy everything else by reference
                    } else {
                        target[key] = value;
                    }
                }
            }
        }
        return target;
    };

    $.widget.bridge = function (name, object) {
        var fullName = object.prototype.widgetFullName || name;
        $.fn[name] = function (options) {
            var isMethodCall = typeof options === "string";
            var args = widgetSlice.call(arguments, 1);
            var returnValue = this;

            if (isMethodCall) {

                // If this is an empty collection, we need to have the instance method
                // return undefined instead of the jQuery instance
                if (!this.length && options === "instance") {
                    returnValue = undefined;
                } else {
                    this.each(function () {
                        var methodValue;
                        var instance = $.data(this, fullName);

                        if (options === "instance") {
                            returnValue = instance;
                            return false;
                        }

                        if (!instance) {
                            return $.error("cannot call methods on " + name +
                                " prior to initialization; " +
                                "attempted to call method '" + options + "'");
                        }

                        if (!$.isFunction(instance[options]) || options.charAt(0) === "_") {
                            return $.error("no such method '" + options + "' for " + name +
                                " widget instance");
                        }

                        methodValue = instance[options].apply(instance, args);

                        if (methodValue !== instance && methodValue !== undefined) {
                            returnValue = methodValue && methodValue.jquery ?
                                returnValue.pushStack(methodValue.get()) :
                                methodValue;
                            return false;
                        }
                    });
                }
            } else {

                // Allow multiple hashes to be passed on init
                if (args.length) {
                    options = $.widget.extend.apply(null, [options].concat(args));
                }

                this.each(function () {
                    var instance = $.data(this, fullName);
                    if (instance) {
                        instance.option(options || {});
                        if (instance._init) {
                            instance._init();
                        }
                    } else {
                        $.data(this, fullName, new object(options, this));
                    }
                });
            }

            return returnValue;
        };
    };

    $.Widget = function ( /* options, element */) { };
    $.Widget._childConstructors = [];

    $.Widget.prototype = {
        widgetName: "widget",
        widgetEventPrefix: "",
        defaultElement: "<div>",

        options: {
            classes: {},
            disabled: false,

            // Callbacks
            create: null
        },

        _createWidget: function (options, element) {
            element = $(element || this.defaultElement || this)[0];
            this.element = $(element);
            this.uuid = widgetUuid++;
            this.eventNamespace = "." + this.widgetName + this.uuid;

            this.bindings = $();
            this.hoverable = $();
            this.focusable = $();
            this.classesElementLookup = {};

            if (element !== this) {
                $.data(element, this.widgetFullName, this);
                this._on(true, this.element, {
                    remove: function (event) {
                        if (event.target === element) {
                            this.destroy();
                        }
                    }
                });
                this.document = $(element.style ?

                    // Element within the document
                    element.ownerDocument :

                    // Element is window or document
                    element.document || element);
                this.window = $(this.document[0].defaultView || this.document[0].parentWindow);
            }

            this.options = $.widget.extend({},
                this.options,
                this._getCreateOptions(),
                options);

            this._create();

            if (this.options.disabled) {
                this._setOptionDisabled(this.options.disabled);
            }

            this._trigger("create", null, this._getCreateEventData());
            this._init();
        },

        _getCreateOptions: function () {
            return {};
        },

        _getCreateEventData: $.noop,

        _create: $.noop,

        _init: $.noop,

        destroy: function () {
            var that = this;

            this._destroy();
            $.each(this.classesElementLookup, function (key, value) {
                that._removeClass(value, key);
            });

            // We can probably remove the unbind calls in 2.0
            // all event bindings should go through this._on()
            this.element
                .off(this.eventNamespace)
                .removeData(this.widgetFullName);
            this.widget()
                .off(this.eventNamespace)
                .removeAttr("aria-disabled");

            // Clean up events and states
            this.bindings.off(this.eventNamespace);
        },

        _destroy: $.noop,

        widget: function () {
            return this.element;
        },

        option: function (key, value) {
            var options = key;
            var parts;
            var curOption;
            var i;

            if (arguments.length === 0) {

                // Don't return a reference to the internal hash
                return $.widget.extend({}, this.options);
            }

            if (typeof key === "string") {

                // Handle nested keys, e.g., "foo.bar" => { foo: { bar: ___ } }
                options = {};
                parts = key.split(".");
                key = parts.shift();
                if (parts.length) {
                    curOption = options[key] = $.widget.extend({}, this.options[key]);
                    for (i = 0; i < parts.length - 1; i++) {
                        curOption[parts[i]] = curOption[parts[i]] || {};
                        curOption = curOption[parts[i]];
                    }
                    key = parts.pop();
                    if (arguments.length === 1) {
                        return curOption[key] === undefined ? null : curOption[key];
                    }
                    curOption[key] = value;
                } else {
                    if (arguments.length === 1) {
                        return this.options[key] === undefined ? null : this.options[key];
                    }
                    options[key] = value;
                }
            }

            this._setOptions(options);

            return this;
        },

        _setOptions: function (options) {
            var key;

            for (key in options) {
                this._setOption(key, options[key]);
            }

            return this;
        },

        _setOption: function (key, value) {
            if (key === "classes") {
                this._setOptionClasses(value);
            }

            this.options[key] = value;

            if (key === "disabled") {
                this._setOptionDisabled(value);
            }

            return this;
        },

        _setOptionClasses: function (value) {
            var classKey, elements, currentElements;

            for (classKey in value) {
                currentElements = this.classesElementLookup[classKey];
                if (value[classKey] === this.options.classes[classKey] ||
                    !currentElements ||
                    !currentElements.length) {
                    continue;
                }

                // We are doing this to create a new jQuery object because the _removeClass() call
                // on the next line is going to destroy the reference to the current elements being
                // tracked. We need to save a copy of this collection so that we can add the new classes
                // below.
                elements = $(currentElements.get());
                this._removeClass(currentElements, classKey);

                // We don't use _addClass() here, because that uses this.options.classes
                // for generating the string of classes. We want to use the value passed in from
                // _setOption(), this is the new value of the classes option which was passed to
                // _setOption(). We pass this value directly to _classes().
                elements.addClass(this._classes({
                    element: elements,
                    keys: classKey,
                    classes: value,
                    add: true
                }));
            }
        },

        _setOptionDisabled: function (value) {
            this._toggleClass(this.widget(), this.widgetFullName + "-disabled", null, !!value);

            // If the widget is becoming disabled, then nothing is interactive
            if (value) {
                this._removeClass(this.hoverable, null, "ui-state-hover");
                this._removeClass(this.focusable, null, "ui-state-focus");
            }
        },

        enable: function () {
            return this._setOptions({ disabled: false });
        },

        disable: function () {
            return this._setOptions({ disabled: true });
        },

        _classes: function (options) {
            var full = [];
            var that = this;

            options = $.extend({
                element: this.element,
                classes: this.options.classes || {}
            }, options);

            function processClassString(classes, checkOption) {
                var current, i;
                for (i = 0; i < classes.length; i++) {
                    current = that.classesElementLookup[classes[i]] || $();
                    if (options.add) {
                        current = $($.unique(current.get().concat(options.element.get())));
                    } else {
                        current = $(current.not(options.element).get());
                    }
                    that.classesElementLookup[classes[i]] = current;
                    full.push(classes[i]);
                    if (checkOption && options.classes[classes[i]]) {
                        full.push(options.classes[classes[i]]);
                    }
                }
            }

            this._on(options.element, {
                "remove": "_untrackClassesElement"
            });

            if (options.keys) {
                processClassString(options.keys.match(/\S+/g) || [], true);
            }
            if (options.extra) {
                processClassString(options.extra.match(/\S+/g) || []);
            }

            return full.join(" ");
        },

        _untrackClassesElement: function (event) {
            var that = this;
            $.each(that.classesElementLookup, function (key, value) {
                if ($.inArray(event.target, value) !== -1) {
                    that.classesElementLookup[key] = $(value.not(event.target).get());
                }
            });
        },

        _removeClass: function (element, keys, extra) {
            return this._toggleClass(element, keys, extra, false);
        },

        _addClass: function (element, keys, extra) {
            return this._toggleClass(element, keys, extra, true);
        },

        _toggleClass: function (element, keys, extra, add) {
            add = (typeof add === "boolean") ? add : extra;
            var shift = (typeof element === "string" || element === null),
                options = {
                    extra: shift ? keys : extra,
                    keys: shift ? element : keys,
                    element: shift ? this.element : element,
                    add: add
                };
            options.element.toggleClass(this._classes(options), add);
            return this;
        },

        _on: function (suppressDisabledCheck, element, handlers) {
            var delegateElement;
            var instance = this;

            // No suppressDisabledCheck flag, shuffle arguments
            if (typeof suppressDisabledCheck !== "boolean") {
                handlers = element;
                element = suppressDisabledCheck;
                suppressDisabledCheck = false;
            }

            // No element argument, shuffle and use this.element
            if (!handlers) {
                handlers = element;
                element = this.element;
                delegateElement = this.widget();
            } else {
                element = delegateElement = $(element);
                this.bindings = this.bindings.add(element);
            }

            $.each(handlers, function (event, handler) {
                function handlerProxy() {

                    // Allow widgets to customize the disabled handling
                    // - disabled as an array instead of boolean
                    // - disabled class as method for disabling individual parts
                    if (!suppressDisabledCheck &&
                        (instance.options.disabled === true ||
                            $(this).hasClass("ui-state-disabled"))) {
                        return;
                    }
                    return (typeof handler === "string" ? instance[handler] : handler)
                        .apply(instance, arguments);
                }

                // Copy the guid so direct unbinding works
                if (typeof handler !== "string") {
                    handlerProxy.guid = handler.guid =
                        handler.guid || handlerProxy.guid || $.guid++;
                }

                var match = event.match(/^([\w:-]*)\s*(.*)$/);
                var eventName = match[1] + instance.eventNamespace;
                var selector = match[2];

                if (selector) {
                    delegateElement.on(eventName, selector, handlerProxy);
                } else {
                    element.on(eventName, handlerProxy);
                }
            });
        },

        _off: function (element, eventName) {
            eventName = (eventName || "").split(" ").join(this.eventNamespace + " ") +
                this.eventNamespace;
            element.off(eventName).off(eventName);

            // Clear the stack to avoid memory leaks (#10056)
            this.bindings = $(this.bindings.not(element).get());
            this.focusable = $(this.focusable.not(element).get());
            this.hoverable = $(this.hoverable.not(element).get());
        },

        _delay: function (handler, delay) {
            function handlerProxy() {
                return (typeof handler === "string" ? instance[handler] : handler)
                    .apply(instance, arguments);
            }
            var instance = this;
            return setTimeout(handlerProxy, delay || 0);
        },

        _hoverable: function (element) {
            this.hoverable = this.hoverable.add(element);
            this._on(element, {
                mouseenter: function (event) {
                    this._addClass($(event.currentTarget), null, "ui-state-hover");
                },
                mouseleave: function (event) {
                    this._removeClass($(event.currentTarget), null, "ui-state-hover");
                }
            });
        },

        _focusable: function (element) {
            this.focusable = this.focusable.add(element);
            this._on(element, {
                focusin: function (event) {
                    this._addClass($(event.currentTarget), null, "ui-state-focus");
                },
                focusout: function (event) {
                    this._removeClass($(event.currentTarget), null, "ui-state-focus");
                }
            });
        },

        _trigger: function (type, event, data) {
            var prop, orig;
            var callback = this.options[type];

            data = data || {};
            event = $.Event(event);
            event.type = (type === this.widgetEventPrefix ?
                type :
                this.widgetEventPrefix + type).toLowerCase();

            // The original event may come from any element
            // so we need to reset the target on the new event
            event.target = this.element[0];

            // Copy original event properties over to the new event
            orig = event.originalEvent;
            if (orig) {
                for (prop in orig) {
                    if (!(prop in event)) {
                        event[prop] = orig[prop];
                    }
                }
            }

            this.element.trigger(event, data);
            return !($.isFunction(callback) &&
                callback.apply(this.element[0], [event].concat(data)) === false ||
                event.isDefaultPrevented());
        }
    };

    $.each({ show: "fadeIn", hide: "fadeOut" }, function (method, defaultEffect) {
        $.Widget.prototype["_" + method] = function (element, options, callback) {
            if (typeof options === "string") {
                options = { effect: options };
            }

            var hasOptions;
            var effectName = !options ?
                method :
                options === true || typeof options === "number" ?
                    defaultEffect :
                    options.effect || defaultEffect;

            options = options || {};
            if (typeof options === "number") {
                options = { duration: options };
            }

            hasOptions = !$.isEmptyObject(options);
            options.complete = callback;

            if (options.delay) {
                element.delay(options.delay);
            }

            if (hasOptions && $.effects && $.effects.effect[effectName]) {
                element[method](options);
            } else if (effectName !== method && element[effectName]) {
                element[effectName](options.duration, options.easing, callback);
            } else {
                element.queue(function (next) {
                    $(this)[method]();
                    if (callback) {
                        callback.call(element[0]);
                    }
                    next();
                });
            }
        };
    });

    var widget = $.widget;


    /*!
     * jQuery UI Position 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     *
     * http://api.jqueryui.com/position/
     */

    //>>label: Position
    //>>group: Core
    //>>description: Positions elements relative to other elements.
    //>>docs: http://api.jqueryui.com/position/
    //>>demos: http://jqueryui.com/position/


    (function () {
        var cachedScrollbarWidth,
            max = Math.max,
            abs = Math.abs,
            rhorizontal = /left|center|right/,
            rvertical = /top|center|bottom/,
            roffset = /[\+\-]\d+(\.[\d]+)?%?/,
            rposition = /^\w+/,
            rpercent = /%$/,
            _position = $.fn.position;

        function getOffsets(offsets, width, height) {
            return [
                parseFloat(offsets[0]) * (rpercent.test(offsets[0]) ? width / 100 : 1),
                parseFloat(offsets[1]) * (rpercent.test(offsets[1]) ? height / 100 : 1)
            ];
        }

        function parseCss(element, property) {
            return parseInt($.css(element, property), 10) || 0;
        }

        function getDimensions(elem) {
            var raw = elem[0];
            if (raw.nodeType === 9) {
                return {
                    width: elem.width(),
                    height: elem.height(),
                    offset: { top: 0, left: 0 }
                };
            }
            if ($.isWindow(raw)) {
                return {
                    width: elem.width(),
                    height: elem.height(),
                    offset: { top: elem.scrollTop(), left: elem.scrollLeft() }
                };
            }
            if (raw.preventDefault) {
                return {
                    width: 0,
                    height: 0,
                    offset: { top: raw.pageY, left: raw.pageX }
                };
            }
            return {
                width: elem.outerWidth(),
                height: elem.outerHeight(),
                offset: elem.offset()
            };
        }

        $.position = {
            scrollbarWidth: function () {
                if (cachedScrollbarWidth !== undefined) {
                    return cachedScrollbarWidth;
                }
                var w1, w2,
                    div = $("<div " +
                        "style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'>" +
                        "<div style='height:100px;width:auto;'></div></div>"),
                    innerDiv = div.children()[0];

                $("body").append(div);
                w1 = innerDiv.offsetWidth;
                div.css("overflow", "scroll");

                w2 = innerDiv.offsetWidth;

                if (w1 === w2) {
                    w2 = div[0].clientWidth;
                }

                div.remove();

                return (cachedScrollbarWidth = w1 - w2);
            },
            getScrollInfo: function (within) {
                var overflowX = within.isWindow || within.isDocument ? "" :
                    within.element.css("overflow-x"),
                    overflowY = within.isWindow || within.isDocument ? "" :
                        within.element.css("overflow-y"),
                    hasOverflowX = overflowX === "scroll" ||
                        (overflowX === "auto" && within.width < within.element[0].scrollWidth),
                    hasOverflowY = overflowY === "scroll" ||
                        (overflowY === "auto" && within.height < within.element[0].scrollHeight);
                return {
                    width: hasOverflowY ? $.position.scrollbarWidth() : 0,
                    height: hasOverflowX ? $.position.scrollbarWidth() : 0
                };
            },
            getWithinInfo: function (element) {
                var withinElement = $(element || window),
                    isWindow = $.isWindow(withinElement[0]),
                    isDocument = !!withinElement[0] && withinElement[0].nodeType === 9,
                    hasOffset = !isWindow && !isDocument;
                return {
                    element: withinElement,
                    isWindow: isWindow,
                    isDocument: isDocument,
                    offset: hasOffset ? $(element).offset() : { left: 0, top: 0 },
                    scrollLeft: withinElement.scrollLeft(),
                    scrollTop: withinElement.scrollTop(),
                    width: withinElement.outerWidth(),
                    height: withinElement.outerHeight()
                };
            }
        };

        $.fn.position = function (options) {
            if (!options || !options.of) {
                return _position.apply(this, arguments);
            }

            // Make a copy, we don't want to modify arguments
            options = $.extend({}, options);

            var atOffset, targetWidth, targetHeight, targetOffset, basePosition, dimensions,
                target = $(options.of),
                within = $.position.getWithinInfo(options.within),
                scrollInfo = $.position.getScrollInfo(within),
                collision = (options.collision || "flip").split(" "),
                offsets = {};

            dimensions = getDimensions(target);
            if (target[0].preventDefault) {

                // Force left top to allow flipping
                options.at = "left top";
            }
            targetWidth = dimensions.width;
            targetHeight = dimensions.height;
            targetOffset = dimensions.offset;

            // Clone to reuse original targetOffset later
            basePosition = $.extend({}, targetOffset);

            // Force my and at to have valid horizontal and vertical positions
            // if a value is missing or invalid, it will be converted to center
            $.each(["my", "at"], function () {
                var pos = (options[this] || "").split(" "),
                    horizontalOffset,
                    verticalOffset;

                if (pos.length === 1) {
                    pos = rhorizontal.test(pos[0]) ?
                        pos.concat(["center"]) :
                        rvertical.test(pos[0]) ?
                            ["center"].concat(pos) :
                            ["center", "center"];
                }
                pos[0] = rhorizontal.test(pos[0]) ? pos[0] : "center";
                pos[1] = rvertical.test(pos[1]) ? pos[1] : "center";

                // Calculate offsets
                horizontalOffset = roffset.exec(pos[0]);
                verticalOffset = roffset.exec(pos[1]);
                offsets[this] = [
                    horizontalOffset ? horizontalOffset[0] : 0,
                    verticalOffset ? verticalOffset[0] : 0
                ];

                // Reduce to just the positions without the offsets
                options[this] = [
                    rposition.exec(pos[0])[0],
                    rposition.exec(pos[1])[0]
                ];
            });

            // Normalize collision option
            if (collision.length === 1) {
                collision[1] = collision[0];
            }

            if (options.at[0] === "right") {
                basePosition.left += targetWidth;
            } else if (options.at[0] === "center") {
                basePosition.left += targetWidth / 2;
            }

            if (options.at[1] === "bottom") {
                basePosition.top += targetHeight;
            } else if (options.at[1] === "center") {
                basePosition.top += targetHeight / 2;
            }

            atOffset = getOffsets(offsets.at, targetWidth, targetHeight);
            basePosition.left += atOffset[0];
            basePosition.top += atOffset[1];

            return this.each(function () {
                var collisionPosition, using,
                    elem = $(this),
                    elemWidth = elem.outerWidth(),
                    elemHeight = elem.outerHeight(),
                    marginLeft = parseCss(this, "marginLeft"),
                    marginTop = parseCss(this, "marginTop"),
                    collisionWidth = elemWidth + marginLeft + parseCss(this, "marginRight") +
                        scrollInfo.width,
                    collisionHeight = elemHeight + marginTop + parseCss(this, "marginBottom") +
                        scrollInfo.height,
                    position = $.extend({}, basePosition),
                    myOffset = getOffsets(offsets.my, elem.outerWidth(), elem.outerHeight());

                if (options.my[0] === "right") {
                    position.left -= elemWidth;
                } else if (options.my[0] === "center") {
                    position.left -= elemWidth / 2;
                }

                if (options.my[1] === "bottom") {
                    position.top -= elemHeight;
                } else if (options.my[1] === "center") {
                    position.top -= elemHeight / 2;
                }

                position.left += myOffset[0];
                position.top += myOffset[1];

                collisionPosition = {
                    marginLeft: marginLeft,
                    marginTop: marginTop
                };

                $.each(["left", "top"], function (i, dir) {
                    if ($.ui.position[collision[i]]) {
                        $.ui.position[collision[i]][dir](position, {
                            targetWidth: targetWidth,
                            targetHeight: targetHeight,
                            elemWidth: elemWidth,
                            elemHeight: elemHeight,
                            collisionPosition: collisionPosition,
                            collisionWidth: collisionWidth,
                            collisionHeight: collisionHeight,
                            offset: [atOffset[0] + myOffset[0], atOffset[1] + myOffset[1]],
                            my: options.my,
                            at: options.at,
                            within: within,
                            elem: elem
                        });
                    }
                });

                if (options.using) {

                    // Adds feedback as second argument to using callback, if present
                    using = function (props) {
                        var left = targetOffset.left - position.left,
                            right = left + targetWidth - elemWidth,
                            top = targetOffset.top - position.top,
                            bottom = top + targetHeight - elemHeight,
                            feedback = {
                                target: {
                                    element: target,
                                    left: targetOffset.left,
                                    top: targetOffset.top,
                                    width: targetWidth,
                                    height: targetHeight
                                },
                                element: {
                                    element: elem,
                                    left: position.left,
                                    top: position.top,
                                    width: elemWidth,
                                    height: elemHeight
                                },
                                horizontal: right < 0 ? "left" : left > 0 ? "right" : "center",
                                vertical: bottom < 0 ? "top" : top > 0 ? "bottom" : "middle"
                            };
                        if (targetWidth < elemWidth && abs(left + right) < targetWidth) {
                            feedback.horizontal = "center";
                        }
                        if (targetHeight < elemHeight && abs(top + bottom) < targetHeight) {
                            feedback.vertical = "middle";
                        }
                        if (max(abs(left), abs(right)) > max(abs(top), abs(bottom))) {
                            feedback.important = "horizontal";
                        } else {
                            feedback.important = "vertical";
                        }
                        options.using.call(this, props, feedback);
                    };
                }

                elem.offset($.extend(position, { using: using }));
            });
        };

        $.ui.position = {
            fit: {
                left: function (position, data) {
                    var within = data.within,
                        withinOffset = within.isWindow ? within.scrollLeft : within.offset.left,
                        outerWidth = within.width,
                        collisionPosLeft = position.left - data.collisionPosition.marginLeft,
                        overLeft = withinOffset - collisionPosLeft,
                        overRight = collisionPosLeft + data.collisionWidth - outerWidth - withinOffset,
                        newOverRight;

                    // Element is wider than within
                    if (data.collisionWidth > outerWidth) {

                        // Element is initially over the left side of within
                        if (overLeft > 0 && overRight <= 0) {
                            newOverRight = position.left + overLeft + data.collisionWidth - outerWidth -
                                withinOffset;
                            position.left += overLeft - newOverRight;

                            // Element is initially over right side of within
                        } else if (overRight > 0 && overLeft <= 0) {
                            position.left = withinOffset;

                            // Element is initially over both left and right sides of within
                        } else {
                            if (overLeft > overRight) {
                                position.left = withinOffset + outerWidth - data.collisionWidth;
                            } else {
                                position.left = withinOffset;
                            }
                        }

                        // Too far left -> align with left edge
                    } else if (overLeft > 0) {
                        position.left += overLeft;

                        // Too far right -> align with right edge
                    } else if (overRight > 0) {
                        position.left -= overRight;

                        // Adjust based on position and margin
                    } else {
                        position.left = max(position.left - collisionPosLeft, position.left);
                    }
                },
                top: function (position, data) {
                    var within = data.within,
                        withinOffset = within.isWindow ? within.scrollTop : within.offset.top,
                        outerHeight = data.within.height,
                        collisionPosTop = position.top - data.collisionPosition.marginTop,
                        overTop = withinOffset - collisionPosTop,
                        overBottom = collisionPosTop + data.collisionHeight - outerHeight - withinOffset,
                        newOverBottom;

                    // Element is taller than within
                    if (data.collisionHeight > outerHeight) {

                        // Element is initially over the top of within
                        if (overTop > 0 && overBottom <= 0) {
                            newOverBottom = position.top + overTop + data.collisionHeight - outerHeight -
                                withinOffset;
                            position.top += overTop - newOverBottom;

                            // Element is initially over bottom of within
                        } else if (overBottom > 0 && overTop <= 0) {
                            position.top = withinOffset;

                            // Element is initially over both top and bottom of within
                        } else {
                            if (overTop > overBottom) {
                                position.top = withinOffset + outerHeight - data.collisionHeight;
                            } else {
                                position.top = withinOffset;
                            }
                        }

                        // Too far up -> align with top
                    } else if (overTop > 0) {
                        position.top += overTop;

                        // Too far down -> align with bottom edge
                    } else if (overBottom > 0) {
                        position.top -= overBottom;

                        // Adjust based on position and margin
                    } else {
                        position.top = max(position.top - collisionPosTop, position.top);
                    }
                }
            },
            flip: {
                left: function (position, data) {
                    var within = data.within,
                        withinOffset = within.offset.left + within.scrollLeft,
                        outerWidth = within.width,
                        offsetLeft = within.isWindow ? within.scrollLeft : within.offset.left,
                        collisionPosLeft = position.left - data.collisionPosition.marginLeft,
                        overLeft = collisionPosLeft - offsetLeft,
                        overRight = collisionPosLeft + data.collisionWidth - outerWidth - offsetLeft,
                        myOffset = data.my[0] === "left" ?
                            -data.elemWidth :
                            data.my[0] === "right" ?
                                data.elemWidth :
                                0,
                        atOffset = data.at[0] === "left" ?
                            data.targetWidth :
                            data.at[0] === "right" ?
                                -data.targetWidth :
                                0,
                        offset = -2 * data.offset[0],
                        newOverRight,
                        newOverLeft;

                    if (overLeft < 0) {
                        newOverRight = position.left + myOffset + atOffset + offset + data.collisionWidth -
                            outerWidth - withinOffset;
                        if (newOverRight < 0 || newOverRight < abs(overLeft)) {
                            position.left += myOffset + atOffset + offset;
                        }
                    } else if (overRight > 0) {
                        newOverLeft = position.left - data.collisionPosition.marginLeft + myOffset +
                            atOffset + offset - offsetLeft;
                        if (newOverLeft > 0 || abs(newOverLeft) < overRight) {
                            position.left += myOffset + atOffset + offset;
                        }
                    }
                },
                top: function (position, data) {
                    var within = data.within,
                        withinOffset = within.offset.top + within.scrollTop,
                        outerHeight = within.height,
                        offsetTop = within.isWindow ? within.scrollTop : within.offset.top,
                        collisionPosTop = position.top - data.collisionPosition.marginTop,
                        overTop = collisionPosTop - offsetTop,
                        overBottom = collisionPosTop + data.collisionHeight - outerHeight - offsetTop,
                        top = data.my[1] === "top",
                        myOffset = top ?
                            -data.elemHeight :
                            data.my[1] === "bottom" ?
                                data.elemHeight :
                                0,
                        atOffset = data.at[1] === "top" ?
                            data.targetHeight :
                            data.at[1] === "bottom" ?
                                -data.targetHeight :
                                0,
                        offset = -2 * data.offset[1],
                        newOverTop,
                        newOverBottom;
                    if (overTop < 0) {
                        newOverBottom = position.top + myOffset + atOffset + offset + data.collisionHeight -
                            outerHeight - withinOffset;
                        if (newOverBottom < 0 || newOverBottom < abs(overTop)) {
                            position.top += myOffset + atOffset + offset;
                        }
                    } else if (overBottom > 0) {
                        newOverTop = position.top - data.collisionPosition.marginTop + myOffset + atOffset +
                            offset - offsetTop;
                        if (newOverTop > 0 || abs(newOverTop) < overBottom) {
                            position.top += myOffset + atOffset + offset;
                        }
                    }
                }
            },
            flipfit: {
                left: function () {
                    $.ui.position.flip.left.apply(this, arguments);
                    $.ui.position.fit.left.apply(this, arguments);
                },
                top: function () {
                    $.ui.position.flip.top.apply(this, arguments);
                    $.ui.position.fit.top.apply(this, arguments);
                }
            }
        };

    })();

    var position = $.ui.position;


    /*!
     * jQuery UI :data 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: :data Selector
    //>>group: Core
    //>>description: Selects elements which have data stored under the specified key.
    //>>docs: http://api.jqueryui.com/data-selector/


    var data = $.extend($.expr[":"], {
        data: $.expr.createPseudo ?
            $.expr.createPseudo(function (dataName) {
                return function (elem) {
                    return !!$.data(elem, dataName);
                };
            }) :

            // Support: jQuery <1.8
            function (elem, i, match) {
                return !!$.data(elem, match[3]);
            }
    });

    /*!
     * jQuery UI Disable Selection 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: disableSelection
    //>>group: Core
    //>>description: Disable selection of text content within the set of matched elements.
    //>>docs: http://api.jqueryui.com/disableSelection/

    // This file is deprecated


    var disableSelection = $.fn.extend({
        disableSelection: (function () {
            var eventType = "onselectstart" in document.createElement("div") ?
                "selectstart" :
                "mousedown";

            return function () {
                return this.on(eventType + ".ui-disableSelection", function (event) {
                    event.preventDefault();
                });
            };
        })(),

        enableSelection: function () {
            return this.off(".ui-disableSelection");
        }
    });


    /*!
     * jQuery UI Focusable 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: :focusable Selector
    //>>group: Core
    //>>description: Selects elements which can be focused.
    //>>docs: http://api.jqueryui.com/focusable-selector/



    // Selectors
    $.ui.focusable = function (element, hasTabindex) {
        var map, mapName, img, focusableIfVisible, fieldset,
            nodeName = element.nodeName.toLowerCase();

        if ("area" === nodeName) {
            map = element.parentNode;
            mapName = map.name;
            if (!element.href || !mapName || map.nodeName.toLowerCase() !== "map") {
                return false;
            }
            img = $("img[usemap='#" + mapName + "']");
            return img.length > 0 && img.is(":visible");
        }

        if (/^(input|select|textarea|button|object)$/.test(nodeName)) {
            focusableIfVisible = !element.disabled;

            if (focusableIfVisible) {

                // Form controls within a disabled fieldset are disabled.
                // However, controls within the fieldset's legend do not get disabled.
                // Since controls generally aren't placed inside legends, we skip
                // this portion of the check.
                fieldset = $(element).closest("fieldset")[0];
                if (fieldset) {
                    focusableIfVisible = !fieldset.disabled;
                }
            }
        } else if ("a" === nodeName) {
            focusableIfVisible = element.href || hasTabindex;
        } else {
            focusableIfVisible = hasTabindex;
        }

        return focusableIfVisible && $(element).is(":visible") && visible($(element));
    };

    // Support: IE 8 only
    // IE 8 doesn't resolve inherit to visible/hidden for computed values
    function visible(element) {
        var visibility = element.css("visibility");
        while (visibility === "inherit") {
            element = element.parent();
            visibility = element.css("visibility");
        }
        return visibility !== "hidden";
    }

    $.extend($.expr[":"], {
        focusable: function (element) {
            return $.ui.focusable(element, $.attr(element, "tabindex") != null);
        }
    });

    var focusable = $.ui.focusable;




    // Support: IE8 Only
    // IE8 does not support the form attribute and when it is supplied. It overwrites the form prop
    // with a string, so we need to find the proper form.
    var form = $.fn.form = function () {
        return typeof this[0].form === "string" ? this.closest("form") : $(this[0].form);
    };


    /*!
     * jQuery UI Form Reset Mixin 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Form Reset Mixin
    //>>group: Core
    //>>description: Refresh input widgets when their form is reset
    //>>docs: http://api.jqueryui.com/form-reset-mixin/



    var formResetMixin = $.ui.formResetMixin = {
        _formResetHandler: function () {
            var form = $(this);

            // Wait for the form reset to actually happen before refreshing
            setTimeout(function () {
                var instances = form.data("ui-form-reset-instances");
                $.each(instances, function () {
                    this.refresh();
                });
            });
        },

        _bindFormResetHandler: function () {
            this.form = this.element.form();
            if (!this.form.length) {
                return;
            }

            var instances = this.form.data("ui-form-reset-instances") || [];
            if (!instances.length) {

                // We don't use _on() here because we use a single event handler per form
                this.form.on("reset.ui-form-reset", this._formResetHandler);
            }
            instances.push(this);
            this.form.data("ui-form-reset-instances", instances);
        },

        _unbindFormResetHandler: function () {
            if (!this.form.length) {
                return;
            }

            var instances = this.form.data("ui-form-reset-instances");
            instances.splice($.inArray(this, instances), 1);
            if (instances.length) {
                this.form.data("ui-form-reset-instances", instances);
            } else {
                this.form
                    .removeData("ui-form-reset-instances")
                    .off("reset.ui-form-reset");
            }
        }
    };


    /*!
     * jQuery UI Support for jQuery core 1.7.x 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     *
     */

    //>>label: jQuery 1.7 Support
    //>>group: Core
    //>>description: Support version 1.7.x of jQuery core



    // Support: jQuery 1.7 only
    // Not a great way to check versions, but since we only support 1.7+ and only
    // need to detect <1.8, this is a simple check that should suffice. Checking
    // for "1.7." would be a bit safer, but the version string is 1.7, not 1.7.0
    // and we'll never reach 1.70.0 (if we do, we certainly won't be supporting
    // 1.7 anymore). See #11197 for why we're not using feature detection.
    if ($.fn.jquery.substring(0, 3) === "1.7") {

        // Setters for .innerWidth(), .innerHeight(), .outerWidth(), .outerHeight()
        // Unlike jQuery Core 1.8+, these only support numeric values to set the
        // dimensions in pixels
        $.each(["Width", "Height"], function (i, name) {
            var side = name === "Width" ? ["Left", "Right"] : ["Top", "Bottom"],
                type = name.toLowerCase(),
                orig = {
                    innerWidth: $.fn.innerWidth,
                    innerHeight: $.fn.innerHeight,
                    outerWidth: $.fn.outerWidth,
                    outerHeight: $.fn.outerHeight
                };

            function reduce(elem, size, border, margin) {
                $.each(side, function () {
                    size -= parseFloat($.css(elem, "padding" + this)) || 0;
                    if (border) {
                        size -= parseFloat($.css(elem, "border" + this + "Width")) || 0;
                    }
                    if (margin) {
                        size -= parseFloat($.css(elem, "margin" + this)) || 0;
                    }
                });
                return size;
            }

            $.fn["inner" + name] = function (size) {
                if (size === undefined) {
                    return orig["inner" + name].call(this);
                }

                return this.each(function () {
                    $(this).css(type, reduce(this, size) + "px");
                });
            };

            $.fn["outer" + name] = function (size, margin) {
                if (typeof size !== "number") {
                    return orig["outer" + name].call(this, size);
                }

                return this.each(function () {
                    $(this).css(type, reduce(this, size, true, margin) + "px");
                });
            };
        });

        $.fn.addBack = function (selector) {
            return this.add(selector == null ?
                this.prevObject : this.prevObject.filter(selector)
            );
        };
    }

    ;
    /*!
     * jQuery UI Keycode 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Keycode
    //>>group: Core
    //>>description: Provide keycodes as keynames
    //>>docs: http://api.jqueryui.com/jQuery.ui.keyCode/


    var keycode = $.ui.keyCode = {
        BACKSPACE: 8,
        COMMA: 188,
        DELETE: 46,
        DOWN: 40,
        END: 35,
        ENTER: 13,
        ESCAPE: 27,
        HOME: 36,
        LEFT: 37,
        PAGE_DOWN: 34,
        PAGE_UP: 33,
        PERIOD: 190,
        RIGHT: 39,
        SPACE: 32,
        TAB: 9,
        UP: 38
    };




    // Internal use only
    var escapeSelector = $.ui.escapeSelector = (function () {
        var selectorEscape = /([!"#$%&'()*+,./:;<=>?@[\]^'{|}~])/g;
        return function (selector) {
            return selector.replace(selectorEscape, "\\$1");
        };
    })();


    /*!
     * jQuery UI Labels 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: labels
    //>>group: Core
    //>>description: Find all the labels associated with a given input
    //>>docs: http://api.jqueryui.com/labels/



    var labels = $.fn.labels = function () {
        var ancestor, selector, id, labels, ancestors;

        // Check control.labels first
        if (this[0].labels && this[0].labels.length) {
            return this.pushStack(this[0].labels);
        }

        // Support: IE <= 11, FF <= 37, Android <= 2.3 only
        // Above browsers do not support control.labels. Everything below is to support them
        // as well as document fragments. control.labels does not work on document fragments
        labels = this.eq(0).parents("label");

        // Look for the label based on the id
        id = this.attr("id");
        if (id) {

            // We don't search against the document in case the element
            // is disconnected from the DOM
            ancestor = this.eq(0).parents().last();

            // Get a full set of top level ancestors
            ancestors = ancestor.add(ancestor.length ? ancestor.siblings() : this.siblings());

            // Create a selector for the label based on the id
            selector = "label[for='" + $.ui.escapeSelector(id) + "']";

            labels = labels.add(ancestors.find(selector).addBack(selector));

        }

        // Return whatever we have found for labels
        return this.pushStack(labels);
    };


    /*!
     * jQuery UI Scroll Parent 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: scrollParent
    //>>group: Core
    //>>description: Get the closest ancestor element that is scrollable.
    //>>docs: http://api.jqueryui.com/scrollParent/



    var scrollParent = $.fn.scrollParent = function (includeHidden) {
        var position = this.css("position"),
            excludeStaticParent = position === "absolute",
            overflowRegex = includeHidden ? /(auto|scroll|hidden)/ : /(auto|scroll)/,
            scrollParent = this.parents().filter(function () {
                var parent = $(this);
                if (excludeStaticParent && parent.css("position") === "static") {
                    return false;
                }
                return overflowRegex.test(parent.css("overflow") + parent.css("overflow-y") +
                    parent.css("overflow-x"));
            }).eq(0);

        return position === "fixed" || !scrollParent.length ?
            $(this[0].ownerDocument || document) :
            scrollParent;
    };


    /*!
     * jQuery UI Tabbable 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: :tabbable Selector
    //>>group: Core
    //>>description: Selects elements which can be tabbed to.
    //>>docs: http://api.jqueryui.com/tabbable-selector/



    var tabbable = $.extend($.expr[":"], {
        tabbable: function (element) {
            var tabIndex = $.attr(element, "tabindex"),
                hasTabindex = tabIndex != null;
            return (!hasTabindex || tabIndex >= 0) && $.ui.focusable(element, hasTabindex);
        }
    });


    /*!
     * jQuery UI Unique ID 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: uniqueId
    //>>group: Core
    //>>description: Functions to generate and remove uniqueId's
    //>>docs: http://api.jqueryui.com/uniqueId/



    var uniqueId = $.fn.extend({
        uniqueId: (function () {
            var uuid = 0;

            return function () {
                return this.each(function () {
                    if (!this.id) {
                        this.id = "ui-id-" + (++uuid);
                    }
                });
            };
        })(),

        removeUniqueId: function () {
            return this.each(function () {
                if (/^ui-id-\d+$/.test(this.id)) {
                    $(this).removeAttr("id");
                }
            });
        }
    });




    // This file is deprecated
    var ie = $.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());

    /*!
     * jQuery UI Mouse 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Mouse
    //>>group: Widgets
    //>>description: Abstracts mouse-based interactions to assist in creating certain widgets.
    //>>docs: http://api.jqueryui.com/mouse/



    var mouseHandled = false;
    $(document).on("mouseup", function () {
        mouseHandled = false;
    });

    var widgetsMouse = $.widget("ui.mouse", {
        version: "1.12.1",
        options: {
            cancel: "input, textarea, button, select, option",
            distance: 1,
            delay: 0
        },
        _mouseInit: function () {
            var that = this;

            this.element
                .on("mousedown." + this.widgetName, function (event) {
                    return that._mouseDown(event);
                })
                .on("click." + this.widgetName, function (event) {
                    if (true === $.data(event.target, that.widgetName + ".preventClickEvent")) {
                        $.removeData(event.target, that.widgetName + ".preventClickEvent");
                        event.stopImmediatePropagation();
                        return false;
                    }
                });

            this.started = false;
        },

        // TODO: make sure destroying one instance of mouse doesn't mess with
        // other instances of mouse
        _mouseDestroy: function () {
            this.element.off("." + this.widgetName);
            if (this._mouseMoveDelegate) {
                this.document
                    .off("mousemove." + this.widgetName, this._mouseMoveDelegate)
                    .off("mouseup." + this.widgetName, this._mouseUpDelegate);
            }
        },

        _mouseDown: function (event) {

            // don't let more than one widget handle mouseStart
            if (mouseHandled) {
                return;
            }

            this._mouseMoved = false;

            // We may have missed mouseup (out of window)
            (this._mouseStarted && this._mouseUp(event));

            this._mouseDownEvent = event;

            var that = this,
                btnIsLeft = (event.which === 1),

                // event.target.nodeName works around a bug in IE 8 with
                // disabled inputs (#7620)
                elIsCancel = (typeof this.options.cancel === "string" && event.target.nodeName ?
                    $(event.target).closest(this.options.cancel).length : false);
            if (!btnIsLeft || elIsCancel || !this._mouseCapture(event)) {
                return true;
            }

            this.mouseDelayMet = !this.options.delay;
            if (!this.mouseDelayMet) {
                this._mouseDelayTimer = setTimeout(function () {
                    that.mouseDelayMet = true;
                }, this.options.delay);
            }

            if (this._mouseDistanceMet(event) && this._mouseDelayMet(event)) {
                this._mouseStarted = (this._mouseStart(event) !== false);
                if (!this._mouseStarted) {
                    event.preventDefault();
                    return true;
                }
            }

            // Click event may never have fired (Gecko & Opera)
            if (true === $.data(event.target, this.widgetName + ".preventClickEvent")) {
                $.removeData(event.target, this.widgetName + ".preventClickEvent");
            }

            // These delegates are required to keep context
            this._mouseMoveDelegate = function (event) {
                return that._mouseMove(event);
            };
            this._mouseUpDelegate = function (event) {
                return that._mouseUp(event);
            };

            this.document
                .on("mousemove." + this.widgetName, this._mouseMoveDelegate)
                .on("mouseup." + this.widgetName, this._mouseUpDelegate);

            event.preventDefault();

            mouseHandled = true;
            return true;
        },

        _mouseMove: function (event) {

            // Only check for mouseups outside the document if you've moved inside the document
            // at least once. This prevents the firing of mouseup in the case of IE<9, which will
            // fire a mousemove event if content is placed under the cursor. See #7778
            // Support: IE <9
            if (this._mouseMoved) {

                // IE mouseup check - mouseup happened when mouse was out of window
                if ($.ui.ie && (!document.documentMode || document.documentMode < 9) &&
                    !event.button) {
                    return this._mouseUp(event);

                    // Iframe mouseup check - mouseup occurred in another document
                } else if (!event.which) {

                    // Support: Safari <=8 - 9
                    // Safari sets which to 0 if you press any of the following keys
                    // during a drag (#14461)
                    if (event.originalEvent.altKey || event.originalEvent.ctrlKey ||
                        event.originalEvent.metaKey || event.originalEvent.shiftKey) {
                        this.ignoreMissingWhich = true;
                    } else if (!this.ignoreMissingWhich) {
                        return this._mouseUp(event);
                    }
                }
            }

            if (event.which || event.button) {
                this._mouseMoved = true;
            }

            if (this._mouseStarted) {
                this._mouseDrag(event);
                return event.preventDefault();
            }

            if (this._mouseDistanceMet(event) && this._mouseDelayMet(event)) {
                this._mouseStarted =
                    (this._mouseStart(this._mouseDownEvent, event) !== false);
                (this._mouseStarted ? this._mouseDrag(event) : this._mouseUp(event));
            }

            return !this._mouseStarted;
        },

        _mouseUp: function (event) {
            this.document
                .off("mousemove." + this.widgetName, this._mouseMoveDelegate)
                .off("mouseup." + this.widgetName, this._mouseUpDelegate);

            if (this._mouseStarted) {
                this._mouseStarted = false;

                if (event.target === this._mouseDownEvent.target) {
                    $.data(event.target, this.widgetName + ".preventClickEvent", true);
                }

                this._mouseStop(event);
            }

            if (this._mouseDelayTimer) {
                clearTimeout(this._mouseDelayTimer);
                delete this._mouseDelayTimer;
            }

            this.ignoreMissingWhich = false;
            mouseHandled = false;
            event.preventDefault();
        },

        _mouseDistanceMet: function (event) {
            return (Math.max(
                Math.abs(this._mouseDownEvent.pageX - event.pageX),
                Math.abs(this._mouseDownEvent.pageY - event.pageY)
            ) >= this.options.distance
            );
        },

        _mouseDelayMet: function ( /* event */) {
            return this.mouseDelayMet;
        },

        // These are placeholder methods, to be overriden by extending plugin
        _mouseStart: function ( /* event */) { },
        _mouseDrag: function ( /* event */) { },
        _mouseStop: function ( /* event */) { },
        _mouseCapture: function ( /* event */) { return true; }
    });




    // $.ui.plugin is deprecated. Use $.widget() extensions instead.
    var plugin = $.ui.plugin = {
        add: function (module, option, set) {
            var i,
                proto = $.ui[module].prototype;
            for (i in set) {
                proto.plugins[i] = proto.plugins[i] || [];
                proto.plugins[i].push([option, set[i]]);
            }
        },
        call: function (instance, name, args, allowDisconnected) {
            var i,
                set = instance.plugins[name];

            if (!set) {
                return;
            }

            if (!allowDisconnected && (!instance.element[0].parentNode ||
                instance.element[0].parentNode.nodeType === 11)) {
                return;
            }

            for (i = 0; i < set.length; i++) {
                if (instance.options[set[i][0]]) {
                    set[i][1].apply(instance.element, args);
                }
            }
        }
    };



    var safeActiveElement = $.ui.safeActiveElement = function (document) {
        var activeElement;

        // Support: IE 9 only
        // IE9 throws an "Unspecified error" accessing document.activeElement from an <iframe>
        try {
            activeElement = document.activeElement;
        } catch (error) {
            activeElement = document.body;
        }

        // Support: IE 9 - 11 only
        // IE may return null instead of an element
        // Interestingly, this only seems to occur when NOT in an iframe
        if (!activeElement) {
            activeElement = document.body;
        }

        // Support: IE 11 only
        // IE11 returns a seemingly empty object in some cases when accessing
        // document.activeElement from an <iframe>
        if (!activeElement.nodeName) {
            activeElement = document.body;
        }

        return activeElement;
    };



    var safeBlur = $.ui.safeBlur = function (element) {

        // Support: IE9 - 10 only
        // If the <body> is blurred, IE will switch windows, see #9420
        if (element && element.nodeName.toLowerCase() !== "body") {
            $(element).trigger("blur");
        }
    };


    /*!
     * jQuery UI Draggable 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Draggable
    //>>group: Interactions
    //>>description: Enables dragging functionality for any element.
    //>>docs: http://api.jqueryui.com/draggable/
    //>>demos: http://jqueryui.com/draggable/
    //>>css.structure: ../../themes/base/draggable.css



    $.widget("ui.draggable", $.ui.mouse, {
        version: "1.12.1",
        widgetEventPrefix: "drag",
        options: {
            addClasses: true,
            appendTo: "parent",
            axis: false,
            connectToSortable: false,
            containment: false,
            cursor: "auto",
            cursorAt: false,
            grid: false,
            handle: false,
            helper: "original",
            iframeFix: false,
            opacity: false,
            refreshPositions: false,
            revert: false,
            revertDuration: 500,
            scope: "default",
            scroll: true,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            snap: false,
            snapMode: "both",
            snapTolerance: 20,
            stack: false,
            zIndex: false,

            // Callbacks
            drag: null,
            start: null,
            stop: null
        },
        _create: function () {

            if (this.options.helper === "original") {
                this._setPositionRelative();
            }
            if (this.options.addClasses) {
                this._addClass("ui-draggable");
            }
            this._setHandleClassName();

            this._mouseInit();
        },

        _setOption: function (key, value) {
            this._super(key, value);
            if (key === "handle") {
                this._removeHandleClassName();
                this._setHandleClassName();
            }
        },

        _destroy: function () {
            if ((this.helper || this.element).is(".ui-draggable-dragging")) {
                this.destroyOnClear = true;
                return;
            }
            this._removeHandleClassName();
            this._mouseDestroy();
        },

        _mouseCapture: function (event) {
            var o = this.options;

            // Among others, prevent a drag on a resizable-handle
            if (this.helper || o.disabled ||
                $(event.target).closest(".ui-resizable-handle").length > 0) {
                return false;
            }

            //Quit if we're not on a valid handle
            this.handle = this._getHandle(event);
            if (!this.handle) {
                return false;
            }

            this._blurActiveElement(event);

            this._blockFrames(o.iframeFix === true ? "iframe" : o.iframeFix);

            return true;

        },

        _blockFrames: function (selector) {
            this.iframeBlocks = this.document.find(selector).map(function () {
                var iframe = $(this);

                return $("<div>")
                    .css("position", "absolute")
                    .appendTo(iframe.parent())
                    .outerWidth(iframe.outerWidth())
                    .outerHeight(iframe.outerHeight())
                    .offset(iframe.offset())[0];
            });
        },

        _unblockFrames: function () {
            if (this.iframeBlocks) {
                this.iframeBlocks.remove();
                delete this.iframeBlocks;
            }
        },

        _blurActiveElement: function (event) {
            var activeElement = $.ui.safeActiveElement(this.document[0]),
                target = $(event.target);

            // Don't blur if the event occurred on an element that is within
            // the currently focused element
            // See #10527, #12472
            if (target.closest(activeElement).length) {
                return;
            }

            // Blur any element that currently has focus, see #4261
            $.ui.safeBlur(activeElement);
        },

        _mouseStart: function (event) {

            var o = this.options;

            //Create and append the visible helper
            this.helper = this._createHelper(event);

            this._addClass(this.helper, "ui-draggable-dragging");

            //Cache the helper size
            this._cacheHelperProportions();

            //If ddmanager is used for droppables, set the global draggable
            if ($.ui.ddmanager) {
                $.ui.ddmanager.current = this;
            }

            /*
             * - Position generation -
             * This block generates everything position related - it's the core of draggables.
             */

            //Cache the margins of the original element
            this._cacheMargins();

            //Store the helper's css position
            this.cssPosition = this.helper.css("position");
            this.scrollParent = this.helper.scrollParent(true);
            this.offsetParent = this.helper.offsetParent();
            this.hasFixedAncestor = this.helper.parents().filter(function () {
                return $(this).css("position") === "fixed";
            }).length > 0;

            //The element's absolute position on the page minus margins
            this.positionAbs = this.element.offset();
            this._refreshOffsets(event);

            //Generate the original position
            this.originalPosition = this.position = this._generatePosition(event, false);
            this.originalPageX = event.pageX;
            this.originalPageY = event.pageY;

            //Adjust the mouse offset relative to the helper if "cursorAt" is supplied
            (o.cursorAt && this._adjustOffsetFromHelper(o.cursorAt));

            //Set a containment if given in the options
            this._setContainment();

            //Trigger event + callbacks
            if (this._trigger("start", event) === false) {
                this._clear();
                return false;
            }

            //Recache the helper size
            this._cacheHelperProportions();

            //Prepare the droppable offsets
            if ($.ui.ddmanager && !o.dropBehaviour) {
                $.ui.ddmanager.prepareOffsets(this, event);
            }

            // Execute the drag once - this causes the helper not to be visible before getting its
            // correct position
            this._mouseDrag(event, true);

            // If the ddmanager is used for droppables, inform the manager that dragging has started
            // (see #5003)
            if ($.ui.ddmanager) {
                $.ui.ddmanager.dragStart(this, event);
            }

            return true;
        },

        _refreshOffsets: function (event) {
            this.offset = {
                top: this.positionAbs.top - this.margins.top,
                left: this.positionAbs.left - this.margins.left,
                scroll: false,
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            };

            this.offset.click = {
                left: event.pageX - this.offset.left,
                top: event.pageY - this.offset.top
            };
        },

        _mouseDrag: function (event, noPropagation) {

            // reset any necessary cached properties (see #5009)
            if (this.hasFixedAncestor) {
                this.offset.parent = this._getParentOffset();
            }

            //Compute the helpers position
            this.position = this._generatePosition(event, true);
            this.positionAbs = this._convertPositionTo("absolute");

            //Call plugins and callbacks and use the resulting position if something is returned
            if (!noPropagation) {
                var ui = this._uiHash();
                if (this._trigger("drag", event, ui) === false) {
                    this._mouseUp(new $.Event("mouseup", event));
                    return false;
                }
                this.position = ui.position;
            }

            this.helper[0].style.left = this.position.left + "px";
            this.helper[0].style.top = this.position.top + "px";

            if ($.ui.ddmanager) {
                $.ui.ddmanager.drag(this, event);
            }

            return false;
        },

        _mouseStop: function (event) {

            //If we are using droppables, inform the manager about the drop
            var that = this,
                dropped = false;
            if ($.ui.ddmanager && !this.options.dropBehaviour) {
                dropped = $.ui.ddmanager.drop(this, event);
            }

            //if a drop comes from outside (a sortable)
            if (this.dropped) {
                dropped = this.dropped;
                this.dropped = false;
            }

            if ((this.options.revert === "invalid" && !dropped) ||
                (this.options.revert === "valid" && dropped) ||
                this.options.revert === true || ($.isFunction(this.options.revert) &&
                    this.options.revert.call(this.element, dropped))
            ) {
                $(this.helper).animate(
                    this.originalPosition,
                    parseInt(this.options.revertDuration, 10),
                    function () {
                        if (that._trigger("stop", event) !== false) {
                            that._clear();
                        }
                    }
                );
            } else {
                if (this._trigger("stop", event) !== false) {
                    this._clear();
                }
            }

            return false;
        },

        _mouseUp: function (event) {
            this._unblockFrames();

            // If the ddmanager is used for droppables, inform the manager that dragging has stopped
            // (see #5003)
            if ($.ui.ddmanager) {
                $.ui.ddmanager.dragStop(this, event);
            }

            // Only need to focus if the event occurred on the draggable itself, see #10527
            if (this.handleElement.is(event.target)) {

                // The interaction is over; whether or not the click resulted in a drag,
                // focus the element
                this.element.trigger("focus");
            }

            return $.ui.mouse.prototype._mouseUp.call(this, event);
        },

        cancel: function () {

            if (this.helper.is(".ui-draggable-dragging")) {
                this._mouseUp(new $.Event("mouseup", { target: this.element[0] }));
            } else {
                this._clear();
            }

            return this;

        },

        _getHandle: function (event) {
            return this.options.handle ?
                !!$(event.target).closest(this.element.find(this.options.handle)).length :
                true;
        },

        _setHandleClassName: function () {
            this.handleElement = this.options.handle ?
                this.element.find(this.options.handle) : this.element;
            this._addClass(this.handleElement, "ui-draggable-handle");
        },

        _removeHandleClassName: function () {
            this._removeClass(this.handleElement, "ui-draggable-handle");
        },

        _createHelper: function (event) {

            var o = this.options,
                helperIsFunction = $.isFunction(o.helper),
                helper = helperIsFunction ?
                    $(o.helper.apply(this.element[0], [event])) :
                    (o.helper === "clone" ?
                        this.element.clone().removeAttr("id") :
                        this.element);

            if (!helper.parents("body").length) {
                helper.appendTo((o.appendTo === "parent" ?
                    this.element[0].parentNode :
                    o.appendTo));
            }

            // Http://bugs.jqueryui.com/ticket/9446
            // a helper function can return the original element
            // which wouldn't have been set to relative in _create
            if (helperIsFunction && helper[0] === this.element[0]) {
                this._setPositionRelative();
            }

            if (helper[0] !== this.element[0] &&
                !(/(fixed|absolute)/).test(helper.css("position"))) {
                helper.css("position", "absolute");
            }

            return helper;

        },

        _setPositionRelative: function () {
            if (!(/^(?:r|a|f)/).test(this.element.css("position"))) {
                this.element[0].style.position = "relative";
            }
        },

        _adjustOffsetFromHelper: function (obj) {
            if (typeof obj === "string") {
                obj = obj.split(" ");
            }
            if ($.isArray(obj)) {
                obj = { left: +obj[0], top: +obj[1] || 0 };
            }
            if ("left" in obj) {
                this.offset.click.left = obj.left + this.margins.left;
            }
            if ("right" in obj) {
                this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left;
            }
            if ("top" in obj) {
                this.offset.click.top = obj.top + this.margins.top;
            }
            if ("bottom" in obj) {
                this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top;
            }
        },

        _isRootNode: function (element) {
            return (/(html|body)/i).test(element.tagName) || element === this.document[0];
        },

        _getParentOffset: function () {

            //Get the offsetParent and cache its position
            var po = this.offsetParent.offset(),
                document = this.document[0];

            // This is a special case where we need to modify a offset calculated on start, since the
            // following happened:
            // 1. The position of the helper is absolute, so it's position is calculated based on the
            // next positioned parent
            // 2. The actual offset parent is a child of the scroll parent, and the scroll parent isn't
            // the document, which means that the scroll is included in the initial calculation of the
            // offset of the parent, and never recalculated upon drag
            if (this.cssPosition === "absolute" && this.scrollParent[0] !== document &&
                $.contains(this.scrollParent[0], this.offsetParent[0])) {
                po.left += this.scrollParent.scrollLeft();
                po.top += this.scrollParent.scrollTop();
            }

            if (this._isRootNode(this.offsetParent[0])) {
                po = { top: 0, left: 0 };
            }

            return {
                top: po.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: po.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            };

        },

        _getRelativeOffset: function () {
            if (this.cssPosition !== "relative") {
                return { top: 0, left: 0 };
            }

            var p = this.element.position(),
                scrollIsRootNode = this._isRootNode(this.scrollParent[0]);

            return {
                top: p.top - (parseInt(this.helper.css("top"), 10) || 0) +
                    (!scrollIsRootNode ? this.scrollParent.scrollTop() : 0),
                left: p.left - (parseInt(this.helper.css("left"), 10) || 0) +
                    (!scrollIsRootNode ? this.scrollParent.scrollLeft() : 0)
            };

        },

        _cacheMargins: function () {
            this.margins = {
                left: (parseInt(this.element.css("marginLeft"), 10) || 0),
                top: (parseInt(this.element.css("marginTop"), 10) || 0),
                right: (parseInt(this.element.css("marginRight"), 10) || 0),
                bottom: (parseInt(this.element.css("marginBottom"), 10) || 0)
            };
        },

        _cacheHelperProportions: function () {
            this.helperProportions = {
                width: this.helper.outerWidth(),
                height: this.helper.outerHeight()
            };
        },

        _setContainment: function () {

            var isUserScrollable, c, ce,
                o = this.options,
                document = this.document[0];

            this.relativeContainer = null;

            if (!o.containment) {
                this.containment = null;
                return;
            }

            if (o.containment === "window") {
                this.containment = [
                    $(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left,
                    $(window).scrollTop() - this.offset.relative.top - this.offset.parent.top,
                    $(window).scrollLeft() + $(window).width() -
                    this.helperProportions.width - this.margins.left,
                    $(window).scrollTop() +
                    ($(window).height() || document.body.parentNode.scrollHeight) -
                    this.helperProportions.height - this.margins.top
                ];
                return;
            }

            if (o.containment === "document") {
                this.containment = [
                    0,
                    0,
                    $(document).width() - this.helperProportions.width - this.margins.left,
                    ($(document).height() || document.body.parentNode.scrollHeight) -
                    this.helperProportions.height - this.margins.top
                ];
                return;
            }

            if (o.containment.constructor === Array) {
                this.containment = o.containment;
                return;
            }

            if (o.containment === "parent") {
                o.containment = this.helper[0].parentNode;
            }

            c = $(o.containment);
            ce = c[0];

            if (!ce) {
                return;
            }

            isUserScrollable = /(scroll|auto)/.test(c.css("overflow"));

            this.containment = [
                (parseInt(c.css("borderLeftWidth"), 10) || 0) +
                (parseInt(c.css("paddingLeft"), 10) || 0),
                (parseInt(c.css("borderTopWidth"), 10) || 0) +
                (parseInt(c.css("paddingTop"), 10) || 0),
                (isUserScrollable ? Math.max(ce.scrollWidth, ce.offsetWidth) : ce.offsetWidth) -
                (parseInt(c.css("borderRightWidth"), 10) || 0) -
                (parseInt(c.css("paddingRight"), 10) || 0) -
                this.helperProportions.width -
                this.margins.left -
                this.margins.right,
                (isUserScrollable ? Math.max(ce.scrollHeight, ce.offsetHeight) : ce.offsetHeight) -
                (parseInt(c.css("borderBottomWidth"), 10) || 0) -
                (parseInt(c.css("paddingBottom"), 10) || 0) -
                this.helperProportions.height -
                this.margins.top -
                this.margins.bottom
            ];
            this.relativeContainer = c;
        },

        _convertPositionTo: function (d, pos) {

            if (!pos) {
                pos = this.position;
            }

            var mod = d === "absolute" ? 1 : -1,
                scrollIsRootNode = this._isRootNode(this.scrollParent[0]);

            return {
                top: (

                    // The absolute mouse position
                    pos.top +

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.top * mod +

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.top * mod -
                    ((this.cssPosition === "fixed" ?
                        -this.offset.scroll.top :
                        (scrollIsRootNode ? 0 : this.offset.scroll.top)) * mod)
                ),
                left: (

                    // The absolute mouse position
                    pos.left +

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.left * mod +

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.left * mod -
                    ((this.cssPosition === "fixed" ?
                        -this.offset.scroll.left :
                        (scrollIsRootNode ? 0 : this.offset.scroll.left)) * mod)
                )
            };

        },

        _generatePosition: function (event, constrainPosition) {

            var containment, co, top, left,
                o = this.options,
                scrollIsRootNode = this._isRootNode(this.scrollParent[0]),
                pageX = event.pageX,
                pageY = event.pageY;

            // Cache the scroll
            if (!scrollIsRootNode || !this.offset.scroll) {
                this.offset.scroll = {
                    top: this.scrollParent.scrollTop(),
                    left: this.scrollParent.scrollLeft()
                };
            }

            /*
             * - Position constraining -
             * Constrain the position to a mix of grid, containment.
             */

            // If we are not dragging yet, we won't check for options
            if (constrainPosition) {
                if (this.containment) {
                    if (this.relativeContainer) {
                        co = this.relativeContainer.offset();
                        containment = [
                            this.containment[0] + co.left,
                            this.containment[1] + co.top,
                            this.containment[2] + co.left,
                            this.containment[3] + co.top
                        ];
                    } else {
                        containment = this.containment;
                    }

                    if (event.pageX - this.offset.click.left < containment[0]) {
                        pageX = containment[0] + this.offset.click.left;
                    }
                    if (event.pageY - this.offset.click.top < containment[1]) {
                        pageY = containment[1] + this.offset.click.top;
                    }
                    if (event.pageX - this.offset.click.left > containment[2]) {
                        pageX = containment[2] + this.offset.click.left;
                    }
                    if (event.pageY - this.offset.click.top > containment[3]) {
                        pageY = containment[3] + this.offset.click.top;
                    }
                }

                if (o.grid) {

                    //Check for grid elements set to 0 to prevent divide by 0 error causing invalid
                    // argument errors in IE (see ticket #6950)
                    top = o.grid[1] ? this.originalPageY + Math.round((pageY -
                        this.originalPageY) / o.grid[1]) * o.grid[1] : this.originalPageY;
                    pageY = containment ? ((top - this.offset.click.top >= containment[1] ||
                        top - this.offset.click.top > containment[3]) ?
                        top :
                        ((top - this.offset.click.top >= containment[1]) ?
                            top - o.grid[1] : top + o.grid[1])) : top;

                    left = o.grid[0] ? this.originalPageX +
                        Math.round((pageX - this.originalPageX) / o.grid[0]) * o.grid[0] :
                        this.originalPageX;
                    pageX = containment ? ((left - this.offset.click.left >= containment[0] ||
                        left - this.offset.click.left > containment[2]) ?
                        left :
                        ((left - this.offset.click.left >= containment[0]) ?
                            left - o.grid[0] : left + o.grid[0])) : left;
                }

                if (o.axis === "y") {
                    pageX = this.originalPageX;
                }

                if (o.axis === "x") {
                    pageY = this.originalPageY;
                }
            }

            return {
                top: (

                    // The absolute mouse position
                    pageY -

                    // Click offset (relative to the element)
                    this.offset.click.top -

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.top -

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.top +
                    (this.cssPosition === "fixed" ?
                        -this.offset.scroll.top :
                        (scrollIsRootNode ? 0 : this.offset.scroll.top))
                ),
                left: (

                    // The absolute mouse position
                    pageX -

                    // Click offset (relative to the element)
                    this.offset.click.left -

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.left -

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.left +
                    (this.cssPosition === "fixed" ?
                        -this.offset.scroll.left :
                        (scrollIsRootNode ? 0 : this.offset.scroll.left))
                )
            };

        },

        _clear: function () {
            this._removeClass(this.helper, "ui-draggable-dragging");
            if (this.helper[0] !== this.element[0] && !this.cancelHelperRemoval) {
                this.helper.remove();
            }
            this.helper = null;
            this.cancelHelperRemoval = false;
            if (this.destroyOnClear) {
                this.destroy();
            }
        },

        // From now on bulk stuff - mainly helpers

        _trigger: function (type, event, ui) {
            ui = ui || this._uiHash();
            $.ui.plugin.call(this, type, [event, ui, this], true);

            // Absolute position and offset (see #6884 ) have to be recalculated after plugins
            if (/^(drag|start|stop)/.test(type)) {
                this.positionAbs = this._convertPositionTo("absolute");
                ui.offset = this.positionAbs;
            }
            return $.Widget.prototype._trigger.call(this, type, event, ui);
        },

        plugins: {},

        _uiHash: function () {
            return {
                helper: this.helper,
                position: this.position,
                originalPosition: this.originalPosition,
                offset: this.positionAbs
            };
        }

    });

    $.ui.plugin.add("draggable", "connectToSortable", {
        start: function (event, ui, draggable) {
            var uiSortable = $.extend({}, ui, {
                item: draggable.element
            });

            draggable.sortables = [];
            $(draggable.options.connectToSortable).each(function () {
                var sortable = $(this).sortable("instance");

                if (sortable && !sortable.options.disabled) {
                    draggable.sortables.push(sortable);

                    // RefreshPositions is called at drag start to refresh the containerCache
                    // which is used in drag. This ensures it's initialized and synchronized
                    // with any changes that might have happened on the page since initialization.
                    sortable.refreshPositions();
                    sortable._trigger("activate", event, uiSortable);
                }
            });
        },
        stop: function (event, ui, draggable) {
            var uiSortable = $.extend({}, ui, {
                item: draggable.element
            });

            draggable.cancelHelperRemoval = false;

            $.each(draggable.sortables, function () {
                var sortable = this;

                if (sortable.isOver) {
                    sortable.isOver = 0;

                    // Allow this sortable to handle removing the helper
                    draggable.cancelHelperRemoval = true;
                    sortable.cancelHelperRemoval = false;

                    // Use _storedCSS To restore properties in the sortable,
                    // as this also handles revert (#9675) since the draggable
                    // may have modified them in unexpected ways (#8809)
                    sortable._storedCSS = {
                        position: sortable.placeholder.css("position"),
                        top: sortable.placeholder.css("top"),
                        left: sortable.placeholder.css("left")
                    };

                    sortable._mouseStop(event);

                    // Once drag has ended, the sortable should return to using
                    // its original helper, not the shared helper from draggable
                    sortable.options.helper = sortable.options._helper;
                } else {

                    // Prevent this Sortable from removing the helper.
                    // However, don't set the draggable to remove the helper
                    // either as another connected Sortable may yet handle the removal.
                    sortable.cancelHelperRemoval = true;

                    sortable._trigger("deactivate", event, uiSortable);
                }
            });
        },
        drag: function (event, ui, draggable) {
            $.each(draggable.sortables, function () {
                var innermostIntersecting = false,
                    sortable = this;

                // Copy over variables that sortable's _intersectsWith uses
                sortable.positionAbs = draggable.positionAbs;
                sortable.helperProportions = draggable.helperProportions;
                sortable.offset.click = draggable.offset.click;

                if (sortable._intersectsWith(sortable.containerCache)) {
                    innermostIntersecting = true;

                    $.each(draggable.sortables, function () {

                        // Copy over variables that sortable's _intersectsWith uses
                        this.positionAbs = draggable.positionAbs;
                        this.helperProportions = draggable.helperProportions;
                        this.offset.click = draggable.offset.click;

                        if (this !== sortable &&
                            this._intersectsWith(this.containerCache) &&
                            $.contains(sortable.element[0], this.element[0])) {
                            innermostIntersecting = false;
                        }

                        return innermostIntersecting;
                    });
                }

                if (innermostIntersecting) {

                    // If it intersects, we use a little isOver variable and set it once,
                    // so that the move-in stuff gets fired only once.
                    if (!sortable.isOver) {
                        sortable.isOver = 1;

                        // Store draggable's parent in case we need to reappend to it later.
                        draggable._parent = ui.helper.parent();

                        sortable.currentItem = ui.helper
                            .appendTo(sortable.element)
                            .data("ui-sortable-item", true);

                        // Store helper option to later restore it
                        sortable.options._helper = sortable.options.helper;

                        sortable.options.helper = function () {
                            return ui.helper[0];
                        };

                        // Fire the start events of the sortable with our passed browser event,
                        // and our own helper (so it doesn't create a new one)
                        event.target = sortable.currentItem[0];
                        sortable._mouseCapture(event, true);
                        sortable._mouseStart(event, true, true);

                        // Because the browser event is way off the new appended portlet,
                        // modify necessary variables to reflect the changes
                        sortable.offset.click.top = draggable.offset.click.top;
                        sortable.offset.click.left = draggable.offset.click.left;
                        sortable.offset.parent.left -= draggable.offset.parent.left -
                            sortable.offset.parent.left;
                        sortable.offset.parent.top -= draggable.offset.parent.top -
                            sortable.offset.parent.top;

                        draggable._trigger("toSortable", event);

                        // Inform draggable that the helper is in a valid drop zone,
                        // used solely in the revert option to handle "valid/invalid".
                        draggable.dropped = sortable.element;

                        // Need to refreshPositions of all sortables in the case that
                        // adding to one sortable changes the location of the other sortables (#9675)
                        $.each(draggable.sortables, function () {
                            this.refreshPositions();
                        });

                        // Hack so receive/update callbacks work (mostly)
                        draggable.currentItem = draggable.element;
                        sortable.fromOutside = draggable;
                    }

                    if (sortable.currentItem) {
                        sortable._mouseDrag(event);

                        // Copy the sortable's position because the draggable's can potentially reflect
                        // a relative position, while sortable is always absolute, which the dragged
                        // element has now become. (#8809)
                        ui.position = sortable.position;
                    }
                } else {

                    // If it doesn't intersect with the sortable, and it intersected before,
                    // we fake the drag stop of the sortable, but make sure it doesn't remove
                    // the helper by using cancelHelperRemoval.
                    if (sortable.isOver) {

                        sortable.isOver = 0;
                        sortable.cancelHelperRemoval = true;

                        // Calling sortable's mouseStop would trigger a revert,
                        // so revert must be temporarily false until after mouseStop is called.
                        sortable.options._revert = sortable.options.revert;
                        sortable.options.revert = false;

                        sortable._trigger("out", event, sortable._uiHash(sortable));
                        sortable._mouseStop(event, true);

                        // Restore sortable behaviors that were modfied
                        // when the draggable entered the sortable area (#9481)
                        sortable.options.revert = sortable.options._revert;
                        sortable.options.helper = sortable.options._helper;

                        if (sortable.placeholder) {
                            sortable.placeholder.remove();
                        }

                        // Restore and recalculate the draggable's offset considering the sortable
                        // may have modified them in unexpected ways. (#8809, #10669)
                        ui.helper.appendTo(draggable._parent);
                        draggable._refreshOffsets(event);
                        ui.position = draggable._generatePosition(event, true);

                        draggable._trigger("fromSortable", event);

                        // Inform draggable that the helper is no longer in a valid drop zone
                        draggable.dropped = false;

                        // Need to refreshPositions of all sortables just in case removing
                        // from one sortable changes the location of other sortables (#9675)
                        $.each(draggable.sortables, function () {
                            this.refreshPositions();
                        });
                    }
                }
            });
        }
    });

    $.ui.plugin.add("draggable", "cursor", {
        start: function (event, ui, instance) {
            var t = $("body"),
                o = instance.options;

            if (t.css("cursor")) {
                o._cursor = t.css("cursor");
            }
            t.css("cursor", o.cursor);
        },
        stop: function (event, ui, instance) {
            var o = instance.options;
            if (o._cursor) {
                $("body").css("cursor", o._cursor);
            }
        }
    });

    $.ui.plugin.add("draggable", "opacity", {
        start: function (event, ui, instance) {
            var t = $(ui.helper),
                o = instance.options;
            if (t.css("opacity")) {
                o._opacity = t.css("opacity");
            }
            t.css("opacity", o.opacity);
        },
        stop: function (event, ui, instance) {
            var o = instance.options;
            if (o._opacity) {
                $(ui.helper).css("opacity", o._opacity);
            }
        }
    });

    $.ui.plugin.add("draggable", "scroll", {
        start: function (event, ui, i) {
            if (!i.scrollParentNotHidden) {
                i.scrollParentNotHidden = i.helper.scrollParent(false);
            }

            if (i.scrollParentNotHidden[0] !== i.document[0] &&
                i.scrollParentNotHidden[0].tagName !== "HTML") {
                i.overflowOffset = i.scrollParentNotHidden.offset();
            }
        },
        drag: function (event, ui, i) {

            var o = i.options,
                scrolled = false,
                scrollParent = i.scrollParentNotHidden[0],
                document = i.document[0];

            if (scrollParent !== document && scrollParent.tagName !== "HTML") {
                if (!o.axis || o.axis !== "x") {
                    if ((i.overflowOffset.top + scrollParent.offsetHeight) - event.pageY <
                        o.scrollSensitivity) {
                        scrollParent.scrollTop = scrolled = scrollParent.scrollTop + o.scrollSpeed;
                    } else if (event.pageY - i.overflowOffset.top < o.scrollSensitivity) {
                        scrollParent.scrollTop = scrolled = scrollParent.scrollTop - o.scrollSpeed;
                    }
                }

                if (!o.axis || o.axis !== "y") {
                    if ((i.overflowOffset.left + scrollParent.offsetWidth) - event.pageX <
                        o.scrollSensitivity) {
                        scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft + o.scrollSpeed;
                    } else if (event.pageX - i.overflowOffset.left < o.scrollSensitivity) {
                        scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft - o.scrollSpeed;
                    }
                }

            } else {

                if (!o.axis || o.axis !== "x") {
                    if (event.pageY - $(document).scrollTop() < o.scrollSensitivity) {
                        scrolled = $(document).scrollTop($(document).scrollTop() - o.scrollSpeed);
                    } else if ($(window).height() - (event.pageY - $(document).scrollTop()) <
                        o.scrollSensitivity) {
                        scrolled = $(document).scrollTop($(document).scrollTop() + o.scrollSpeed);
                    }
                }

                if (!o.axis || o.axis !== "y") {
                    if (event.pageX - $(document).scrollLeft() < o.scrollSensitivity) {
                        scrolled = $(document).scrollLeft(
                            $(document).scrollLeft() - o.scrollSpeed
                        );
                    } else if ($(window).width() - (event.pageX - $(document).scrollLeft()) <
                        o.scrollSensitivity) {
                        scrolled = $(document).scrollLeft(
                            $(document).scrollLeft() + o.scrollSpeed
                        );
                    }
                }

            }

            if (scrolled !== false && $.ui.ddmanager && !o.dropBehaviour) {
                $.ui.ddmanager.prepareOffsets(i, event);
            }

        }
    });

    $.ui.plugin.add("draggable", "snap", {
        start: function (event, ui, i) {

            var o = i.options;

            i.snapElements = [];

            $(o.snap.constructor !== String ? (o.snap.items || ":data(ui-draggable)") : o.snap)
                .each(function () {
                    var $t = $(this),
                        $o = $t.offset();
                    if (this !== i.element[0]) {
                        i.snapElements.push({
                            item: this,
                            width: $t.outerWidth(), height: $t.outerHeight(),
                            top: $o.top, left: $o.left
                        });
                    }
                });

        },
        drag: function (event, ui, inst) {

            var ts, bs, ls, rs, l, r, t, b, i, first,
                o = inst.options,
                d = o.snapTolerance,
                x1 = ui.offset.left, x2 = x1 + inst.helperProportions.width,
                y1 = ui.offset.top, y2 = y1 + inst.helperProportions.height;

            for (i = inst.snapElements.length - 1; i >= 0; i--) {

                l = inst.snapElements[i].left - inst.margins.left;
                r = l + inst.snapElements[i].width;
                t = inst.snapElements[i].top - inst.margins.top;
                b = t + inst.snapElements[i].height;

                if (x2 < l - d || x1 > r + d || y2 < t - d || y1 > b + d ||
                    !$.contains(inst.snapElements[i].item.ownerDocument,
                        inst.snapElements[i].item)) {
                    if (inst.snapElements[i].snapping) {
                        (inst.options.snap.release &&
                            inst.options.snap.release.call(
                                inst.element,
                                event,
                                $.extend(inst._uiHash(), { snapItem: inst.snapElements[i].item })
                            ));
                    }
                    inst.snapElements[i].snapping = false;
                    continue;
                }

                if (o.snapMode !== "inner") {
                    ts = Math.abs(t - y2) <= d;
                    bs = Math.abs(b - y1) <= d;
                    ls = Math.abs(l - x2) <= d;
                    rs = Math.abs(r - x1) <= d;
                    if (ts) {
                        ui.position.top = inst._convertPositionTo("relative", {
                            top: t - inst.helperProportions.height,
                            left: 0
                        }).top;
                    }
                    if (bs) {
                        ui.position.top = inst._convertPositionTo("relative", {
                            top: b,
                            left: 0
                        }).top;
                    }
                    if (ls) {
                        ui.position.left = inst._convertPositionTo("relative", {
                            top: 0,
                            left: l - inst.helperProportions.width
                        }).left;
                    }
                    if (rs) {
                        ui.position.left = inst._convertPositionTo("relative", {
                            top: 0,
                            left: r
                        }).left;
                    }
                }

                first = (ts || bs || ls || rs);

                if (o.snapMode !== "outer") {
                    ts = Math.abs(t - y1) <= d;
                    bs = Math.abs(b - y2) <= d;
                    ls = Math.abs(l - x1) <= d;
                    rs = Math.abs(r - x2) <= d;
                    if (ts) {
                        ui.position.top = inst._convertPositionTo("relative", {
                            top: t,
                            left: 0
                        }).top;
                    }
                    if (bs) {
                        ui.position.top = inst._convertPositionTo("relative", {
                            top: b - inst.helperProportions.height,
                            left: 0
                        }).top;
                    }
                    if (ls) {
                        ui.position.left = inst._convertPositionTo("relative", {
                            top: 0,
                            left: l
                        }).left;
                    }
                    if (rs) {
                        ui.position.left = inst._convertPositionTo("relative", {
                            top: 0,
                            left: r - inst.helperProportions.width
                        }).left;
                    }
                }

                if (!inst.snapElements[i].snapping && (ts || bs || ls || rs || first)) {
                    (inst.options.snap.snap &&
                        inst.options.snap.snap.call(
                            inst.element,
                            event,
                            $.extend(inst._uiHash(), {
                                snapItem: inst.snapElements[i].item
                            })));
                }
                inst.snapElements[i].snapping = (ts || bs || ls || rs || first);

            }

        }
    });

    $.ui.plugin.add("draggable", "stack", {
        start: function (event, ui, instance) {
            var min,
                o = instance.options,
                group = $.makeArray($(o.stack)).sort(function (a, b) {
                    return (parseInt($(a).css("zIndex"), 10) || 0) -
                        (parseInt($(b).css("zIndex"), 10) || 0);
                });

            if (!group.length) { return; }

            min = parseInt($(group[0]).css("zIndex"), 10) || 0;
            $(group).each(function (i) {
                $(this).css("zIndex", min + i);
            });
            this.css("zIndex", (min + group.length));
        }
    });

    $.ui.plugin.add("draggable", "zIndex", {
        start: function (event, ui, instance) {
            var t = $(ui.helper),
                o = instance.options;

            if (t.css("zIndex")) {
                o._zIndex = t.css("zIndex");
            }
            t.css("zIndex", o.zIndex);
        },
        stop: function (event, ui, instance) {
            var o = instance.options;

            if (o._zIndex) {
                $(ui.helper).css("zIndex", o._zIndex);
            }
        }
    });

    var widgetsDraggable = $.ui.draggable;


    /*!
     * jQuery UI Droppable 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Droppable
    //>>group: Interactions
    //>>description: Enables drop targets for draggable elements.
    //>>docs: http://api.jqueryui.com/droppable/
    //>>demos: http://jqueryui.com/droppable/



    $.widget("ui.droppable", {
        version: "1.12.1",
        widgetEventPrefix: "drop",
        options: {
            accept: "*",
            addClasses: true,
            greedy: false,
            scope: "default",
            tolerance: "intersect",

            // Callbacks
            activate: null,
            deactivate: null,
            drop: null,
            out: null,
            over: null
        },
        _create: function () {

            var proportions,
                o = this.options,
                accept = o.accept;

            this.isover = false;
            this.isout = true;

            this.accept = $.isFunction(accept) ? accept : function (d) {
                return d.is(accept);
            };

            this.proportions = function ( /* valueToWrite */) {
                if (arguments.length) {

                    // Store the droppable's proportions
                    proportions = arguments[0];
                } else {

                    // Retrieve or derive the droppable's proportions
                    return proportions ?
                        proportions :
                        proportions = {
                            width: this.element[0].offsetWidth,
                            height: this.element[0].offsetHeight
                        };
                }
            };

            this._addToManager(o.scope);

            o.addClasses && this._addClass("ui-droppable");

        },

        _addToManager: function (scope) {

            // Add the reference and positions to the manager
            $.ui.ddmanager.droppables[scope] = $.ui.ddmanager.droppables[scope] || [];
            $.ui.ddmanager.droppables[scope].push(this);
        },

        _splice: function (drop) {
            var i = 0;
            for (; i < drop.length; i++) {
                if (drop[i] === this) {
                    drop.splice(i, 1);
                }
            }
        },

        _destroy: function () {
            var drop = $.ui.ddmanager.droppables[this.options.scope];

            this._splice(drop);
        },

        _setOption: function (key, value) {

            if (key === "accept") {
                this.accept = $.isFunction(value) ? value : function (d) {
                    return d.is(value);
                };
            } else if (key === "scope") {
                var drop = $.ui.ddmanager.droppables[this.options.scope];

                this._splice(drop);
                this._addToManager(value);
            }

            this._super(key, value);
        },

        _activate: function (event) {
            var draggable = $.ui.ddmanager.current;

            this._addActiveClass();
            if (draggable) {
                this._trigger("activate", event, this.ui(draggable));
            }
        },

        _deactivate: function (event) {
            var draggable = $.ui.ddmanager.current;

            this._removeActiveClass();
            if (draggable) {
                this._trigger("deactivate", event, this.ui(draggable));
            }
        },

        _over: function (event) {

            var draggable = $.ui.ddmanager.current;

            // Bail if draggable and droppable are same element
            if (!draggable || (draggable.currentItem ||
                draggable.element)[0] === this.element[0]) {
                return;
            }

            if (this.accept.call(this.element[0], (draggable.currentItem ||
                draggable.element))) {
                this._addHoverClass();
                this._trigger("over", event, this.ui(draggable));
            }

        },

        _out: function (event) {

            var draggable = $.ui.ddmanager.current;

            // Bail if draggable and droppable are same element
            if (!draggable || (draggable.currentItem ||
                draggable.element)[0] === this.element[0]) {
                return;
            }

            if (this.accept.call(this.element[0], (draggable.currentItem ||
                draggable.element))) {
                this._removeHoverClass();
                this._trigger("out", event, this.ui(draggable));
            }

        },

        _drop: function (event, custom) {

            var draggable = custom || $.ui.ddmanager.current,
                childrenIntersection = false;

            // Bail if draggable and droppable are same element
            if (!draggable || (draggable.currentItem ||
                draggable.element)[0] === this.element[0]) {
                return false;
            }

            this.element
                .find(":data(ui-droppable)")
                .not(".ui-draggable-dragging")
                .each(function () {
                    var inst = $(this).droppable("instance");
                    if (
                        inst.options.greedy &&
                        !inst.options.disabled &&
                        inst.options.scope === draggable.options.scope &&
                        inst.accept.call(
                            inst.element[0], (draggable.currentItem || draggable.element)
                        ) &&
                        intersect(
                            draggable,
                            $.extend(inst, { offset: inst.element.offset() }),
                            inst.options.tolerance, event
                        )
                    ) {
                        childrenIntersection = true;
                        return false;
                    }
                });
            if (childrenIntersection) {
                return false;
            }

            if (this.accept.call(this.element[0],
                (draggable.currentItem || draggable.element))) {
                this._removeActiveClass();
                this._removeHoverClass();

                this._trigger("drop", event, this.ui(draggable));
                return this.element;
            }

            return false;

        },

        ui: function (c) {
            return {
                draggable: (c.currentItem || c.element),
                helper: c.helper,
                position: c.position,
                offset: c.positionAbs
            };
        },

        // Extension points just to make backcompat sane and avoid duplicating logic
        // TODO: Remove in 1.13 along with call to it below
        _addHoverClass: function () {
            this._addClass("ui-droppable-hover");
        },

        _removeHoverClass: function () {
            this._removeClass("ui-droppable-hover");
        },

        _addActiveClass: function () {
            this._addClass("ui-droppable-active");
        },

        _removeActiveClass: function () {
            this._removeClass("ui-droppable-active");
        }
    });

    var intersect = $.ui.intersect = (function () {
        function isOverAxis(x, reference, size) {
            return (x >= reference) && (x < (reference + size));
        }

        return function (draggable, droppable, toleranceMode, event) {

            if (!droppable.offset) {
                return false;
            }

            var x1 = (draggable.positionAbs ||
                draggable.position.absolute).left + draggable.margins.left,
                y1 = (draggable.positionAbs ||
                    draggable.position.absolute).top + draggable.margins.top,
                x2 = x1 + draggable.helperProportions.width,
                y2 = y1 + draggable.helperProportions.height,
                l = droppable.offset.left,
                t = droppable.offset.top,
                r = l + droppable.proportions().width,
                b = t + droppable.proportions().height;

            switch (toleranceMode) {
                case "fit":
                    return (l <= x1 && x2 <= r && t <= y1 && y2 <= b);
                case "intersect":
                    return (l < x1 + (draggable.helperProportions.width / 2) && // Right Half
                        x2 - (draggable.helperProportions.width / 2) < r && // Left Half
                        t < y1 + (draggable.helperProportions.height / 2) && // Bottom Half
                        y2 - (draggable.helperProportions.height / 2) < b); // Top Half
                case "pointer":
                    return isOverAxis(event.pageY, t, droppable.proportions().height) &&
                        isOverAxis(event.pageX, l, droppable.proportions().width);
                case "touch":
                    return (
                        (y1 >= t && y1 <= b) || // Top edge touching
                        (y2 >= t && y2 <= b) || // Bottom edge touching
                        (y1 < t && y2 > b) // Surrounded vertically
                    ) && (
                            (x1 >= l && x1 <= r) || // Left edge touching
                            (x2 >= l && x2 <= r) || // Right edge touching
                            (x1 < l && x2 > r) // Surrounded horizontally
                        );
                default:
                    return false;
            }
        };
    })();

    /*
        This manager tracks offsets of draggables and droppables
    */
    $.ui.ddmanager = {
        current: null,
        droppables: { "default": [] },
        prepareOffsets: function (t, event) {

            var i, j,
                m = $.ui.ddmanager.droppables[t.options.scope] || [],
                type = event ? event.type : null, // workaround for #2317
                list = (t.currentItem || t.element).find(":data(ui-droppable)").addBack();

            droppablesLoop: for (i = 0; i < m.length; i++) {

                // No disabled and non-accepted
                if (m[i].options.disabled || (t && !m[i].accept.call(m[i].element[0],
                    (t.currentItem || t.element)))) {
                    continue;
                }

                // Filter out elements in the current dragged item
                for (j = 0; j < list.length; j++) {
                    if (list[j] === m[i].element[0]) {
                        m[i].proportions().height = 0;
                        continue droppablesLoop;
                    }
                }

                m[i].visible = m[i].element.css("display") !== "none";
                if (!m[i].visible) {
                    continue;
                }

                // Activate the droppable if used directly from draggables
                if (type === "mousedown") {
                    m[i]._activate.call(m[i], event);
                }

                m[i].offset = m[i].element.offset();
                m[i].proportions({
                    width: m[i].element[0].offsetWidth,
                    height: m[i].element[0].offsetHeight
                });

            }

        },
        drop: function (draggable, event) {

            var dropped = false;

            // Create a copy of the droppables in case the list changes during the drop (#9116)
            $.each(($.ui.ddmanager.droppables[draggable.options.scope] || []).slice(), function () {

                if (!this.options) {
                    return;
                }
                if (!this.options.disabled && this.visible &&
                    intersect(draggable, this, this.options.tolerance, event)) {
                    dropped = this._drop.call(this, event) || dropped;
                }

                if (!this.options.disabled && this.visible && this.accept.call(this.element[0],
                    (draggable.currentItem || draggable.element))) {
                    this.isout = true;
                    this.isover = false;
                    this._deactivate.call(this, event);
                }

            });
            return dropped;

        },
        dragStart: function (draggable, event) {

            // Listen for scrolling so that if the dragging causes scrolling the position of the
            // droppables can be recalculated (see #5003)
            draggable.element.parentsUntil("body").on("scroll.droppable", function () {
                if (!draggable.options.refreshPositions) {
                    $.ui.ddmanager.prepareOffsets(draggable, event);
                }
            });
        },
        drag: function (draggable, event) {

            // If you have a highly dynamic page, you might try this option. It renders positions
            // every time you move the mouse.
            if (draggable.options.refreshPositions) {
                $.ui.ddmanager.prepareOffsets(draggable, event);
            }

            // Run through all droppables and check their positions based on specific tolerance options
            $.each($.ui.ddmanager.droppables[draggable.options.scope] || [], function () {

                if (this.options.disabled || this.greedyChild || !this.visible) {
                    return;
                }

                var parentInstance, scope, parent,
                    intersects = intersect(draggable, this, this.options.tolerance, event),
                    c = !intersects && this.isover ?
                        "isout" :
                        (intersects && !this.isover ? "isover" : null);
                if (!c) {
                    return;
                }

                if (this.options.greedy) {

                    // find droppable parents with same scope
                    scope = this.options.scope;
                    parent = this.element.parents(":data(ui-droppable)").filter(function () {
                        return $(this).droppable("instance").options.scope === scope;
                    });

                    if (parent.length) {
                        parentInstance = $(parent[0]).droppable("instance");
                        parentInstance.greedyChild = (c === "isover");
                    }
                }

                // We just moved into a greedy child
                if (parentInstance && c === "isover") {
                    parentInstance.isover = false;
                    parentInstance.isout = true;
                    parentInstance._out.call(parentInstance, event);
                }

                this[c] = true;
                this[c === "isout" ? "isover" : "isout"] = false;
                this[c === "isover" ? "_over" : "_out"].call(this, event);

                // We just moved out of a greedy child
                if (parentInstance && c === "isout") {
                    parentInstance.isout = false;
                    parentInstance.isover = true;
                    parentInstance._over.call(parentInstance, event);
                }
            });

        },
        dragStop: function (draggable, event) {
            draggable.element.parentsUntil("body").off("scroll.droppable");

            // Call prepareOffsets one final time since IE does not fire return scroll events when
            // overflow was caused by drag (see #5003)
            if (!draggable.options.refreshPositions) {
                $.ui.ddmanager.prepareOffsets(draggable, event);
            }
        }
    };

    // DEPRECATED
    // TODO: switch return back to widget declaration at top of file when this is removed
    if ($.uiBackCompat !== false) {

        // Backcompat for activeClass and hoverClass options
        $.widget("ui.droppable", $.ui.droppable, {
            options: {
                hoverClass: false,
                activeClass: false
            },
            _addActiveClass: function () {
                this._super();
                if (this.options.activeClass) {
                    this.element.addClass(this.options.activeClass);
                }
            },
            _removeActiveClass: function () {
                this._super();
                if (this.options.activeClass) {
                    this.element.removeClass(this.options.activeClass);
                }
            },
            _addHoverClass: function () {
                this._super();
                if (this.options.hoverClass) {
                    this.element.addClass(this.options.hoverClass);
                }
            },
            _removeHoverClass: function () {
                this._super();
                if (this.options.hoverClass) {
                    this.element.removeClass(this.options.hoverClass);
                }
            }
        });
    }

    var widgetsDroppable = $.ui.droppable;


    /*!
     * jQuery UI Resizable 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Resizable
    //>>group: Interactions
    //>>description: Enables resize functionality for any element.
    //>>docs: http://api.jqueryui.com/resizable/
    //>>demos: http://jqueryui.com/resizable/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/resizable.css
    //>>css.theme: ../../themes/base/theme.css



    $.widget("ui.resizable", $.ui.mouse, {
        version: "1.12.1",
        widgetEventPrefix: "resize",
        options: {
            alsoResize: false,
            animate: false,
            animateDuration: "slow",
            animateEasing: "swing",
            aspectRatio: false,
            autoHide: false,
            classes: {
                "ui-resizable-se": "ui-icon ui-icon-gripsmall-diagonal-se"
            },
            containment: false,
            ghost: false,
            grid: false,
            handles: "e,s,se",
            helper: false,
            maxHeight: null,
            maxWidth: null,
            minHeight: 10,
            minWidth: 10,

            // See #7960
            zIndex: 90,

            // Callbacks
            resize: null,
            start: null,
            stop: null
        },

        _num: function (value) {
            return parseFloat(value) || 0;
        },

        _isNumber: function (value) {
            return !isNaN(parseFloat(value));
        },

        _hasScroll: function (el, a) {

            if ($(el).css("overflow") === "hidden") {
                return false;
            }

            var scroll = (a && a === "left") ? "scrollLeft" : "scrollTop",
                has = false;

            if (el[scroll] > 0) {
                return true;
            }

            // TODO: determine which cases actually cause this to happen
            // if the element doesn't have the scroll set, see if it's possible to
            // set the scroll
            el[scroll] = 1;
            has = (el[scroll] > 0);
            el[scroll] = 0;
            return has;
        },

        _create: function () {

            var margins,
                o = this.options,
                that = this;
            this._addClass("ui-resizable");

            $.extend(this, {
                _aspectRatio: !!(o.aspectRatio),
                aspectRatio: o.aspectRatio,
                originalElement: this.element,
                _proportionallyResizeElements: [],
                _helper: o.helper || o.ghost || o.animate ? o.helper || "ui-resizable-helper" : null
            });

            // Wrap the element if it cannot hold child nodes
            if (this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)) {

                this.element.wrap(
                    $("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({
                        position: this.element.css("position"),
                        width: this.element.outerWidth(),
                        height: this.element.outerHeight(),
                        top: this.element.css("top"),
                        left: this.element.css("left")
                    })
                );

                this.element = this.element.parent().data(
                    "ui-resizable", this.element.resizable("instance")
                );

                this.elementIsWrapper = true;

                margins = {
                    marginTop: this.originalElement.css("marginTop"),
                    marginRight: this.originalElement.css("marginRight"),
                    marginBottom: this.originalElement.css("marginBottom"),
                    marginLeft: this.originalElement.css("marginLeft")
                };

                this.element.css(margins);
                this.originalElement.css("margin", 0);

                // support: Safari
                // Prevent Safari textarea resize
                this.originalResizeStyle = this.originalElement.css("resize");
                this.originalElement.css("resize", "none");

                this._proportionallyResizeElements.push(this.originalElement.css({
                    position: "static",
                    zoom: 1,
                    display: "block"
                }));

                // Support: IE9
                // avoid IE jump (hard set the margin)
                this.originalElement.css(margins);

                this._proportionallyResize();
            }

            this._setupHandles();

            if (o.autoHide) {
                $(this.element)
                    .on("mouseenter", function () {
                        if (o.disabled) {
                            return;
                        }
                        that._removeClass("ui-resizable-autohide");
                        that._handles.show();
                    })
                    .on("mouseleave", function () {
                        if (o.disabled) {
                            return;
                        }
                        if (!that.resizing) {
                            that._addClass("ui-resizable-autohide");
                            that._handles.hide();
                        }
                    });
            }

            this._mouseInit();
        },

        _destroy: function () {

            this._mouseDestroy();

            var wrapper,
                _destroy = function (exp) {
                    $(exp)
                        .removeData("resizable")
                        .removeData("ui-resizable")
                        .off(".resizable")
                        .find(".ui-resizable-handle")
                        .remove();
                };

            // TODO: Unwrap at same DOM position
            if (this.elementIsWrapper) {
                _destroy(this.element);
                wrapper = this.element;
                this.originalElement.css({
                    position: wrapper.css("position"),
                    width: wrapper.outerWidth(),
                    height: wrapper.outerHeight(),
                    top: wrapper.css("top"),
                    left: wrapper.css("left")
                }).insertAfter(wrapper);
                wrapper.remove();
            }

            this.originalElement.css("resize", this.originalResizeStyle);
            _destroy(this.originalElement);

            return this;
        },

        _setOption: function (key, value) {
            this._super(key, value);

            switch (key) {
                case "handles":
                    this._removeHandles();
                    this._setupHandles();
                    break;
                default:
                    break;
            }
        },

        _setupHandles: function () {
            var o = this.options, handle, i, n, hname, axis, that = this;
            this.handles = o.handles ||
                (!$(".ui-resizable-handle", this.element).length ?
                    "e,s,se" : {
                        n: ".ui-resizable-n",
                        e: ".ui-resizable-e",
                        s: ".ui-resizable-s",
                        w: ".ui-resizable-w",
                        se: ".ui-resizable-se",
                        sw: ".ui-resizable-sw",
                        ne: ".ui-resizable-ne",
                        nw: ".ui-resizable-nw"
                    });

            this._handles = $();
            if (this.handles.constructor === String) {

                if (this.handles === "all") {
                    this.handles = "n,e,s,w,se,sw,ne,nw";
                }

                n = this.handles.split(",");
                this.handles = {};

                for (i = 0; i < n.length; i++) {

                    handle = $.trim(n[i]);
                    hname = "ui-resizable-" + handle;
                    axis = $("<div>");
                    this._addClass(axis, "ui-resizable-handle " + hname);

                    axis.css({ zIndex: o.zIndex });

                    this.handles[handle] = ".ui-resizable-" + handle;
                    this.element.append(axis);
                }

            }

            this._renderAxis = function (target) {

                var i, axis, padPos, padWrapper;

                target = target || this.element;

                for (i in this.handles) {

                    if (this.handles[i].constructor === String) {
                        this.handles[i] = this.element.children(this.handles[i]).first().show();
                    } else if (this.handles[i].jquery || this.handles[i].nodeType) {
                        this.handles[i] = $(this.handles[i]);
                        this._on(this.handles[i], { "mousedown": that._mouseDown });
                    }

                    if (this.elementIsWrapper &&
                        this.originalElement[0]
                            .nodeName
                            .match(/^(textarea|input|select|button)$/i)) {
                        axis = $(this.handles[i], this.element);

                        padWrapper = /sw|ne|nw|se|n|s/.test(i) ?
                            axis.outerHeight() :
                            axis.outerWidth();

                        padPos = ["padding",
                            /ne|nw|n/.test(i) ? "Top" :
                                /se|sw|s/.test(i) ? "Bottom" :
                                    /^e$/.test(i) ? "Right" : "Left"].join("");

                        target.css(padPos, padWrapper);

                        this._proportionallyResize();
                    }

                    this._handles = this._handles.add(this.handles[i]);
                }
            };

            // TODO: make renderAxis a prototype function
            this._renderAxis(this.element);

            this._handles = this._handles.add(this.element.find(".ui-resizable-handle"));
            this._handles.disableSelection();

            this._handles.on("mouseover", function () {
                if (!that.resizing) {
                    if (this.className) {
                        axis = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);
                    }
                    that.axis = axis && axis[1] ? axis[1] : "se";
                }
            });

            if (o.autoHide) {
                this._handles.hide();
                this._addClass("ui-resizable-autohide");
            }
        },

        _removeHandles: function () {
            this._handles.remove();
        },

        _mouseCapture: function (event) {
            var i, handle,
                capture = false;

            for (i in this.handles) {
                handle = $(this.handles[i])[0];
                if (handle === event.target || $.contains(handle, event.target)) {
                    capture = true;
                }
            }

            return !this.options.disabled && capture;
        },

        _mouseStart: function (event) {

            var curleft, curtop, cursor,
                o = this.options,
                el = this.element;

            this.resizing = true;

            this._renderProxy();

            curleft = this._num(this.helper.css("left"));
            curtop = this._num(this.helper.css("top"));

            if (o.containment) {
                curleft += $(o.containment).scrollLeft() || 0;
                curtop += $(o.containment).scrollTop() || 0;
            }

            this.offset = this.helper.offset();
            this.position = { left: curleft, top: curtop };

            this.size = this._helper ? {
                width: this.helper.width(),
                height: this.helper.height()
            } : {
                    width: el.width(),
                    height: el.height()
                };

            this.originalSize = this._helper ? {
                width: el.outerWidth(),
                height: el.outerHeight()
            } : {
                    width: el.width(),
                    height: el.height()
                };

            this.sizeDiff = {
                width: el.outerWidth() - el.width(),
                height: el.outerHeight() - el.height()
            };

            this.originalPosition = { left: curleft, top: curtop };
            this.originalMousePosition = { left: event.pageX, top: event.pageY };

            this.aspectRatio = (typeof o.aspectRatio === "number") ?
                o.aspectRatio :
                ((this.originalSize.width / this.originalSize.height) || 1);

            cursor = $(".ui-resizable-" + this.axis).css("cursor");
            $("body").css("cursor", cursor === "auto" ? this.axis + "-resize" : cursor);

            this._addClass("ui-resizable-resizing");
            this._propagate("start", event);
            return true;
        },

        _mouseDrag: function (event) {

            var data, props,
                smp = this.originalMousePosition,
                a = this.axis,
                dx = (event.pageX - smp.left) || 0,
                dy = (event.pageY - smp.top) || 0,
                trigger = this._change[a];

            this._updatePrevProperties();

            if (!trigger) {
                return false;
            }

            data = trigger.apply(this, [event, dx, dy]);

            this._updateVirtualBoundaries(event.shiftKey);
            if (this._aspectRatio || event.shiftKey) {
                data = this._updateRatio(data, event);
            }

            data = this._respectSize(data, event);

            this._updateCache(data);

            this._propagate("resize", event);

            props = this._applyChanges();

            if (!this._helper && this._proportionallyResizeElements.length) {
                this._proportionallyResize();
            }

            if (!$.isEmptyObject(props)) {
                this._updatePrevProperties();
                this._trigger("resize", event, this.ui());
                this._applyChanges();
            }

            return false;
        },

        _mouseStop: function (event) {

            this.resizing = false;
            var pr, ista, soffseth, soffsetw, s, left, top,
                o = this.options, that = this;

            if (this._helper) {

                pr = this._proportionallyResizeElements;
                ista = pr.length && (/textarea/i).test(pr[0].nodeName);
                soffseth = ista && this._hasScroll(pr[0], "left") ? 0 : that.sizeDiff.height;
                soffsetw = ista ? 0 : that.sizeDiff.width;

                s = {
                    width: (that.helper.width() - soffsetw),
                    height: (that.helper.height() - soffseth)
                };
                left = (parseFloat(that.element.css("left")) +
                    (that.position.left - that.originalPosition.left)) || null;
                top = (parseFloat(that.element.css("top")) +
                    (that.position.top - that.originalPosition.top)) || null;

                if (!o.animate) {
                    this.element.css($.extend(s, { top: top, left: left }));
                }

                that.helper.height(that.size.height);
                that.helper.width(that.size.width);

                if (this._helper && !o.animate) {
                    this._proportionallyResize();
                }
            }

            $("body").css("cursor", "auto");

            this._removeClass("ui-resizable-resizing");

            this._propagate("stop", event);

            if (this._helper) {
                this.helper.remove();
            }

            return false;

        },

        _updatePrevProperties: function () {
            this.prevPosition = {
                top: this.position.top,
                left: this.position.left
            };
            this.prevSize = {
                width: this.size.width,
                height: this.size.height
            };
        },

        _applyChanges: function () {
            var props = {};

            if (this.position.top !== this.prevPosition.top) {
                props.top = this.position.top + "px";
            }
            if (this.position.left !== this.prevPosition.left) {
                props.left = this.position.left + "px";
            }
            if (this.size.width !== this.prevSize.width) {
                props.width = this.size.width + "px";
            }
            if (this.size.height !== this.prevSize.height) {
                props.height = this.size.height + "px";
            }

            this.helper.css(props);

            return props;
        },

        _updateVirtualBoundaries: function (forceAspectRatio) {
            var pMinWidth, pMaxWidth, pMinHeight, pMaxHeight, b,
                o = this.options;

            b = {
                minWidth: this._isNumber(o.minWidth) ? o.minWidth : 0,
                maxWidth: this._isNumber(o.maxWidth) ? o.maxWidth : Infinity,
                minHeight: this._isNumber(o.minHeight) ? o.minHeight : 0,
                maxHeight: this._isNumber(o.maxHeight) ? o.maxHeight : Infinity
            };

            if (this._aspectRatio || forceAspectRatio) {
                pMinWidth = b.minHeight * this.aspectRatio;
                pMinHeight = b.minWidth / this.aspectRatio;
                pMaxWidth = b.maxHeight * this.aspectRatio;
                pMaxHeight = b.maxWidth / this.aspectRatio;

                if (pMinWidth > b.minWidth) {
                    b.minWidth = pMinWidth;
                }
                if (pMinHeight > b.minHeight) {
                    b.minHeight = pMinHeight;
                }
                if (pMaxWidth < b.maxWidth) {
                    b.maxWidth = pMaxWidth;
                }
                if (pMaxHeight < b.maxHeight) {
                    b.maxHeight = pMaxHeight;
                }
            }
            this._vBoundaries = b;
        },

        _updateCache: function (data) {
            this.offset = this.helper.offset();
            if (this._isNumber(data.left)) {
                this.position.left = data.left;
            }
            if (this._isNumber(data.top)) {
                this.position.top = data.top;
            }
            if (this._isNumber(data.height)) {
                this.size.height = data.height;
            }
            if (this._isNumber(data.width)) {
                this.size.width = data.width;
            }
        },

        _updateRatio: function (data) {

            var cpos = this.position,
                csize = this.size,
                a = this.axis;

            if (this._isNumber(data.height)) {
                data.width = (data.height * this.aspectRatio);
            } else if (this._isNumber(data.width)) {
                data.height = (data.width / this.aspectRatio);
            }

            if (a === "sw") {
                data.left = cpos.left + (csize.width - data.width);
                data.top = null;
            }
            if (a === "nw") {
                data.top = cpos.top + (csize.height - data.height);
                data.left = cpos.left + (csize.width - data.width);
            }

            return data;
        },

        _respectSize: function (data) {

            var o = this._vBoundaries,
                a = this.axis,
                ismaxw = this._isNumber(data.width) && o.maxWidth && (o.maxWidth < data.width),
                ismaxh = this._isNumber(data.height) && o.maxHeight && (o.maxHeight < data.height),
                isminw = this._isNumber(data.width) && o.minWidth && (o.minWidth > data.width),
                isminh = this._isNumber(data.height) && o.minHeight && (o.minHeight > data.height),
                dw = this.originalPosition.left + this.originalSize.width,
                dh = this.originalPosition.top + this.originalSize.height,
                cw = /sw|nw|w/.test(a), ch = /nw|ne|n/.test(a);
            if (isminw) {
                data.width = o.minWidth;
            }
            if (isminh) {
                data.height = o.minHeight;
            }
            if (ismaxw) {
                data.width = o.maxWidth;
            }
            if (ismaxh) {
                data.height = o.maxHeight;
            }

            if (isminw && cw) {
                data.left = dw - o.minWidth;
            }
            if (ismaxw && cw) {
                data.left = dw - o.maxWidth;
            }
            if (isminh && ch) {
                data.top = dh - o.minHeight;
            }
            if (ismaxh && ch) {
                data.top = dh - o.maxHeight;
            }

            // Fixing jump error on top/left - bug #2330
            if (!data.width && !data.height && !data.left && data.top) {
                data.top = null;
            } else if (!data.width && !data.height && !data.top && data.left) {
                data.left = null;
            }

            return data;
        },

        _getPaddingPlusBorderDimensions: function (element) {
            var i = 0,
                widths = [],
                borders = [
                    element.css("borderTopWidth"),
                    element.css("borderRightWidth"),
                    element.css("borderBottomWidth"),
                    element.css("borderLeftWidth")
                ],
                paddings = [
                    element.css("paddingTop"),
                    element.css("paddingRight"),
                    element.css("paddingBottom"),
                    element.css("paddingLeft")
                ];

            for (; i < 4; i++) {
                widths[i] = (parseFloat(borders[i]) || 0);
                widths[i] += (parseFloat(paddings[i]) || 0);
            }

            return {
                height: widths[0] + widths[2],
                width: widths[1] + widths[3]
            };
        },

        _proportionallyResize: function () {

            if (!this._proportionallyResizeElements.length) {
                return;
            }

            var prel,
                i = 0,
                element = this.helper || this.element;

            for (; i < this._proportionallyResizeElements.length; i++) {

                prel = this._proportionallyResizeElements[i];

                // TODO: Seems like a bug to cache this.outerDimensions
                // considering that we are in a loop.
                if (!this.outerDimensions) {
                    this.outerDimensions = this._getPaddingPlusBorderDimensions(prel);
                }

                prel.css({
                    height: (element.height() - this.outerDimensions.height) || 0,
                    width: (element.width() - this.outerDimensions.width) || 0
                });

            }

        },

        _renderProxy: function () {

            var el = this.element, o = this.options;
            this.elementOffset = el.offset();

            if (this._helper) {

                this.helper = this.helper || $("<div style='overflow:hidden;'></div>");

                this._addClass(this.helper, this._helper);
                this.helper.css({
                    width: this.element.outerWidth(),
                    height: this.element.outerHeight(),
                    position: "absolute",
                    left: this.elementOffset.left + "px",
                    top: this.elementOffset.top + "px",
                    zIndex: ++o.zIndex //TODO: Don't modify option
                });

                this.helper
                    .appendTo("body")
                    .disableSelection();

            } else {
                this.helper = this.element;
            }

        },

        _change: {
            e: function (event, dx) {
                return { width: this.originalSize.width + dx };
            },
            w: function (event, dx) {
                var cs = this.originalSize, sp = this.originalPosition;
                return { left: sp.left + dx, width: cs.width - dx };
            },
            n: function (event, dx, dy) {
                var cs = this.originalSize, sp = this.originalPosition;
                return { top: sp.top + dy, height: cs.height - dy };
            },
            s: function (event, dx, dy) {
                return { height: this.originalSize.height + dy };
            },
            se: function (event, dx, dy) {
                return $.extend(this._change.s.apply(this, arguments),
                    this._change.e.apply(this, [event, dx, dy]));
            },
            sw: function (event, dx, dy) {
                return $.extend(this._change.s.apply(this, arguments),
                    this._change.w.apply(this, [event, dx, dy]));
            },
            ne: function (event, dx, dy) {
                return $.extend(this._change.n.apply(this, arguments),
                    this._change.e.apply(this, [event, dx, dy]));
            },
            nw: function (event, dx, dy) {
                return $.extend(this._change.n.apply(this, arguments),
                    this._change.w.apply(this, [event, dx, dy]));
            }
        },

        _propagate: function (n, event) {
            $.ui.plugin.call(this, n, [event, this.ui()]);
            (n !== "resize" && this._trigger(n, event, this.ui()));
        },

        plugins: {},

        ui: function () {
            return {
                originalElement: this.originalElement,
                element: this.element,
                helper: this.helper,
                position: this.position,
                size: this.size,
                originalSize: this.originalSize,
                originalPosition: this.originalPosition
            };
        }

    });

    /*
     * Resizable Extensions
     */

    $.ui.plugin.add("resizable", "animate", {

        stop: function (event) {
            var that = $(this).resizable("instance"),
                o = that.options,
                pr = that._proportionallyResizeElements,
                ista = pr.length && (/textarea/i).test(pr[0].nodeName),
                soffseth = ista && that._hasScroll(pr[0], "left") ? 0 : that.sizeDiff.height,
                soffsetw = ista ? 0 : that.sizeDiff.width,
                style = {
                    width: (that.size.width - soffsetw),
                    height: (that.size.height - soffseth)
                },
                left = (parseFloat(that.element.css("left")) +
                    (that.position.left - that.originalPosition.left)) || null,
                top = (parseFloat(that.element.css("top")) +
                    (that.position.top - that.originalPosition.top)) || null;

            that.element.animate(
                $.extend(style, top && left ? { top: top, left: left } : {}), {
                    duration: o.animateDuration,
                    easing: o.animateEasing,
                    step: function () {

                        var data = {
                            width: parseFloat(that.element.css("width")),
                            height: parseFloat(that.element.css("height")),
                            top: parseFloat(that.element.css("top")),
                            left: parseFloat(that.element.css("left"))
                        };

                        if (pr && pr.length) {
                            $(pr[0]).css({ width: data.width, height: data.height });
                        }

                        // Propagating resize, and updating values for each animation step
                        that._updateCache(data);
                        that._propagate("resize", event);

                    }
                }
            );
        }

    });

    $.ui.plugin.add("resizable", "containment", {

        start: function () {
            var element, p, co, ch, cw, width, height,
                that = $(this).resizable("instance"),
                o = that.options,
                el = that.element,
                oc = o.containment,
                ce = (oc instanceof $) ?
                    oc.get(0) :
                    (/parent/.test(oc)) ? el.parent().get(0) : oc;

            if (!ce) {
                return;
            }

            that.containerElement = $(ce);

            if (/document/.test(oc) || oc === document) {
                that.containerOffset = {
                    left: 0,
                    top: 0
                };
                that.containerPosition = {
                    left: 0,
                    top: 0
                };

                that.parentData = {
                    element: $(document),
                    left: 0,
                    top: 0,
                    width: $(document).width(),
                    height: $(document).height() || document.body.parentNode.scrollHeight
                };
            } else {
                element = $(ce);
                p = [];
                $(["Top", "Right", "Left", "Bottom"]).each(function (i, name) {
                    p[i] = that._num(element.css("padding" + name));
                });

                that.containerOffset = element.offset();
                that.containerPosition = element.position();
                that.containerSize = {
                    height: (element.innerHeight() - p[3]),
                    width: (element.innerWidth() - p[1])
                };

                co = that.containerOffset;
                ch = that.containerSize.height;
                cw = that.containerSize.width;
                width = (that._hasScroll(ce, "left") ? ce.scrollWidth : cw);
                height = (that._hasScroll(ce) ? ce.scrollHeight : ch);

                that.parentData = {
                    element: ce,
                    left: co.left,
                    top: co.top,
                    width: width,
                    height: height
                };
            }
        },

        resize: function (event) {
            var woset, hoset, isParent, isOffsetRelative,
                that = $(this).resizable("instance"),
                o = that.options,
                co = that.containerOffset,
                cp = that.position,
                pRatio = that._aspectRatio || event.shiftKey,
                cop = {
                    top: 0,
                    left: 0
                },
                ce = that.containerElement,
                continueResize = true;

            if (ce[0] !== document && (/static/).test(ce.css("position"))) {
                cop = co;
            }

            if (cp.left < (that._helper ? co.left : 0)) {
                that.size.width = that.size.width +
                    (that._helper ?
                        (that.position.left - co.left) :
                        (that.position.left - cop.left));

                if (pRatio) {
                    that.size.height = that.size.width / that.aspectRatio;
                    continueResize = false;
                }
                that.position.left = o.helper ? co.left : 0;
            }

            if (cp.top < (that._helper ? co.top : 0)) {
                that.size.height = that.size.height +
                    (that._helper ?
                        (that.position.top - co.top) :
                        that.position.top);

                if (pRatio) {
                    that.size.width = that.size.height * that.aspectRatio;
                    continueResize = false;
                }
                that.position.top = that._helper ? co.top : 0;
            }

            isParent = that.containerElement.get(0) === that.element.parent().get(0);
            isOffsetRelative = /relative|absolute/.test(that.containerElement.css("position"));

            if (isParent && isOffsetRelative) {
                that.offset.left = that.parentData.left + that.position.left;
                that.offset.top = that.parentData.top + that.position.top;
            } else {
                that.offset.left = that.element.offset().left;
                that.offset.top = that.element.offset().top;
            }

            woset = Math.abs(that.sizeDiff.width +
                (that._helper ?
                    that.offset.left - cop.left :
                    (that.offset.left - co.left)));

            hoset = Math.abs(that.sizeDiff.height +
                (that._helper ?
                    that.offset.top - cop.top :
                    (that.offset.top - co.top)));

            if (woset + that.size.width >= that.parentData.width) {
                that.size.width = that.parentData.width - woset;
                if (pRatio) {
                    that.size.height = that.size.width / that.aspectRatio;
                    continueResize = false;
                }
            }

            if (hoset + that.size.height >= that.parentData.height) {
                that.size.height = that.parentData.height - hoset;
                if (pRatio) {
                    that.size.width = that.size.height * that.aspectRatio;
                    continueResize = false;
                }
            }

            if (!continueResize) {
                that.position.left = that.prevPosition.left;
                that.position.top = that.prevPosition.top;
                that.size.width = that.prevSize.width;
                that.size.height = that.prevSize.height;
            }
        },

        stop: function () {
            var that = $(this).resizable("instance"),
                o = that.options,
                co = that.containerOffset,
                cop = that.containerPosition,
                ce = that.containerElement,
                helper = $(that.helper),
                ho = helper.offset(),
                w = helper.outerWidth() - that.sizeDiff.width,
                h = helper.outerHeight() - that.sizeDiff.height;

            if (that._helper && !o.animate && (/relative/).test(ce.css("position"))) {
                $(this).css({
                    left: ho.left - cop.left - co.left,
                    width: w,
                    height: h
                });
            }

            if (that._helper && !o.animate && (/static/).test(ce.css("position"))) {
                $(this).css({
                    left: ho.left - cop.left - co.left,
                    width: w,
                    height: h
                });
            }
        }
    });

    $.ui.plugin.add("resizable", "alsoResize", {

        start: function () {
            var that = $(this).resizable("instance"),
                o = that.options;

            $(o.alsoResize).each(function () {
                var el = $(this);
                el.data("ui-resizable-alsoresize", {
                    width: parseFloat(el.width()), height: parseFloat(el.height()),
                    left: parseFloat(el.css("left")), top: parseFloat(el.css("top"))
                });
            });
        },

        resize: function (event, ui) {
            var that = $(this).resizable("instance"),
                o = that.options,
                os = that.originalSize,
                op = that.originalPosition,
                delta = {
                    height: (that.size.height - os.height) || 0,
                    width: (that.size.width - os.width) || 0,
                    top: (that.position.top - op.top) || 0,
                    left: (that.position.left - op.left) || 0
                };

            $(o.alsoResize).each(function () {
                var el = $(this), start = $(this).data("ui-resizable-alsoresize"), style = {},
                    css = el.parents(ui.originalElement[0]).length ?
                        ["width", "height"] :
                        ["width", "height", "top", "left"];

                $.each(css, function (i, prop) {
                    var sum = (start[prop] || 0) + (delta[prop] || 0);
                    if (sum && sum >= 0) {
                        style[prop] = sum || null;
                    }
                });

                el.css(style);
            });
        },

        stop: function () {
            $(this).removeData("ui-resizable-alsoresize");
        }
    });

    $.ui.plugin.add("resizable", "ghost", {

        start: function () {

            var that = $(this).resizable("instance"), cs = that.size;

            that.ghost = that.originalElement.clone();
            that.ghost.css({
                opacity: 0.25,
                display: "block",
                position: "relative",
                height: cs.height,
                width: cs.width,
                margin: 0,
                left: 0,
                top: 0
            });

            that._addClass(that.ghost, "ui-resizable-ghost");

            // DEPRECATED
            // TODO: remove after 1.12
            if ($.uiBackCompat !== false && typeof that.options.ghost === "string") {

                // Ghost option
                that.ghost.addClass(this.options.ghost);
            }

            that.ghost.appendTo(that.helper);

        },

        resize: function () {
            var that = $(this).resizable("instance");
            if (that.ghost) {
                that.ghost.css({
                    position: "relative",
                    height: that.size.height,
                    width: that.size.width
                });
            }
        },

        stop: function () {
            var that = $(this).resizable("instance");
            if (that.ghost && that.helper) {
                that.helper.get(0).removeChild(that.ghost.get(0));
            }
        }

    });

    $.ui.plugin.add("resizable", "grid", {

        resize: function () {
            var outerDimensions,
                that = $(this).resizable("instance"),
                o = that.options,
                cs = that.size,
                os = that.originalSize,
                op = that.originalPosition,
                a = that.axis,
                grid = typeof o.grid === "number" ? [o.grid, o.grid] : o.grid,
                gridX = (grid[0] || 1),
                gridY = (grid[1] || 1),
                ox = Math.round((cs.width - os.width) / gridX) * gridX,
                oy = Math.round((cs.height - os.height) / gridY) * gridY,
                newWidth = os.width + ox,
                newHeight = os.height + oy,
                isMaxWidth = o.maxWidth && (o.maxWidth < newWidth),
                isMaxHeight = o.maxHeight && (o.maxHeight < newHeight),
                isMinWidth = o.minWidth && (o.minWidth > newWidth),
                isMinHeight = o.minHeight && (o.minHeight > newHeight);

            o.grid = grid;

            if (isMinWidth) {
                newWidth += gridX;
            }
            if (isMinHeight) {
                newHeight += gridY;
            }
            if (isMaxWidth) {
                newWidth -= gridX;
            }
            if (isMaxHeight) {
                newHeight -= gridY;
            }

            if (/^(se|s|e)$/.test(a)) {
                that.size.width = newWidth;
                that.size.height = newHeight;
            } else if (/^(ne)$/.test(a)) {
                that.size.width = newWidth;
                that.size.height = newHeight;
                that.position.top = op.top - oy;
            } else if (/^(sw)$/.test(a)) {
                that.size.width = newWidth;
                that.size.height = newHeight;
                that.position.left = op.left - ox;
            } else {
                if (newHeight - gridY <= 0 || newWidth - gridX <= 0) {
                    outerDimensions = that._getPaddingPlusBorderDimensions(this);
                }

                if (newHeight - gridY > 0) {
                    that.size.height = newHeight;
                    that.position.top = op.top - oy;
                } else {
                    newHeight = gridY - outerDimensions.height;
                    that.size.height = newHeight;
                    that.position.top = op.top + os.height - newHeight;
                }
                if (newWidth - gridX > 0) {
                    that.size.width = newWidth;
                    that.position.left = op.left - ox;
                } else {
                    newWidth = gridX - outerDimensions.width;
                    that.size.width = newWidth;
                    that.position.left = op.left + os.width - newWidth;
                }
            }
        }

    });

    var widgetsResizable = $.ui.resizable;


    /*!
     * jQuery UI Selectable 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Selectable
    //>>group: Interactions
    //>>description: Allows groups of elements to be selected with the mouse.
    //>>docs: http://api.jqueryui.com/selectable/
    //>>demos: http://jqueryui.com/selectable/
    //>>css.structure: ../../themes/base/selectable.css



    var widgetsSelectable = $.widget("ui.selectable", $.ui.mouse, {
        version: "1.12.1",
        options: {
            appendTo: "body",
            autoRefresh: true,
            distance: 0,
            filter: "*",
            tolerance: "touch",

            // Callbacks
            selected: null,
            selecting: null,
            start: null,
            stop: null,
            unselected: null,
            unselecting: null
        },
        _create: function () {
            var that = this;

            this._addClass("ui-selectable");

            this.dragged = false;

            // Cache selectee children based on filter
            this.refresh = function () {
                that.elementPos = $(that.element[0]).offset();
                that.selectees = $(that.options.filter, that.element[0]);
                that._addClass(that.selectees, "ui-selectee");
                that.selectees.each(function () {
                    var $this = $(this),
                        selecteeOffset = $this.offset(),
                        pos = {
                            left: selecteeOffset.left - that.elementPos.left,
                            top: selecteeOffset.top - that.elementPos.top
                        };
                    $.data(this, "selectable-item", {
                        element: this,
                        $element: $this,
                        left: pos.left,
                        top: pos.top,
                        right: pos.left + $this.outerWidth(),
                        bottom: pos.top + $this.outerHeight(),
                        startselected: false,
                        selected: $this.hasClass("ui-selected"),
                        selecting: $this.hasClass("ui-selecting"),
                        unselecting: $this.hasClass("ui-unselecting")
                    });
                });
            };
            this.refresh();

            this._mouseInit();

            this.helper = $("<div>");
            this._addClass(this.helper, "ui-selectable-helper");
        },

        _destroy: function () {
            this.selectees.removeData("selectable-item");
            this._mouseDestroy();
        },

        _mouseStart: function (event) {
            var that = this,
                options = this.options;

            this.opos = [event.pageX, event.pageY];
            this.elementPos = $(this.element[0]).offset();

            if (this.options.disabled) {
                return;
            }

            this.selectees = $(options.filter, this.element[0]);

            this._trigger("start", event);

            $(options.appendTo).append(this.helper);

            // position helper (lasso)
            this.helper.css({
                "left": event.pageX,
                "top": event.pageY,
                "width": 0,
                "height": 0
            });

            if (options.autoRefresh) {
                this.refresh();
            }

            this.selectees.filter(".ui-selected").each(function () {
                var selectee = $.data(this, "selectable-item");
                selectee.startselected = true;
                if (!event.metaKey && !event.ctrlKey) {
                    that._removeClass(selectee.$element, "ui-selected");
                    selectee.selected = false;
                    that._addClass(selectee.$element, "ui-unselecting");
                    selectee.unselecting = true;

                    // selectable UNSELECTING callback
                    that._trigger("unselecting", event, {
                        unselecting: selectee.element
                    });
                }
            });

            $(event.target).parents().addBack().each(function () {
                var doSelect,
                    selectee = $.data(this, "selectable-item");
                if (selectee) {
                    doSelect = (!event.metaKey && !event.ctrlKey) ||
                        !selectee.$element.hasClass("ui-selected");
                    that._removeClass(selectee.$element, doSelect ? "ui-unselecting" : "ui-selected")
                        ._addClass(selectee.$element, doSelect ? "ui-selecting" : "ui-unselecting");
                    selectee.unselecting = !doSelect;
                    selectee.selecting = doSelect;
                    selectee.selected = doSelect;

                    // selectable (UN)SELECTING callback
                    if (doSelect) {
                        that._trigger("selecting", event, {
                            selecting: selectee.element
                        });
                    } else {
                        that._trigger("unselecting", event, {
                            unselecting: selectee.element
                        });
                    }
                    return false;
                }
            });

        },

        _mouseDrag: function (event) {

            this.dragged = true;

            if (this.options.disabled) {
                return;
            }

            var tmp,
                that = this,
                options = this.options,
                x1 = this.opos[0],
                y1 = this.opos[1],
                x2 = event.pageX,
                y2 = event.pageY;

            if (x1 > x2) { tmp = x2; x2 = x1; x1 = tmp; }
            if (y1 > y2) { tmp = y2; y2 = y1; y1 = tmp; }
            this.helper.css({ left: x1, top: y1, width: x2 - x1, height: y2 - y1 });

            this.selectees.each(function () {
                var selectee = $.data(this, "selectable-item"),
                    hit = false,
                    offset = {};

                //prevent helper from being selected if appendTo: selectable
                if (!selectee || selectee.element === that.element[0]) {
                    return;
                }

                offset.left = selectee.left + that.elementPos.left;
                offset.right = selectee.right + that.elementPos.left;
                offset.top = selectee.top + that.elementPos.top;
                offset.bottom = selectee.bottom + that.elementPos.top;

                if (options.tolerance === "touch") {
                    hit = (!(offset.left > x2 || offset.right < x1 || offset.top > y2 ||
                        offset.bottom < y1));
                } else if (options.tolerance === "fit") {
                    hit = (offset.left > x1 && offset.right < x2 && offset.top > y1 &&
                        offset.bottom < y2);
                }

                if (hit) {

                    // SELECT
                    if (selectee.selected) {
                        that._removeClass(selectee.$element, "ui-selected");
                        selectee.selected = false;
                    }
                    if (selectee.unselecting) {
                        that._removeClass(selectee.$element, "ui-unselecting");
                        selectee.unselecting = false;
                    }
                    if (!selectee.selecting) {
                        that._addClass(selectee.$element, "ui-selecting");
                        selectee.selecting = true;

                        // selectable SELECTING callback
                        that._trigger("selecting", event, {
                            selecting: selectee.element
                        });
                    }
                } else {

                    // UNSELECT
                    if (selectee.selecting) {
                        if ((event.metaKey || event.ctrlKey) && selectee.startselected) {
                            that._removeClass(selectee.$element, "ui-selecting");
                            selectee.selecting = false;
                            that._addClass(selectee.$element, "ui-selected");
                            selectee.selected = true;
                        } else {
                            that._removeClass(selectee.$element, "ui-selecting");
                            selectee.selecting = false;
                            if (selectee.startselected) {
                                that._addClass(selectee.$element, "ui-unselecting");
                                selectee.unselecting = true;
                            }

                            // selectable UNSELECTING callback
                            that._trigger("unselecting", event, {
                                unselecting: selectee.element
                            });
                        }
                    }
                    if (selectee.selected) {
                        if (!event.metaKey && !event.ctrlKey && !selectee.startselected) {
                            that._removeClass(selectee.$element, "ui-selected");
                            selectee.selected = false;

                            that._addClass(selectee.$element, "ui-unselecting");
                            selectee.unselecting = true;

                            // selectable UNSELECTING callback
                            that._trigger("unselecting", event, {
                                unselecting: selectee.element
                            });
                        }
                    }
                }
            });

            return false;
        },

        _mouseStop: function (event) {
            var that = this;

            this.dragged = false;

            $(".ui-unselecting", this.element[0]).each(function () {
                var selectee = $.data(this, "selectable-item");
                that._removeClass(selectee.$element, "ui-unselecting");
                selectee.unselecting = false;
                selectee.startselected = false;
                that._trigger("unselected", event, {
                    unselected: selectee.element
                });
            });
            $(".ui-selecting", this.element[0]).each(function () {
                var selectee = $.data(this, "selectable-item");
                that._removeClass(selectee.$element, "ui-selecting")
                    ._addClass(selectee.$element, "ui-selected");
                selectee.selecting = false;
                selectee.selected = true;
                selectee.startselected = true;
                that._trigger("selected", event, {
                    selected: selectee.element
                });
            });
            this._trigger("stop", event);

            this.helper.remove();

            return false;
        }

    });


    /*!
     * jQuery UI Sortable 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Sortable
    //>>group: Interactions
    //>>description: Enables items in a list to be sorted using the mouse.
    //>>docs: http://api.jqueryui.com/sortable/
    //>>demos: http://jqueryui.com/sortable/
    //>>css.structure: ../../themes/base/sortable.css



    var widgetsSortable = $.widget("ui.sortable", $.ui.mouse, {
        version: "1.12.1",
        widgetEventPrefix: "sort",
        ready: false,
        options: {
            appendTo: "parent",
            axis: false,
            connectWith: false,
            containment: false,
            cursor: "auto",
            cursorAt: false,
            dropOnEmpty: true,
            forcePlaceholderSize: false,
            forceHelperSize: false,
            grid: false,
            handle: false,
            helper: "original",
            items: "> *",
            opacity: false,
            placeholder: false,
            revert: false,
            scroll: true,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            scope: "default",
            tolerance: "intersect",
            zIndex: 1000,

            // Callbacks
            activate: null,
            beforeStop: null,
            change: null,
            deactivate: null,
            out: null,
            over: null,
            receive: null,
            remove: null,
            sort: null,
            start: null,
            stop: null,
            update: null
        },

        _isOverAxis: function (x, reference, size) {
            return (x >= reference) && (x < (reference + size));
        },

        _isFloating: function (item) {
            return (/left|right/).test(item.css("float")) ||
                (/inline|table-cell/).test(item.css("display"));
        },

        _create: function () {
            this.containerCache = {};
            this._addClass("ui-sortable");

            //Get the items
            this.refresh();

            //Let's determine the parent's offset
            this.offset = this.element.offset();

            //Initialize mouse events for interaction
            this._mouseInit();

            this._setHandleClassName();

            //We're ready to go
            this.ready = true;

        },

        _setOption: function (key, value) {
            this._super(key, value);

            if (key === "handle") {
                this._setHandleClassName();
            }
        },

        _setHandleClassName: function () {
            var that = this;
            this._removeClass(this.element.find(".ui-sortable-handle"), "ui-sortable-handle");
            $.each(this.items, function () {
                that._addClass(
                    this.instance.options.handle ?
                        this.item.find(this.instance.options.handle) :
                        this.item,
                    "ui-sortable-handle"
                );
            });
        },

        _destroy: function () {
            this._mouseDestroy();

            for (var i = this.items.length - 1; i >= 0; i--) {
                this.items[i].item.removeData(this.widgetName + "-item");
            }

            return this;
        },

        _mouseCapture: function (event, overrideHandle) {
            var currentItem = null,
                validHandle = false,
                that = this;

            if (this.reverting) {
                return false;
            }

            if (this.options.disabled || this.options.type === "static") {
                return false;
            }

            //We have to refresh the items data once first
            this._refreshItems(event);

            //Find out if the clicked node (or one of its parents) is a actual item in this.items
            $(event.target).parents().each(function () {
                if ($.data(this, that.widgetName + "-item") === that) {
                    currentItem = $(this);
                    return false;
                }
            });
            if ($.data(event.target, that.widgetName + "-item") === that) {
                currentItem = $(event.target);
            }

            if (!currentItem) {
                return false;
            }
            if (this.options.handle && !overrideHandle) {
                $(this.options.handle, currentItem).find("*").addBack().each(function () {
                    if (this === event.target) {
                        validHandle = true;
                    }
                });
                if (!validHandle) {
                    return false;
                }
            }

            this.currentItem = currentItem;
            this._removeCurrentsFromItems();
            return true;

        },

        _mouseStart: function (event, overrideHandle, noActivation) {

            var i, body,
                o = this.options;

            this.currentContainer = this;

            //We only need to call refreshPositions, because the refreshItems call has been moved to
            // mouseCapture
            this.refreshPositions();

            //Create and append the visible helper
            this.helper = this._createHelper(event);

            //Cache the helper size
            this._cacheHelperProportions();

            /*
             * - Position generation -
             * This block generates everything position related - it's the core of draggables.
             */

            //Cache the margins of the original element
            this._cacheMargins();

            //Get the next scrolling parent
            this.scrollParent = this.helper.scrollParent();

            //The element's absolute position on the page minus margins
            this.offset = this.currentItem.offset();
            this.offset = {
                top: this.offset.top - this.margins.top,
                left: this.offset.left - this.margins.left
            };

            $.extend(this.offset, {
                click: { //Where the click happened, relative to the element
                    left: event.pageX - this.offset.left,
                    top: event.pageY - this.offset.top
                },
                parent: this._getParentOffset(),

                // This is a relative to absolute position minus the actual position calculation -
                // only used for relative positioned helper
                relative: this._getRelativeOffset()
            });

            // Only after we got the offset, we can change the helper's position to absolute
            // TODO: Still need to figure out a way to make relative sorting possible
            this.helper.css("position", "absolute");
            this.cssPosition = this.helper.css("position");

            //Generate the original position
            this.originalPosition = this._generatePosition(event);
            this.originalPageX = event.pageX;
            this.originalPageY = event.pageY;

            //Adjust the mouse offset relative to the helper if "cursorAt" is supplied
            (o.cursorAt && this._adjustOffsetFromHelper(o.cursorAt));

            //Cache the former DOM position
            this.domPosition = {
                prev: this.currentItem.prev()[0],
                parent: this.currentItem.parent()[0]
            };

            // If the helper is not the original, hide the original so it's not playing any role during
            // the drag, won't cause anything bad this way
            if (this.helper[0] !== this.currentItem[0]) {
                this.currentItem.hide();
            }

            //Create the placeholder
            this._createPlaceholder();

            //Set a containment if given in the options
            if (o.containment) {
                this._setContainment();
            }

            if (o.cursor && o.cursor !== "auto") { // cursor option
                body = this.document.find("body");

                // Support: IE
                this.storedCursor = body.css("cursor");
                body.css("cursor", o.cursor);

                this.storedStylesheet =
                    $("<style>*{ cursor: " + o.cursor + " !important; }</style>").appendTo(body);
            }

            if (o.opacity) { // opacity option
                if (this.helper.css("opacity")) {
                    this._storedOpacity = this.helper.css("opacity");
                }
                this.helper.css("opacity", o.opacity);
            }

            if (o.zIndex) { // zIndex option
                if (this.helper.css("zIndex")) {
                    this._storedZIndex = this.helper.css("zIndex");
                }
                this.helper.css("zIndex", o.zIndex);
            }

            //Prepare scrolling
            if (this.scrollParent[0] !== this.document[0] &&
                this.scrollParent[0].tagName !== "HTML") {
                this.overflowOffset = this.scrollParent.offset();
            }

            //Call callbacks
            this._trigger("start", event, this._uiHash());

            //Recache the helper size
            if (!this._preserveHelperProportions) {
                this._cacheHelperProportions();
            }

            //Post "activate" events to possible containers
            if (!noActivation) {
                for (i = this.containers.length - 1; i >= 0; i--) {
                    this.containers[i]._trigger("activate", event, this._uiHash(this));
                }
            }

            //Prepare possible droppables
            if ($.ui.ddmanager) {
                $.ui.ddmanager.current = this;
            }

            if ($.ui.ddmanager && !o.dropBehaviour) {
                $.ui.ddmanager.prepareOffsets(this, event);
            }

            this.dragging = true;

            this._addClass(this.helper, "ui-sortable-helper");

            // Execute the drag once - this causes the helper not to be visiblebefore getting its
            // correct position
            this._mouseDrag(event);
            return true;

        },

        _mouseDrag: function (event) {
            var i, item, itemElement, intersection,
                o = this.options,
                scrolled = false;

            //Compute the helpers position
            this.position = this._generatePosition(event);
            this.positionAbs = this._convertPositionTo("absolute");

            if (!this.lastPositionAbs) {
                this.lastPositionAbs = this.positionAbs;
            }

            //Do scrolling
            if (this.options.scroll) {
                if (this.scrollParent[0] !== this.document[0] &&
                    this.scrollParent[0].tagName !== "HTML") {

                    if ((this.overflowOffset.top + this.scrollParent[0].offsetHeight) -
                        event.pageY < o.scrollSensitivity) {
                        this.scrollParent[0].scrollTop =
                            scrolled = this.scrollParent[0].scrollTop + o.scrollSpeed;
                    } else if (event.pageY - this.overflowOffset.top < o.scrollSensitivity) {
                        this.scrollParent[0].scrollTop =
                            scrolled = this.scrollParent[0].scrollTop - o.scrollSpeed;
                    }

                    if ((this.overflowOffset.left + this.scrollParent[0].offsetWidth) -
                        event.pageX < o.scrollSensitivity) {
                        this.scrollParent[0].scrollLeft = scrolled =
                            this.scrollParent[0].scrollLeft + o.scrollSpeed;
                    } else if (event.pageX - this.overflowOffset.left < o.scrollSensitivity) {
                        this.scrollParent[0].scrollLeft = scrolled =
                            this.scrollParent[0].scrollLeft - o.scrollSpeed;
                    }

                } else {

                    if (event.pageY - this.document.scrollTop() < o.scrollSensitivity) {
                        scrolled = this.document.scrollTop(this.document.scrollTop() - o.scrollSpeed);
                    } else if (this.window.height() - (event.pageY - this.document.scrollTop()) <
                        o.scrollSensitivity) {
                        scrolled = this.document.scrollTop(this.document.scrollTop() + o.scrollSpeed);
                    }

                    if (event.pageX - this.document.scrollLeft() < o.scrollSensitivity) {
                        scrolled = this.document.scrollLeft(
                            this.document.scrollLeft() - o.scrollSpeed
                        );
                    } else if (this.window.width() - (event.pageX - this.document.scrollLeft()) <
                        o.scrollSensitivity) {
                        scrolled = this.document.scrollLeft(
                            this.document.scrollLeft() + o.scrollSpeed
                        );
                    }

                }

                if (scrolled !== false && $.ui.ddmanager && !o.dropBehaviour) {
                    $.ui.ddmanager.prepareOffsets(this, event);
                }
            }

            //Regenerate the absolute position used for position checks
            this.positionAbs = this._convertPositionTo("absolute");

            //Set the helper position
            if (!this.options.axis || this.options.axis !== "y") {
                this.helper[0].style.left = this.position.left + "px";
            }
            if (!this.options.axis || this.options.axis !== "x") {
                this.helper[0].style.top = this.position.top + "px";
            }

            //Rearrange
            for (i = this.items.length - 1; i >= 0; i--) {

                //Cache variables and intersection, continue if no intersection
                item = this.items[i];
                itemElement = item.item[0];
                intersection = this._intersectsWithPointer(item);
                if (!intersection) {
                    continue;
                }

                // Only put the placeholder inside the current Container, skip all
                // items from other containers. This works because when moving
                // an item from one container to another the
                // currentContainer is switched before the placeholder is moved.
                //
                // Without this, moving items in "sub-sortables" can cause
                // the placeholder to jitter between the outer and inner container.
                if (item.instance !== this.currentContainer) {
                    continue;
                }

                // Cannot intersect with itself
                // no useless actions that have been done before
                // no action if the item moved is the parent of the item checked
                if (itemElement !== this.currentItem[0] &&
                    this.placeholder[intersection === 1 ? "next" : "prev"]()[0] !== itemElement &&
                    !$.contains(this.placeholder[0], itemElement) &&
                    (this.options.type === "semi-dynamic" ?
                        !$.contains(this.element[0], itemElement) :
                        true
                    )
                ) {

                    this.direction = intersection === 1 ? "down" : "up";

                    if (this.options.tolerance === "pointer" || this._intersectsWithSides(item)) {
                        this._rearrange(event, item);
                    } else {
                        break;
                    }

                    this._trigger("change", event, this._uiHash());
                    break;
                }
            }

            //Post events to containers
            this._contactContainers(event);

            //Interconnect with droppables
            if ($.ui.ddmanager) {
                $.ui.ddmanager.drag(this, event);
            }

            //Call callbacks
            this._trigger("sort", event, this._uiHash());

            this.lastPositionAbs = this.positionAbs;
            return false;

        },

        _mouseStop: function (event, noPropagation) {

            if (!event) {
                return;
            }

            //If we are using droppables, inform the manager about the drop
            if ($.ui.ddmanager && !this.options.dropBehaviour) {
                $.ui.ddmanager.drop(this, event);
            }

            if (this.options.revert) {
                var that = this,
                    cur = this.placeholder.offset(),
                    axis = this.options.axis,
                    animation = {};

                if (!axis || axis === "x") {
                    animation.left = cur.left - this.offset.parent.left - this.margins.left +
                        (this.offsetParent[0] === this.document[0].body ?
                            0 :
                            this.offsetParent[0].scrollLeft
                        );
                }
                if (!axis || axis === "y") {
                    animation.top = cur.top - this.offset.parent.top - this.margins.top +
                        (this.offsetParent[0] === this.document[0].body ?
                            0 :
                            this.offsetParent[0].scrollTop
                        );
                }
                this.reverting = true;
                $(this.helper).animate(
                    animation,
                    parseInt(this.options.revert, 10) || 500,
                    function () {
                        that._clear(event);
                    }
                );
            } else {
                this._clear(event, noPropagation);
            }

            return false;

        },

        cancel: function () {

            if (this.dragging) {

                this._mouseUp(new $.Event("mouseup", { target: null }));

                if (this.options.helper === "original") {
                    this.currentItem.css(this._storedCSS);
                    this._removeClass(this.currentItem, "ui-sortable-helper");
                } else {
                    this.currentItem.show();
                }

                //Post deactivating events to containers
                for (var i = this.containers.length - 1; i >= 0; i--) {
                    this.containers[i]._trigger("deactivate", null, this._uiHash(this));
                    if (this.containers[i].containerCache.over) {
                        this.containers[i]._trigger("out", null, this._uiHash(this));
                        this.containers[i].containerCache.over = 0;
                    }
                }

            }

            if (this.placeholder) {

                //$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,
                // it unbinds ALL events from the original node!
                if (this.placeholder[0].parentNode) {
                    this.placeholder[0].parentNode.removeChild(this.placeholder[0]);
                }
                if (this.options.helper !== "original" && this.helper &&
                    this.helper[0].parentNode) {
                    this.helper.remove();
                }

                $.extend(this, {
                    helper: null,
                    dragging: false,
                    reverting: false,
                    _noFinalSort: null
                });

                if (this.domPosition.prev) {
                    $(this.domPosition.prev).after(this.currentItem);
                } else {
                    $(this.domPosition.parent).prepend(this.currentItem);
                }
            }

            return this;

        },

        serialize: function (o) {

            var items = this._getItemsAsjQuery(o && o.connected),
                str = [];
            o = o || {};

            $(items).each(function () {
                var res = ($(o.item || this).attr(o.attribute || "id") || "")
                    .match(o.expression || (/(.+)[\-=_](.+)/));
                if (res) {
                    str.push(
                        (o.key || res[1] + "[]") +
                        "=" + (o.key && o.expression ? res[1] : res[2]));
                }
            });

            if (!str.length && o.key) {
                str.push(o.key + "=");
            }

            return str.join("&");

        },

        toArray: function (o) {

            var items = this._getItemsAsjQuery(o && o.connected),
                ret = [];

            o = o || {};

            items.each(function () {
                ret.push($(o.item || this).attr(o.attribute || "id") || "");
            });
            return ret;

        },

        /* Be careful with the following core functions */
        _intersectsWith: function (item) {

            var x1 = this.positionAbs.left,
                x2 = x1 + this.helperProportions.width,
                y1 = this.positionAbs.top,
                y2 = y1 + this.helperProportions.height,
                l = item.left,
                r = l + item.width,
                t = item.top,
                b = t + item.height,
                dyClick = this.offset.click.top,
                dxClick = this.offset.click.left,
                isOverElementHeight = (this.options.axis === "x") || ((y1 + dyClick) > t &&
                    (y1 + dyClick) < b),
                isOverElementWidth = (this.options.axis === "y") || ((x1 + dxClick) > l &&
                    (x1 + dxClick) < r),
                isOverElement = isOverElementHeight && isOverElementWidth;

            if (this.options.tolerance === "pointer" ||
                this.options.forcePointerForContainers ||
                (this.options.tolerance !== "pointer" &&
                    this.helperProportions[this.floating ? "width" : "height"] >
                    item[this.floating ? "width" : "height"])
            ) {
                return isOverElement;
            } else {

                return (l < x1 + (this.helperProportions.width / 2) && // Right Half
                    x2 - (this.helperProportions.width / 2) < r && // Left Half
                    t < y1 + (this.helperProportions.height / 2) && // Bottom Half
                    y2 - (this.helperProportions.height / 2) < b); // Top Half

            }
        },

        _intersectsWithPointer: function (item) {
            var verticalDirection, horizontalDirection,
                isOverElementHeight = (this.options.axis === "x") ||
                    this._isOverAxis(
                        this.positionAbs.top + this.offset.click.top, item.top, item.height),
                isOverElementWidth = (this.options.axis === "y") ||
                    this._isOverAxis(
                        this.positionAbs.left + this.offset.click.left, item.left, item.width),
                isOverElement = isOverElementHeight && isOverElementWidth;

            if (!isOverElement) {
                return false;
            }

            verticalDirection = this._getDragVerticalDirection();
            horizontalDirection = this._getDragHorizontalDirection();

            return this.floating ?
                ((horizontalDirection === "right" || verticalDirection === "down") ? 2 : 1)
                : (verticalDirection && (verticalDirection === "down" ? 2 : 1));

        },

        _intersectsWithSides: function (item) {

            var isOverBottomHalf = this._isOverAxis(this.positionAbs.top +
                this.offset.click.top, item.top + (item.height / 2), item.height),
                isOverRightHalf = this._isOverAxis(this.positionAbs.left +
                    this.offset.click.left, item.left + (item.width / 2), item.width),
                verticalDirection = this._getDragVerticalDirection(),
                horizontalDirection = this._getDragHorizontalDirection();

            if (this.floating && horizontalDirection) {
                return ((horizontalDirection === "right" && isOverRightHalf) ||
                    (horizontalDirection === "left" && !isOverRightHalf));
            } else {
                return verticalDirection && ((verticalDirection === "down" && isOverBottomHalf) ||
                    (verticalDirection === "up" && !isOverBottomHalf));
            }

        },

        _getDragVerticalDirection: function () {
            var delta = this.positionAbs.top - this.lastPositionAbs.top;
            return delta !== 0 && (delta > 0 ? "down" : "up");
        },

        _getDragHorizontalDirection: function () {
            var delta = this.positionAbs.left - this.lastPositionAbs.left;
            return delta !== 0 && (delta > 0 ? "right" : "left");
        },

        refresh: function (event) {
            this._refreshItems(event);
            this._setHandleClassName();
            this.refreshPositions();
            return this;
        },

        _connectWith: function () {
            var options = this.options;
            return options.connectWith.constructor === String ?
                [options.connectWith] :
                options.connectWith;
        },

        _getItemsAsjQuery: function (connected) {

            var i, j, cur, inst,
                items = [],
                queries = [],
                connectWith = this._connectWith();

            if (connectWith && connected) {
                for (i = connectWith.length - 1; i >= 0; i--) {
                    cur = $(connectWith[i], this.document[0]);
                    for (j = cur.length - 1; j >= 0; j--) {
                        inst = $.data(cur[j], this.widgetFullName);
                        if (inst && inst !== this && !inst.options.disabled) {
                            queries.push([$.isFunction(inst.options.items) ?
                                inst.options.items.call(inst.element) :
                                $(inst.options.items, inst.element)
                                    .not(".ui-sortable-helper")
                                    .not(".ui-sortable-placeholder"), inst]);
                        }
                    }
                }
            }

            queries.push([$.isFunction(this.options.items) ?
                this.options.items
                    .call(this.element, null, { options: this.options, item: this.currentItem }) :
                $(this.options.items, this.element)
                    .not(".ui-sortable-helper")
                    .not(".ui-sortable-placeholder"), this]);

            function addItems() {
                items.push(this);
            }
            for (i = queries.length - 1; i >= 0; i--) {
                queries[i][0].each(addItems);
            }

            return $(items);

        },

        _removeCurrentsFromItems: function () {

            var list = this.currentItem.find(":data(" + this.widgetName + "-item)");

            this.items = $.grep(this.items, function (item) {
                for (var j = 0; j < list.length; j++) {
                    if (list[j] === item.item[0]) {
                        return false;
                    }
                }
                return true;
            });

        },

        _refreshItems: function (event) {

            this.items = [];
            this.containers = [this];

            var i, j, cur, inst, targetData, _queries, item, queriesLength,
                items = this.items,
                queries = [[$.isFunction(this.options.items) ?
                    this.options.items.call(this.element[0], event, { item: this.currentItem }) :
                    $(this.options.items, this.element), this]],
                connectWith = this._connectWith();

            //Shouldn't be run the first time through due to massive slow-down
            if (connectWith && this.ready) {
                for (i = connectWith.length - 1; i >= 0; i--) {
                    cur = $(connectWith[i], this.document[0]);
                    for (j = cur.length - 1; j >= 0; j--) {
                        inst = $.data(cur[j], this.widgetFullName);
                        if (inst && inst !== this && !inst.options.disabled) {
                            queries.push([$.isFunction(inst.options.items) ?
                                inst.options.items
                                    .call(inst.element[0], event, { item: this.currentItem }) :
                                $(inst.options.items, inst.element), inst]);
                            this.containers.push(inst);
                        }
                    }
                }
            }

            for (i = queries.length - 1; i >= 0; i--) {
                targetData = queries[i][1];
                _queries = queries[i][0];

                for (j = 0, queriesLength = _queries.length; j < queriesLength; j++) {
                    item = $(_queries[j]);

                    // Data for target checking (mouse manager)
                    item.data(this.widgetName + "-item", targetData);

                    items.push({
                        item: item,
                        instance: targetData,
                        width: 0, height: 0,
                        left: 0, top: 0
                    });
                }
            }

        },

        refreshPositions: function (fast) {

            // Determine whether items are being displayed horizontally
            this.floating = this.items.length ?
                this.options.axis === "x" || this._isFloating(this.items[0].item) :
                false;

            //This has to be redone because due to the item being moved out/into the offsetParent,
            // the offsetParent's position will change
            if (this.offsetParent && this.helper) {
                this.offset.parent = this._getParentOffset();
            }

            var i, item, t, p;

            for (i = this.items.length - 1; i >= 0; i--) {
                item = this.items[i];

                //We ignore calculating positions of all connected containers when we're not over them
                if (item.instance !== this.currentContainer && this.currentContainer &&
                    item.item[0] !== this.currentItem[0]) {
                    continue;
                }

                t = this.options.toleranceElement ?
                    $(this.options.toleranceElement, item.item) :
                    item.item;

                if (!fast) {
                    item.width = t.outerWidth();
                    item.height = t.outerHeight();
                }

                p = t.offset();
                item.left = p.left;
                item.top = p.top;
            }

            if (this.options.custom && this.options.custom.refreshContainers) {
                this.options.custom.refreshContainers.call(this);
            } else {
                for (i = this.containers.length - 1; i >= 0; i--) {
                    p = this.containers[i].element.offset();
                    this.containers[i].containerCache.left = p.left;
                    this.containers[i].containerCache.top = p.top;
                    this.containers[i].containerCache.width =
                        this.containers[i].element.outerWidth();
                    this.containers[i].containerCache.height =
                        this.containers[i].element.outerHeight();
                }
            }

            return this;
        },

        _createPlaceholder: function (that) {
            that = that || this;
            var className,
                o = that.options;

            if (!o.placeholder || o.placeholder.constructor === String) {
                className = o.placeholder;
                o.placeholder = {
                    element: function () {

                        var nodeName = that.currentItem[0].nodeName.toLowerCase(),
                            element = $("<" + nodeName + ">", that.document[0]);

                        that._addClass(element, "ui-sortable-placeholder",
                            className || that.currentItem[0].className)
                            ._removeClass(element, "ui-sortable-helper");

                        if (nodeName === "tbody") {
                            that._createTrPlaceholder(
                                that.currentItem.find("tr").eq(0),
                                $("<tr>", that.document[0]).appendTo(element)
                            );
                        } else if (nodeName === "tr") {
                            that._createTrPlaceholder(that.currentItem, element);
                        } else if (nodeName === "img") {
                            element.attr("src", that.currentItem.attr("src"));
                        }

                        if (!className) {
                            element.css("visibility", "hidden");
                        }

                        return element;
                    },
                    update: function (container, p) {

                        // 1. If a className is set as 'placeholder option, we don't force sizes -
                        // the class is responsible for that
                        // 2. The option 'forcePlaceholderSize can be enabled to force it even if a
                        // class name is specified
                        if (className && !o.forcePlaceholderSize) {
                            return;
                        }

                        //If the element doesn't have a actual height by itself (without styles coming
                        // from a stylesheet), it receives the inline height from the dragged item
                        if (!p.height()) {
                            p.height(
                                that.currentItem.innerHeight() -
                                parseInt(that.currentItem.css("paddingTop") || 0, 10) -
                                parseInt(that.currentItem.css("paddingBottom") || 0, 10));
                        }
                        if (!p.width()) {
                            p.width(
                                that.currentItem.innerWidth() -
                                parseInt(that.currentItem.css("paddingLeft") || 0, 10) -
                                parseInt(that.currentItem.css("paddingRight") || 0, 10));
                        }
                    }
                };
            }

            //Create the placeholder
            that.placeholder = $(o.placeholder.element.call(that.element, that.currentItem));

            //Append it after the actual current item
            that.currentItem.after(that.placeholder);

            //Update the size of the placeholder (TODO: Logic to fuzzy, see line 316/317)
            o.placeholder.update(that, that.placeholder);

        },

        _createTrPlaceholder: function (sourceTr, targetTr) {
            var that = this;

            sourceTr.children().each(function () {
                $("<td>&#160;</td>", that.document[0])
                    .attr("colspan", $(this).attr("colspan") || 1)
                    .appendTo(targetTr);
            });
        },

        _contactContainers: function (event) {
            var i, j, dist, itemWithLeastDistance, posProperty, sizeProperty, cur, nearBottom,
                floating, axis,
                innermostContainer = null,
                innermostIndex = null;

            // Get innermost container that intersects with item
            for (i = this.containers.length - 1; i >= 0; i--) {

                // Never consider a container that's located within the item itself
                if ($.contains(this.currentItem[0], this.containers[i].element[0])) {
                    continue;
                }

                if (this._intersectsWith(this.containers[i].containerCache)) {

                    // If we've already found a container and it's more "inner" than this, then continue
                    if (innermostContainer &&
                        $.contains(
                            this.containers[i].element[0],
                            innermostContainer.element[0])) {
                        continue;
                    }

                    innermostContainer = this.containers[i];
                    innermostIndex = i;

                } else {

                    // container doesn't intersect. trigger "out" event if necessary
                    if (this.containers[i].containerCache.over) {
                        this.containers[i]._trigger("out", event, this._uiHash(this));
                        this.containers[i].containerCache.over = 0;
                    }
                }

            }

            // If no intersecting containers found, return
            if (!innermostContainer) {
                return;
            }

            // Move the item into the container if it's not there already
            if (this.containers.length === 1) {
                if (!this.containers[innermostIndex].containerCache.over) {
                    this.containers[innermostIndex]._trigger("over", event, this._uiHash(this));
                    this.containers[innermostIndex].containerCache.over = 1;
                }
            } else {

                // When entering a new container, we will find the item with the least distance and
                // append our item near it
                dist = 10000;
                itemWithLeastDistance = null;
                floating = innermostContainer.floating || this._isFloating(this.currentItem);
                posProperty = floating ? "left" : "top";
                sizeProperty = floating ? "width" : "height";
                axis = floating ? "pageX" : "pageY";

                for (j = this.items.length - 1; j >= 0; j--) {
                    if (!$.contains(
                        this.containers[innermostIndex].element[0], this.items[j].item[0])
                    ) {
                        continue;
                    }
                    if (this.items[j].item[0] === this.currentItem[0]) {
                        continue;
                    }

                    cur = this.items[j].item.offset()[posProperty];
                    nearBottom = false;
                    if (event[axis] - cur > this.items[j][sizeProperty] / 2) {
                        nearBottom = true;
                    }

                    if (Math.abs(event[axis] - cur) < dist) {
                        dist = Math.abs(event[axis] - cur);
                        itemWithLeastDistance = this.items[j];
                        this.direction = nearBottom ? "up" : "down";
                    }
                }

                //Check if dropOnEmpty is enabled
                if (!itemWithLeastDistance && !this.options.dropOnEmpty) {
                    return;
                }

                if (this.currentContainer === this.containers[innermostIndex]) {
                    if (!this.currentContainer.containerCache.over) {
                        this.containers[innermostIndex]._trigger("over", event, this._uiHash());
                        this.currentContainer.containerCache.over = 1;
                    }
                    return;
                }

                itemWithLeastDistance ?
                    this._rearrange(event, itemWithLeastDistance, null, true) :
                    this._rearrange(event, null, this.containers[innermostIndex].element, true);
                this._trigger("change", event, this._uiHash());
                this.containers[innermostIndex]._trigger("change", event, this._uiHash(this));
                this.currentContainer = this.containers[innermostIndex];

                //Update the placeholder
                this.options.placeholder.update(this.currentContainer, this.placeholder);

                this.containers[innermostIndex]._trigger("over", event, this._uiHash(this));
                this.containers[innermostIndex].containerCache.over = 1;
            }

        },

        _createHelper: function (event) {

            var o = this.options,
                helper = $.isFunction(o.helper) ?
                    $(o.helper.apply(this.element[0], [event, this.currentItem])) :
                    (o.helper === "clone" ? this.currentItem.clone() : this.currentItem);

            //Add the helper to the DOM if that didn't happen already
            if (!helper.parents("body").length) {
                $(o.appendTo !== "parent" ?
                    o.appendTo :
                    this.currentItem[0].parentNode)[0].appendChild(helper[0]);
            }

            if (helper[0] === this.currentItem[0]) {
                this._storedCSS = {
                    width: this.currentItem[0].style.width,
                    height: this.currentItem[0].style.height,
                    position: this.currentItem.css("position"),
                    top: this.currentItem.css("top"),
                    left: this.currentItem.css("left")
                };
            }

            if (!helper[0].style.width || o.forceHelperSize) {
                helper.width(this.currentItem.width());
            }
            if (!helper[0].style.height || o.forceHelperSize) {
                helper.height(this.currentItem.height());
            }

            return helper;

        },

        _adjustOffsetFromHelper: function (obj) {
            if (typeof obj === "string") {
                obj = obj.split(" ");
            }
            if ($.isArray(obj)) {
                obj = { left: +obj[0], top: +obj[1] || 0 };
            }
            if ("left" in obj) {
                this.offset.click.left = obj.left + this.margins.left;
            }
            if ("right" in obj) {
                this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left;
            }
            if ("top" in obj) {
                this.offset.click.top = obj.top + this.margins.top;
            }
            if ("bottom" in obj) {
                this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top;
            }
        },

        _getParentOffset: function () {

            //Get the offsetParent and cache its position
            this.offsetParent = this.helper.offsetParent();
            var po = this.offsetParent.offset();

            // This is a special case where we need to modify a offset calculated on start, since the
            // following happened:
            // 1. The position of the helper is absolute, so it's position is calculated based on the
            // next positioned parent
            // 2. The actual offset parent is a child of the scroll parent, and the scroll parent isn't
            // the document, which means that the scroll is included in the initial calculation of the
            // offset of the parent, and never recalculated upon drag
            if (this.cssPosition === "absolute" && this.scrollParent[0] !== this.document[0] &&
                $.contains(this.scrollParent[0], this.offsetParent[0])) {
                po.left += this.scrollParent.scrollLeft();
                po.top += this.scrollParent.scrollTop();
            }

            // This needs to be actually done for all browsers, since pageX/pageY includes this
            // information with an ugly IE fix
            if (this.offsetParent[0] === this.document[0].body ||
                (this.offsetParent[0].tagName &&
                    this.offsetParent[0].tagName.toLowerCase() === "html" && $.ui.ie)) {
                po = { top: 0, left: 0 };
            }

            return {
                top: po.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: po.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            };

        },

        _getRelativeOffset: function () {

            if (this.cssPosition === "relative") {
                var p = this.currentItem.position();
                return {
                    top: p.top - (parseInt(this.helper.css("top"), 10) || 0) +
                        this.scrollParent.scrollTop(),
                    left: p.left - (parseInt(this.helper.css("left"), 10) || 0) +
                        this.scrollParent.scrollLeft()
                };
            } else {
                return { top: 0, left: 0 };
            }

        },

        _cacheMargins: function () {
            this.margins = {
                left: (parseInt(this.currentItem.css("marginLeft"), 10) || 0),
                top: (parseInt(this.currentItem.css("marginTop"), 10) || 0)
            };
        },

        _cacheHelperProportions: function () {
            this.helperProportions = {
                width: this.helper.outerWidth(),
                height: this.helper.outerHeight()
            };
        },

        _setContainment: function () {

            var ce, co, over,
                o = this.options;
            if (o.containment === "parent") {
                o.containment = this.helper[0].parentNode;
            }
            if (o.containment === "document" || o.containment === "window") {
                this.containment = [
                    0 - this.offset.relative.left - this.offset.parent.left,
                    0 - this.offset.relative.top - this.offset.parent.top,
                    o.containment === "document" ?
                        this.document.width() :
                        this.window.width() - this.helperProportions.width - this.margins.left,
                    (o.containment === "document" ?
                        (this.document.height() || document.body.parentNode.scrollHeight) :
                        this.window.height() || this.document[0].body.parentNode.scrollHeight
                    ) - this.helperProportions.height - this.margins.top
                ];
            }

            if (!(/^(document|window|parent)$/).test(o.containment)) {
                ce = $(o.containment)[0];
                co = $(o.containment).offset();
                over = ($(ce).css("overflow") !== "hidden");

                this.containment = [
                    co.left + (parseInt($(ce).css("borderLeftWidth"), 10) || 0) +
                    (parseInt($(ce).css("paddingLeft"), 10) || 0) - this.margins.left,
                    co.top + (parseInt($(ce).css("borderTopWidth"), 10) || 0) +
                    (parseInt($(ce).css("paddingTop"), 10) || 0) - this.margins.top,
                    co.left + (over ? Math.max(ce.scrollWidth, ce.offsetWidth) : ce.offsetWidth) -
                    (parseInt($(ce).css("borderLeftWidth"), 10) || 0) -
                    (parseInt($(ce).css("paddingRight"), 10) || 0) -
                    this.helperProportions.width - this.margins.left,
                    co.top + (over ? Math.max(ce.scrollHeight, ce.offsetHeight) : ce.offsetHeight) -
                    (parseInt($(ce).css("borderTopWidth"), 10) || 0) -
                    (parseInt($(ce).css("paddingBottom"), 10) || 0) -
                    this.helperProportions.height - this.margins.top
                ];
            }

        },

        _convertPositionTo: function (d, pos) {

            if (!pos) {
                pos = this.position;
            }
            var mod = d === "absolute" ? 1 : -1,
                scroll = this.cssPosition === "absolute" &&
                    !(this.scrollParent[0] !== this.document[0] &&
                        $.contains(this.scrollParent[0], this.offsetParent[0])) ?
                    this.offsetParent :
                    this.scrollParent,
                scrollIsRootNode = (/(html|body)/i).test(scroll[0].tagName);

            return {
                top: (

                    // The absolute mouse position
                    pos.top +

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.top * mod +

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.top * mod -
                    ((this.cssPosition === "fixed" ?
                        -this.scrollParent.scrollTop() :
                        (scrollIsRootNode ? 0 : scroll.scrollTop())) * mod)
                ),
                left: (

                    // The absolute mouse position
                    pos.left +

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.left * mod +

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.left * mod -
                    ((this.cssPosition === "fixed" ?
                        -this.scrollParent.scrollLeft() : scrollIsRootNode ? 0 :
                            scroll.scrollLeft()) * mod)
                )
            };

        },

        _generatePosition: function (event) {

            var top, left,
                o = this.options,
                pageX = event.pageX,
                pageY = event.pageY,
                scroll = this.cssPosition === "absolute" &&
                    !(this.scrollParent[0] !== this.document[0] &&
                        $.contains(this.scrollParent[0], this.offsetParent[0])) ?
                    this.offsetParent :
                    this.scrollParent,
                scrollIsRootNode = (/(html|body)/i).test(scroll[0].tagName);

            // This is another very weird special case that only happens for relative elements:
            // 1. If the css position is relative
            // 2. and the scroll parent is the document or similar to the offset parent
            // we have to refresh the relative offset during the scroll so there are no jumps
            if (this.cssPosition === "relative" && !(this.scrollParent[0] !== this.document[0] &&
                this.scrollParent[0] !== this.offsetParent[0])) {
                this.offset.relative = this._getRelativeOffset();
            }

            /*
             * - Position constraining -
             * Constrain the position to a mix of grid, containment.
             */

            if (this.originalPosition) { //If we are not dragging yet, we won't check for options

                if (this.containment) {
                    if (event.pageX - this.offset.click.left < this.containment[0]) {
                        pageX = this.containment[0] + this.offset.click.left;
                    }
                    if (event.pageY - this.offset.click.top < this.containment[1]) {
                        pageY = this.containment[1] + this.offset.click.top;
                    }
                    if (event.pageX - this.offset.click.left > this.containment[2]) {
                        pageX = this.containment[2] + this.offset.click.left;
                    }
                    if (event.pageY - this.offset.click.top > this.containment[3]) {
                        pageY = this.containment[3] + this.offset.click.top;
                    }
                }

                if (o.grid) {
                    top = this.originalPageY + Math.round((pageY - this.originalPageY) /
                        o.grid[1]) * o.grid[1];
                    pageY = this.containment ?
                        ((top - this.offset.click.top >= this.containment[1] &&
                            top - this.offset.click.top <= this.containment[3]) ?
                            top :
                            ((top - this.offset.click.top >= this.containment[1]) ?
                                top - o.grid[1] : top + o.grid[1])) :
                        top;

                    left = this.originalPageX + Math.round((pageX - this.originalPageX) /
                        o.grid[0]) * o.grid[0];
                    pageX = this.containment ?
                        ((left - this.offset.click.left >= this.containment[0] &&
                            left - this.offset.click.left <= this.containment[2]) ?
                            left :
                            ((left - this.offset.click.left >= this.containment[0]) ?
                                left - o.grid[0] : left + o.grid[0])) :
                        left;
                }

            }

            return {
                top: (

                    // The absolute mouse position
                    pageY -

                    // Click offset (relative to the element)
                    this.offset.click.top -

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.top -

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.top +
                    ((this.cssPosition === "fixed" ?
                        -this.scrollParent.scrollTop() :
                        (scrollIsRootNode ? 0 : scroll.scrollTop())))
                ),
                left: (

                    // The absolute mouse position
                    pageX -

                    // Click offset (relative to the element)
                    this.offset.click.left -

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.left -

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.left +
                    ((this.cssPosition === "fixed" ?
                        -this.scrollParent.scrollLeft() :
                        scrollIsRootNode ? 0 : scroll.scrollLeft()))
                )
            };

        },

        _rearrange: function (event, i, a, hardRefresh) {

            a ? a[0].appendChild(this.placeholder[0]) :
                i.item[0].parentNode.insertBefore(this.placeholder[0],
                    (this.direction === "down" ? i.item[0] : i.item[0].nextSibling));

            //Various things done here to improve the performance:
            // 1. we create a setTimeout, that calls refreshPositions
            // 2. on the instance, we have a counter variable, that get's higher after every append
            // 3. on the local scope, we copy the counter variable, and check in the timeout,
            // if it's still the same
            // 4. this lets only the last addition to the timeout stack through
            this.counter = this.counter ? ++this.counter : 1;
            var counter = this.counter;

            this._delay(function () {
                if (counter === this.counter) {

                    //Precompute after each DOM insertion, NOT on mousemove
                    this.refreshPositions(!hardRefresh);
                }
            });

        },

        _clear: function (event, noPropagation) {

            this.reverting = false;

            // We delay all events that have to be triggered to after the point where the placeholder
            // has been removed and everything else normalized again
            var i,
                delayedTriggers = [];

            // We first have to update the dom position of the actual currentItem
            // Note: don't do it if the current item is already removed (by a user), or it gets
            // reappended (see #4088)
            if (!this._noFinalSort && this.currentItem.parent().length) {
                this.placeholder.before(this.currentItem);
            }
            this._noFinalSort = null;

            if (this.helper[0] === this.currentItem[0]) {
                for (i in this._storedCSS) {
                    if (this._storedCSS[i] === "auto" || this._storedCSS[i] === "static") {
                        this._storedCSS[i] = "";
                    }
                }
                this.currentItem.css(this._storedCSS);
                this._removeClass(this.currentItem, "ui-sortable-helper");
            } else {
                this.currentItem.show();
            }

            if (this.fromOutside && !noPropagation) {
                delayedTriggers.push(function (event) {
                    this._trigger("receive", event, this._uiHash(this.fromOutside));
                });
            }
            if ((this.fromOutside ||
                this.domPosition.prev !==
                this.currentItem.prev().not(".ui-sortable-helper")[0] ||
                this.domPosition.parent !== this.currentItem.parent()[0]) && !noPropagation) {

                // Trigger update callback if the DOM position has changed
                delayedTriggers.push(function (event) {
                    this._trigger("update", event, this._uiHash());
                });
            }

            // Check if the items Container has Changed and trigger appropriate
            // events.
            if (this !== this.currentContainer) {
                if (!noPropagation) {
                    delayedTriggers.push(function (event) {
                        this._trigger("remove", event, this._uiHash());
                    });
                    delayedTriggers.push((function (c) {
                        return function (event) {
                            c._trigger("receive", event, this._uiHash(this));
                        };
                    }).call(this, this.currentContainer));
                    delayedTriggers.push((function (c) {
                        return function (event) {
                            c._trigger("update", event, this._uiHash(this));
                        };
                    }).call(this, this.currentContainer));
                }
            }

            //Post events to containers
            function delayEvent(type, instance, container) {
                return function (event) {
                    container._trigger(type, event, instance._uiHash(instance));
                };
            }
            for (i = this.containers.length - 1; i >= 0; i--) {
                if (!noPropagation) {
                    delayedTriggers.push(delayEvent("deactivate", this, this.containers[i]));
                }
                if (this.containers[i].containerCache.over) {
                    delayedTriggers.push(delayEvent("out", this, this.containers[i]));
                    this.containers[i].containerCache.over = 0;
                }
            }

            //Do what was originally in plugins
            if (this.storedCursor) {
                this.document.find("body").css("cursor", this.storedCursor);
                this.storedStylesheet.remove();
            }
            if (this._storedOpacity) {
                this.helper.css("opacity", this._storedOpacity);
            }
            if (this._storedZIndex) {
                this.helper.css("zIndex", this._storedZIndex === "auto" ? "" : this._storedZIndex);
            }

            this.dragging = false;

            if (!noPropagation) {
                this._trigger("beforeStop", event, this._uiHash());
            }

            //$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,
            // it unbinds ALL events from the original node!
            this.placeholder[0].parentNode.removeChild(this.placeholder[0]);

            if (!this.cancelHelperRemoval) {
                if (this.helper[0] !== this.currentItem[0]) {
                    this.helper.remove();
                }
                this.helper = null;
            }

            if (!noPropagation) {
                for (i = 0; i < delayedTriggers.length; i++) {

                    // Trigger all delayed events
                    delayedTriggers[i].call(this, event);
                }
                this._trigger("stop", event, this._uiHash());
            }

            this.fromOutside = false;
            return !this.cancelHelperRemoval;

        },

        _trigger: function () {
            if ($.Widget.prototype._trigger.apply(this, arguments) === false) {
                this.cancel();
            }
        },

        _uiHash: function (_inst) {
            var inst = _inst || this;
            return {
                helper: inst.helper,
                placeholder: inst.placeholder || $([]),
                position: inst.position,
                originalPosition: inst.originalPosition,
                offset: inst.positionAbs,
                item: inst.currentItem,
                sender: _inst ? _inst.element : null
            };
        }

    });


    /*!
     * jQuery UI Accordion 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Accordion
    //>>group: Widgets
    // jscs:disable maximumLineLength
    //>>description: Displays collapsible content panels for presenting information in a limited amount of space.
    // jscs:enable maximumLineLength
    //>>docs: http://api.jqueryui.com/accordion/
    //>>demos: http://jqueryui.com/accordion/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/accordion.css
    //>>css.theme: ../../themes/base/theme.css



    var widgetsAccordion = $.widget("ui.accordion", {
        version: "1.12.1",
        options: {
            active: 0,
            animate: {},
            classes: {
                "ui-accordion-header": "ui-corner-top",
                "ui-accordion-header-collapsed": "ui-corner-all",
                "ui-accordion-content": "ui-corner-bottom"
            },
            collapsible: false,
            event: "click",
            header: "> li > :first-child, > :not(li):even",
            heightStyle: "auto",
            icons: {
                activeHeader: "ui-icon-triangle-1-s",
                header: "ui-icon-triangle-1-e"
            },

            // Callbacks
            activate: null,
            beforeActivate: null
        },

        hideProps: {
            borderTopWidth: "hide",
            borderBottomWidth: "hide",
            paddingTop: "hide",
            paddingBottom: "hide",
            height: "hide"
        },

        showProps: {
            borderTopWidth: "show",
            borderBottomWidth: "show",
            paddingTop: "show",
            paddingBottom: "show",
            height: "show"
        },

        _create: function () {
            var options = this.options;

            this.prevShow = this.prevHide = $();
            this._addClass("ui-accordion", "ui-widget ui-helper-reset");
            this.element.attr("role", "tablist");

            // Don't allow collapsible: false and active: false / null
            if (!options.collapsible && (options.active === false || options.active == null)) {
                options.active = 0;
            }

            this._processPanels();

            // handle negative values
            if (options.active < 0) {
                options.active += this.headers.length;
            }
            this._refresh();
        },

        _getCreateEventData: function () {
            return {
                header: this.active,
                panel: !this.active.length ? $() : this.active.next()
            };
        },

        _createIcons: function () {
            var icon, children,
                icons = this.options.icons;

            if (icons) {
                icon = $("<span>");
                this._addClass(icon, "ui-accordion-header-icon", "ui-icon " + icons.header);
                icon.prependTo(this.headers);
                children = this.active.children(".ui-accordion-header-icon");
                this._removeClass(children, icons.header)
                    ._addClass(children, null, icons.activeHeader)
                    ._addClass(this.headers, "ui-accordion-icons");
            }
        },

        _destroyIcons: function () {
            this._removeClass(this.headers, "ui-accordion-icons");
            this.headers.children(".ui-accordion-header-icon").remove();
        },

        _destroy: function () {
            var contents;

            // Clean up main element
            this.element.removeAttr("role");

            // Clean up headers
            this.headers
                .removeAttr("role aria-expanded aria-selected aria-controls tabIndex")
                .removeUniqueId();

            this._destroyIcons();

            // Clean up content panels
            contents = this.headers.next()
                .css("display", "")
                .removeAttr("role aria-hidden aria-labelledby")
                .removeUniqueId();

            if (this.options.heightStyle !== "content") {
                contents.css("height", "");
            }
        },

        _setOption: function (key, value) {
            if (key === "active") {

                // _activate() will handle invalid values and update this.options
                this._activate(value);
                return;
            }

            if (key === "event") {
                if (this.options.event) {
                    this._off(this.headers, this.options.event);
                }
                this._setupEvents(value);
            }

            this._super(key, value);

            // Setting collapsible: false while collapsed; open first panel
            if (key === "collapsible" && !value && this.options.active === false) {
                this._activate(0);
            }

            if (key === "icons") {
                this._destroyIcons();
                if (value) {
                    this._createIcons();
                }
            }
        },

        _setOptionDisabled: function (value) {
            this._super(value);

            this.element.attr("aria-disabled", value);

            // Support: IE8 Only
            // #5332 / #6059 - opacity doesn't cascade to positioned elements in IE
            // so we need to add the disabled class to the headers and panels
            this._toggleClass(null, "ui-state-disabled", !!value);
            this._toggleClass(this.headers.add(this.headers.next()), null, "ui-state-disabled",
                !!value);
        },

        _keydown: function (event) {
            if (event.altKey || event.ctrlKey) {
                return;
            }

            var keyCode = $.ui.keyCode,
                length = this.headers.length,
                currentIndex = this.headers.index(event.target),
                toFocus = false;

            switch (event.keyCode) {
                case keyCode.RIGHT:
                case keyCode.DOWN:
                    toFocus = this.headers[(currentIndex + 1) % length];
                    break;
                case keyCode.LEFT:
                case keyCode.UP:
                    toFocus = this.headers[(currentIndex - 1 + length) % length];
                    break;
                case keyCode.SPACE:
                case keyCode.ENTER:
                    this._eventHandler(event);
                    break;
                case keyCode.HOME:
                    toFocus = this.headers[0];
                    break;
                case keyCode.END:
                    toFocus = this.headers[length - 1];
                    break;
            }

            if (toFocus) {
                $(event.target).attr("tabIndex", -1);
                $(toFocus).attr("tabIndex", 0);
                $(toFocus).trigger("focus");
                event.preventDefault();
            }
        },

        _panelKeyDown: function (event) {
            if (event.keyCode === $.ui.keyCode.UP && event.ctrlKey) {
                $(event.currentTarget).prev().trigger("focus");
            }
        },

        refresh: function () {
            var options = this.options;
            this._processPanels();

            // Was collapsed or no panel
            if ((options.active === false && options.collapsible === true) ||
                !this.headers.length) {
                options.active = false;
                this.active = $();

                // active false only when collapsible is true
            } else if (options.active === false) {
                this._activate(0);

                // was active, but active panel is gone
            } else if (this.active.length && !$.contains(this.element[0], this.active[0])) {

                // all remaining panel are disabled
                if (this.headers.length === this.headers.find(".ui-state-disabled").length) {
                    options.active = false;
                    this.active = $();

                    // activate previous panel
                } else {
                    this._activate(Math.max(0, options.active - 1));
                }

                // was active, active panel still exists
            } else {

                // make sure active index is correct
                options.active = this.headers.index(this.active);
            }

            this._destroyIcons();

            this._refresh();
        },

        _processPanels: function () {
            var prevHeaders = this.headers,
                prevPanels = this.panels;

            this.headers = this.element.find(this.options.header);
            this._addClass(this.headers, "ui-accordion-header ui-accordion-header-collapsed",
                "ui-state-default");

            this.panels = this.headers.next().filter(":not(.ui-accordion-content-active)").hide();
            this._addClass(this.panels, "ui-accordion-content", "ui-helper-reset ui-widget-content");

            // Avoid memory leaks (#10056)
            if (prevPanels) {
                this._off(prevHeaders.not(this.headers));
                this._off(prevPanels.not(this.panels));
            }
        },

        _refresh: function () {
            var maxHeight,
                options = this.options,
                heightStyle = options.heightStyle,
                parent = this.element.parent();

            this.active = this._findActive(options.active);
            this._addClass(this.active, "ui-accordion-header-active", "ui-state-active")
                ._removeClass(this.active, "ui-accordion-header-collapsed");
            this._addClass(this.active.next(), "ui-accordion-content-active");
            this.active.next().show();

            this.headers
                .attr("role", "tab")
                .each(function () {
                    var header = $(this),
                        headerId = header.uniqueId().attr("id"),
                        panel = header.next(),
                        panelId = panel.uniqueId().attr("id");
                    header.attr("aria-controls", panelId);
                    panel.attr("aria-labelledby", headerId);
                })
                .next()
                .attr("role", "tabpanel");

            this.headers
                .not(this.active)
                .attr({
                    "aria-selected": "false",
                    "aria-expanded": "false",
                    tabIndex: -1
                })
                .next()
                .attr({
                    "aria-hidden": "true"
                })
                .hide();

            // Make sure at least one header is in the tab order
            if (!this.active.length) {
                this.headers.eq(0).attr("tabIndex", 0);
            } else {
                this.active.attr({
                    "aria-selected": "true",
                    "aria-expanded": "true",
                    tabIndex: 0
                })
                    .next()
                    .attr({
                        "aria-hidden": "false"
                    });
            }

            this._createIcons();

            this._setupEvents(options.event);

            if (heightStyle === "fill") {
                maxHeight = parent.height();
                this.element.siblings(":visible").each(function () {
                    var elem = $(this),
                        position = elem.css("position");

                    if (position === "absolute" || position === "fixed") {
                        return;
                    }
                    maxHeight -= elem.outerHeight(true);
                });

                this.headers.each(function () {
                    maxHeight -= $(this).outerHeight(true);
                });

                this.headers.next()
                    .each(function () {
                        $(this).height(Math.max(0, maxHeight -
                            $(this).innerHeight() + $(this).height()));
                    })
                    .css("overflow", "auto");
            } else if (heightStyle === "auto") {
                maxHeight = 0;
                this.headers.next()
                    .each(function () {
                        var isVisible = $(this).is(":visible");
                        if (!isVisible) {
                            $(this).show();
                        }
                        maxHeight = Math.max(maxHeight, $(this).css("height", "").height());
                        if (!isVisible) {
                            $(this).hide();
                        }
                    })
                    .height(maxHeight);
            }
        },

        _activate: function (index) {
            var active = this._findActive(index)[0];

            // Trying to activate the already active panel
            if (active === this.active[0]) {
                return;
            }

            // Trying to collapse, simulate a click on the currently active header
            active = active || this.active[0];

            this._eventHandler({
                target: active,
                currentTarget: active,
                preventDefault: $.noop
            });
        },

        _findActive: function (selector) {
            return typeof selector === "number" ? this.headers.eq(selector) : $();
        },

        _setupEvents: function (event) {
            var events = {
                keydown: "_keydown"
            };
            if (event) {
                $.each(event.split(" "), function (index, eventName) {
                    events[eventName] = "_eventHandler";
                });
            }

            this._off(this.headers.add(this.headers.next()));
            this._on(this.headers, events);
            this._on(this.headers.next(), { keydown: "_panelKeyDown" });
            this._hoverable(this.headers);
            this._focusable(this.headers);
        },

        _eventHandler: function (event) {
            var activeChildren, clickedChildren,
                options = this.options,
                active = this.active,
                clicked = $(event.currentTarget),
                clickedIsActive = clicked[0] === active[0],
                collapsing = clickedIsActive && options.collapsible,
                toShow = collapsing ? $() : clicked.next(),
                toHide = active.next(),
                eventData = {
                    oldHeader: active,
                    oldPanel: toHide,
                    newHeader: collapsing ? $() : clicked,
                    newPanel: toShow
                };

            event.preventDefault();

            if (

                // click on active header, but not collapsible
                (clickedIsActive && !options.collapsible) ||

                // allow canceling activation
                (this._trigger("beforeActivate", event, eventData) === false)) {
                return;
            }

            options.active = collapsing ? false : this.headers.index(clicked);

            // When the call to ._toggle() comes after the class changes
            // it causes a very odd bug in IE 8 (see #6720)
            this.active = clickedIsActive ? $() : clicked;
            this._toggle(eventData);

            // Switch classes
            // corner classes on the previously active header stay after the animation
            this._removeClass(active, "ui-accordion-header-active", "ui-state-active");
            if (options.icons) {
                activeChildren = active.children(".ui-accordion-header-icon");
                this._removeClass(activeChildren, null, options.icons.activeHeader)
                    ._addClass(activeChildren, null, options.icons.header);
            }

            if (!clickedIsActive) {
                this._removeClass(clicked, "ui-accordion-header-collapsed")
                    ._addClass(clicked, "ui-accordion-header-active", "ui-state-active");
                if (options.icons) {
                    clickedChildren = clicked.children(".ui-accordion-header-icon");
                    this._removeClass(clickedChildren, null, options.icons.header)
                        ._addClass(clickedChildren, null, options.icons.activeHeader);
                }

                this._addClass(clicked.next(), "ui-accordion-content-active");
            }
        },

        _toggle: function (data) {
            var toShow = data.newPanel,
                toHide = this.prevShow.length ? this.prevShow : data.oldPanel;

            // Handle activating a panel during the animation for another activation
            this.prevShow.add(this.prevHide).stop(true, true);
            this.prevShow = toShow;
            this.prevHide = toHide;

            if (this.options.animate) {
                this._animate(toShow, toHide, data);
            } else {
                toHide.hide();
                toShow.show();
                this._toggleComplete(data);
            }

            toHide.attr({
                "aria-hidden": "true"
            });
            toHide.prev().attr({
                "aria-selected": "false",
                "aria-expanded": "false"
            });

            // if we're switching panels, remove the old header from the tab order
            // if we're opening from collapsed state, remove the previous header from the tab order
            // if we're collapsing, then keep the collapsing header in the tab order
            if (toShow.length && toHide.length) {
                toHide.prev().attr({
                    "tabIndex": -1,
                    "aria-expanded": "false"
                });
            } else if (toShow.length) {
                this.headers.filter(function () {
                    return parseInt($(this).attr("tabIndex"), 10) === 0;
                })
                    .attr("tabIndex", -1);
            }

            toShow
                .attr("aria-hidden", "false")
                .prev()
                .attr({
                    "aria-selected": "true",
                    "aria-expanded": "true",
                    tabIndex: 0
                });
        },

        _animate: function (toShow, toHide, data) {
            var total, easing, duration,
                that = this,
                adjust = 0,
                boxSizing = toShow.css("box-sizing"),
                down = toShow.length &&
                    (!toHide.length || (toShow.index() < toHide.index())),
                animate = this.options.animate || {},
                options = down && animate.down || animate,
                complete = function () {
                    that._toggleComplete(data);
                };

            if (typeof options === "number") {
                duration = options;
            }
            if (typeof options === "string") {
                easing = options;
            }

            // fall back from options to animation in case of partial down settings
            easing = easing || options.easing || animate.easing;
            duration = duration || options.duration || animate.duration;

            if (!toHide.length) {
                return toShow.animate(this.showProps, duration, easing, complete);
            }
            if (!toShow.length) {
                return toHide.animate(this.hideProps, duration, easing, complete);
            }

            total = toShow.show().outerHeight();
            toHide.animate(this.hideProps, {
                duration: duration,
                easing: easing,
                step: function (now, fx) {
                    fx.now = Math.round(now);
                }
            });
            toShow
                .hide()
                .animate(this.showProps, {
                    duration: duration,
                    easing: easing,
                    complete: complete,
                    step: function (now, fx) {
                        fx.now = Math.round(now);
                        if (fx.prop !== "height") {
                            if (boxSizing === "content-box") {
                                adjust += fx.now;
                            }
                        } else if (that.options.heightStyle !== "content") {
                            fx.now = Math.round(total - toHide.outerHeight() - adjust);
                            adjust = 0;
                        }
                    }
                });
        },

        _toggleComplete: function (data) {
            var toHide = data.oldPanel,
                prev = toHide.prev();

            this._removeClass(toHide, "ui-accordion-content-active");
            this._removeClass(prev, "ui-accordion-header-active")
                ._addClass(prev, "ui-accordion-header-collapsed");

            // Work around for rendering bug in IE (#5421)
            if (toHide.length) {
                toHide.parent()[0].className = toHide.parent()[0].className;
            }
            this._trigger("activate", null, data);
        }
    });


    /*!
     * jQuery UI Menu 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Menu
    //>>group: Widgets
    //>>description: Creates nestable menus.
    //>>docs: http://api.jqueryui.com/menu/
    //>>demos: http://jqueryui.com/menu/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/menu.css
    //>>css.theme: ../../themes/base/theme.css



    var widgetsMenu = $.widget("ui.menu", {
        version: "1.12.1",
        defaultElement: "<ul>",
        delay: 300,
        options: {
            icons: {
                submenu: "ui-icon-caret-1-e"
            },
            items: "> *",
            menus: "ul",
            position: {
                my: "left top",
                at: "right top"
            },
            role: "menu",

            // Callbacks
            blur: null,
            focus: null,
            select: null
        },

        _create: function () {
            this.activeMenu = this.element;

            // Flag used to prevent firing of the click handler
            // as the event bubbles up through nested menus
            this.mouseHandled = false;
            this.element
                .uniqueId()
                .attr({
                    role: this.options.role,
                    tabIndex: 0
                });

            this._addClass("ui-menu", "ui-widget ui-widget-content");
            this._on({

                // Prevent focus from sticking to links inside menu after clicking
                // them (focus should always stay on UL during navigation).
                "mousedown .ui-menu-item": function (event) {
                    event.preventDefault();
                },
                "click .ui-menu-item": function (event) {
                    var target = $(event.target);
                    var active = $($.ui.safeActiveElement(this.document[0]));
                    if (!this.mouseHandled && target.not(".ui-state-disabled").length) {
                        this.select(event);

                        // Only set the mouseHandled flag if the event will bubble, see #9469.
                        if (!event.isPropagationStopped()) {
                            this.mouseHandled = true;
                        }

                        // Open submenu on click
                        if (target.has(".ui-menu").length) {
                            this.expand(event);
                        } else if (!this.element.is(":focus") &&
                            active.closest(".ui-menu").length) {

                            // Redirect focus to the menu
                            this.element.trigger("focus", [true]);

                            // If the active item is on the top level, let it stay active.
                            // Otherwise, blur the active item since it is no longer visible.
                            if (this.active && this.active.parents(".ui-menu").length === 1) {
                                clearTimeout(this.timer);
                            }
                        }
                    }
                },
                "mouseenter .ui-menu-item": function (event) {

                    // Ignore mouse events while typeahead is active, see #10458.
                    // Prevents focusing the wrong item when typeahead causes a scroll while the mouse
                    // is over an item in the menu
                    if (this.previousFilter) {
                        return;
                    }

                    var actualTarget = $(event.target).closest(".ui-menu-item"),
                        target = $(event.currentTarget);

                    // Ignore bubbled events on parent items, see #11641
                    if (actualTarget[0] !== target[0]) {
                        return;
                    }

                    // Remove ui-state-active class from siblings of the newly focused menu item
                    // to avoid a jump caused by adjacent elements both having a class with a border
                    this._removeClass(target.siblings().children(".ui-state-active"),
                        null, "ui-state-active");
                    this.focus(event, target);
                },
                mouseleave: "collapseAll",
                "mouseleave .ui-menu": "collapseAll",
                focus: function (event, keepActiveItem) {

                    // If there's already an active item, keep it active
                    // If not, activate the first item
                    var item = this.active || this.element.find(this.options.items).eq(0);

                    if (!keepActiveItem) {
                        this.focus(event, item);
                    }
                },
                blur: function (event) {
                    this._delay(function () {
                        var notContained = !$.contains(
                            this.element[0],
                            $.ui.safeActiveElement(this.document[0])
                        );
                        if (notContained) {
                            this.collapseAll(event);
                        }
                    });
                },
                keydown: "_keydown"
            });

            this.refresh();

            // Clicks outside of a menu collapse any open menus
            this._on(this.document, {
                click: function (event) {
                    if (this._closeOnDocumentClick(event)) {
                        this.collapseAll(event);
                    }

                    // Reset the mouseHandled flag
                    this.mouseHandled = false;
                }
            });
        },

        _destroy: function () {
            var items = this.element.find(".ui-menu-item")
                .removeAttr("role aria-disabled"),
                submenus = items.children(".ui-menu-item-wrapper")
                    .removeUniqueId()
                    .removeAttr("tabIndex role aria-haspopup");

            // Destroy (sub)menus
            this.element
                .removeAttr("aria-activedescendant")
                .find(".ui-menu").addBack()
                .removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled " +
                "tabIndex")
                .removeUniqueId()
                .show();

            submenus.children().each(function () {
                var elem = $(this);
                if (elem.data("ui-menu-submenu-caret")) {
                    elem.remove();
                }
            });
        },

        _keydown: function (event) {
            var match, prev, character, skip,
                preventDefault = true;

            switch (event.keyCode) {
                case $.ui.keyCode.PAGE_UP:
                    this.previousPage(event);
                    break;
                case $.ui.keyCode.PAGE_DOWN:
                    this.nextPage(event);
                    break;
                case $.ui.keyCode.HOME:
                    this._move("first", "first", event);
                    break;
                case $.ui.keyCode.END:
                    this._move("last", "last", event);
                    break;
                case $.ui.keyCode.UP:
                    this.previous(event);
                    break;
                case $.ui.keyCode.DOWN:
                    this.next(event);
                    break;
                case $.ui.keyCode.LEFT:
                    this.collapse(event);
                    break;
                case $.ui.keyCode.RIGHT:
                    if (this.active && !this.active.is(".ui-state-disabled")) {
                        this.expand(event);
                    }
                    break;
                case $.ui.keyCode.ENTER:
                case $.ui.keyCode.SPACE:
                    this._activate(event);
                    break;
                case $.ui.keyCode.ESCAPE:
                    this.collapse(event);
                    break;
                default:
                    preventDefault = false;
                    prev = this.previousFilter || "";
                    skip = false;

                    // Support number pad values
                    character = event.keyCode >= 96 && event.keyCode <= 105 ?
                        (event.keyCode - 96).toString() : String.fromCharCode(event.keyCode);

                    clearTimeout(this.filterTimer);

                    if (character === prev) {
                        skip = true;
                    } else {
                        character = prev + character;
                    }

                    match = this._filterMenuItems(character);
                    match = skip && match.index(this.active.next()) !== -1 ?
                        this.active.nextAll(".ui-menu-item") :
                        match;

                    // If no matches on the current filter, reset to the last character pressed
                    // to move down the menu to the first item that starts with that character
                    if (!match.length) {
                        character = String.fromCharCode(event.keyCode);
                        match = this._filterMenuItems(character);
                    }

                    if (match.length) {
                        this.focus(event, match);
                        this.previousFilter = character;
                        this.filterTimer = this._delay(function () {
                            delete this.previousFilter;
                        }, 1000);
                    } else {
                        delete this.previousFilter;
                    }
            }

            if (preventDefault) {
                event.preventDefault();
            }
        },

        _activate: function (event) {
            if (this.active && !this.active.is(".ui-state-disabled")) {
                if (this.active.children("[aria-haspopup='true']").length) {
                    this.expand(event);
                } else {
                    this.select(event);
                }
            }
        },

        refresh: function () {
            var menus, items, newSubmenus, newItems, newWrappers,
                that = this,
                icon = this.options.icons.submenu,
                submenus = this.element.find(this.options.menus);

            this._toggleClass("ui-menu-icons", null, !!this.element.find(".ui-icon").length);

            // Initialize nested menus
            newSubmenus = submenus.filter(":not(.ui-menu)")
                .hide()
                .attr({
                    role: this.options.role,
                    "aria-hidden": "true",
                    "aria-expanded": "false"
                })
                .each(function () {
                    var menu = $(this),
                        item = menu.prev(),
                        submenuCaret = $("<span>").data("ui-menu-submenu-caret", true);

                    that._addClass(submenuCaret, "ui-menu-icon", "ui-icon " + icon);
                    item
                        .attr("aria-haspopup", "true")
                        .prepend(submenuCaret);
                    menu.attr("aria-labelledby", item.attr("id"));
                });

            this._addClass(newSubmenus, "ui-menu", "ui-widget ui-widget-content ui-front");

            menus = submenus.add(this.element);
            items = menus.find(this.options.items);

            // Initialize menu-items containing spaces and/or dashes only as dividers
            items.not(".ui-menu-item").each(function () {
                var item = $(this);
                if (that._isDivider(item)) {
                    that._addClass(item, "ui-menu-divider", "ui-widget-content");
                }
            });

            // Don't refresh list items that are already adapted
            newItems = items.not(".ui-menu-item, .ui-menu-divider");
            newWrappers = newItems.children()
                .not(".ui-menu")
                .uniqueId()
                .attr({
                    tabIndex: -1,
                    role: this._itemRole()
                });
            this._addClass(newItems, "ui-menu-item")
                ._addClass(newWrappers, "ui-menu-item-wrapper");

            // Add aria-disabled attribute to any disabled menu item
            items.filter(".ui-state-disabled").attr("aria-disabled", "true");

            // If the active item has been removed, blur the menu
            if (this.active && !$.contains(this.element[0], this.active[0])) {
                this.blur();
            }
        },

        _itemRole: function () {
            return {
                menu: "menuitem",
                listbox: "option"
            }[this.options.role];
        },

        _setOption: function (key, value) {
            if (key === "icons") {
                var icons = this.element.find(".ui-menu-icon");
                this._removeClass(icons, null, this.options.icons.submenu)
                    ._addClass(icons, null, value.submenu);
            }
            this._super(key, value);
        },

        _setOptionDisabled: function (value) {
            this._super(value);

            this.element.attr("aria-disabled", String(value));
            this._toggleClass(null, "ui-state-disabled", !!value);
        },

        focus: function (event, item) {
            var nested, focused, activeParent;
            this.blur(event, event && event.type === "focus");

            this._scrollIntoView(item);

            this.active = item.first();

            focused = this.active.children(".ui-menu-item-wrapper");
            this._addClass(focused, null, "ui-state-active");

            // Only update aria-activedescendant if there's a role
            // otherwise we assume focus is managed elsewhere
            if (this.options.role) {
                this.element.attr("aria-activedescendant", focused.attr("id"));
            }

            // Highlight active parent menu item, if any
            activeParent = this.active
                .parent()
                .closest(".ui-menu-item")
                .children(".ui-menu-item-wrapper");
            this._addClass(activeParent, null, "ui-state-active");

            if (event && event.type === "keydown") {
                this._close();
            } else {
                this.timer = this._delay(function () {
                    this._close();
                }, this.delay);
            }

            nested = item.children(".ui-menu");
            if (nested.length && event && (/^mouse/.test(event.type))) {
                this._startOpening(nested);
            }
            this.activeMenu = item.parent();

            this._trigger("focus", event, { item: item });
        },

        _scrollIntoView: function (item) {
            var borderTop, paddingTop, offset, scroll, elementHeight, itemHeight;
            if (this._hasScroll()) {
                borderTop = parseFloat($.css(this.activeMenu[0], "borderTopWidth")) || 0;
                paddingTop = parseFloat($.css(this.activeMenu[0], "paddingTop")) || 0;
                offset = item.offset().top - this.activeMenu.offset().top - borderTop - paddingTop;
                scroll = this.activeMenu.scrollTop();
                elementHeight = this.activeMenu.height();
                itemHeight = item.outerHeight();

                if (offset < 0) {
                    this.activeMenu.scrollTop(scroll + offset);
                } else if (offset + itemHeight > elementHeight) {
                    this.activeMenu.scrollTop(scroll + offset - elementHeight + itemHeight);
                }
            }
        },

        blur: function (event, fromFocus) {
            if (!fromFocus) {
                clearTimeout(this.timer);
            }

            if (!this.active) {
                return;
            }

            this._removeClass(this.active.children(".ui-menu-item-wrapper"),
                null, "ui-state-active");

            this._trigger("blur", event, { item: this.active });
            this.active = null;
        },

        _startOpening: function (submenu) {
            clearTimeout(this.timer);

            // Don't open if already open fixes a Firefox bug that caused a .5 pixel
            // shift in the submenu position when mousing over the caret icon
            if (submenu.attr("aria-hidden") !== "true") {
                return;
            }

            this.timer = this._delay(function () {
                this._close();
                this._open(submenu);
            }, this.delay);
        },

        _open: function (submenu) {
            var position = $.extend({
                of: this.active
            }, this.options.position);

            clearTimeout(this.timer);
            this.element.find(".ui-menu").not(submenu.parents(".ui-menu"))
                .hide()
                .attr("aria-hidden", "true");

            submenu
                .show()
                .removeAttr("aria-hidden")
                .attr("aria-expanded", "true")
                .position(position);
        },

        collapseAll: function (event, all) {
            clearTimeout(this.timer);
            this.timer = this._delay(function () {

                // If we were passed an event, look for the submenu that contains the event
                var currentMenu = all ? this.element :
                    $(event && event.target).closest(this.element.find(".ui-menu"));

                // If we found no valid submenu ancestor, use the main menu to close all
                // sub menus anyway
                if (!currentMenu.length) {
                    currentMenu = this.element;
                }

                this._close(currentMenu);

                this.blur(event);

                // Work around active item staying active after menu is blurred
                this._removeClass(currentMenu.find(".ui-state-active"), null, "ui-state-active");

                this.activeMenu = currentMenu;
            }, this.delay);
        },

        // With no arguments, closes the currently active menu - if nothing is active
        // it closes all menus.  If passed an argument, it will search for menus BELOW
        _close: function (startMenu) {
            if (!startMenu) {
                startMenu = this.active ? this.active.parent() : this.element;
            }

            startMenu.find(".ui-menu")
                .hide()
                .attr("aria-hidden", "true")
                .attr("aria-expanded", "false");
        },

        _closeOnDocumentClick: function (event) {
            return !$(event.target).closest(".ui-menu").length;
        },

        _isDivider: function (item) {

            // Match hyphen, em dash, en dash
            return !/[^\-\u2014\u2013\s]/.test(item.text());
        },

        collapse: function (event) {
            var newItem = this.active &&
                this.active.parent().closest(".ui-menu-item", this.element);
            if (newItem && newItem.length) {
                this._close();
                this.focus(event, newItem);
            }
        },

        expand: function (event) {
            var newItem = this.active &&
                this.active
                    .children(".ui-menu ")
                    .find(this.options.items)
                    .first();

            if (newItem && newItem.length) {
                this._open(newItem.parent());

                // Delay so Firefox will not hide activedescendant change in expanding submenu from AT
                this._delay(function () {
                    this.focus(event, newItem);
                });
            }
        },

        next: function (event) {
            this._move("next", "first", event);
        },

        previous: function (event) {
            this._move("prev", "last", event);
        },

        isFirstItem: function () {
            return this.active && !this.active.prevAll(".ui-menu-item").length;
        },

        isLastItem: function () {
            return this.active && !this.active.nextAll(".ui-menu-item").length;
        },

        _move: function (direction, filter, event) {
            var next;
            if (this.active) {
                if (direction === "first" || direction === "last") {
                    next = this.active
                    [direction === "first" ? "prevAll" : "nextAll"](".ui-menu-item")
                        .eq(-1);
                } else {
                    next = this.active
                    [direction + "All"](".ui-menu-item")
                        .eq(0);
                }
            }
            if (!next || !next.length || !this.active) {
                next = this.activeMenu.find(this.options.items)[filter]();
            }

            this.focus(event, next);
        },

        nextPage: function (event) {
            var item, base, height;

            if (!this.active) {
                this.next(event);
                return;
            }
            if (this.isLastItem()) {
                return;
            }
            if (this._hasScroll()) {
                base = this.active.offset().top;
                height = this.element.height();
                this.active.nextAll(".ui-menu-item").each(function () {
                    item = $(this);
                    return item.offset().top - base - height < 0;
                });

                this.focus(event, item);
            } else {
                this.focus(event, this.activeMenu.find(this.options.items)
                [!this.active ? "first" : "last"]());
            }
        },

        previousPage: function (event) {
            var item, base, height;
            if (!this.active) {
                this.next(event);
                return;
            }
            if (this.isFirstItem()) {
                return;
            }
            if (this._hasScroll()) {
                base = this.active.offset().top;
                height = this.element.height();
                this.active.prevAll(".ui-menu-item").each(function () {
                    item = $(this);
                    return item.offset().top - base + height > 0;
                });

                this.focus(event, item);
            } else {
                this.focus(event, this.activeMenu.find(this.options.items).first());
            }
        },

        _hasScroll: function () {
            return this.element.outerHeight() < this.element.prop("scrollHeight");
        },

        select: function (event) {

            // TODO: It should never be possible to not have an active item at this
            // point, but the tests don't trigger mouseenter before click.
            this.active = this.active || $(event.target).closest(".ui-menu-item");
            var ui = { item: this.active };
            if (!this.active.has(".ui-menu").length) {
                this.collapseAll(event, true);
            }
            this._trigger("select", event, ui);
        },

        _filterMenuItems: function (character) {
            var escapedCharacter = character.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&"),
                regex = new RegExp("^" + escapedCharacter, "i");

            return this.activeMenu
                .find(this.options.items)

                // Only match on items, not dividers or other content (#10571)
                .filter(".ui-menu-item")
                .filter(function () {
                    return regex.test(
                        $.trim($(this).children(".ui-menu-item-wrapper").text()));
                });
        }
    });


    /*!
     * jQuery UI Autocomplete 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Autocomplete
    //>>group: Widgets
    //>>description: Lists suggested words as the user is typing.
    //>>docs: http://api.jqueryui.com/autocomplete/
    //>>demos: http://jqueryui.com/autocomplete/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/autocomplete.css
    //>>css.theme: ../../themes/base/theme.css



    $.widget("ui.autocomplete", {
        version: "1.12.1",
        defaultElement: "<input>",
        options: {
            appendTo: null,
            autoFocus: false,
            delay: 300,
            minLength: 1,
            position: {
                my: "left top",
                at: "left bottom",
                collision: "none"
            },
            source: null,

            // Callbacks
            change: null,
            close: null,
            focus: null,
            open: null,
            response: null,
            search: null,
            select: null
        },

        requestIndex: 0,
        pending: 0,

        _create: function () {

            // Some browsers only repeat keydown events, not keypress events,
            // so we use the suppressKeyPress flag to determine if we've already
            // handled the keydown event. #7269
            // Unfortunately the code for & in keypress is the same as the up arrow,
            // so we use the suppressKeyPressRepeat flag to avoid handling keypress
            // events when we know the keydown event was used to modify the
            // search term. #7799
            var suppressKeyPress, suppressKeyPressRepeat, suppressInput,
                nodeName = this.element[0].nodeName.toLowerCase(),
                isTextarea = nodeName === "textarea",
                isInput = nodeName === "input";

            // Textareas are always multi-line
            // Inputs are always single-line, even if inside a contentEditable element
            // IE also treats inputs as contentEditable
            // All other element types are determined by whether or not they're contentEditable
            this.isMultiLine = isTextarea || !isInput && this._isContentEditable(this.element);

            this.valueMethod = this.element[isTextarea || isInput ? "val" : "text"];
            this.isNewMenu = true;

            this._addClass("ui-autocomplete-input");
            this.element.attr("autocomplete", "off");

            this._on(this.element, {
                keydown: function (event) {
                    if (this.element.prop("readOnly")) {
                        suppressKeyPress = true;
                        suppressInput = true;
                        suppressKeyPressRepeat = true;
                        return;
                    }

                    suppressKeyPress = false;
                    suppressInput = false;
                    suppressKeyPressRepeat = false;
                    var keyCode = $.ui.keyCode;
                    switch (event.keyCode) {
                        case keyCode.PAGE_UP:
                            suppressKeyPress = true;
                            this._move("previousPage", event);
                            break;
                        case keyCode.PAGE_DOWN:
                            suppressKeyPress = true;
                            this._move("nextPage", event);
                            break;
                        case keyCode.UP:
                            suppressKeyPress = true;
                            this._keyEvent("previous", event);
                            break;
                        case keyCode.DOWN:
                            suppressKeyPress = true;
                            this._keyEvent("next", event);
                            break;
                        case keyCode.ENTER:

                            // when menu is open and has focus
                            if (this.menu.active) {

                                // #6055 - Opera still allows the keypress to occur
                                // which causes forms to submit
                                suppressKeyPress = true;
                                event.preventDefault();
                                this.menu.select(event);
                            }
                            break;
                        case keyCode.TAB:
                            if (this.menu.active) {
                                this.menu.select(event);
                            }
                            break;
                        case keyCode.ESCAPE:
                            if (this.menu.element.is(":visible")) {
                                if (!this.isMultiLine) {
                                    this._value(this.term);
                                }
                                this.close(event);

                                // Different browsers have different default behavior for escape
                                // Single press can mean undo or clear
                                // Double press in IE means clear the whole form
                                event.preventDefault();
                            }
                            break;
                        default:
                            suppressKeyPressRepeat = true;

                            // search timeout should be triggered before the input value is changed
                            this._searchTimeout(event);
                            break;
                    }
                },
                keypress: function (event) {
                    if (suppressKeyPress) {
                        suppressKeyPress = false;
                        if (!this.isMultiLine || this.menu.element.is(":visible")) {
                            event.preventDefault();
                        }
                        return;
                    }
                    if (suppressKeyPressRepeat) {
                        return;
                    }

                    // Replicate some key handlers to allow them to repeat in Firefox and Opera
                    var keyCode = $.ui.keyCode;
                    switch (event.keyCode) {
                        case keyCode.PAGE_UP:
                            this._move("previousPage", event);
                            break;
                        case keyCode.PAGE_DOWN:
                            this._move("nextPage", event);
                            break;
                        case keyCode.UP:
                            this._keyEvent("previous", event);
                            break;
                        case keyCode.DOWN:
                            this._keyEvent("next", event);
                            break;
                    }
                },
                input: function (event) {
                    if (suppressInput) {
                        suppressInput = false;
                        event.preventDefault();
                        return;
                    }
                    this._searchTimeout(event);
                },
                focus: function () {
                    this.selectedItem = null;
                    this.previous = this._value();
                },
                blur: function (event) {
                    if (this.cancelBlur) {
                        delete this.cancelBlur;
                        return;
                    }

                    clearTimeout(this.searching);
                    this.close(event);
                    this._change(event);
                }
            });

            this._initSource();
            this.menu = $("<ul>")
                .appendTo(this._appendTo())
                .menu({

                    // disable ARIA support, the live region takes care of that
                    role: null
                })
                .hide()
                .menu("instance");

            this._addClass(this.menu.element, "ui-autocomplete", "ui-front");
            this._on(this.menu.element, {
                mousedown: function (event) {

                    // prevent moving focus out of the text field
                    event.preventDefault();

                    // IE doesn't prevent moving focus even with event.preventDefault()
                    // so we set a flag to know when we should ignore the blur event
                    this.cancelBlur = true;
                    this._delay(function () {
                        delete this.cancelBlur;

                        // Support: IE 8 only
                        // Right clicking a menu item or selecting text from the menu items will
                        // result in focus moving out of the input. However, we've already received
                        // and ignored the blur event because of the cancelBlur flag set above. So
                        // we restore focus to ensure that the menu closes properly based on the user's
                        // next actions.
                        if (this.element[0] !== $.ui.safeActiveElement(this.document[0])) {
                            this.element.trigger("focus");
                        }
                    });
                },
                menufocus: function (event, ui) {
                    var label, item;

                    // support: Firefox
                    // Prevent accidental activation of menu items in Firefox (#7024 #9118)
                    if (this.isNewMenu) {
                        this.isNewMenu = false;
                        if (event.originalEvent && /^mouse/.test(event.originalEvent.type)) {
                            this.menu.blur();

                            this.document.one("mousemove", function () {
                                $(event.target).trigger(event.originalEvent);
                            });

                            return;
                        }
                    }

                    item = ui.item.data("ui-autocomplete-item");
                    if (false !== this._trigger("focus", event, { item: item })) {

                        // use value to match what will end up in the input, if it was a key event
                        if (event.originalEvent && /^key/.test(event.originalEvent.type)) {
                            this._value(item.value);
                        }
                    }

                    // Announce the value in the liveRegion
                    label = ui.item.attr("aria-label") || item.value;
                    if (label && $.trim(label).length) {
                        this.liveRegion.children().hide();
                        $("<div>").text(label).appendTo(this.liveRegion);
                    }
                },
                menuselect: function (event, ui) {
                    var item = ui.item.data("ui-autocomplete-item"),
                        previous = this.previous;

                    // Only trigger when focus was lost (click on menu)
                    if (this.element[0] !== $.ui.safeActiveElement(this.document[0])) {
                        this.element.trigger("focus");
                        this.previous = previous;

                        // #6109 - IE triggers two focus events and the second
                        // is asynchronous, so we need to reset the previous
                        // term synchronously and asynchronously :-(
                        this._delay(function () {
                            this.previous = previous;
                            this.selectedItem = item;
                        });
                    }

                    if (false !== this._trigger("select", event, { item: item })) {
                        this._value(item.value);
                    }

                    // reset the term after the select event
                    // this allows custom select handling to work properly
                    this.term = this._value();

                    this.close(event);
                    this.selectedItem = item;
                }
            });

            this.liveRegion = $("<div>", {
                role: "status",
                "aria-live": "assertive",
                "aria-relevant": "additions"
            })
                .appendTo(this.document[0].body);

            this._addClass(this.liveRegion, null, "ui-helper-hidden-accessible");

            // Turning off autocomplete prevents the browser from remembering the
            // value when navigating through history, so we re-enable autocomplete
            // if the page is unloaded before the widget is destroyed. #7790
            this._on(this.window, {
                beforeunload: function () {
                    this.element.removeAttr("autocomplete");
                }
            });
        },

        _destroy: function () {
            clearTimeout(this.searching);
            this.element.removeAttr("autocomplete");
            this.menu.element.remove();
            this.liveRegion.remove();
        },

        _setOption: function (key, value) {
            this._super(key, value);
            if (key === "source") {
                this._initSource();
            }
            if (key === "appendTo") {
                this.menu.element.appendTo(this._appendTo());
            }
            if (key === "disabled" && value && this.xhr) {
                this.xhr.abort();
            }
        },

        _isEventTargetInWidget: function (event) {
            var menuElement = this.menu.element[0];

            return event.target === this.element[0] ||
                event.target === menuElement ||
                $.contains(menuElement, event.target);
        },

        _closeOnClickOutside: function (event) {
            if (!this._isEventTargetInWidget(event)) {
                this.close();
            }
        },

        _appendTo: function () {
            var element = this.options.appendTo;

            if (element) {
                element = element.jquery || element.nodeType ?
                    $(element) :
                    this.document.find(element).eq(0);
            }

            if (!element || !element[0]) {
                element = this.element.closest(".ui-front, dialog");
            }

            if (!element.length) {
                element = this.document[0].body;
            }

            return element;
        },

        _initSource: function () {
            var array, url,
                that = this;
            if ($.isArray(this.options.source)) {
                array = this.options.source;
                this.source = function (request, response) {
                    response($.ui.autocomplete.filter(array, request.term));
                };
            } else if (typeof this.options.source === "string") {
                url = this.options.source;
                this.source = function (request, response) {
                    if (that.xhr) {
                        that.xhr.abort();
                    }
                    that.xhr = $.ajax({
                        url: url,
                        data: request,
                        dataType: "json",
                        success: function (data) {
                            response(data);
                        },
                        error: function () {
                            response([]);
                        }
                    });
                };
            } else {
                this.source = this.options.source;
            }
        },

        _searchTimeout: function (event) {
            clearTimeout(this.searching);
            this.searching = this._delay(function () {

                // Search if the value has changed, or if the user retypes the same value (see #7434)
                var equalValues = this.term === this._value(),
                    menuVisible = this.menu.element.is(":visible"),
                    modifierKey = event.altKey || event.ctrlKey || event.metaKey || event.shiftKey;

                if (!equalValues || (equalValues && !menuVisible && !modifierKey)) {
                    this.selectedItem = null;
                    this.search(null, event);
                }
            }, this.options.delay);
        },

        search: function (value, event) {
            value = value != null ? value : this._value();

            // Always save the actual value, not the one passed as an argument
            this.term = this._value();

            if (value.length < this.options.minLength) {
                return this.close(event);
            }

            if (this._trigger("search", event) === false) {
                return;
            }

            return this._search(value);
        },

        _search: function (value) {
            this.pending++;
            this._addClass("ui-autocomplete-loading");
            this.cancelSearch = false;

            this.source({ term: value }, this._response());
        },

        _response: function () {
            var index = ++this.requestIndex;

            return $.proxy(function (content) {
                if (index === this.requestIndex) {
                    this.__response(content);
                }

                this.pending--;
                if (!this.pending) {
                    this._removeClass("ui-autocomplete-loading");
                }
            }, this);
        },

        __response: function (content) {
            if (content) {
                content = this._normalize(content);
            }
            this._trigger("response", null, { content: content });
            if (!this.options.disabled && content && content.length && !this.cancelSearch) {
                this._suggest(content);
                this._trigger("open");
            } else {

                // use ._close() instead of .close() so we don't cancel future searches
                this._close();
            }
        },

        close: function (event) {
            this.cancelSearch = true;
            this._close(event);
        },

        _close: function (event) {

            // Remove the handler that closes the menu on outside clicks
            this._off(this.document, "mousedown");

            if (this.menu.element.is(":visible")) {
                this.menu.element.hide();
                this.menu.blur();
                this.isNewMenu = true;
                this._trigger("close", event);
            }
        },

        _change: function (event) {
            if (this.previous !== this._value()) {
                this._trigger("change", event, { item: this.selectedItem });
            }
        },

        _normalize: function (items) {

            // assume all items have the right format when the first item is complete
            if (items.length && items[0].label && items[0].value) {
                return items;
            }
            return $.map(items, function (item) {
                if (typeof item === "string") {
                    return {
                        label: item,
                        value: item
                    };
                }
                return $.extend({}, item, {
                    label: item.label || item.value,
                    value: item.value || item.label
                });
            });
        },

        _suggest: function (items) {
            var ul = this.menu.element.empty();
            this._renderMenu(ul, items);
            this.isNewMenu = true;
            this.menu.refresh();

            // Size and position menu
            ul.show();
            this._resizeMenu();
            ul.position($.extend({
                of: this.element
            }, this.options.position));

            if (this.options.autoFocus) {
                this.menu.next();
            }

            // Listen for interactions outside of the widget (#6642)
            this._on(this.document, {
                mousedown: "_closeOnClickOutside"
            });
        },

        _resizeMenu: function () {
            var ul = this.menu.element;
            ul.outerWidth(Math.max(

                // Firefox wraps long text (possibly a rounding bug)
                // so we add 1px to avoid the wrapping (#7513)
                ul.width("").outerWidth() + 1,
                this.element.outerWidth()
            ));
        },

        _renderMenu: function (ul, items) {
            var that = this;
            $.each(items, function (index, item) {
                that._renderItemData(ul, item);
            });
        },

        _renderItemData: function (ul, item) {
            return this._renderItem(ul, item).data("ui-autocomplete-item", item);
        },

        _renderItem: function (ul, item) {
            return $("<li>")
                .append($("<div>").text(item.label))
                .appendTo(ul);
        },

        _move: function (direction, event) {
            if (!this.menu.element.is(":visible")) {
                this.search(null, event);
                return;
            }
            if (this.menu.isFirstItem() && /^previous/.test(direction) ||
                this.menu.isLastItem() && /^next/.test(direction)) {

                if (!this.isMultiLine) {
                    this._value(this.term);
                }

                this.menu.blur();
                return;
            }
            this.menu[direction](event);
        },

        widget: function () {
            return this.menu.element;
        },

        _value: function () {
            return this.valueMethod.apply(this.element, arguments);
        },

        _keyEvent: function (keyEvent, event) {
            if (!this.isMultiLine || this.menu.element.is(":visible")) {
                this._move(keyEvent, event);

                // Prevents moving cursor to beginning/end of the text field in some browsers
                event.preventDefault();
            }
        },

        // Support: Chrome <=50
        // We should be able to just use this.element.prop( "isContentEditable" )
        // but hidden elements always report false in Chrome.
        // https://code.google.com/p/chromium/issues/detail?id=313082
        _isContentEditable: function (element) {
            if (!element.length) {
                return false;
            }

            var editable = element.prop("contentEditable");

            if (editable === "inherit") {
                return this._isContentEditable(element.parent());
            }

            return editable === "true";
        }
    });

    $.extend($.ui.autocomplete, {
        escapeRegex: function (value) {
            return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&");
        },
        filter: function (array, term) {
            var matcher = new RegExp($.ui.autocomplete.escapeRegex(term), "i");
            return $.grep(array, function (value) {
                return matcher.test(value.label || value.value || value);
            });
        }
    });

    // Live region extension, adding a 'messages' option
    // NOTE: This is an experimental API. We are still investigating
    // a full solution for string manipulation and internationalization.
    $.widget("ui.autocomplete", $.ui.autocomplete, {
        options: {
            messages: {
                noResults: "No search results.",
                results: function (amount) {
                    return amount + (amount > 1 ? " results are" : " result is") +
                        " available, use up and down arrow keys to navigate.";
                }
            }
        },

        __response: function (content) {
            var message;
            this._superApply(arguments);
            if (this.options.disabled || this.cancelSearch) {
                return;
            }
            if (content && content.length) {
                message = this.options.messages.results(content.length);
            } else {
                message = this.options.messages.noResults;
            }
            this.liveRegion.children().hide();
            $("<div>").text(message).appendTo(this.liveRegion);
        }
    });

    var widgetsAutocomplete = $.ui.autocomplete;


    /*!
     * jQuery UI Controlgroup 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Controlgroup
    //>>group: Widgets
    //>>description: Visually groups form control widgets
    //>>docs: http://api.jqueryui.com/controlgroup/
    //>>demos: http://jqueryui.com/controlgroup/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/controlgroup.css
    //>>css.theme: ../../themes/base/theme.css


    var controlgroupCornerRegex = /ui-corner-([a-z]){2,6}/g;

    var widgetsControlgroup = $.widget("ui.controlgroup", {
        version: "1.12.1",
        defaultElement: "<div>",
        options: {
            direction: "horizontal",
            disabled: null,
            onlyVisible: true,
            items: {
                "button": "input[type=button], input[type=submit], input[type=reset], button, a",
                "controlgroupLabel": ".ui-controlgroup-label",
                "checkboxradio": "input[type='checkbox'], input[type='radio']",
                "selectmenu": "select",
                "spinner": ".ui-spinner-input"
            }
        },

        _create: function () {
            this._enhance();
        },

        // To support the enhanced option in jQuery Mobile, we isolate DOM manipulation
        _enhance: function () {
            this.element.attr("role", "toolbar");
            this.refresh();
        },

        _destroy: function () {
            this._callChildMethod("destroy");
            this.childWidgets.removeData("ui-controlgroup-data");
            this.element.removeAttr("role");
            if (this.options.items.controlgroupLabel) {
                this.element
                    .find(this.options.items.controlgroupLabel)
                    .find(".ui-controlgroup-label-contents")
                    .contents().unwrap();
            }
        },

        _initWidgets: function () {
            var that = this,
                childWidgets = [];

            // First we iterate over each of the items options
            $.each(this.options.items, function (widget, selector) {
                var labels;
                var options = {};

                // Make sure the widget has a selector set
                if (!selector) {
                    return;
                }

                if (widget === "controlgroupLabel") {
                    labels = that.element.find(selector);
                    labels.each(function () {
                        var element = $(this);

                        if (element.children(".ui-controlgroup-label-contents").length) {
                            return;
                        }
                        element.contents()
                            .wrapAll("<span class='ui-controlgroup-label-contents'></span>");
                    });
                    that._addClass(labels, null, "ui-widget ui-widget-content ui-state-default");
                    childWidgets = childWidgets.concat(labels.get());
                    return;
                }

                // Make sure the widget actually exists
                if (!$.fn[widget]) {
                    return;
                }

                // We assume everything is in the middle to start because we can't determine
                // first / last elements until all enhancments are done.
                if (that["_" + widget + "Options"]) {
                    options = that["_" + widget + "Options"]("middle");
                } else {
                    options = { classes: {} };
                }

                // Find instances of this widget inside controlgroup and init them
                that.element
                    .find(selector)
                    .each(function () {
                        var element = $(this);
                        var instance = element[widget]("instance");

                        // We need to clone the default options for this type of widget to avoid
                        // polluting the variable options which has a wider scope than a single widget.
                        var instanceOptions = $.widget.extend({}, options);

                        // If the button is the child of a spinner ignore it
                        // TODO: Find a more generic solution
                        if (widget === "button" && element.parent(".ui-spinner").length) {
                            return;
                        }

                        // Create the widget if it doesn't exist
                        if (!instance) {
                            instance = element[widget]()[widget]("instance");
                        }
                        if (instance) {
                            instanceOptions.classes =
                                that._resolveClassesValues(instanceOptions.classes, instance);
                        }
                        element[widget](instanceOptions);

                        // Store an instance of the controlgroup to be able to reference
                        // from the outermost element for changing options and refresh
                        var widgetElement = element[widget]("widget");
                        $.data(widgetElement[0], "ui-controlgroup-data",
                            instance ? instance : element[widget]("instance"));

                        childWidgets.push(widgetElement[0]);
                    });
            });

            this.childWidgets = $($.unique(childWidgets));
            this._addClass(this.childWidgets, "ui-controlgroup-item");
        },

        _callChildMethod: function (method) {
            this.childWidgets.each(function () {
                var element = $(this),
                    data = element.data("ui-controlgroup-data");
                if (data && data[method]) {
                    data[method]();
                }
            });
        },

        _updateCornerClass: function (element, position) {
            var remove = "ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all";
            var add = this._buildSimpleOptions(position, "label").classes.label;

            this._removeClass(element, null, remove);
            this._addClass(element, null, add);
        },

        _buildSimpleOptions: function (position, key) {
            var direction = this.options.direction === "vertical";
            var result = {
                classes: {}
            };
            result.classes[key] = {
                "middle": "",
                "first": "ui-corner-" + (direction ? "top" : "left"),
                "last": "ui-corner-" + (direction ? "bottom" : "right"),
                "only": "ui-corner-all"
            }[position];

            return result;
        },

        _spinnerOptions: function (position) {
            var options = this._buildSimpleOptions(position, "ui-spinner");

            options.classes["ui-spinner-up"] = "";
            options.classes["ui-spinner-down"] = "";

            return options;
        },

        _buttonOptions: function (position) {
            return this._buildSimpleOptions(position, "ui-button");
        },

        _checkboxradioOptions: function (position) {
            return this._buildSimpleOptions(position, "ui-checkboxradio-label");
        },

        _selectmenuOptions: function (position) {
            var direction = this.options.direction === "vertical";
            return {
                width: direction ? "auto" : false,
                classes: {
                    middle: {
                        "ui-selectmenu-button-open": "",
                        "ui-selectmenu-button-closed": ""
                    },
                    first: {
                        "ui-selectmenu-button-open": "ui-corner-" + (direction ? "top" : "tl"),
                        "ui-selectmenu-button-closed": "ui-corner-" + (direction ? "top" : "left")
                    },
                    last: {
                        "ui-selectmenu-button-open": direction ? "" : "ui-corner-tr",
                        "ui-selectmenu-button-closed": "ui-corner-" + (direction ? "bottom" : "right")
                    },
                    only: {
                        "ui-selectmenu-button-open": "ui-corner-top",
                        "ui-selectmenu-button-closed": "ui-corner-all"
                    }

                }[position]
            };
        },

        _resolveClassesValues: function (classes, instance) {
            var result = {};
            $.each(classes, function (key) {
                var current = instance.options.classes[key] || "";
                current = $.trim(current.replace(controlgroupCornerRegex, ""));
                result[key] = (current + " " + classes[key]).replace(/\s+/g, " ");
            });
            return result;
        },

        _setOption: function (key, value) {
            if (key === "direction") {
                this._removeClass("ui-controlgroup-" + this.options.direction);
            }

            this._super(key, value);
            if (key === "disabled") {
                this._callChildMethod(value ? "disable" : "enable");
                return;
            }

            this.refresh();
        },

        refresh: function () {
            var children,
                that = this;

            this._addClass("ui-controlgroup ui-controlgroup-" + this.options.direction);

            if (this.options.direction === "horizontal") {
                this._addClass(null, "ui-helper-clearfix");
            }
            this._initWidgets();

            children = this.childWidgets;

            // We filter here because we need to track all childWidgets not just the visible ones
            if (this.options.onlyVisible) {
                children = children.filter(":visible");
            }

            if (children.length) {

                // We do this last because we need to make sure all enhancment is done
                // before determining first and last
                $.each(["first", "last"], function (index, value) {
                    var instance = children[value]().data("ui-controlgroup-data");

                    if (instance && that["_" + instance.widgetName + "Options"]) {
                        var options = that["_" + instance.widgetName + "Options"](
                            children.length === 1 ? "only" : value
                        );
                        options.classes = that._resolveClassesValues(options.classes, instance);
                        instance.element[instance.widgetName](options);
                    } else {
                        that._updateCornerClass(children[value](), value);
                    }
                });

                // Finally call the refresh method on each of the child widgets.
                this._callChildMethod("refresh");
            }
        }
    });

    /*!
     * jQuery UI Checkboxradio 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Checkboxradio
    //>>group: Widgets
    //>>description: Enhances a form with multiple themeable checkboxes or radio buttons.
    //>>docs: http://api.jqueryui.com/checkboxradio/
    //>>demos: http://jqueryui.com/checkboxradio/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/button.css
    //>>css.structure: ../../themes/base/checkboxradio.css
    //>>css.theme: ../../themes/base/theme.css



    $.widget("ui.checkboxradio", [$.ui.formResetMixin, {
        version: "1.12.1",
        options: {
            disabled: null,
            label: null,
            icon: true,
            classes: {
                "ui-checkboxradio-label": "ui-corner-all",
                "ui-checkboxradio-icon": "ui-corner-all"
            }
        },

        _getCreateOptions: function () {
            var disabled, labels;
            var that = this;
            var options = this._super() || {};

            // We read the type here, because it makes more sense to throw a element type error first,
            // rather then the error for lack of a label. Often if its the wrong type, it
            // won't have a label (e.g. calling on a div, btn, etc)
            this._readType();

            labels = this.element.labels();

            // If there are multiple labels, use the last one
            this.label = $(labels[labels.length - 1]);
            if (!this.label.length) {
                $.error("No label found for checkboxradio widget");
            }

            this.originalLabel = "";

            // We need to get the label text but this may also need to make sure it does not contain the
            // input itself.
            this.label.contents().not(this.element[0]).each(function () {

                // The label contents could be text, html, or a mix. We concat each element to get a
                // string representation of the label, without the input as part of it.
                that.originalLabel += this.nodeType === 3 ? $(this).text() : this.outerHTML;
            });

            // Set the label option if we found label text
            if (this.originalLabel) {
                options.label = this.originalLabel;
            }

            disabled = this.element[0].disabled;
            if (disabled != null) {
                options.disabled = disabled;
            }
            return options;
        },

        _create: function () {
            var checked = this.element[0].checked;

            this._bindFormResetHandler();

            if (this.options.disabled == null) {
                this.options.disabled = this.element[0].disabled;
            }

            this._setOption("disabled", this.options.disabled);
            this._addClass("ui-checkboxradio", "ui-helper-hidden-accessible");
            this._addClass(this.label, "ui-checkboxradio-label", "ui-button ui-widget");

            if (this.type === "radio") {
                this._addClass(this.label, "ui-checkboxradio-radio-label");
            }

            if (this.options.label && this.options.label !== this.originalLabel) {
                this._updateLabel();
            } else if (this.originalLabel) {
                this.options.label = this.originalLabel;
            }

            this._enhance();

            if (checked) {
                this._addClass(this.label, "ui-checkboxradio-checked", "ui-state-active");
                if (this.icon) {
                    this._addClass(this.icon, null, "ui-state-hover");
                }
            }

            this._on({
                change: "_toggleClasses",
                focus: function () {
                    this._addClass(this.label, null, "ui-state-focus ui-visual-focus");
                },
                blur: function () {
                    this._removeClass(this.label, null, "ui-state-focus ui-visual-focus");
                }
            });
        },

        _readType: function () {
            var nodeName = this.element[0].nodeName.toLowerCase();
            this.type = this.element[0].type;
            if (nodeName !== "input" || !/radio|checkbox/.test(this.type)) {
                $.error("Can't create checkboxradio on element.nodeName=" + nodeName +
                    " and element.type=" + this.type);
            }
        },

        // Support jQuery Mobile enhanced option
        _enhance: function () {
            this._updateIcon(this.element[0].checked);
        },

        widget: function () {
            return this.label;
        },

        _getRadioGroup: function () {
            var group;
            var name = this.element[0].name;
            var nameSelector = "input[name='" + $.ui.escapeSelector(name) + "']";

            if (!name) {
                return $([]);
            }

            if (this.form.length) {
                group = $(this.form[0].elements).filter(nameSelector);
            } else {

                // Not inside a form, check all inputs that also are not inside a form
                group = $(nameSelector).filter(function () {
                    return $(this).form().length === 0;
                });
            }

            return group.not(this.element);
        },

        _toggleClasses: function () {
            var checked = this.element[0].checked;
            this._toggleClass(this.label, "ui-checkboxradio-checked", "ui-state-active", checked);

            if (this.options.icon && this.type === "checkbox") {
                this._toggleClass(this.icon, null, "ui-icon-check ui-state-checked", checked)
                    ._toggleClass(this.icon, null, "ui-icon-blank", !checked);
            }

            if (this.type === "radio") {
                this._getRadioGroup()
                    .each(function () {
                        var instance = $(this).checkboxradio("instance");

                        if (instance) {
                            instance._removeClass(instance.label,
                                "ui-checkboxradio-checked", "ui-state-active");
                        }
                    });
            }
        },

        _destroy: function () {
            this._unbindFormResetHandler();

            if (this.icon) {
                this.icon.remove();
                this.iconSpace.remove();
            }
        },

        _setOption: function (key, value) {

            // We don't allow the value to be set to nothing
            if (key === "label" && !value) {
                return;
            }

            this._super(key, value);

            if (key === "disabled") {
                this._toggleClass(this.label, null, "ui-state-disabled", value);
                this.element[0].disabled = value;

                // Don't refresh when setting disabled
                return;
            }
            this.refresh();
        },

        _updateIcon: function (checked) {
            var toAdd = "ui-icon ui-icon-background ";

            if (this.options.icon) {
                if (!this.icon) {
                    this.icon = $("<span>");
                    this.iconSpace = $("<span> </span>");
                    this._addClass(this.iconSpace, "ui-checkboxradio-icon-space");
                }

                if (this.type === "checkbox") {
                    toAdd += checked ? "ui-icon-check ui-state-checked" : "ui-icon-blank";
                    this._removeClass(this.icon, null, checked ? "ui-icon-blank" : "ui-icon-check");
                } else {
                    toAdd += "ui-icon-blank";
                }
                this._addClass(this.icon, "ui-checkboxradio-icon", toAdd);
                if (!checked) {
                    this._removeClass(this.icon, null, "ui-icon-check ui-state-checked");
                }
                this.icon.prependTo(this.label).after(this.iconSpace);
            } else if (this.icon !== undefined) {
                this.icon.remove();
                this.iconSpace.remove();
                delete this.icon;
            }
        },

        _updateLabel: function () {

            // Remove the contents of the label ( minus the icon, icon space, and input )
            var contents = this.label.contents().not(this.element[0]);
            if (this.icon) {
                contents = contents.not(this.icon[0]);
            }
            if (this.iconSpace) {
                contents = contents.not(this.iconSpace[0]);
            }
            contents.remove();

            this.label.append(this.options.label);
        },

        refresh: function () {
            var checked = this.element[0].checked,
                isDisabled = this.element[0].disabled;

            this._updateIcon(checked);
            this._toggleClass(this.label, "ui-checkboxradio-checked", "ui-state-active", checked);
            if (this.options.label !== null) {
                this._updateLabel();
            }

            if (isDisabled !== this.options.disabled) {
                this._setOptions({ "disabled": isDisabled });
            }
        }

    }]);

    var widgetsCheckboxradio = $.ui.checkboxradio;


    /*!
     * jQuery UI Button 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Button
    //>>group: Widgets
    //>>description: Enhances a form with themeable buttons.
    //>>docs: http://api.jqueryui.com/button/
    //>>demos: http://jqueryui.com/button/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/button.css
    //>>css.theme: ../../themes/base/theme.css



    $.widget("ui.button", {
        version: "1.12.1",
        defaultElement: "<button>",
        options: {
            classes: {
                "ui-button": "ui-corner-all"
            },
            disabled: null,
            icon: null,
            iconPosition: "beginning",
            label: null,
            showLabel: true
        },

        _getCreateOptions: function () {
            var disabled,

                // This is to support cases like in jQuery Mobile where the base widget does have
                // an implementation of _getCreateOptions
                options = this._super() || {};

            this.isInput = this.element.is("input");

            disabled = this.element[0].disabled;
            if (disabled != null) {
                options.disabled = disabled;
            }

            this.originalLabel = this.isInput ? this.element.val() : this.element.html();
            if (this.originalLabel) {
                options.label = this.originalLabel;
            }

            return options;
        },

        _create: function () {
            if (!this.option.showLabel & !this.options.icon) {
                this.options.showLabel = true;
            }

            // We have to check the option again here even though we did in _getCreateOptions,
            // because null may have been passed on init which would override what was set in
            // _getCreateOptions
            if (this.options.disabled == null) {
                this.options.disabled = this.element[0].disabled || false;
            }

            this.hasTitle = !!this.element.attr("title");

            // Check to see if the label needs to be set or if its already correct
            if (this.options.label && this.options.label !== this.originalLabel) {
                if (this.isInput) {
                    this.element.val(this.options.label);
                } else {
                    this.element.html(this.options.label);
                }
            }
            this._addClass("ui-button", "ui-widget");
            this._setOption("disabled", this.options.disabled);
            this._enhance();

            if (this.element.is("a")) {
                this._on({
                    "keyup": function (event) {
                        if (event.keyCode === $.ui.keyCode.SPACE) {
                            event.preventDefault();

                            // Support: PhantomJS <= 1.9, IE 8 Only
                            // If a native click is available use it so we actually cause navigation
                            // otherwise just trigger a click event
                            if (this.element[0].click) {
                                this.element[0].click();
                            } else {
                                this.element.trigger("click");
                            }
                        }
                    }
                });
            }
        },

        _enhance: function () {
            if (!this.element.is("button")) {
                this.element.attr("role", "button");
            }

            if (this.options.icon) {
                this._updateIcon("icon", this.options.icon);
                this._updateTooltip();
            }
        },

        _updateTooltip: function () {
            this.title = this.element.attr("title");

            if (!this.options.showLabel && !this.title) {
                this.element.attr("title", this.options.label);
            }
        },

        _updateIcon: function (option, value) {
            var icon = option !== "iconPosition",
                position = icon ? this.options.iconPosition : value,
                displayBlock = position === "top" || position === "bottom";

            // Create icon
            if (!this.icon) {
                this.icon = $("<span>");

                this._addClass(this.icon, "ui-button-icon", "ui-icon");

                if (!this.options.showLabel) {
                    this._addClass("ui-button-icon-only");
                }
            } else if (icon) {

                // If we are updating the icon remove the old icon class
                this._removeClass(this.icon, null, this.options.icon);
            }

            // If we are updating the icon add the new icon class
            if (icon) {
                this._addClass(this.icon, null, value);
            }

            this._attachIcon(position);

            // If the icon is on top or bottom we need to add the ui-widget-icon-block class and remove
            // the iconSpace if there is one.
            if (displayBlock) {
                this._addClass(this.icon, null, "ui-widget-icon-block");
                if (this.iconSpace) {
                    this.iconSpace.remove();
                }
            } else {

                // Position is beginning or end so remove the ui-widget-icon-block class and add the
                // space if it does not exist
                if (!this.iconSpace) {
                    this.iconSpace = $("<span> </span>");
                    this._addClass(this.iconSpace, "ui-button-icon-space");
                }
                this._removeClass(this.icon, null, "ui-wiget-icon-block");
                this._attachIconSpace(position);
            }
        },

        _destroy: function () {
            this.element.removeAttr("role");

            if (this.icon) {
                this.icon.remove();
            }
            if (this.iconSpace) {
                this.iconSpace.remove();
            }
            if (!this.hasTitle) {
                this.element.removeAttr("title");
            }
        },

        _attachIconSpace: function (iconPosition) {
            this.icon[/^(?:end|bottom)/.test(iconPosition) ? "before" : "after"](this.iconSpace);
        },

        _attachIcon: function (iconPosition) {
            this.element[/^(?:end|bottom)/.test(iconPosition) ? "append" : "prepend"](this.icon);
        },

        _setOptions: function (options) {
            var newShowLabel = options.showLabel === undefined ?
                this.options.showLabel :
                options.showLabel,
                newIcon = options.icon === undefined ? this.options.icon : options.icon;

            if (!newShowLabel && !newIcon) {
                options.showLabel = true;
            }
            this._super(options);
        },

        _setOption: function (key, value) {
            if (key === "icon") {
                if (value) {
                    this._updateIcon(key, value);
                } else if (this.icon) {
                    this.icon.remove();
                    if (this.iconSpace) {
                        this.iconSpace.remove();
                    }
                }
            }

            if (key === "iconPosition") {
                this._updateIcon(key, value);
            }

            // Make sure we can't end up with a button that has neither text nor icon
            if (key === "showLabel") {
                this._toggleClass("ui-button-icon-only", null, !value);
                this._updateTooltip();
            }

            if (key === "label") {
                if (this.isInput) {
                    this.element.val(value);
                } else {

                    // If there is an icon, append it, else nothing then append the value
                    // this avoids removal of the icon when setting label text
                    this.element.html(value);
                    if (this.icon) {
                        this._attachIcon(this.options.iconPosition);
                        this._attachIconSpace(this.options.iconPosition);
                    }
                }
            }

            this._super(key, value);

            if (key === "disabled") {
                this._toggleClass(null, "ui-state-disabled", value);
                this.element[0].disabled = value;
                if (value) {
                    this.element.blur();
                }
            }
        },

        refresh: function () {

            // Make sure to only check disabled if its an element that supports this otherwise
            // check for the disabled class to determine state
            var isDisabled = this.element.is("input, button") ?
                this.element[0].disabled : this.element.hasClass("ui-button-disabled");

            if (isDisabled !== this.options.disabled) {
                this._setOptions({ disabled: isDisabled });
            }

            this._updateTooltip();
        }
    });

    // DEPRECATED
    if ($.uiBackCompat !== false) {

        // Text and Icons options
        $.widget("ui.button", $.ui.button, {
            options: {
                text: true,
                icons: {
                    primary: null,
                    secondary: null
                }
            },

            _create: function () {
                if (this.options.showLabel && !this.options.text) {
                    this.options.showLabel = this.options.text;
                }
                if (!this.options.showLabel && this.options.text) {
                    this.options.text = this.options.showLabel;
                }
                if (!this.options.icon && (this.options.icons.primary ||
                    this.options.icons.secondary)) {
                    if (this.options.icons.primary) {
                        this.options.icon = this.options.icons.primary;
                    } else {
                        this.options.icon = this.options.icons.secondary;
                        this.options.iconPosition = "end";
                    }
                } else if (this.options.icon) {
                    this.options.icons.primary = this.options.icon;
                }
                this._super();
            },

            _setOption: function (key, value) {
                if (key === "text") {
                    this._super("showLabel", value);
                    return;
                }
                if (key === "showLabel") {
                    this.options.text = value;
                }
                if (key === "icon") {
                    this.options.icons.primary = value;
                }
                if (key === "icons") {
                    if (value.primary) {
                        this._super("icon", value.primary);
                        this._super("iconPosition", "beginning");
                    } else if (value.secondary) {
                        this._super("icon", value.secondary);
                        this._super("iconPosition", "end");
                    }
                }
                this._superApply(arguments);
            }
        });

        $.fn.button = (function (orig) {
            return function () {
                if (!this.length || (this.length && this[0].tagName !== "INPUT") ||
                    (this.length && this[0].tagName === "INPUT" && (
                        this.attr("type") !== "checkbox" && this.attr("type") !== "radio"
                    ))) {
                    return orig.apply(this, arguments);
                }
                if (!$.ui.checkboxradio) {
                    $.error("Checkboxradio widget missing");
                }
                if (arguments.length === 0) {
                    return this.checkboxradio({
                        "icon": false
                    });
                }
                return this.checkboxradio.apply(this, arguments);
            };
        })($.fn.button);

        $.fn.buttonset = function () {
            if (!$.ui.controlgroup) {
                $.error("Controlgroup widget missing");
            }
            if (arguments[0] === "option" && arguments[1] === "items" && arguments[2]) {
                return this.controlgroup.apply(this,
                    [arguments[0], "items.button", arguments[2]]);
            }
            if (arguments[0] === "option" && arguments[1] === "items") {
                return this.controlgroup.apply(this, [arguments[0], "items.button"]);
            }
            if (typeof arguments[0] === "object" && arguments[0].items) {
                arguments[0].items = {
                    button: arguments[0].items
                };
            }
            return this.controlgroup.apply(this, arguments);
        };
    }

    var widgetsButton = $.ui.button;


    // jscs:disable maximumLineLength
    /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
    /*!
     * jQuery UI Datepicker 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Datepicker
    //>>group: Widgets
    //>>description: Displays a calendar from an input or inline for selecting dates.
    //>>docs: http://api.jqueryui.com/datepicker/
    //>>demos: http://jqueryui.com/datepicker/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/datepicker.css
    //>>css.theme: ../../themes/base/theme.css



    $.extend($.ui, { datepicker: { version: "1.12.1" } });

    var datepicker_instActive;

    function datepicker_getZindex(elem) {
        var position, value;
        while (elem.length && elem[0] !== document) {

            // Ignore z-index if position is set to a value where z-index is ignored by the browser
            // This makes behavior of this function consistent across browsers
            // WebKit always returns auto if the element is positioned
            position = elem.css("position");
            if (position === "absolute" || position === "relative" || position === "fixed") {

                // IE returns 0 when zIndex is not specified
                // other browsers return a string
                // we ignore the case of nested elements with an explicit value of 0
                // <div style="z-index: -10;"><div style="z-index: 0;"></div></div>
                value = parseInt(elem.css("zIndex"), 10);
                if (!isNaN(value) && value !== 0) {
                    return value;
                }
            }
            elem = elem.parent();
        }

        return 0;
    }
    /* Date picker manager.
       Use the singleton instance of this class, $.datepicker, to interact with the date picker.
       Settings for (groups of) date pickers are maintained in an instance object,
       allowing multiple different settings on the same page. */

    function Datepicker() {
        this._curInst = null; // The current instance in use
        this._keyEvent = false; // If the last event was a key event
        this._disabledInputs = []; // List of date picker inputs that have been disabled
        this._datepickerShowing = false; // True if the popup picker is showing , false if not
        this._inDialog = false; // True if showing within a "dialog", false if not
        this._mainDivId = "ui-datepicker-div"; // The ID of the main datepicker division
        this._inlineClass = "ui-datepicker-inline"; // The name of the inline marker class
        this._appendClass = "ui-datepicker-append"; // The name of the append marker class
        this._triggerClass = "ui-datepicker-trigger"; // The name of the trigger marker class
        this._dialogClass = "ui-datepicker-dialog"; // The name of the dialog marker class
        this._disableClass = "ui-datepicker-disabled"; // The name of the disabled covering marker class
        this._unselectableClass = "ui-datepicker-unselectable"; // The name of the unselectable cell marker class
        this._currentClass = "ui-datepicker-current-day"; // The name of the current day marker class
        this._dayOverClass = "ui-datepicker-days-cell-over"; // The name of the day hover marker class
        this.regional = []; // Available regional settings, indexed by language code
        this.regional[""] = { // Default regional settings
            closeText: _options.closeText, // Display text for close link
            prevText: _options.tabelaPaginatePrevious, // Display text for previous month link
            nextText: _options.tabelaPaginateNext, // Display text for next month link
            currentText: _options.currentText, // Display text for current month link
            monthNames: _options.monthNames,
            monthNamesShort: _options.monthNamesShort,
            dayNames: _options.dayNames,
            dayNamesShort: _options.dayNamesShort,
            dayNamesMin: _options.dayNamesMin,
            weekHeader: "Wk", // Column header for week of the year
            dateFormat: _options.dateFormat,
            firstDay: 0, // The first day of the week, Sun = 0, Mon = 1, ...
            isRTL: false, // True if right-to-left language, false if left-to-right
            showMonthAfterYear: false, // True if the year select precedes month, false for month then year
            yearSuffix: "" // Additional text to append to the year in the month headers
        };
        this._defaults = { // Global defaults for all the date picker instances
            showOn: "focus", // "focus" for popup on focus,
            // "button" for trigger button, or "both" for either
            showAnim: "fadeIn", // Name of jQuery animation for popup
            showOptions: {}, // Options for enhanced animations
            defaultDate: null, // Used when field is blank: actual date,
            // +/-number for offset from today, null for today
            appendText: "", // Display text following the input box, e.g. showing the format
            buttonText: "...", // Text for trigger button
            buttonImage: "", // URL for trigger button image
            buttonImageOnly: false, // True if the image appears alone, false if it appears on a button
            hideIfNoPrevNext: false, // True to hide next/previous month links
            // if not applicable, false to just disable them
            navigationAsDateFormat: false, // True if date formatting applied to prev/today/next links
            gotoCurrent: false, // True if today link goes back to current selection instead
            changeMonth: false, // True if month can be selected directly, false if only prev/next
            changeYear: false, // True if year can be selected directly, false if only prev/next
            yearRange: "c-10:c+10", // Range of years to display in drop-down,
            // either relative to today's year (-nn:+nn), relative to currently displayed year
            // (c-nn:c+nn), absolute (nnnn:nnnn), or a combination of the above (nnnn:-n)
            showOtherMonths: false, // True to show dates in other months, false to leave blank
            selectOtherMonths: false, // True to allow selection of dates in other months, false for unselectable
            showWeek: false, // True to show week of the year, false to not show it
            calculateWeek: this.iso8601Week, // How to calculate the week of the year,
            // takes a Date and returns the number of the week for it
            shortYearCutoff: "+10", // Short year values < this are in the current century,
            // > this are in the previous century,
            // string value starting with "+" for current year + value
            minDate: null, // The earliest selectable date, or null for no limit
            maxDate: null, // The latest selectable date, or null for no limit
            duration: "fast", // Duration of display/closure
            beforeShowDay: null, // Function that takes a date and returns an array with
            // [0] = true if selectable, false if not, [1] = custom CSS class name(s) or "",
            // [2] = cell title (optional), e.g. $.datepicker.noWeekends
            beforeShow: null, // Function that takes an input field and
            // returns a set of custom settings for the date picker
            onSelect: null, // Define a callback function when a date is selected
            onChangeMonthYear: null, // Define a callback function when the month or year is changed
            onClose: null, // Define a callback function when the datepicker is closed
            numberOfMonths: 1, // Number of months to show at a time
            showCurrentAtPos: 0, // The position in multipe months at which to show the current month (starting at 0)
            stepMonths: 1, // Number of months to step back/forward
            stepBigMonths: 12, // Number of months to step back/forward for the big links
            altField: "", // Selector for an alternate field to store selected dates into
            altFormat: "", // The date format to use for the alternate field
            constrainInput: true, // The input is constrained by the current date format
            showButtonPanel: false, // True to show button panel, false to not show it
            autoSize: false, // True to size the input for the date format, false to leave as is
            disabled: false // The initial disabled state
        };
        $.extend(this._defaults, this.regional[""]);
        this.regional.en = $.extend(true, {}, this.regional[""]);
        this.regional["en-US"] = $.extend(true, {}, this.regional.en);
        this.dpDiv = datepicker_bindHover($("<div id='" + this._mainDivId + "' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"));
    }

    $.extend(Datepicker.prototype, {
        /* Class name added to elements to indicate already configured with a date picker. */
        markerClassName: "hasDatepicker",

        //Keep track of the maximum number of rows displayed (see #7043)
        maxRows: 4,

        // TODO rename to "widget" when switching to widget factory
        _widgetDatepicker: function () {
            return this.dpDiv;
        },

        /* Override the default settings for all instances of the date picker.
         * @param  settings  object - the new settings to use as defaults (anonymous object)
         * @return the manager object
         */
        setDefaults: function (settings) {
            datepicker_extendRemove(this._defaults, settings || {});
            return this;
        },

        /* Attach the date picker to a jQuery selection.
         * @param  target	element - the target input field or division or span
         * @param  settings  object - the new settings to use for this date picker instance (anonymous)
         */
        _attachDatepicker: function (target, settings) {
            var nodeName, inline, inst;
            nodeName = target.nodeName.toLowerCase();
            inline = (nodeName === "div" || nodeName === "span");
            if (!target.id) {
                this.uuid += 1;
                target.id = "dp" + this.uuid;
            }
            inst = this._newInst($(target), inline);
            inst.settings = $.extend({}, settings || {});
            if (nodeName === "input") {
                this._connectDatepicker(target, inst);
            } else if (inline) {
                this._inlineDatepicker(target, inst);
            }
        },

        /* Create a new instance object. */
        _newInst: function (target, inline) {
            var id = target[0].id.replace(/([^A-Za-z0-9_\-])/g, "\\\\$1"); // escape jQuery meta chars
            return {
                id: id, input: target, // associated target
                selectedDay: 0, selectedMonth: 0, selectedYear: 0, // current selection
                drawMonth: 0, drawYear: 0, // month being drawn
                inline: inline, // is datepicker inline or not
                dpDiv: (!inline ? this.dpDiv : // presentation div
                    datepicker_bindHover($("<div class='" + this._inlineClass + " ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")))
            };
        },

        /* Attach the date picker to an input field. */
        _connectDatepicker: function (target, inst) {
            var input = $(target);
            inst.append = $([]);
            inst.trigger = $([]);
            if (input.hasClass(this.markerClassName)) {
                return;
            }
            this._attachments(input, inst);
            input.addClass(this.markerClassName).on("keydown", this._doKeyDown).
                on("keypress", this._doKeyPress).on("keyup", this._doKeyUp);
            this._autoSize(inst);
            $.data(target, "datepicker", inst);

            //If disabled option is true, disable the datepicker once it has been attached to the input (see ticket #5665)
            if (inst.settings.disabled) {
                this._disableDatepicker(target);
            }
        },

        /* Make attachments based on settings. */
        _attachments: function (input, inst) {
            var showOn, buttonText, buttonImage,
                appendText = this._get(inst, "appendText"),
                isRTL = this._get(inst, "isRTL");

            if (inst.append) {
                inst.append.remove();
            }
            if (appendText) {
                inst.append = $("<span class='" + this._appendClass + "'>" + appendText + "</span>");
                input[isRTL ? "before" : "after"](inst.append);
            }

            input.off("focus", this._showDatepicker);

            if (inst.trigger) {
                inst.trigger.remove();
            }

            showOn = this._get(inst, "showOn");
            if (showOn === "focus" || showOn === "both") { // pop-up date picker when in the marked field
                input.on("focus", this._showDatepicker);
            }
            if (showOn === "button" || showOn === "both") { // pop-up date picker when button clicked
                buttonText = this._get(inst, "buttonText");
                buttonImage = this._get(inst, "buttonImage");
                inst.trigger = $(this._get(inst, "buttonImageOnly") ?
                    $("<img/>").addClass(this._triggerClass).
                        attr({ src: buttonImage, alt: buttonText, title: buttonText }) :
                    $("<button type='button'></button>").addClass(this._triggerClass).
                        html(!buttonImage ? buttonText : $("<img/>").attr(
                            { src: buttonImage, alt: buttonText, title: buttonText })));
                input[isRTL ? "before" : "after"](inst.trigger);
                inst.trigger.on("click", function () {
                    if ($.datepicker._datepickerShowing && $.datepicker._lastInput === input[0]) {
                        $.datepicker._hideDatepicker();
                    } else if ($.datepicker._datepickerShowing && $.datepicker._lastInput !== input[0]) {
                        $.datepicker._hideDatepicker();
                        $.datepicker._showDatepicker(input[0]);
                    } else {
                        $.datepicker._showDatepicker(input[0]);
                    }
                    return false;
                });
            }
        },

        /* Apply the maximum length for the date format. */
        _autoSize: function (inst) {
            if (this._get(inst, "autoSize") && !inst.inline) {
                var findMax, max, maxI, i,
                    date = new Date(2009, 12 - 1, 20), // Ensure double digits
                    dateFormat = this._get(inst, "dateFormat");

                if (dateFormat.match(/[DM]/)) {
                    findMax = function (names) {
                        max = 0;
                        maxI = 0;
                        for (i = 0; i < names.length; i++) {
                            if (names[i].length > max) {
                                max = names[i].length;
                                maxI = i;
                            }
                        }
                        return maxI;
                    };
                    date.setMonth(findMax(this._get(inst, (dateFormat.match(/MM/) ?
                        "monthNames" : "monthNamesShort"))));
                    date.setDate(findMax(this._get(inst, (dateFormat.match(/DD/) ?
                        "dayNames" : "dayNamesShort"))) + 20 - date.getDay());
                }
                inst.input.attr("size", this._formatDate(inst, date).length);
            }
        },

        /* Attach an inline date picker to a div. */
        _inlineDatepicker: function (target, inst) {
            var divSpan = $(target);
            if (divSpan.hasClass(this.markerClassName)) {
                return;
            }
            divSpan.addClass(this.markerClassName).append(inst.dpDiv);
            $.data(target, "datepicker", inst);
            this._setDate(inst, this._getDefaultDate(inst), true);
            this._updateDatepicker(inst);
            this._updateAlternate(inst);

            //If disabled option is true, disable the datepicker before showing it (see ticket #5665)
            if (inst.settings.disabled) {
                this._disableDatepicker(target);
            }

            // Set display:block in place of inst.dpDiv.show() which won't work on disconnected elements
            // http://bugs.jqueryui.com/ticket/7552 - A Datepicker created on a detached div has zero height
            inst.dpDiv.css("display", "block");
        },

        /* Pop-up the date picker in a "dialog" box.
         * @param  input element - ignored
         * @param  date	string or Date - the initial date to display
         * @param  onSelect  function - the function to call when a date is selected
         * @param  settings  object - update the dialog date picker instance's settings (anonymous object)
         * @param  pos int[2] - coordinates for the dialog's position within the screen or
         *					event - with x/y coordinates or
         *					leave empty for default (screen centre)
         * @return the manager object
         */
        _dialogDatepicker: function (input, date, onSelect, settings, pos) {
            var id, browserWidth, browserHeight, scrollX, scrollY,
                inst = this._dialogInst; // internal instance

            if (!inst) {
                this.uuid += 1;
                id = "dp" + this.uuid;
                this._dialogInput = $("<input type='text' id='" + id +
                    "' style='position: absolute; top: -100px; width: 0px;'/>");
                this._dialogInput.on("keydown", this._doKeyDown);
                $("body").append(this._dialogInput);
                inst = this._dialogInst = this._newInst(this._dialogInput, false);
                inst.settings = {};
                $.data(this._dialogInput[0], "datepicker", inst);
            }
            datepicker_extendRemove(inst.settings, settings || {});
            date = (date && date.constructor === Date ? this._formatDate(inst, date) : date);
            this._dialogInput.val(date);

            this._pos = (pos ? (pos.length ? pos : [pos.pageX, pos.pageY]) : null);
            if (!this._pos) {
                browserWidth = document.documentElement.clientWidth;
                browserHeight = document.documentElement.clientHeight;
                scrollX = document.documentElement.scrollLeft || document.body.scrollLeft;
                scrollY = document.documentElement.scrollTop || document.body.scrollTop;
                this._pos = // should use actual width/height below
                    [(browserWidth / 2) - 100 + scrollX, (browserHeight / 2) - 150 + scrollY];
            }

            // Move input on screen for focus, but hidden behind dialog
            this._dialogInput.css("left", (this._pos[0] + 20) + "px").css("top", this._pos[1] + "px");
            inst.settings.onSelect = onSelect;
            this._inDialog = true;
            this.dpDiv.addClass(this._dialogClass);
            this._showDatepicker(this._dialogInput[0]);
            if ($.blockUI) {
                $.blockUI(this.dpDiv);
            }
            $.data(this._dialogInput[0], "datepicker", inst);
            return this;
        },

        /* Detach a datepicker from its control.
         * @param  target	element - the target input field or division or span
         */
        _destroyDatepicker: function (target) {
            var nodeName,
                $target = $(target),
                inst = $.data(target, "datepicker");

            if (!$target.hasClass(this.markerClassName)) {
                return;
            }

            nodeName = target.nodeName.toLowerCase();
            $.removeData(target, "datepicker");
            if (nodeName === "input") {
                inst.append.remove();
                inst.trigger.remove();
                $target.removeClass(this.markerClassName).
                    off("focus", this._showDatepicker).
                    off("keydown", this._doKeyDown).
                    off("keypress", this._doKeyPress).
                    off("keyup", this._doKeyUp);
            } else if (nodeName === "div" || nodeName === "span") {
                $target.removeClass(this.markerClassName).empty();
            }

            if (datepicker_instActive === inst) {
                datepicker_instActive = null;
            }
        },

        /* Enable the date picker to a jQuery selection.
         * @param  target	element - the target input field or division or span
         */
        _enableDatepicker: function (target) {
            var nodeName, inline,
                $target = $(target),
                inst = $.data(target, "datepicker");

            if (!$target.hasClass(this.markerClassName)) {
                return;
            }

            nodeName = target.nodeName.toLowerCase();
            if (nodeName === "input") {
                target.disabled = false;
                inst.trigger.filter("button").
                    each(function () { this.disabled = false; }).end().
                    filter("img").css({ opacity: "1.0", cursor: "" });
            } else if (nodeName === "div" || nodeName === "span") {
                inline = $target.children("." + this._inlineClass);
                inline.children().removeClass("ui-state-disabled");
                inline.find("select.ui-datepicker-month, select.ui-datepicker-year").
                    prop("disabled", false);
            }
            this._disabledInputs = $.map(this._disabledInputs,
                function (value) { return (value === target ? null : value); }); // delete entry
        },

        /* Disable the date picker to a jQuery selection.
         * @param  target	element - the target input field or division or span
         */
        _disableDatepicker: function (target) {
            var nodeName, inline,
                $target = $(target),
                inst = $.data(target, "datepicker");

            if (!$target.hasClass(this.markerClassName)) {
                return;
            }

            nodeName = target.nodeName.toLowerCase();
            if (nodeName === "input") {
                target.disabled = true;
                inst.trigger.filter("button").
                    each(function () { this.disabled = true; }).end().
                    filter("img").css({ opacity: "0.5", cursor: "default" });
            } else if (nodeName === "div" || nodeName === "span") {
                inline = $target.children("." + this._inlineClass);
                inline.children().addClass("ui-state-disabled");
                inline.find("select.ui-datepicker-month, select.ui-datepicker-year").
                    prop("disabled", true);
            }
            this._disabledInputs = $.map(this._disabledInputs,
                function (value) { return (value === target ? null : value); }); // delete entry
            this._disabledInputs[this._disabledInputs.length] = target;
        },

        /* Is the first field in a jQuery collection disabled as a datepicker?
         * @param  target	element - the target input field or division or span
         * @return boolean - true if disabled, false if enabled
         */
        _isDisabledDatepicker: function (target) {
            if (!target) {
                return false;
            }
            for (var i = 0; i < this._disabledInputs.length; i++) {
                if (this._disabledInputs[i] === target) {
                    return true;
                }
            }
            return false;
        },

        /* Retrieve the instance data for the target control.
         * @param  target  element - the target input field or division or span
         * @return  object - the associated instance data
         * @throws  error if a jQuery problem getting data
         */
        _getInst: function (target) {
            try {
                return $.data(target, "datepicker");
            }
            catch (err) {
                throw "Missing instance data for this datepicker";
            }
        },

        /* Update or retrieve the settings for a date picker attached to an input field or division.
         * @param  target  element - the target input field or division or span
         * @param  name	object - the new settings to update or
         *				string - the name of the setting to change or retrieve,
         *				when retrieving also "all" for all instance settings or
         *				"defaults" for all global defaults
         * @param  value   any - the new value for the setting
         *				(omit if above is an object or to retrieve a value)
         */
        _optionDatepicker: function (target, name, value) {
            var settings, date, minDate, maxDate,
                inst = this._getInst(target);

            if (arguments.length === 2 && typeof name === "string") {
                return (name === "defaults" ? $.extend({}, $.datepicker._defaults) :
                    (inst ? (name === "all" ? $.extend({}, inst.settings) :
                        this._get(inst, name)) : null));
            }

            settings = name || {};
            if (typeof name === "string") {
                settings = {};
                settings[name] = value;
            }

            if (inst) {
                if (this._curInst === inst) {
                    this._hideDatepicker();
                }

                date = this._getDateDatepicker(target, true);
                minDate = this._getMinMaxDate(inst, "min");
                maxDate = this._getMinMaxDate(inst, "max");
                datepicker_extendRemove(inst.settings, settings);

                // reformat the old minDate/maxDate values if dateFormat changes and a new minDate/maxDate isn't provided
                if (minDate !== null && settings.dateFormat !== undefined && settings.minDate === undefined) {
                    inst.settings.minDate = this._formatDate(inst, minDate);
                }
                if (maxDate !== null && settings.dateFormat !== undefined && settings.maxDate === undefined) {
                    inst.settings.maxDate = this._formatDate(inst, maxDate);
                }
                if ("disabled" in settings) {
                    if (settings.disabled) {
                        this._disableDatepicker(target);
                    } else {
                        this._enableDatepicker(target);
                    }
                }
                this._attachments($(target), inst);
                this._autoSize(inst);
                this._setDate(inst, date);
                this._updateAlternate(inst);
                this._updateDatepicker(inst);
            }
        },

        // Change method deprecated
        _changeDatepicker: function (target, name, value) {
            this._optionDatepicker(target, name, value);
        },

        /* Redraw the date picker attached to an input field or division.
         * @param  target  element - the target input field or division or span
         */
        _refreshDatepicker: function (target) {
            var inst = this._getInst(target);
            if (inst) {
                this._updateDatepicker(inst);
            }
        },

        /* Set the dates for a jQuery selection.
         * @param  target element - the target input field or division or span
         * @param  date	Date - the new date
         */
        _setDateDatepicker: function (target, date) {
            var inst = this._getInst(target);
            if (inst) {
                this._setDate(inst, date);
                this._updateDatepicker(inst);
                this._updateAlternate(inst);
            }
        },

        /* Get the date(s) for the first entry in a jQuery selection.
         * @param  target element - the target input field or division or span
         * @param  noDefault boolean - true if no default date is to be used
         * @return Date - the current date
         */
        _getDateDatepicker: function (target, noDefault) {
            var inst = this._getInst(target);
            if (inst && !inst.inline) {
                this._setDateFromField(inst, noDefault);
            }
            return (inst ? this._getDate(inst) : null);
        },

        /* Handle keystrokes. */
        _doKeyDown: function (event) {
            var onSelect, dateStr, sel,
                inst = $.datepicker._getInst(event.target),
                handled = true,
                isRTL = inst.dpDiv.is(".ui-datepicker-rtl");

            inst._keyEvent = true;
            if ($.datepicker._datepickerShowing) {
                switch (event.keyCode) {
                    case 9: $.datepicker._hideDatepicker();
                        handled = false;
                        break; // hide on tab out
                    case 13: sel = $("td." + $.datepicker._dayOverClass + ":not(." +
                        $.datepicker._currentClass + ")", inst.dpDiv);
                        if (sel[0]) {
                            $.datepicker._selectDay(event.target, inst.selectedMonth, inst.selectedYear, sel[0]);
                        }

                        onSelect = $.datepicker._get(inst, "onSelect");
                        if (onSelect) {
                            dateStr = $.datepicker._formatDate(inst);

                            // Trigger custom callback
                            onSelect.apply((inst.input ? inst.input[0] : null), [dateStr, inst]);
                        } else {
                            $.datepicker._hideDatepicker();
                        }

                        return false; // don't submit the form
                    case 27: $.datepicker._hideDatepicker();
                        break; // hide on escape
                    case 33: $.datepicker._adjustDate(event.target, (event.ctrlKey ?
                        -$.datepicker._get(inst, "stepBigMonths") :
                        -$.datepicker._get(inst, "stepMonths")), "M");
                        break; // previous month/year on page up/+ ctrl
                    case 34: $.datepicker._adjustDate(event.target, (event.ctrlKey ?
                        +$.datepicker._get(inst, "stepBigMonths") :
                        +$.datepicker._get(inst, "stepMonths")), "M");
                        break; // next month/year on page down/+ ctrl
                    case 35: if (event.ctrlKey || event.metaKey) {
                        $.datepicker._clearDate(event.target);
                    }
                        handled = event.ctrlKey || event.metaKey;
                        break; // clear on ctrl or command +end
                    case 36: if (event.ctrlKey || event.metaKey) {
                        $.datepicker._gotoToday(event.target);
                    }
                        handled = event.ctrlKey || event.metaKey;
                        break; // current on ctrl or command +home
                    case 37: if (event.ctrlKey || event.metaKey) {
                        $.datepicker._adjustDate(event.target, (isRTL ? +1 : -1), "D");
                    }
                        handled = event.ctrlKey || event.metaKey;

                        // -1 day on ctrl or command +left
                        if (event.originalEvent.altKey) {
                            $.datepicker._adjustDate(event.target, (event.ctrlKey ?
                                -$.datepicker._get(inst, "stepBigMonths") :
                                -$.datepicker._get(inst, "stepMonths")), "M");
                        }

                        // next month/year on alt +left on Mac
                        break;
                    case 38: if (event.ctrlKey || event.metaKey) {
                        $.datepicker._adjustDate(event.target, -7, "D");
                    }
                        handled = event.ctrlKey || event.metaKey;
                        break; // -1 week on ctrl or command +up
                    case 39: if (event.ctrlKey || event.metaKey) {
                        $.datepicker._adjustDate(event.target, (isRTL ? -1 : +1), "D");
                    }
                        handled = event.ctrlKey || event.metaKey;

                        // +1 day on ctrl or command +right
                        if (event.originalEvent.altKey) {
                            $.datepicker._adjustDate(event.target, (event.ctrlKey ?
                                +$.datepicker._get(inst, "stepBigMonths") :
                                +$.datepicker._get(inst, "stepMonths")), "M");
                        }

                        // next month/year on alt +right
                        break;
                    case 40: if (event.ctrlKey || event.metaKey) {
                        $.datepicker._adjustDate(event.target, +7, "D");
                    }
                        handled = event.ctrlKey || event.metaKey;
                        break; // +1 week on ctrl or command +down
                    default: handled = false;
                }
            } else if (event.keyCode === 36 && event.ctrlKey) { // display the date picker on ctrl+home
                $.datepicker._showDatepicker(this);
            } else {
                handled = false;
            }

            if (handled) {
                event.preventDefault();
                event.stopPropagation();
            }
        },

        /* Filter entered characters - based on date format. */
        _doKeyPress: function (event) {
            var chars, chr,
                inst = $.datepicker._getInst(event.target);

            if ($.datepicker._get(inst, "constrainInput")) {
                chars = $.datepicker._possibleChars($.datepicker._get(inst, "dateFormat"));
                chr = String.fromCharCode(event.charCode == null ? event.keyCode : event.charCode);
                return event.ctrlKey || event.metaKey || (chr < " " || !chars || chars.indexOf(chr) > -1);
            }
        },

        /* Synchronise manual entry and field/alternate field. */
        _doKeyUp: function (event) {
            var date,
                inst = $.datepicker._getInst(event.target);

            if (inst.input.val() !== inst.lastVal) {
                try {
                    date = $.datepicker.parseDate($.datepicker._get(inst, "dateFormat"),
                        (inst.input ? inst.input.val() : null),
                        $.datepicker._getFormatConfig(inst));

                    if (date) { // only if valid
                        $.datepicker._setDateFromField(inst);
                        $.datepicker._updateAlternate(inst);
                        $.datepicker._updateDatepicker(inst);
                    }
                }
                catch (err) {
                }
            }
            return true;
        },

        /* Pop-up the date picker for a given input field.
         * If false returned from beforeShow event handler do not show.
         * @param  input  element - the input field attached to the date picker or
         *					event - if triggered by focus
         */
        _showDatepicker: function (input) {
            input = input.target || input;
            if (input.nodeName.toLowerCase() !== "input") { // find from button/image trigger
                input = $("input", input.parentNode)[0];
            }

            if ($.datepicker._isDisabledDatepicker(input) || $.datepicker._lastInput === input) { // already here
                return;
            }

            var inst, beforeShow, beforeShowSettings, isFixed,
                offset, showAnim, duration;

            inst = $.datepicker._getInst(input);
            if ($.datepicker._curInst && $.datepicker._curInst !== inst) {
                $.datepicker._curInst.dpDiv.stop(true, true);
                if (inst && $.datepicker._datepickerShowing) {
                    $.datepicker._hideDatepicker($.datepicker._curInst.input[0]);
                }
            }

            beforeShow = $.datepicker._get(inst, "beforeShow");
            beforeShowSettings = beforeShow ? beforeShow.apply(input, [input, inst]) : {};
            if (beforeShowSettings === false) {
                return;
            }
            datepicker_extendRemove(inst.settings, beforeShowSettings);

            inst.lastVal = null;
            $.datepicker._lastInput = input;
            $.datepicker._setDateFromField(inst);

            if ($.datepicker._inDialog) { // hide cursor
                input.value = "";
            }
            if (!$.datepicker._pos) { // position below input
                $.datepicker._pos = $.datepicker._findPos(input);
                $.datepicker._pos[1] += input.offsetHeight; // add the height
            }

            isFixed = false;
            $(input).parents().each(function () {
                isFixed |= $(this).css("position") === "fixed";
                return !isFixed;
            });

            offset = { left: $.datepicker._pos[0], top: $.datepicker._pos[1] };
            $.datepicker._pos = null;

            //to avoid flashes on Firefox
            inst.dpDiv.empty();

            // determine sizing offscreen
            inst.dpDiv.css({ position: "absolute", display: "block", top: "-1000px" });
            $.datepicker._updateDatepicker(inst);

            // fix width for dynamic number of date pickers
            // and adjust position before showing
            offset = $.datepicker._checkOffset(inst, offset, isFixed);
            inst.dpDiv.css({
                position: ($.datepicker._inDialog && $.blockUI ?
                    "static" : (isFixed ? "fixed" : "absolute")), display: "none",
                left: offset.left + "px", top: offset.top + "px"
            });

            if (!inst.inline) {
                showAnim = $.datepicker._get(inst, "showAnim");
                duration = $.datepicker._get(inst, "duration");
                inst.dpDiv.css("z-index", datepicker_getZindex($(input)) + 1);
                $.datepicker._datepickerShowing = true;

                if ($.effects && $.effects.effect[showAnim]) {
                    inst.dpDiv.show(showAnim, $.datepicker._get(inst, "showOptions"), duration);
                } else {
                    inst.dpDiv[showAnim || "show"](showAnim ? duration : null);
                }

                if ($.datepicker._shouldFocusInput(inst)) {
                    inst.input.trigger("focus");
                }

                $.datepicker._curInst = inst;
            }
        },

        /* Generate the date picker content. */
        _updateDatepicker: function (inst) {
            this.maxRows = 4; //Reset the max number of rows being displayed (see #7043)
            datepicker_instActive = inst; // for delegate hover events
            inst.dpDiv.empty().append(this._generateHTML(inst));
            this._attachHandlers(inst);

            var origyearshtml,
                numMonths = this._getNumberOfMonths(inst),
                cols = numMonths[1],
                width = 17,
                activeCell = inst.dpDiv.find("." + this._dayOverClass + " a");

            if (activeCell.length > 0) {
                datepicker_handleMouseover.apply(activeCell.get(0));
            }

            inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");
            if (cols > 1) {
                inst.dpDiv.addClass("ui-datepicker-multi-" + cols).css("width", (width * cols) + "em");
            }
            inst.dpDiv[(numMonths[0] !== 1 || numMonths[1] !== 1 ? "add" : "remove") +
                "Class"]("ui-datepicker-multi");
            inst.dpDiv[(this._get(inst, "isRTL") ? "add" : "remove") +
                "Class"]("ui-datepicker-rtl");

            if (inst === $.datepicker._curInst && $.datepicker._datepickerShowing && $.datepicker._shouldFocusInput(inst)) {
                inst.input.trigger("focus");
            }

            // Deffered render of the years select (to avoid flashes on Firefox)
            if (inst.yearshtml) {
                origyearshtml = inst.yearshtml;
                setTimeout(function () {

                    //assure that inst.yearshtml didn't change.
                    if (origyearshtml === inst.yearshtml && inst.yearshtml) {
                        inst.dpDiv.find("select.ui-datepicker-year:first").replaceWith(inst.yearshtml);
                    }
                    origyearshtml = inst.yearshtml = null;
                }, 0);
            }
        },

        // #6694 - don't focus the input if it's already focused
        // this breaks the change event in IE
        // Support: IE and jQuery <1.9
        _shouldFocusInput: function (inst) {
            return inst.input && inst.input.is(":visible") && !inst.input.is(":disabled") && !inst.input.is(":focus");
        },

        /* Check positioning to remain on screen. */
        _checkOffset: function (inst, offset, isFixed) {
            var dpWidth = inst.dpDiv.outerWidth(),
                dpHeight = inst.dpDiv.outerHeight(),
                inputWidth = inst.input ? inst.input.outerWidth() : 0,
                inputHeight = inst.input ? inst.input.outerHeight() : 0,
                viewWidth = document.documentElement.clientWidth + (isFixed ? 0 : $(document).scrollLeft()),
                viewHeight = document.documentElement.clientHeight + (isFixed ? 0 : $(document).scrollTop());

            offset.left -= (this._get(inst, "isRTL") ? (dpWidth - inputWidth) : 0);
            offset.left -= (isFixed && offset.left === inst.input.offset().left) ? $(document).scrollLeft() : 0;
            offset.top -= (isFixed && offset.top === (inst.input.offset().top + inputHeight)) ? $(document).scrollTop() : 0;

            // Now check if datepicker is showing outside window viewport - move to a better place if so.
            offset.left -= Math.min(offset.left, (offset.left + dpWidth > viewWidth && viewWidth > dpWidth) ?
                Math.abs(offset.left + dpWidth - viewWidth) : 0);
            offset.top -= Math.min(offset.top, (offset.top + dpHeight > viewHeight && viewHeight > dpHeight) ?
                Math.abs(dpHeight + inputHeight) : 0);

            return offset;
        },

        /* Find an object's position on the screen. */
        _findPos: function (obj) {
            var position,
                inst = this._getInst(obj),
                isRTL = this._get(inst, "isRTL");

            while (obj && (obj.type === "hidden" || obj.nodeType !== 1 || $.expr.filters.hidden(obj))) {
                obj = obj[isRTL ? "previousSibling" : "nextSibling"];
            }

            position = $(obj).offset();
            return [position.left, position.top];
        },

        /* Hide the date picker from view.
         * @param  input  element - the input field attached to the date picker
         */
        _hideDatepicker: function (input) {
            var showAnim, duration, postProcess, onClose,
                inst = this._curInst;

            if (!inst || (input && inst !== $.data(input, "datepicker"))) {
                return;
            }

            if (this._datepickerShowing) {
                showAnim = this._get(inst, "showAnim");
                duration = this._get(inst, "duration");
                postProcess = function () {
                    $.datepicker._tidyDialog(inst);
                };

                // DEPRECATED: after BC for 1.8.x $.effects[ showAnim ] is not needed
                if ($.effects && ($.effects.effect[showAnim] || $.effects[showAnim])) {
                    inst.dpDiv.hide(showAnim, $.datepicker._get(inst, "showOptions"), duration, postProcess);
                } else {
                    inst.dpDiv[(showAnim === "slideDown" ? "slideUp" :
                        (showAnim === "fadeIn" ? "fadeOut" : "hide"))]((showAnim ? duration : null), postProcess);
                }

                if (!showAnim) {
                    postProcess();
                }
                this._datepickerShowing = false;

                onClose = this._get(inst, "onClose");
                if (onClose) {
                    onClose.apply((inst.input ? inst.input[0] : null), [(inst.input ? inst.input.val() : ""), inst]);
                }

                this._lastInput = null;
                if (this._inDialog) {
                    this._dialogInput.css({ position: "absolute", left: "0", top: "-100px" });
                    if ($.blockUI) {
                        $.unblockUI();
                        $("body").append(this.dpDiv);
                    }
                }
                this._inDialog = false;
            }
        },

        /* Tidy up after a dialog display. */
        _tidyDialog: function (inst) {
            inst.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar");
        },

        /* Close date picker if clicked elsewhere. */
        _checkExternalClick: function (event) {
            if (!$.datepicker._curInst) {
                return;
            }

            var $target = $(event.target),
                inst = $.datepicker._getInst($target[0]);

            if ((($target[0].id !== $.datepicker._mainDivId &&
                $target.parents("#" + $.datepicker._mainDivId).length === 0 &&
                !$target.hasClass($.datepicker.markerClassName) &&
                !$target.closest("." + $.datepicker._triggerClass).length &&
                $.datepicker._datepickerShowing && !($.datepicker._inDialog && $.blockUI))) ||
                ($target.hasClass($.datepicker.markerClassName) && $.datepicker._curInst !== inst)) {
                $.datepicker._hideDatepicker();
            }
        },

        /* Adjust one of the date sub-fields. */
        _adjustDate: function (id, offset, period) {
            var target = $(id),
                inst = this._getInst(target[0]);

            if (this._isDisabledDatepicker(target[0])) {
                return;
            }
            this._adjustInstDate(inst, offset +
                (period === "M" ? this._get(inst, "showCurrentAtPos") : 0), // undo positioning
                period);
            this._updateDatepicker(inst);
        },

        /* Action for current link. */
        _gotoToday: function (id) {
            var date,
                target = $(id),
                inst = this._getInst(target[0]);

            if (this._get(inst, "gotoCurrent") && inst.currentDay) {
                inst.selectedDay = inst.currentDay;
                inst.drawMonth = inst.selectedMonth = inst.currentMonth;
                inst.drawYear = inst.selectedYear = inst.currentYear;
            } else {
                date = new Date();
                inst.selectedDay = date.getDate();
                inst.drawMonth = inst.selectedMonth = date.getMonth();
                inst.drawYear = inst.selectedYear = date.getFullYear();
            }
            this._notifyChange(inst);
            this._adjustDate(target);
        },

        /* Action for selecting a new month/year. */
        _selectMonthYear: function (id, select, period) {
            var target = $(id),
                inst = this._getInst(target[0]);

            inst["selected" + (period === "M" ? "Month" : "Year")] =
                inst["draw" + (period === "M" ? "Month" : "Year")] =
                parseInt(select.options[select.selectedIndex].value, 10);

            this._notifyChange(inst);
            this._adjustDate(target);
        },

        /* Action for selecting a day. */
        _selectDay: function (id, month, year, td) {
            var inst,
                target = $(id);

            if ($(td).hasClass(this._unselectableClass) || this._isDisabledDatepicker(target[0])) {
                return;
            }

            inst = this._getInst(target[0]);
            inst.selectedDay = inst.currentDay = $("a", td).html();
            inst.selectedMonth = inst.currentMonth = month;
            inst.selectedYear = inst.currentYear = year;
            this._selectDate(id, this._formatDate(inst,
                inst.currentDay, inst.currentMonth, inst.currentYear));
        },

        /* Erase the input field and hide the date picker. */
        _clearDate: function (id) {
            var target = $(id);
            this._selectDate(target, "");
        },

        /* Update the input field with the selected date. */
        _selectDate: function (id, dateStr) {
            var onSelect,
                target = $(id),
                inst = this._getInst(target[0]);

            dateStr = (dateStr != null ? dateStr : this._formatDate(inst));
            if (inst.input) {
                inst.input.val(dateStr);
            }
            this._updateAlternate(inst);

            onSelect = this._get(inst, "onSelect");
            if (onSelect) {
                onSelect.apply((inst.input ? inst.input[0] : null), [dateStr, inst]);  // trigger custom callback
            } else if (inst.input) {
                inst.input.trigger("change"); // fire the change event
            }

            if (inst.inline) {
                this._updateDatepicker(inst);
            } else {
                this._hideDatepicker();
                this._lastInput = inst.input[0];
                if (typeof (inst.input[0]) !== "object") {
                    inst.input.trigger("focus"); // restore focus
                }
                this._lastInput = null;
            }
        },

        /* Update any alternate field to synchronise with the main field. */
        _updateAlternate: function (inst) {
            var altFormat, date, dateStr,
                altField = this._get(inst, "altField");

            if (altField) { // update alternate field too
                altFormat = this._get(inst, "altFormat") || this._get(inst, "dateFormat");
                date = this._getDate(inst);
                dateStr = this.formatDate(altFormat, date, this._getFormatConfig(inst));
                $(altField).val(dateStr);
            }
        },

        /* Set as beforeShowDay function to prevent selection of weekends.
         * @param  date  Date - the date to customise
         * @return [boolean, string] - is this date selectable?, what is its CSS class?
         */
        noWeekends: function (date) {
            var day = date.getDay();
            return [(day > 0 && day < 6), ""];
        },

        /* Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.
         * @param  date  Date - the date to get the week for
         * @return  number - the number of the week within the year that contains this date
         */
        iso8601Week: function (date) {
            var time,
                checkDate = new Date(date.getTime());

            // Find Thursday of this week starting on Monday
            checkDate.setDate(checkDate.getDate() + 4 - (checkDate.getDay() || 7));

            time = checkDate.getTime();
            checkDate.setMonth(0); // Compare with Jan 1
            checkDate.setDate(1);
            return Math.floor(Math.round((time - checkDate) / 86400000) / 7) + 1;
        },

        /* Parse a string value into a date object.
         * See formatDate below for the possible formats.
         *
         * @param  format string - the expected format of the date
         * @param  value string - the date in the above format
         * @param  settings Object - attributes include:
         *					shortYearCutoff  number - the cutoff year for determining the century (optional)
         *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
         *					dayNames		string[7] - names of the days from Sunday (optional)
         *					monthNamesShort string[12] - abbreviated names of the months (optional)
         *					monthNames		string[12] - names of the months (optional)
         * @return  Date - the extracted date value or null if value is blank
         */
        parseDate: function (format, value, settings) {
            if (format == null || value == null) {
                throw "Invalid arguments";
            }

            value = (typeof value === "object" ? value.toString() : value + "");
            if (value === "") {
                return null;
            }

            var iFormat, dim, extra,
                iValue = 0,
                shortYearCutoffTemp = (settings ? settings.shortYearCutoff : null) || this._defaults.shortYearCutoff,
                shortYearCutoff = (typeof shortYearCutoffTemp !== "string" ? shortYearCutoffTemp :
                    new Date().getFullYear() % 100 + parseInt(shortYearCutoffTemp, 10)),
                dayNamesShort = (settings ? settings.dayNamesShort : null) || this._defaults.dayNamesShort,
                dayNames = (settings ? settings.dayNames : null) || this._defaults.dayNames,
                monthNamesShort = (settings ? settings.monthNamesShort : null) || this._defaults.monthNamesShort,
                monthNames = (settings ? settings.monthNames : null) || this._defaults.monthNames,
                year = -1,
                month = -1,
                day = -1,
                doy = -1,
                literal = false,
                date,

                // Check whether a format character is doubled
                lookAhead = function (match) {
                    var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) === match);
                    if (matches) {
                        iFormat++;
                    }
                    return matches;
                },

                // Extract a number from the string value
                getNumber = function (match) {
                    var isDoubled = lookAhead(match),
                        size = (match === "@" ? 14 : (match === "!" ? 20 :
                            (match === "y" && isDoubled ? 4 : (match === "o" ? 3 : 2)))),
                        minSize = (match === "y" ? size : 1),
                        digits = new RegExp("^\\d{" + minSize + "," + size + "}"),
                        num = value.substring(iValue).match(digits);
                    if (!num) {
                        throw "Missing number at position " + iValue;
                    }
                    iValue += num[0].length;
                    return parseInt(num[0], 10);
                },

                // Extract a name from the string value and convert to an index
                getName = function (match, shortNames, longNames) {
                    var index = -1,
                        names = $.map(lookAhead(match) ? longNames : shortNames, function (v, k) {
                            return [[k, v]];
                        }).sort(function (a, b) {
                            return -(a[1].length - b[1].length);
                        });

                    $.each(names, function (i, pair) {
                        var name = pair[1];
                        if (value.substr(iValue, name.length).toLowerCase() === name.toLowerCase()) {
                            index = pair[0];
                            iValue += name.length;
                            return false;
                        }
                    });
                    if (index !== -1) {
                        return index + 1;
                    } else {
                        throw "Unknown name at position " + iValue;
                    }
                },

                // Confirm that a literal character matches the string value
                checkLiteral = function () {
                    if (value.charAt(iValue) !== format.charAt(iFormat)) {
                        throw "Unexpected literal at position " + iValue;
                    }
                    iValue++;
                };

            for (iFormat = 0; iFormat < format.length; iFormat++) {
                if (literal) {
                    if (format.charAt(iFormat) === "'" && !lookAhead("'")) {
                        literal = false;
                    } else {
                        checkLiteral();
                    }
                } else {
                    switch (format.charAt(iFormat)) {
                        case "d":
                            day = getNumber("d");
                            break;
                        case "D":
                            getName("D", dayNamesShort, dayNames);
                            break;
                        case "o":
                            doy = getNumber("o");
                            break;
                        case "m":
                            month = getNumber("m");
                            break;
                        case "M":
                            month = getName("M", monthNamesShort, monthNames);
                            break;
                        case "y":
                            year = getNumber("y");
                            break;
                        case "@":
                            date = new Date(getNumber("@"));
                            year = date.getFullYear();
                            month = date.getMonth() + 1;
                            day = date.getDate();
                            break;
                        case "!":
                            date = new Date((getNumber("!") - this._ticksTo1970) / 10000);
                            year = date.getFullYear();
                            month = date.getMonth() + 1;
                            day = date.getDate();
                            break;
                        case "'":
                            if (lookAhead("'")) {
                                checkLiteral();
                            } else {
                                literal = true;
                            }
                            break;
                        default:
                            checkLiteral();
                    }
                }
            }

            if (iValue < value.length) {
                extra = value.substr(iValue);
                if (!/^\s+/.test(extra)) {
                    throw "Extra/unparsed characters found in date: " + extra;
                }
            }

            if (year === -1) {
                year = new Date().getFullYear();
            } else if (year < 100) {
                year += new Date().getFullYear() - new Date().getFullYear() % 100 +
                    (year <= shortYearCutoff ? 0 : -100);
            }

            if (doy > -1) {
                month = 1;
                day = doy;
                do {
                    dim = this._getDaysInMonth(year, month - 1);
                    if (day <= dim) {
                        break;
                    }
                    month++;
                    day -= dim;
                } while (true);
            }

            date = this._daylightSavingAdjust(new Date(year, month - 1, day));
            if (date.getFullYear() !== year || date.getMonth() + 1 !== month || date.getDate() !== day) {
                throw "Invalid date"; // E.g. 31/02/00
            }
            return date;
        },

        /* Standard date formats. */
        ATOM: "yy-mm-dd", // RFC 3339 (ISO 8601)
        COOKIE: "D, dd M yy",
        ISO_8601: "yy-mm-dd",
        RFC_822: "D, d M y",
        RFC_850: "DD, dd-M-y",
        RFC_1036: "D, d M y",
        RFC_1123: "D, d M yy",
        RFC_2822: "D, d M yy",
        RSS: "D, d M y", // RFC 822
        TICKS: "!",
        TIMESTAMP: "@",
        W3C: "yy-mm-dd", // ISO 8601

        _ticksTo1970: (((1970 - 1) * 365 + Math.floor(1970 / 4) - Math.floor(1970 / 100) +
            Math.floor(1970 / 400)) * 24 * 60 * 60 * 10000000),

        /* Format a date object into a string value.
         * The format can be combinations of the following:
         * d  - day of month (no leading zero)
         * dd - day of month (two digit)
         * o  - day of year (no leading zeros)
         * oo - day of year (three digit)
         * D  - day name short
         * DD - day name long
         * m  - month of year (no leading zero)
         * mm - month of year (two digit)
         * M  - month name short
         * MM - month name long
         * y  - year (two digit)
         * yy - year (four digit)
         * @ - Unix timestamp (ms since 01/01/1970)
         * ! - Windows ticks (100ns since 01/01/0001)
         * "..." - literal text
         * '' - single quote
         *
         * @param  format string - the desired format of the date
         * @param  date Date - the date value to format
         * @param  settings Object - attributes include:
         *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
         *					dayNames		string[7] - names of the days from Sunday (optional)
         *					monthNamesShort string[12] - abbreviated names of the months (optional)
         *					monthNames		string[12] - names of the months (optional)
         * @return  string - the date in the above format
         */
        formatDate: function (format, date, settings) {
            if (!date) {
                return "";
            }

            var iFormat,
                dayNamesShort = (settings ? settings.dayNamesShort : null) || this._defaults.dayNamesShort,
                dayNames = (settings ? settings.dayNames : null) || this._defaults.dayNames,
                monthNamesShort = (settings ? settings.monthNamesShort : null) || this._defaults.monthNamesShort,
                monthNames = (settings ? settings.monthNames : null) || this._defaults.monthNames,

                // Check whether a format character is doubled
                lookAhead = function (match) {
                    var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) === match);
                    if (matches) {
                        iFormat++;
                    }
                    return matches;
                },

                // Format a number, with leading zero if necessary
                formatNumber = function (match, value, len) {
                    var num = "" + value;
                    if (lookAhead(match)) {
                        while (num.length < len) {
                            num = "0" + num;
                        }
                    }
                    return num;
                },

                // Format a name, short or long as requested
                formatName = function (match, value, shortNames, longNames) {
                    return (lookAhead(match) ? longNames[value] : shortNames[value]);
                },
                output = "",
                literal = false;

            if (date) {
                for (iFormat = 0; iFormat < format.length; iFormat++) {
                    if (literal) {
                        if (format.charAt(iFormat) === "'" && !lookAhead("'")) {
                            literal = false;
                        } else {
                            output += format.charAt(iFormat);
                        }
                    } else {
                        switch (format.charAt(iFormat)) {
                            case "d":
                                output += formatNumber("d", date.getDate(), 2);
                                break;
                            case "D":
                                output += formatName("D", date.getDay(), dayNamesShort, dayNames);
                                break;
                            case "o":
                                output += formatNumber("o",
                                    Math.round((new Date(date.getFullYear(), date.getMonth(), date.getDate()).getTime() - new Date(date.getFullYear(), 0, 0).getTime()) / 86400000), 3);
                                break;
                            case "m":
                                output += formatNumber("m", date.getMonth() + 1, 2);
                                break;
                            case "M":
                                output += formatName("M", date.getMonth(), monthNamesShort, monthNames);
                                break;
                            case "y":
                                output += (lookAhead("y") ? date.getFullYear() :
                                    (date.getFullYear() % 100 < 10 ? "0" : "") + date.getFullYear() % 100);
                                break;
                            case "@":
                                output += date.getTime();
                                break;
                            case "!":
                                output += date.getTime() * 10000 + this._ticksTo1970;
                                break;
                            case "'":
                                if (lookAhead("'")) {
                                    output += "'";
                                } else {
                                    literal = true;
                                }
                                break;
                            default:
                                output += format.charAt(iFormat);
                        }
                    }
                }
            }
            return output;
        },

        /* Extract all possible characters from the date format. */
        _possibleChars: function (format) {
            var iFormat,
                chars = "",
                literal = false,

                // Check whether a format character is doubled
                lookAhead = function (match) {
                    var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) === match);
                    if (matches) {
                        iFormat++;
                    }
                    return matches;
                };

            for (iFormat = 0; iFormat < format.length; iFormat++) {
                if (literal) {
                    if (format.charAt(iFormat) === "'" && !lookAhead("'")) {
                        literal = false;
                    } else {
                        chars += format.charAt(iFormat);
                    }
                } else {
                    switch (format.charAt(iFormat)) {
                        case "d": case "m": case "y": case "@":
                            chars += "0123456789";
                            break;
                        case "D": case "M":
                            return null; // Accept anything
                        case "'":
                            if (lookAhead("'")) {
                                chars += "'";
                            } else {
                                literal = true;
                            }
                            break;
                        default:
                            chars += format.charAt(iFormat);
                    }
                }
            }
            return chars;
        },

        /* Get a setting value, defaulting if necessary. */
        _get: function (inst, name) {
            return inst.settings[name] !== undefined ?
                inst.settings[name] : this._defaults[name];
        },

        /* Parse existing date and initialise date picker. */
        _setDateFromField: function (inst, noDefault) {
            if (inst.input.val() === inst.lastVal) {
                return;
            }

            var dateFormat = this._get(inst, "dateFormat"),
                dates = inst.lastVal = inst.input ? inst.input.val() : null,
                defaultDate = this._getDefaultDate(inst),
                date = defaultDate,
                settings = this._getFormatConfig(inst);

            try {
                date = this.parseDate(dateFormat, dates, settings) || defaultDate;
            } catch (event) {
                dates = (noDefault ? "" : dates);
            }
            inst.selectedDay = date.getDate();
            inst.drawMonth = inst.selectedMonth = date.getMonth();
            inst.drawYear = inst.selectedYear = date.getFullYear();
            inst.currentDay = (dates ? date.getDate() : 0);
            inst.currentMonth = (dates ? date.getMonth() : 0);
            inst.currentYear = (dates ? date.getFullYear() : 0);
            this._adjustInstDate(inst);
        },

        /* Retrieve the default date shown on opening. */
        _getDefaultDate: function (inst) {
            return this._restrictMinMax(inst,
                this._determineDate(inst, this._get(inst, "defaultDate"), new Date()));
        },

        /* A date may be specified as an exact value or a relative one. */
        _determineDate: function (inst, date, defaultDate) {
            var offsetNumeric = function (offset) {
                var date = new Date();
                date.setDate(date.getDate() + offset);
                return date;
            },
                offsetString = function (offset) {
                    try {
                        return $.datepicker.parseDate($.datepicker._get(inst, "dateFormat"),
                            offset, $.datepicker._getFormatConfig(inst));
                    }
                    catch (e) {

                        // Ignore
                    }

                    var date = (offset.toLowerCase().match(/^c/) ?
                        $.datepicker._getDate(inst) : null) || new Date(),
                        year = date.getFullYear(),
                        month = date.getMonth(),
                        day = date.getDate(),
                        pattern = /([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,
                        matches = pattern.exec(offset);

                    while (matches) {
                        switch (matches[2] || "d") {
                            case "d": case "D":
                                day += parseInt(matches[1], 10); break;
                            case "w": case "W":
                                day += parseInt(matches[1], 10) * 7; break;
                            case "m": case "M":
                                month += parseInt(matches[1], 10);
                                day = Math.min(day, $.datepicker._getDaysInMonth(year, month));
                                break;
                            case "y": case "Y":
                                year += parseInt(matches[1], 10);
                                day = Math.min(day, $.datepicker._getDaysInMonth(year, month));
                                break;
                        }
                        matches = pattern.exec(offset);
                    }
                    return new Date(year, month, day);
                },
                newDate = (date == null || date === "" ? defaultDate : (typeof date === "string" ? offsetString(date) :
                    (typeof date === "number" ? (isNaN(date) ? defaultDate : offsetNumeric(date)) : new Date(date.getTime()))));

            newDate = (newDate && newDate.toString() === "Invalid Date" ? defaultDate : newDate);
            if (newDate) {
                newDate.setHours(0);
                newDate.setMinutes(0);
                newDate.setSeconds(0);
                newDate.setMilliseconds(0);
            }
            return this._daylightSavingAdjust(newDate);
        },

        /* Handle switch to/from daylight saving.
         * Hours may be non-zero on daylight saving cut-over:
         * > 12 when midnight changeover, but then cannot generate
         * midnight datetime, so jump to 1AM, otherwise reset.
         * @param  date  (Date) the date to check
         * @return  (Date) the corrected date
         */
        _daylightSavingAdjust: function (date) {
            if (!date) {
                return null;
            }
            date.setHours(date.getHours() > 12 ? date.getHours() + 2 : 0);
            return date;
        },

        /* Set the date(s) directly. */
        _setDate: function (inst, date, noChange) {
            var clear = !date,
                origMonth = inst.selectedMonth,
                origYear = inst.selectedYear,
                newDate = this._restrictMinMax(inst, this._determineDate(inst, date, new Date()));

            inst.selectedDay = inst.currentDay = newDate.getDate();
            inst.drawMonth = inst.selectedMonth = inst.currentMonth = newDate.getMonth();
            inst.drawYear = inst.selectedYear = inst.currentYear = newDate.getFullYear();
            if ((origMonth !== inst.selectedMonth || origYear !== inst.selectedYear) && !noChange) {
                this._notifyChange(inst);
            }
            this._adjustInstDate(inst);
            if (inst.input) {
                inst.input.val(clear ? "" : this._formatDate(inst));
            }
        },

        /* Retrieve the date(s) directly. */
        _getDate: function (inst) {
            var startDate = (!inst.currentYear || (inst.input && inst.input.val() === "") ? null :
                this._daylightSavingAdjust(new Date(
                    inst.currentYear, inst.currentMonth, inst.currentDay)));
            return startDate;
        },

        /* Attach the onxxx handlers.  These are declared statically so
         * they work with static code transformers like Caja.
         */
        _attachHandlers: function (inst) {
            var stepMonths = this._get(inst, "stepMonths"),
                id = "#" + inst.id.replace(/\\\\/g, "\\");
            inst.dpDiv.find("[data-handler]").map(function () {
                var handler = {
                    prev: function () {
                        $.datepicker._adjustDate(id, -stepMonths, "M");
                    },
                    next: function () {
                        $.datepicker._adjustDate(id, +stepMonths, "M");
                    },
                    hide: function () {
                        $.datepicker._hideDatepicker();
                    },
                    today: function () {
                        $.datepicker._gotoToday(id);
                    },
                    selectDay: function () {
                        $.datepicker._selectDay(id, +this.getAttribute("data-month"), +this.getAttribute("data-year"), this);
                        return false;
                    },
                    selectMonth: function () {
                        $.datepicker._selectMonthYear(id, this, "M");
                        return false;
                    },
                    selectYear: function () {
                        $.datepicker._selectMonthYear(id, this, "Y");
                        return false;
                    }
                };
                $(this).on(this.getAttribute("data-event"), handler[this.getAttribute("data-handler")]);
            });
        },

        /* Generate the HTML for the current state of the date picker. */
        _generateHTML: function (inst) {
            var maxDraw, prevText, prev, nextText, next, currentText, gotoDate,
                controls, buttonPanel, firstDay, showWeek, dayNames, dayNamesMin,
                monthNames, monthNamesShort, beforeShowDay, showOtherMonths,
                selectOtherMonths, defaultDate, html, dow, row, group, col, selectedDate,
                cornerClass, calender, thead, day, daysInMonth, leadDays, curRows, numRows,
                printDate, dRow, tbody, daySettings, otherMonth, unselectable,
                tempDate = new Date(),
                today = this._daylightSavingAdjust(
                    new Date(tempDate.getFullYear(), tempDate.getMonth(), tempDate.getDate())), // clear time
                isRTL = this._get(inst, "isRTL"),
                showButtonPanel = this._get(inst, "showButtonPanel"),
                hideIfNoPrevNext = this._get(inst, "hideIfNoPrevNext"),
                navigationAsDateFormat = this._get(inst, "navigationAsDateFormat"),
                numMonths = this._getNumberOfMonths(inst),
                showCurrentAtPos = this._get(inst, "showCurrentAtPos"),
                stepMonths = this._get(inst, "stepMonths"),
                isMultiMonth = (numMonths[0] !== 1 || numMonths[1] !== 1),
                currentDate = this._daylightSavingAdjust((!inst.currentDay ? new Date(9999, 9, 9) :
                    new Date(inst.currentYear, inst.currentMonth, inst.currentDay))),
                minDate = this._getMinMaxDate(inst, "min"),
                maxDate = this._getMinMaxDate(inst, "max"),
                drawMonth = inst.drawMonth - showCurrentAtPos,
                drawYear = inst.drawYear;

            if (drawMonth < 0) {
                drawMonth += 12;
                drawYear--;
            }
            if (maxDate) {
                maxDraw = this._daylightSavingAdjust(new Date(maxDate.getFullYear(),
                    maxDate.getMonth() - (numMonths[0] * numMonths[1]) + 1, maxDate.getDate()));
                maxDraw = (minDate && maxDraw < minDate ? minDate : maxDraw);
                while (this._daylightSavingAdjust(new Date(drawYear, drawMonth, 1)) > maxDraw) {
                    drawMonth--;
                    if (drawMonth < 0) {
                        drawMonth = 11;
                        drawYear--;
                    }
                }
            }
            inst.drawMonth = drawMonth;
            inst.drawYear = drawYear;

            prevText = this._get(inst, "prevText");
            prevText = (!navigationAsDateFormat ? prevText : this.formatDate(prevText,
                this._daylightSavingAdjust(new Date(drawYear, drawMonth - stepMonths, 1)),
                this._getFormatConfig(inst)));

            prev = (this._canAdjustMonth(inst, -1, drawYear, drawMonth) ?
                "<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click'" +
                " title='" + prevText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "e" : "w") + "'>" + prevText + "</span></a>" :
                (hideIfNoPrevNext ? "" : "<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='" + prevText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "e" : "w") + "'>" + prevText + "</span></a>"));

            nextText = this._get(inst, "nextText");
            nextText = (!navigationAsDateFormat ? nextText : this.formatDate(nextText,
                this._daylightSavingAdjust(new Date(drawYear, drawMonth + stepMonths, 1)),
                this._getFormatConfig(inst)));

            next = (this._canAdjustMonth(inst, +1, drawYear, drawMonth) ?
                "<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click'" +
                " title='" + nextText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "w" : "e") + "'>" + nextText + "</span></a>" :
                (hideIfNoPrevNext ? "" : "<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='" + nextText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "w" : "e") + "'>" + nextText + "</span></a>"));

            currentText = this._get(inst, "currentText");
            gotoDate = (this._get(inst, "gotoCurrent") && inst.currentDay ? currentDate : today);
            currentText = (!navigationAsDateFormat ? currentText :
                this.formatDate(currentText, gotoDate, this._getFormatConfig(inst)));

            controls = (!inst.inline ? "<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>" +
                this._get(inst, "closeText") + "</button>" : "");

            buttonPanel = (showButtonPanel) ? "<div class='ui-datepicker-buttonpane ui-widget-content'>" + (isRTL ? controls : "") +
                (this._isInRange(inst, gotoDate) ? "<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'" +
                    ">" + currentText + "</button>" : "") + (isRTL ? "" : controls) + "</div>" : "";

            firstDay = parseInt(this._get(inst, "firstDay"), 10);
            firstDay = (isNaN(firstDay) ? 0 : firstDay);

            showWeek = this._get(inst, "showWeek");
            dayNames = this._get(inst, "dayNames");
            dayNamesMin = this._get(inst, "dayNamesMin");
            monthNames = this._get(inst, "monthNames");
            monthNamesShort = this._get(inst, "monthNamesShort");
            beforeShowDay = this._get(inst, "beforeShowDay");
            showOtherMonths = this._get(inst, "showOtherMonths");
            selectOtherMonths = this._get(inst, "selectOtherMonths");
            defaultDate = this._getDefaultDate(inst);
            html = "";

            for (row = 0; row < numMonths[0]; row++) {
                group = "";
                this.maxRows = 4;
                for (col = 0; col < numMonths[1]; col++) {
                    selectedDate = this._daylightSavingAdjust(new Date(drawYear, drawMonth, inst.selectedDay));
                    cornerClass = " ui-corner-all";
                    calender = "";
                    if (isMultiMonth) {
                        calender += "<div class='ui-datepicker-group";
                        if (numMonths[1] > 1) {
                            switch (col) {
                                case 0: calender += " ui-datepicker-group-first";
                                    cornerClass = " ui-corner-" + (isRTL ? "right" : "left"); break;
                                case numMonths[1] - 1: calender += " ui-datepicker-group-last";
                                    cornerClass = " ui-corner-" + (isRTL ? "left" : "right"); break;
                                default: calender += " ui-datepicker-group-middle"; cornerClass = ""; break;
                            }
                        }
                        calender += "'>";
                    }
                    calender += "<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" + cornerClass + "'>" +
                        (/all|left/.test(cornerClass) && row === 0 ? (isRTL ? next : prev) : "") +
                        (/all|right/.test(cornerClass) && row === 0 ? (isRTL ? prev : next) : "") +
                        this._generateMonthYearHeader(inst, drawMonth, drawYear, minDate, maxDate,
                            row > 0 || col > 0, monthNames, monthNamesShort) + // draw month headers
                        "</div><table class='ui-datepicker-calendar'><thead>" +
                        "<tr>";
                    thead = (showWeek ? "<th class='ui-datepicker-week-col'>" + this._get(inst, "weekHeader") + "</th>" : "");
                    for (dow = 0; dow < 7; dow++) { // days of the week
                        day = (dow + firstDay) % 7;
                        thead += "<th scope='col'" + ((dow + firstDay + 6) % 7 >= 5 ? " class='ui-datepicker-week-end'" : "") + ">" +
                            "<span title='" + dayNames[day] + "'>" + dayNamesMin[day] + "</span></th>";
                    }
                    calender += thead + "</tr></thead><tbody>";
                    daysInMonth = this._getDaysInMonth(drawYear, drawMonth);
                    if (drawYear === inst.selectedYear && drawMonth === inst.selectedMonth) {
                        inst.selectedDay = Math.min(inst.selectedDay, daysInMonth);
                    }
                    leadDays = (this._getFirstDayOfMonth(drawYear, drawMonth) - firstDay + 7) % 7;
                    curRows = Math.ceil((leadDays + daysInMonth) / 7); // calculate the number of rows to generate
                    numRows = (isMultiMonth ? this.maxRows > curRows ? this.maxRows : curRows : curRows); //If multiple months, use the higher number of rows (see #7043)
                    this.maxRows = numRows;
                    printDate = this._daylightSavingAdjust(new Date(drawYear, drawMonth, 1 - leadDays));
                    for (dRow = 0; dRow < numRows; dRow++) { // create date picker rows
                        calender += "<tr>";
                        tbody = (!showWeek ? "" : "<td class='ui-datepicker-week-col'>" +
                            this._get(inst, "calculateWeek")(printDate) + "</td>");
                        for (dow = 0; dow < 7; dow++) { // create date picker days
                            daySettings = (beforeShowDay ?
                                beforeShowDay.apply((inst.input ? inst.input[0] : null), [printDate]) : [true, ""]);
                            otherMonth = (printDate.getMonth() !== drawMonth);
                            unselectable = (otherMonth && !selectOtherMonths) || !daySettings[0] ||
                                (minDate && printDate < minDate) || (maxDate && printDate > maxDate);
                            tbody += "<td class='" +
                                ((dow + firstDay + 6) % 7 >= 5 ? " ui-datepicker-week-end" : "") + // highlight weekends
                                (otherMonth ? " ui-datepicker-other-month" : "") + // highlight days from other months
                                ((printDate.getTime() === selectedDate.getTime() && drawMonth === inst.selectedMonth && inst._keyEvent) || // user pressed key
                                    (defaultDate.getTime() === printDate.getTime() && defaultDate.getTime() === selectedDate.getTime()) ?

                                    // or defaultDate is current printedDate and defaultDate is selectedDate
                                    " " + this._dayOverClass : "") + // highlight selected day
                                (unselectable ? " " + this._unselectableClass + " ui-state-disabled" : "") +  // highlight unselectable days
                                (otherMonth && !showOtherMonths ? "" : " " + daySettings[1] + // highlight custom dates
                                    (printDate.getTime() === currentDate.getTime() ? " " + this._currentClass : "") + // highlight selected day
                                    (printDate.getTime() === today.getTime() ? " ui-datepicker-today" : "")) + "'" + // highlight today (if different)
                                ((!otherMonth || showOtherMonths) && daySettings[2] ? " title='" + daySettings[2].replace(/'/g, "&#39;") + "'" : "") + // cell title
                                (unselectable ? "" : " data-handler='selectDay' data-event='click' data-month='" + printDate.getMonth() + "' data-year='" + printDate.getFullYear() + "'") + ">" + // actions
                                (otherMonth && !showOtherMonths ? "&#xa0;" : // display for other months
                                    (unselectable ? "<span class='ui-state-default'>" + printDate.getDate() + "</span>" : "<a class='ui-state-default" +
                                        (printDate.getTime() === today.getTime() ? " ui-state-highlight" : "") +
                                        (printDate.getTime() === currentDate.getTime() ? " ui-state-active" : "") + // highlight selected day
                                        (otherMonth ? " ui-priority-secondary" : "") + // distinguish dates from other months
                                        "' href='#'>" + printDate.getDate() + "</a>")) + "</td>"; // display selectable date
                            printDate.setDate(printDate.getDate() + 1);
                            printDate = this._daylightSavingAdjust(printDate);
                        }
                        calender += tbody + "</tr>";
                    }
                    drawMonth++;
                    if (drawMonth > 11) {
                        drawMonth = 0;
                        drawYear++;
                    }
                    calender += "</tbody></table>" + (isMultiMonth ? "</div>" +
                        ((numMonths[0] > 0 && col === numMonths[1] - 1) ? "<div class='ui-datepicker-row-break'></div>" : "") : "");
                    group += calender;
                }
                html += group;
            }
            html += buttonPanel;
            inst._keyEvent = false;
            return html;
        },

        /* Generate the month and year header. */
        _generateMonthYearHeader: function (inst, drawMonth, drawYear, minDate, maxDate,
            secondary, monthNames, monthNamesShort) {

            var inMinYear, inMaxYear, month, years, thisYear, determineYear, year, endYear,
                changeMonth = this._get(inst, "changeMonth"),
                changeYear = this._get(inst, "changeYear"),
                showMonthAfterYear = this._get(inst, "showMonthAfterYear"),
                html = "<div class='ui-datepicker-title'>",
                monthHtml = "";

            // Month selection
            if (secondary || !changeMonth) {
                monthHtml += "<span class='ui-datepicker-month'>" + monthNames[drawMonth] + "</span>";
            } else {
                inMinYear = (minDate && minDate.getFullYear() === drawYear);
                inMaxYear = (maxDate && maxDate.getFullYear() === drawYear);
                monthHtml += "<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";
                for (month = 0; month < 12; month++) {
                    if ((!inMinYear || month >= minDate.getMonth()) && (!inMaxYear || month <= maxDate.getMonth())) {
                        monthHtml += "<option value='" + month + "'" +
                            (month === drawMonth ? " selected='selected'" : "") +
                            ">" + monthNamesShort[month] + "</option>";
                    }
                }
                monthHtml += "</select>";
            }

            if (!showMonthAfterYear) {
                html += monthHtml + (secondary || !(changeMonth && changeYear) ? "&#xa0;" : "");
            }

            // Year selection
            if (!inst.yearshtml) {
                inst.yearshtml = "";
                if (secondary || !changeYear) {
                    html += "<span class='ui-datepicker-year'>" + drawYear + "</span>";
                } else {

                    // determine range of years to display
                    years = this._get(inst, "yearRange").split(":");
                    thisYear = new Date().getFullYear();
                    determineYear = function (value) {
                        var year = (value.match(/c[+\-].*/) ? drawYear + parseInt(value.substring(1), 10) :
                            (value.match(/[+\-].*/) ? thisYear + parseInt(value, 10) :
                                parseInt(value, 10)));
                        return (isNaN(year) ? thisYear : year);
                    };
                    year = determineYear(years[0]);
                    endYear = Math.max(year, determineYear(years[1] || ""));
                    year = (minDate ? Math.max(year, minDate.getFullYear()) : year);
                    endYear = (maxDate ? Math.min(endYear, maxDate.getFullYear()) : endYear);
                    inst.yearshtml += "<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";
                    for (; year <= endYear; year++) {
                        inst.yearshtml += "<option value='" + year + "'" +
                            (year === drawYear ? " selected='selected'" : "") +
                            ">" + year + "</option>";
                    }
                    inst.yearshtml += "</select>";

                    html += inst.yearshtml;
                    inst.yearshtml = null;
                }
            }

            html += this._get(inst, "yearSuffix");
            if (showMonthAfterYear) {
                html += (secondary || !(changeMonth && changeYear) ? "&#xa0;" : "") + monthHtml;
            }
            html += "</div>"; // Close datepicker_header
            return html;
        },

        /* Adjust one of the date sub-fields. */
        _adjustInstDate: function (inst, offset, period) {
            var year = inst.selectedYear + (period === "Y" ? offset : 0),
                month = inst.selectedMonth + (period === "M" ? offset : 0),
                day = Math.min(inst.selectedDay, this._getDaysInMonth(year, month)) + (period === "D" ? offset : 0),
                date = this._restrictMinMax(inst, this._daylightSavingAdjust(new Date(year, month, day)));

            inst.selectedDay = date.getDate();
            inst.drawMonth = inst.selectedMonth = date.getMonth();
            inst.drawYear = inst.selectedYear = date.getFullYear();
            if (period === "M" || period === "Y") {
                this._notifyChange(inst);
            }
        },

        /* Ensure a date is within any min/max bounds. */
        _restrictMinMax: function (inst, date) {
            var minDate = this._getMinMaxDate(inst, "min"),
                maxDate = this._getMinMaxDate(inst, "max"),
                newDate = (minDate && date < minDate ? minDate : date);
            return (maxDate && newDate > maxDate ? maxDate : newDate);
        },

        /* Notify change of month/year. */
        _notifyChange: function (inst) {
            var onChange = this._get(inst, "onChangeMonthYear");
            if (onChange) {
                onChange.apply((inst.input ? inst.input[0] : null),
                    [inst.selectedYear, inst.selectedMonth + 1, inst]);
            }
        },

        /* Determine the number of months to show. */
        _getNumberOfMonths: function (inst) {
            var numMonths = this._get(inst, "numberOfMonths");
            return (numMonths == null ? [1, 1] : (typeof numMonths === "number" ? [1, numMonths] : numMonths));
        },

        /* Determine the current maximum date - ensure no time components are set. */
        _getMinMaxDate: function (inst, minMax) {
            return this._determineDate(inst, this._get(inst, minMax + "Date"), null);
        },

        /* Find the number of days in a given month. */
        _getDaysInMonth: function (year, month) {
            return 32 - this._daylightSavingAdjust(new Date(year, month, 32)).getDate();
        },

        /* Find the day of the week of the first of a month. */
        _getFirstDayOfMonth: function (year, month) {
            return new Date(year, month, 1).getDay();
        },

        /* Determines if we should allow a "next/prev" month display change. */
        _canAdjustMonth: function (inst, offset, curYear, curMonth) {
            var numMonths = this._getNumberOfMonths(inst),
                date = this._daylightSavingAdjust(new Date(curYear,
                    curMonth + (offset < 0 ? offset : numMonths[0] * numMonths[1]), 1));

            if (offset < 0) {
                date.setDate(this._getDaysInMonth(date.getFullYear(), date.getMonth()));
            }
            return this._isInRange(inst, date);
        },

        /* Is the given date in the accepted range? */
        _isInRange: function (inst, date) {
            var yearSplit, currentYear,
                minDate = this._getMinMaxDate(inst, "min"),
                maxDate = this._getMinMaxDate(inst, "max"),
                minYear = null,
                maxYear = null,
                years = this._get(inst, "yearRange");
            if (years) {
                yearSplit = years.split(":");
                currentYear = new Date().getFullYear();
                minYear = parseInt(yearSplit[0], 10);
                maxYear = parseInt(yearSplit[1], 10);
                if (yearSplit[0].match(/[+\-].*/)) {
                    minYear += currentYear;
                }
                if (yearSplit[1].match(/[+\-].*/)) {
                    maxYear += currentYear;
                }
            }

            return ((!minDate || date.getTime() >= minDate.getTime()) &&
                (!maxDate || date.getTime() <= maxDate.getTime()) &&
                (!minYear || date.getFullYear() >= minYear) &&
                (!maxYear || date.getFullYear() <= maxYear));
        },

        /* Provide the configuration settings for formatting/parsing. */
        _getFormatConfig: function (inst) {
            var shortYearCutoff = this._get(inst, "shortYearCutoff");
            shortYearCutoff = (typeof shortYearCutoff !== "string" ? shortYearCutoff :
                new Date().getFullYear() % 100 + parseInt(shortYearCutoff, 10));
            return {
                shortYearCutoff: shortYearCutoff,
                dayNamesShort: this._get(inst, "dayNamesShort"), dayNames: this._get(inst, "dayNames"),
                monthNamesShort: this._get(inst, "monthNamesShort"), monthNames: this._get(inst, "monthNames")
            };
        },

        /* Format the given date for display. */
        _formatDate: function (inst, day, month, year) {
            if (!day) {
                inst.currentDay = inst.selectedDay;
                inst.currentMonth = inst.selectedMonth;
                inst.currentYear = inst.selectedYear;
            }
            var date = (day ? (typeof day === "object" ? day :
                this._daylightSavingAdjust(new Date(year, month, day))) :
                this._daylightSavingAdjust(new Date(inst.currentYear, inst.currentMonth, inst.currentDay)));
            return this.formatDate(this._get(inst, "dateFormat"), date, this._getFormatConfig(inst));
        }
    });

    /*
     * Bind hover events for datepicker elements.
     * Done via delegate so the binding only occurs once in the lifetime of the parent div.
     * Global datepicker_instActive, set by _updateDatepicker allows the handlers to find their way back to the active picker.
     */
    function datepicker_bindHover(dpDiv) {
        var selector = "button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";
        return dpDiv.on("mouseout", selector, function () {
            $(this).removeClass("ui-state-hover");
            if (this.className.indexOf("ui-datepicker-prev") !== -1) {
                $(this).removeClass("ui-datepicker-prev-hover");
            }
            if (this.className.indexOf("ui-datepicker-next") !== -1) {
                $(this).removeClass("ui-datepicker-next-hover");
            }
        })
            .on("mouseover", selector, datepicker_handleMouseover);
    }

    function datepicker_handleMouseover() {
        if (!$.datepicker._isDisabledDatepicker(datepicker_instActive.inline ? datepicker_instActive.dpDiv.parent()[0] : datepicker_instActive.input[0])) {
            $(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");
            $(this).addClass("ui-state-hover");
            if (this.className.indexOf("ui-datepicker-prev") !== -1) {
                $(this).addClass("ui-datepicker-prev-hover");
            }
            if (this.className.indexOf("ui-datepicker-next") !== -1) {
                $(this).addClass("ui-datepicker-next-hover");
            }
        }
    }

    /* jQuery extend now ignores nulls! */
    function datepicker_extendRemove(target, props) {
        $.extend(target, props);
        for (var name in props) {
            if (props[name] == null) {
                target[name] = props[name];
            }
        }
        return target;
    }

    /* Invoke the datepicker functionality.
       @param  options  string - a command, optionally followed by additional parameters or
                        Object - settings for attaching new datepicker functionality
       @return  jQuery object */
    $.fn.datepicker = function (options) {

        /* Verify an empty collection wasn't passed - Fixes #6976 */
        if (!this.length) {
            return this;
        }

        /* Initialise the date picker. */
        if (!$.datepicker.initialized) {
            $(document).on("mousedown", $.datepicker._checkExternalClick);
            $.datepicker.initialized = true;
        }

        /* Append datepicker main container to body if not exist. */
        if ($("#" + $.datepicker._mainDivId).length === 0) {
            $("body").append($.datepicker.dpDiv);
        }

        var otherArgs = Array.prototype.slice.call(arguments, 1);
        if (typeof options === "string" && (options === "isDisabled" || options === "getDate" || options === "widget")) {
            return $.datepicker["_" + options + "Datepicker"].
                apply($.datepicker, [this[0]].concat(otherArgs));
        }
        if (options === "option" && arguments.length === 2 && typeof arguments[1] === "string") {
            return $.datepicker["_" + options + "Datepicker"].
                apply($.datepicker, [this[0]].concat(otherArgs));
        }
        return this.each(function () {
            typeof options === "string" ?
                $.datepicker["_" + options + "Datepicker"].
                    apply($.datepicker, [this].concat(otherArgs)) :
                $.datepicker._attachDatepicker(this, options);
        });
    };

    $.datepicker = new Datepicker(); // singleton instance
    $.datepicker.initialized = false;
    $.datepicker.uuid = new Date().getTime();
    $.datepicker.version = "1.12.1";

    var widgetsDatepicker = $.datepicker;


    /*!
     * jQuery UI Dialog 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Dialog
    //>>group: Widgets
    //>>description: Displays customizable dialog windows.
    //>>docs: http://api.jqueryui.com/dialog/
    //>>demos: http://jqueryui.com/dialog/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/dialog.css
    //>>css.theme: ../../themes/base/theme.css



    $.widget("ui.dialog", {
        version: "1.12.1",
        options: {
            appendTo: "body",
            autoOpen: true,
            buttons: [],
            classes: {
                "ui-dialog": "ui-corner-all",
                "ui-dialog-titlebar": "ui-corner-all"
            },
            closeOnEscape: true,
            closeText: "Close",
            draggable: true,
            hide: null,
            height: "auto",
            maxHeight: null,
            maxWidth: null,
            minHeight: 150,
            minWidth: 150,
            modal: false,
            position: {
                my: "center",
                at: "center",
                of: window,
                collision: "fit",

                // Ensure the titlebar is always visible
                using: function (pos) {
                    var topOffset = $(this).css(pos).offset().top;
                    if (topOffset < 0) {
                        $(this).css("top", pos.top - topOffset);
                    }
                }
            },
            resizable: true,
            show: null,
            title: null,
            width: 300,

            // Callbacks
            beforeClose: null,
            close: null,
            drag: null,
            dragStart: null,
            dragStop: null,
            focus: null,
            open: null,
            resize: null,
            resizeStart: null,
            resizeStop: null
        },

        sizeRelatedOptions: {
            buttons: true,
            height: true,
            maxHeight: true,
            maxWidth: true,
            minHeight: true,
            minWidth: true,
            width: true
        },

        resizableRelatedOptions: {
            maxHeight: true,
            maxWidth: true,
            minHeight: true,
            minWidth: true
        },

        _create: function () {
            this.originalCss = {
                display: this.element[0].style.display,
                width: this.element[0].style.width,
                minHeight: this.element[0].style.minHeight,
                maxHeight: this.element[0].style.maxHeight,
                height: this.element[0].style.height
            };
            this.originalPosition = {
                parent: this.element.parent(),
                index: this.element.parent().children().index(this.element)
            };
            this.originalTitle = this.element.attr("title");
            if (this.options.title == null && this.originalTitle != null) {
                this.options.title = this.originalTitle;
            }

            // Dialogs can't be disabled
            if (this.options.disabled) {
                this.options.disabled = false;
            }

            this._createWrapper();

            this.element
                .show()
                .removeAttr("title")
                .appendTo(this.uiDialog);

            this._addClass("ui-dialog-content", "ui-widget-content");

            this._createTitlebar();
            this._createButtonPane();

            if (this.options.draggable && $.fn.draggable) {
                this._makeDraggable();
            }
            if (this.options.resizable && $.fn.resizable) {
                this._makeResizable();
            }

            this._isOpen = false;

            this._trackFocus();
        },

        _init: function () {
            if (this.options.autoOpen) {
                this.open();
            }
        },

        _appendTo: function () {
            var element = this.options.appendTo;
            if (element && (element.jquery || element.nodeType)) {
                return $(element);
            }
            return this.document.find(element || "body").eq(0);
        },

        _destroy: function () {
            var next,
                originalPosition = this.originalPosition;

            this._untrackInstance();
            this._destroyOverlay();

            this.element
                .removeUniqueId()
                .css(this.originalCss)

                // Without detaching first, the following becomes really slow
                .detach();

            this.uiDialog.remove();

            if (this.originalTitle) {
                this.element.attr("title", this.originalTitle);
            }

            next = originalPosition.parent.children().eq(originalPosition.index);

            // Don't try to place the dialog next to itself (#8613)
            if (next.length && next[0] !== this.element[0]) {
                next.before(this.element);
            } else {
                originalPosition.parent.append(this.element);
            }
        },

        widget: function () {
            return this.uiDialog;
        },

        disable: $.noop,
        enable: $.noop,

        close: function (event) {
            var that = this;

            if (!this._isOpen || this._trigger("beforeClose", event) === false) {
                return;
            }

            this._isOpen = false;
            this._focusedElement = null;
            this._destroyOverlay();
            this._untrackInstance();

            if (!this.opener.filter(":focusable").trigger("focus").length) {

                // Hiding a focused element doesn't trigger blur in WebKit
                // so in case we have nothing to focus on, explicitly blur the active element
                // https://bugs.webkit.org/show_bug.cgi?id=47182
                $.ui.safeBlur($.ui.safeActiveElement(this.document[0]));
            }

            this._hide(this.uiDialog, this.options.hide, function () {
                that._trigger("close", event);
            });
        },

        isOpen: function () {
            return this._isOpen;
        },

        moveToTop: function () {
            this._moveToTop();
        },

        _moveToTop: function (event, silent) {
            var moved = false,
                zIndices = this.uiDialog.siblings(".ui-front:visible").map(function () {
                    return +$(this).css("z-index");
                }).get(),
                zIndexMax = Math.max.apply(null, zIndices);

            if (zIndexMax >= +this.uiDialog.css("z-index")) {
                this.uiDialog.css("z-index", zIndexMax + 1);
                moved = true;
            }

            if (moved && !silent) {
                this._trigger("focus", event);
            }
            return moved;
        },

        open: function () {
            var that = this;
            if (this._isOpen) {
                if (this._moveToTop()) {
                    this._focusTabbable();
                }
                return;
            }

            this._isOpen = true;
            this.opener = $($.ui.safeActiveElement(this.document[0]));

            this._size();
            this._position();
            this._createOverlay();
            this._moveToTop(null, true);

            // Ensure the overlay is moved to the top with the dialog, but only when
            // opening. The overlay shouldn't move after the dialog is open so that
            // modeless dialogs opened after the modal dialog stack properly.
            if (this.overlay) {
                this.overlay.css("z-index", this.uiDialog.css("z-index") - 1);
            }

            this._show(this.uiDialog, this.options.show, function () {
                that._focusTabbable();
                that._trigger("focus");
            });

            // Track the dialog immediately upon openening in case a focus event
            // somehow occurs outside of the dialog before an element inside the
            // dialog is focused (#10152)
            this._makeFocusTarget();

            this._trigger("open");
        },

        _focusTabbable: function () {

            // Set focus to the first match:
            // 1. An element that was focused previously
            // 2. First element inside the dialog matching [autofocus]
            // 3. Tabbable element inside the content element
            // 4. Tabbable element inside the buttonpane
            // 5. The close button
            // 6. The dialog itself
            var hasFocus = this._focusedElement;
            if (!hasFocus) {
                hasFocus = this.element.find("[autofocus]");
            }
            if (!hasFocus.length) {
                hasFocus = this.element.find(":tabbable");
            }
            if (!hasFocus.length) {
                hasFocus = this.uiDialogButtonPane.find(":tabbable");
            }
            if (!hasFocus.length) {
                hasFocus = this.uiDialogTitlebarClose.filter(":tabbable");
            }
            if (!hasFocus.length) {
                hasFocus = this.uiDialog;
            }
            hasFocus.eq(0).trigger("focus");
        },

        _keepFocus: function (event) {
            function checkFocus() {
                var activeElement = $.ui.safeActiveElement(this.document[0]),
                    isActive = this.uiDialog[0] === activeElement ||
                        $.contains(this.uiDialog[0], activeElement);
                if (!isActive) {
                    this._focusTabbable();
                }
            }
            event.preventDefault();
            checkFocus.call(this);

            // support: IE
            // IE <= 8 doesn't prevent moving focus even with event.preventDefault()
            // so we check again later
            this._delay(checkFocus);
        },

        _createWrapper: function () {
            this.uiDialog = $("<div>")
                .hide()
                .attr({

                    // Setting tabIndex makes the div focusable
                    tabIndex: -1,
                    role: "dialog"
                })
                .appendTo(this._appendTo());

            this._addClass(this.uiDialog, "ui-dialog", "ui-widget ui-widget-content ui-front");
            this._on(this.uiDialog, {
                keydown: function (event) {
                    if (this.options.closeOnEscape && !event.isDefaultPrevented() && event.keyCode &&
                        event.keyCode === $.ui.keyCode.ESCAPE) {
                        event.preventDefault();
                        this.close(event);
                        return;
                    }

                    // Prevent tabbing out of dialogs
                    if (event.keyCode !== $.ui.keyCode.TAB || event.isDefaultPrevented()) {
                        return;
                    }
                    var tabbables = this.uiDialog.find(":tabbable"),
                        first = tabbables.filter(":first"),
                        last = tabbables.filter(":last");

                    if ((event.target === last[0] || event.target === this.uiDialog[0]) &&
                        !event.shiftKey) {
                        this._delay(function () {
                            first.trigger("focus");
                        });
                        event.preventDefault();
                    } else if ((event.target === first[0] ||
                        event.target === this.uiDialog[0]) && event.shiftKey) {
                        this._delay(function () {
                            last.trigger("focus");
                        });
                        event.preventDefault();
                    }
                },
                mousedown: function (event) {
                    if (this._moveToTop(event)) {
                        this._focusTabbable();
                    }
                }
            });

            // We assume that any existing aria-describedby attribute means
            // that the dialog content is marked up properly
            // otherwise we brute force the content as the description
            if (!this.element.find("[aria-describedby]").length) {
                this.uiDialog.attr({
                    "aria-describedby": this.element.uniqueId().attr("id")
                });
            }
        },

        _createTitlebar: function () {
            var uiDialogTitle;

            this.uiDialogTitlebar = $("<div>");
            this._addClass(this.uiDialogTitlebar,
                "ui-dialog-titlebar", "ui-widget-header ui-helper-clearfix");
            this._on(this.uiDialogTitlebar, {
                mousedown: function (event) {

                    // Don't prevent click on close button (#8838)
                    // Focusing a dialog that is partially scrolled out of view
                    // causes the browser to scroll it into view, preventing the click event
                    if (!$(event.target).closest(".ui-dialog-titlebar-close")) {

                        // Dialog isn't getting focus when dragging (#8063)
                        this.uiDialog.trigger("focus");
                    }
                }
            });

            // Support: IE
            // Use type="button" to prevent enter keypresses in textboxes from closing the
            // dialog in IE (#9312)
            this.uiDialogTitlebarClose = $("<button type='button'></button>")
                .button({
                    label: $("<a>").text(this.options.closeText).html(),
                    icon: "ui-icon-closethick",
                    showLabel: false
                })
                .appendTo(this.uiDialogTitlebar);

            this._addClass(this.uiDialogTitlebarClose, "ui-dialog-titlebar-close");
            this._on(this.uiDialogTitlebarClose, {
                click: function (event) {
                    event.preventDefault();
                    this.close(event);
                }
            });

            uiDialogTitle = $("<span>").uniqueId().prependTo(this.uiDialogTitlebar);
            this._addClass(uiDialogTitle, "ui-dialog-title");
            this._title(uiDialogTitle);

            this.uiDialogTitlebar.prependTo(this.uiDialog);

            this.uiDialog.attr({
                "aria-labelledby": uiDialogTitle.attr("id")
            });
        },

        _title: function (title) {
            if (this.options.title) {
                title.text(this.options.title);
            } else {
                title.html("&#160;");
            }
        },

        _createButtonPane: function () {
            this.uiDialogButtonPane = $("<div>");
            this._addClass(this.uiDialogButtonPane, "ui-dialog-buttonpane",
                "ui-widget-content ui-helper-clearfix");

            this.uiButtonSet = $("<div>")
                .appendTo(this.uiDialogButtonPane);
            this._addClass(this.uiButtonSet, "ui-dialog-buttonset");

            this._createButtons();
        },

        _createButtons: function () {
            var that = this,
                buttons = this.options.buttons;

            // If we already have a button pane, remove it
            this.uiDialogButtonPane.remove();
            this.uiButtonSet.empty();

            if ($.isEmptyObject(buttons) || ($.isArray(buttons) && !buttons.length)) {
                this._removeClass(this.uiDialog, "ui-dialog-buttons");
                return;
            }

            $.each(buttons, function (name, props) {
                var click, buttonOptions;
                props = $.isFunction(props) ?
                    { click: props, text: name } :
                    props;

                // Default to a non-submitting button
                props = $.extend({ type: "button" }, props);

                // Change the context for the click callback to be the main element
                click = props.click;
                buttonOptions = {
                    icon: props.icon,
                    iconPosition: props.iconPosition,
                    showLabel: props.showLabel,

                    // Deprecated options
                    icons: props.icons,
                    text: props.text
                };

                delete props.click;
                delete props.icon;
                delete props.iconPosition;
                delete props.showLabel;

                // Deprecated options
                delete props.icons;
                if (typeof props.text === "boolean") {
                    delete props.text;
                }

                $("<button></button>", props)
                    .button(buttonOptions)
                    .appendTo(that.uiButtonSet)
                    .on("click", function () {
                        click.apply(that.element[0], arguments);
                    });
            });
            this._addClass(this.uiDialog, "ui-dialog-buttons");
            this.uiDialogButtonPane.appendTo(this.uiDialog);
        },

        _makeDraggable: function () {
            var that = this,
                options = this.options;

            function filteredUi(ui) {
                return {
                    position: ui.position,
                    offset: ui.offset
                };
            }

            this.uiDialog.draggable({
                cancel: ".ui-dialog-content, .ui-dialog-titlebar-close",
                handle: ".ui-dialog-titlebar",
                containment: "document",
                start: function (event, ui) {
                    that._addClass($(this), "ui-dialog-dragging");
                    that._blockFrames();
                    that._trigger("dragStart", event, filteredUi(ui));
                },
                drag: function (event, ui) {
                    that._trigger("drag", event, filteredUi(ui));
                },
                stop: function (event, ui) {
                    var left = ui.offset.left - that.document.scrollLeft(),
                        top = ui.offset.top - that.document.scrollTop();

                    options.position = {
                        my: "left top",
                        at: "left" + (left >= 0 ? "+" : "") + left + " " +
                            "top" + (top >= 0 ? "+" : "") + top,
                        of: that.window
                    };
                    that._removeClass($(this), "ui-dialog-dragging");
                    that._unblockFrames();
                    that._trigger("dragStop", event, filteredUi(ui));
                }
            });
        },

        _makeResizable: function () {
            var that = this,
                options = this.options,
                handles = options.resizable,

                // .ui-resizable has position: relative defined in the stylesheet
                // but dialogs have to use absolute or fixed positioning
                position = this.uiDialog.css("position"),
                resizeHandles = typeof handles === "string" ?
                    handles :
                    "n,e,s,w,se,sw,ne,nw";

            function filteredUi(ui) {
                return {
                    originalPosition: ui.originalPosition,
                    originalSize: ui.originalSize,
                    position: ui.position,
                    size: ui.size
                };
            }

            this.uiDialog.resizable({
                cancel: ".ui-dialog-content",
                containment: "document",
                alsoResize: this.element,
                maxWidth: options.maxWidth,
                maxHeight: options.maxHeight,
                minWidth: options.minWidth,
                minHeight: this._minHeight(),
                handles: resizeHandles,
                start: function (event, ui) {
                    that._addClass($(this), "ui-dialog-resizing");
                    that._blockFrames();
                    that._trigger("resizeStart", event, filteredUi(ui));
                },
                resize: function (event, ui) {
                    that._trigger("resize", event, filteredUi(ui));
                },
                stop: function (event, ui) {
                    var offset = that.uiDialog.offset(),
                        left = offset.left - that.document.scrollLeft(),
                        top = offset.top - that.document.scrollTop();

                    options.height = that.uiDialog.height();
                    options.width = that.uiDialog.width();
                    options.position = {
                        my: "left top",
                        at: "left" + (left >= 0 ? "+" : "") + left + " " +
                            "top" + (top >= 0 ? "+" : "") + top,
                        of: that.window
                    };
                    that._removeClass($(this), "ui-dialog-resizing");
                    that._unblockFrames();
                    that._trigger("resizeStop", event, filteredUi(ui));
                }
            })
                .css("position", position);
        },

        _trackFocus: function () {
            this._on(this.widget(), {
                focusin: function (event) {
                    this._makeFocusTarget();
                    this._focusedElement = $(event.target);
                }
            });
        },

        _makeFocusTarget: function () {
            this._untrackInstance();
            this._trackingInstances().unshift(this);
        },

        _untrackInstance: function () {
            var instances = this._trackingInstances(),
                exists = $.inArray(this, instances);
            if (exists !== -1) {
                instances.splice(exists, 1);
            }
        },

        _trackingInstances: function () {
            var instances = this.document.data("ui-dialog-instances");
            if (!instances) {
                instances = [];
                this.document.data("ui-dialog-instances", instances);
            }
            return instances;
        },

        _minHeight: function () {
            var options = this.options;

            return options.height === "auto" ?
                options.minHeight :
                Math.min(options.minHeight, options.height);
        },

        _position: function () {

            // Need to show the dialog to get the actual offset in the position plugin
            var isVisible = this.uiDialog.is(":visible");
            if (!isVisible) {
                this.uiDialog.show();
            }
            this.uiDialog.position(this.options.position);
            if (!isVisible) {
                this.uiDialog.hide();
            }
        },

        _setOptions: function (options) {
            var that = this,
                resize = false,
                resizableOptions = {};

            $.each(options, function (key, value) {
                that._setOption(key, value);

                if (key in that.sizeRelatedOptions) {
                    resize = true;
                }
                if (key in that.resizableRelatedOptions) {
                    resizableOptions[key] = value;
                }
            });

            if (resize) {
                this._size();
                this._position();
            }
            if (this.uiDialog.is(":data(ui-resizable)")) {
                this.uiDialog.resizable("option", resizableOptions);
            }
        },

        _setOption: function (key, value) {
            var isDraggable, isResizable,
                uiDialog = this.uiDialog;

            if (key === "disabled") {
                return;
            }

            this._super(key, value);

            if (key === "appendTo") {
                this.uiDialog.appendTo(this._appendTo());
            }

            if (key === "buttons") {
                this._createButtons();
            }

            if (key === "closeText") {
                this.uiDialogTitlebarClose.button({

                    // Ensure that we always pass a string
                    label: $("<a>").text("" + this.options.closeText).html()
                });
            }

            if (key === "draggable") {
                isDraggable = uiDialog.is(":data(ui-draggable)");
                if (isDraggable && !value) {
                    uiDialog.draggable("destroy");
                }

                if (!isDraggable && value) {
                    this._makeDraggable();
                }
            }

            if (key === "position") {
                this._position();
            }

            if (key === "resizable") {

                // currently resizable, becoming non-resizable
                isResizable = uiDialog.is(":data(ui-resizable)");
                if (isResizable && !value) {
                    uiDialog.resizable("destroy");
                }

                // Currently resizable, changing handles
                if (isResizable && typeof value === "string") {
                    uiDialog.resizable("option", "handles", value);
                }

                // Currently non-resizable, becoming resizable
                if (!isResizable && value !== false) {
                    this._makeResizable();
                }
            }

            if (key === "title") {
                this._title(this.uiDialogTitlebar.find(".ui-dialog-title"));
            }
        },

        _size: function () {

            // If the user has resized the dialog, the .ui-dialog and .ui-dialog-content
            // divs will both have width and height set, so we need to reset them
            var nonContentHeight, minContentHeight, maxContentHeight,
                options = this.options;

            // Reset content sizing
            this.element.show().css({
                width: "auto",
                minHeight: 0,
                maxHeight: "none",
                height: 0
            });

            if (options.minWidth > options.width) {
                options.width = options.minWidth;
            }

            // Reset wrapper sizing
            // determine the height of all the non-content elements
            nonContentHeight = this.uiDialog.css({
                height: "auto",
                width: options.width
            })
                .outerHeight();
            minContentHeight = Math.max(0, options.minHeight - nonContentHeight);
            maxContentHeight = typeof options.maxHeight === "number" ?
                Math.max(0, options.maxHeight - nonContentHeight) :
                "none";

            if (options.height === "auto") {
                this.element.css({
                    minHeight: minContentHeight,
                    maxHeight: maxContentHeight,
                    height: "auto"
                });
            } else {
                this.element.height(Math.max(0, options.height - nonContentHeight));
            }

            if (this.uiDialog.is(":data(ui-resizable)")) {
                this.uiDialog.resizable("option", "minHeight", this._minHeight());
            }
        },

        _blockFrames: function () {
            this.iframeBlocks = this.document.find("iframe").map(function () {
                var iframe = $(this);

                return $("<div>")
                    .css({
                        position: "absolute",
                        width: iframe.outerWidth(),
                        height: iframe.outerHeight()
                    })
                    .appendTo(iframe.parent())
                    .offset(iframe.offset())[0];
            });
        },

        _unblockFrames: function () {
            if (this.iframeBlocks) {
                this.iframeBlocks.remove();
                delete this.iframeBlocks;
            }
        },

        _allowInteraction: function (event) {
            if ($(event.target).closest(".ui-dialog").length) {
                return true;
            }

            // TODO: Remove hack when datepicker implements
            // the .ui-front logic (#8989)
            return !!$(event.target).closest(".ui-datepicker").length;
        },

        _createOverlay: function () {
            if (!this.options.modal) {
                return;
            }

            // We use a delay in case the overlay is created from an
            // event that we're going to be cancelling (#2804)
            var isOpening = true;
            this._delay(function () {
                isOpening = false;
            });

            if (!this.document.data("ui-dialog-overlays")) {

                // Prevent use of anchors and inputs
                // Using _on() for an event handler shared across many instances is
                // safe because the dialogs stack and must be closed in reverse order
                this._on(this.document, {
                    focusin: function (event) {
                        if (isOpening) {
                            return;
                        }

                        if (!this._allowInteraction(event)) {
                            event.preventDefault();
                            this._trackingInstances()[0]._focusTabbable();
                        }
                    }
                });
            }

            this.overlay = $("<div>")
                .appendTo(this._appendTo());

            this._addClass(this.overlay, null, "ui-widget-overlay ui-front");
            this._on(this.overlay, {
                mousedown: "_keepFocus"
            });
            this.document.data("ui-dialog-overlays",
                (this.document.data("ui-dialog-overlays") || 0) + 1);
        },

        _destroyOverlay: function () {
            if (!this.options.modal) {
                return;
            }

            if (this.overlay) {
                var overlays = this.document.data("ui-dialog-overlays") - 1;

                if (!overlays) {
                    this._off(this.document, "focusin");
                    this.document.removeData("ui-dialog-overlays");
                } else {
                    this.document.data("ui-dialog-overlays", overlays);
                }

                this.overlay.remove();
                this.overlay = null;
            }
        }
    });

    // DEPRECATED
    // TODO: switch return back to widget declaration at top of file when this is removed
    if ($.uiBackCompat !== false) {

        // Backcompat for dialogClass option
        $.widget("ui.dialog", $.ui.dialog, {
            options: {
                dialogClass: ""
            },
            _createWrapper: function () {
                this._super();
                this.uiDialog.addClass(this.options.dialogClass);
            },
            _setOption: function (key, value) {
                if (key === "dialogClass") {
                    this.uiDialog
                        .removeClass(this.options.dialogClass)
                        .addClass(value);
                }
                this._superApply(arguments);
            }
        });
    }

    var widgetsDialog = $.ui.dialog;


    /*!
     * jQuery UI Progressbar 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Progressbar
    //>>group: Widgets
    // jscs:disable maximumLineLength
    //>>description: Displays a status indicator for loading state, standard percentage, and other progress indicators.
    // jscs:enable maximumLineLength
    //>>docs: http://api.jqueryui.com/progressbar/
    //>>demos: http://jqueryui.com/progressbar/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/progressbar.css
    //>>css.theme: ../../themes/base/theme.css



    var widgetsProgressbar = $.widget("ui.progressbar", {
        version: "1.12.1",
        options: {
            classes: {
                "ui-progressbar": "ui-corner-all",
                "ui-progressbar-value": "ui-corner-left",
                "ui-progressbar-complete": "ui-corner-right"
            },
            max: 100,
            value: 0,

            change: null,
            complete: null
        },

        min: 0,

        _create: function () {

            // Constrain initial value
            this.oldValue = this.options.value = this._constrainedValue();

            this.element.attr({

                // Only set static values; aria-valuenow and aria-valuemax are
                // set inside _refreshValue()
                role: "progressbar",
                "aria-valuemin": this.min
            });
            this._addClass("ui-progressbar", "ui-widget ui-widget-content");

            this.valueDiv = $("<div>").appendTo(this.element);
            this._addClass(this.valueDiv, "ui-progressbar-value", "ui-widget-header");
            this._refreshValue();
        },

        _destroy: function () {
            this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow");

            this.valueDiv.remove();
        },

        value: function (newValue) {
            if (newValue === undefined) {
                return this.options.value;
            }

            this.options.value = this._constrainedValue(newValue);
            this._refreshValue();
        },

        _constrainedValue: function (newValue) {
            if (newValue === undefined) {
                newValue = this.options.value;
            }

            this.indeterminate = newValue === false;

            // Sanitize value
            if (typeof newValue !== "number") {
                newValue = 0;
            }

            return this.indeterminate ? false :
                Math.min(this.options.max, Math.max(this.min, newValue));
        },

        _setOptions: function (options) {

            // Ensure "value" option is set after other values (like max)
            var value = options.value;
            delete options.value;

            this._super(options);

            this.options.value = this._constrainedValue(value);
            this._refreshValue();
        },

        _setOption: function (key, value) {
            if (key === "max") {

                // Don't allow a max less than min
                value = Math.max(this.min, value);
            }
            this._super(key, value);
        },

        _setOptionDisabled: function (value) {
            this._super(value);

            this.element.attr("aria-disabled", value);
            this._toggleClass(null, "ui-state-disabled", !!value);
        },

        _percentage: function () {
            return this.indeterminate ?
                100 :
                100 * (this.options.value - this.min) / (this.options.max - this.min);
        },

        _refreshValue: function () {
            var value = this.options.value,
                percentage = this._percentage();

            this.valueDiv
                .toggle(this.indeterminate || value > this.min)
                .width(percentage.toFixed(0) + "%");

            this
                ._toggleClass(this.valueDiv, "ui-progressbar-complete", null,
                value === this.options.max)
                ._toggleClass("ui-progressbar-indeterminate", null, this.indeterminate);

            if (this.indeterminate) {
                this.element.removeAttr("aria-valuenow");
                if (!this.overlayDiv) {
                    this.overlayDiv = $("<div>").appendTo(this.valueDiv);
                    this._addClass(this.overlayDiv, "ui-progressbar-overlay");
                }
            } else {
                this.element.attr({
                    "aria-valuemax": this.options.max,
                    "aria-valuenow": value
                });
                if (this.overlayDiv) {
                    this.overlayDiv.remove();
                    this.overlayDiv = null;
                }
            }

            if (this.oldValue !== value) {
                this.oldValue = value;
                this._trigger("change");
            }
            if (value === this.options.max) {
                this._trigger("complete");
            }
        }
    });


    /*!
     * jQuery UI Selectmenu 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Selectmenu
    //>>group: Widgets
    // jscs:disable maximumLineLength
    //>>description: Duplicates and extends the functionality of a native HTML select element, allowing it to be customizable in behavior and appearance far beyond the limitations of a native select.
    // jscs:enable maximumLineLength
    //>>docs: http://api.jqueryui.com/selectmenu/
    //>>demos: http://jqueryui.com/selectmenu/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/selectmenu.css, ../../themes/base/button.css
    //>>css.theme: ../../themes/base/theme.css



    var widgetsSelectmenu = $.widget("ui.selectmenu", [$.ui.formResetMixin, {
        version: "1.12.1",
        defaultElement: "<select>",
        options: {
            appendTo: null,
            classes: {
                "ui-selectmenu-button-open": "ui-corner-top",
                "ui-selectmenu-button-closed": "ui-corner-all"
            },
            disabled: null,
            icons: {
                button: "ui-icon-triangle-1-s"
            },
            position: {
                my: "left top",
                at: "left bottom",
                collision: "none"
            },
            width: false,

            // Callbacks
            change: null,
            close: null,
            focus: null,
            open: null,
            select: null
        },

        _create: function () {
            var selectmenuId = this.element.uniqueId().attr("id");
            this.ids = {
                element: selectmenuId,
                button: selectmenuId + "-button",
                menu: selectmenuId + "-menu"
            };

            this._drawButton();
            this._drawMenu();
            this._bindFormResetHandler();

            this._rendered = false;
            this.menuItems = $();
        },

        _drawButton: function () {
            var icon,
                that = this,
                item = this._parseOption(
                    this.element.find("option:selected"),
                    this.element[0].selectedIndex
                );

            // Associate existing label with the new button
            this.labels = this.element.labels().attr("for", this.ids.button);
            this._on(this.labels, {
                click: function (event) {
                    this.button.focus();
                    event.preventDefault();
                }
            });

            // Hide original select element
            this.element.hide();

            // Create button
            this.button = $("<span>", {
                tabindex: this.options.disabled ? -1 : 0,
                id: this.ids.button,
                role: "combobox",
                "aria-expanded": "false",
                "aria-autocomplete": "list",
                "aria-owns": this.ids.menu,
                "aria-haspopup": "true",
                title: this.element.attr("title")
            })
                .insertAfter(this.element);

            this._addClass(this.button, "ui-selectmenu-button ui-selectmenu-button-closed",
                "ui-button ui-widget");

            icon = $("<span>").appendTo(this.button);
            this._addClass(icon, "ui-selectmenu-icon", "ui-icon " + this.options.icons.button);
            this.buttonItem = this._renderButtonItem(item)
                .appendTo(this.button);

            if (this.options.width !== false) {
                this._resizeButton();
            }

            this._on(this.button, this._buttonEvents);
            this.button.one("focusin", function () {

                // Delay rendering the menu items until the button receives focus.
                // The menu may have already been rendered via a programmatic open.
                if (!that._rendered) {
                    that._refreshMenu();
                }
            });
        },

        _drawMenu: function () {
            var that = this;

            // Create menu
            this.menu = $("<ul>", {
                "aria-hidden": "true",
                "aria-labelledby": this.ids.button,
                id: this.ids.menu
            });

            // Wrap menu
            this.menuWrap = $("<div>").append(this.menu);
            this._addClass(this.menuWrap, "ui-selectmenu-menu", "ui-front");
            this.menuWrap.appendTo(this._appendTo());

            // Initialize menu widget
            this.menuInstance = this.menu
                .menu({
                    classes: {
                        "ui-menu": "ui-corner-bottom"
                    },
                    role: "listbox",
                    select: function (event, ui) {
                        event.preventDefault();

                        // Support: IE8
                        // If the item was selected via a click, the text selection
                        // will be destroyed in IE
                        that._setSelection();

                        that._select(ui.item.data("ui-selectmenu-item"), event);
                    },
                    focus: function (event, ui) {
                        var item = ui.item.data("ui-selectmenu-item");

                        // Prevent inital focus from firing and check if its a newly focused item
                        if (that.focusIndex != null && item.index !== that.focusIndex) {
                            that._trigger("focus", event, { item: item });
                            if (!that.isOpen) {
                                that._select(item, event);
                            }
                        }
                        that.focusIndex = item.index;

                        that.button.attr("aria-activedescendant",
                            that.menuItems.eq(item.index).attr("id"));
                    }
                })
                .menu("instance");

            // Don't close the menu on mouseleave
            this.menuInstance._off(this.menu, "mouseleave");

            // Cancel the menu's collapseAll on document click
            this.menuInstance._closeOnDocumentClick = function () {
                return false;
            };

            // Selects often contain empty items, but never contain dividers
            this.menuInstance._isDivider = function () {
                return false;
            };
        },

        refresh: function () {
            this._refreshMenu();
            this.buttonItem.replaceWith(
                this.buttonItem = this._renderButtonItem(

                    // Fall back to an empty object in case there are no options
                    this._getSelectedItem().data("ui-selectmenu-item") || {}
                )
            );
            if (this.options.width === null) {
                this._resizeButton();
            }
        },

        _refreshMenu: function () {
            var item,
                options = this.element.find("option");

            this.menu.empty();

            this._parseOptions(options);
            this._renderMenu(this.menu, this.items);

            this.menuInstance.refresh();
            this.menuItems = this.menu.find("li")
                .not(".ui-selectmenu-optgroup")
                .find(".ui-menu-item-wrapper");

            this._rendered = true;

            if (!options.length) {
                return;
            }

            item = this._getSelectedItem();

            // Update the menu to have the correct item focused
            this.menuInstance.focus(null, item);
            this._setAria(item.data("ui-selectmenu-item"));

            // Set disabled state
            this._setOption("disabled", this.element.prop("disabled"));
        },

        open: function (event) {
            if (this.options.disabled) {
                return;
            }

            // If this is the first time the menu is being opened, render the items
            if (!this._rendered) {
                this._refreshMenu();
            } else {

                // Menu clears focus on close, reset focus to selected item
                this._removeClass(this.menu.find(".ui-state-active"), null, "ui-state-active");
                this.menuInstance.focus(null, this._getSelectedItem());
            }

            // If there are no options, don't open the menu
            if (!this.menuItems.length) {
                return;
            }

            this.isOpen = true;
            this._toggleAttr();
            this._resizeMenu();
            this._position();

            this._on(this.document, this._documentClick);

            this._trigger("open", event);
        },

        _position: function () {
            this.menuWrap.position($.extend({ of: this.button }, this.options.position));
        },

        close: function (event) {
            if (!this.isOpen) {
                return;
            }

            this.isOpen = false;
            this._toggleAttr();

            this.range = null;
            this._off(this.document);

            this._trigger("close", event);
        },

        widget: function () {
            return this.button;
        },

        menuWidget: function () {
            return this.menu;
        },

        _renderButtonItem: function (item) {
            var buttonItem = $("<span>");

            this._setText(buttonItem, item.label);
            this._addClass(buttonItem, "ui-selectmenu-text");

            return buttonItem;
        },

        _renderMenu: function (ul, items) {
            var that = this,
                currentOptgroup = "";

            $.each(items, function (index, item) {
                var li;

                if (item.optgroup !== currentOptgroup) {
                    li = $("<li>", {
                        text: item.optgroup
                    });
                    that._addClass(li, "ui-selectmenu-optgroup", "ui-menu-divider" +
                        (item.element.parent("optgroup").prop("disabled") ?
                            " ui-state-disabled" :
                            ""));

                    li.appendTo(ul);

                    currentOptgroup = item.optgroup;
                }

                that._renderItemData(ul, item);
            });
        },

        _renderItemData: function (ul, item) {
            return this._renderItem(ul, item).data("ui-selectmenu-item", item);
        },

        _renderItem: function (ul, item) {
            var li = $("<li>"),
                wrapper = $("<div>", {
                    title: item.element.attr("title")
                });

            if (item.disabled) {
                this._addClass(li, null, "ui-state-disabled");
            }
            this._setText(wrapper, item.label);

            return li.append(wrapper).appendTo(ul);
        },

        _setText: function (element, value) {
            if (value) {
                element.text(value);
            } else {
                element.html("&#160;");
            }
        },

        _move: function (direction, event) {
            var item, next,
                filter = ".ui-menu-item";

            if (this.isOpen) {
                item = this.menuItems.eq(this.focusIndex).parent("li");
            } else {
                item = this.menuItems.eq(this.element[0].selectedIndex).parent("li");
                filter += ":not(.ui-state-disabled)";
            }

            if (direction === "first" || direction === "last") {
                next = item[direction === "first" ? "prevAll" : "nextAll"](filter).eq(-1);
            } else {
                next = item[direction + "All"](filter).eq(0);
            }

            if (next.length) {
                this.menuInstance.focus(event, next);
            }
        },

        _getSelectedItem: function () {
            return this.menuItems.eq(this.element[0].selectedIndex).parent("li");
        },

        _toggle: function (event) {
            this[this.isOpen ? "close" : "open"](event);
        },

        _setSelection: function () {
            var selection;

            if (!this.range) {
                return;
            }

            if (window.getSelection) {
                selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(this.range);

                // Support: IE8
            } else {
                this.range.select();
            }

            // Support: IE
            // Setting the text selection kills the button focus in IE, but
            // restoring the focus doesn't kill the selection.
            this.button.focus();
        },

        _documentClick: {
            mousedown: function (event) {
                if (!this.isOpen) {
                    return;
                }

                if (!$(event.target).closest(".ui-selectmenu-menu, #" +
                    $.ui.escapeSelector(this.ids.button)).length) {
                    this.close(event);
                }
            }
        },

        _buttonEvents: {

            // Prevent text selection from being reset when interacting with the selectmenu (#10144)
            mousedown: function () {
                var selection;

                if (window.getSelection) {
                    selection = window.getSelection();
                    if (selection.rangeCount) {
                        this.range = selection.getRangeAt(0);
                    }

                    // Support: IE8
                } else {
                    this.range = document.selection.createRange();
                }
            },

            click: function (event) {
                this._setSelection();
                this._toggle(event);
            },

            keydown: function (event) {
                var preventDefault = true;
                switch (event.keyCode) {
                    case $.ui.keyCode.TAB:
                    case $.ui.keyCode.ESCAPE:
                        this.close(event);
                        preventDefault = false;
                        break;
                    case $.ui.keyCode.ENTER:
                        if (this.isOpen) {
                            this._selectFocusedItem(event);
                        }
                        break;
                    case $.ui.keyCode.UP:
                        if (event.altKey) {
                            this._toggle(event);
                        } else {
                            this._move("prev", event);
                        }
                        break;
                    case $.ui.keyCode.DOWN:
                        if (event.altKey) {
                            this._toggle(event);
                        } else {
                            this._move("next", event);
                        }
                        break;
                    case $.ui.keyCode.SPACE:
                        if (this.isOpen) {
                            this._selectFocusedItem(event);
                        } else {
                            this._toggle(event);
                        }
                        break;
                    case $.ui.keyCode.LEFT:
                        this._move("prev", event);
                        break;
                    case $.ui.keyCode.RIGHT:
                        this._move("next", event);
                        break;
                    case $.ui.keyCode.HOME:
                    case $.ui.keyCode.PAGE_UP:
                        this._move("first", event);
                        break;
                    case $.ui.keyCode.END:
                    case $.ui.keyCode.PAGE_DOWN:
                        this._move("last", event);
                        break;
                    default:
                        this.menu.trigger(event);
                        preventDefault = false;
                }

                if (preventDefault) {
                    event.preventDefault();
                }
            }
        },

        _selectFocusedItem: function (event) {
            var item = this.menuItems.eq(this.focusIndex).parent("li");
            if (!item.hasClass("ui-state-disabled")) {
                this._select(item.data("ui-selectmenu-item"), event);
            }
        },

        _select: function (item, event) {
            var oldIndex = this.element[0].selectedIndex;

            // Change native select element
            this.element[0].selectedIndex = item.index;
            this.buttonItem.replaceWith(this.buttonItem = this._renderButtonItem(item));
            this._setAria(item);
            this._trigger("select", event, { item: item });

            if (item.index !== oldIndex) {
                this._trigger("change", event, { item: item });
            }

            this.close(event);
        },

        _setAria: function (item) {
            var id = this.menuItems.eq(item.index).attr("id");

            this.button.attr({
                "aria-labelledby": id,
                "aria-activedescendant": id
            });
            this.menu.attr("aria-activedescendant", id);
        },

        _setOption: function (key, value) {
            if (key === "icons") {
                var icon = this.button.find("span.ui-icon");
                this._removeClass(icon, null, this.options.icons.button)
                    ._addClass(icon, null, value.button);
            }

            this._super(key, value);

            if (key === "appendTo") {
                this.menuWrap.appendTo(this._appendTo());
            }

            if (key === "width") {
                this._resizeButton();
            }
        },

        _setOptionDisabled: function (value) {
            this._super(value);

            this.menuInstance.option("disabled", value);
            this.button.attr("aria-disabled", value);
            this._toggleClass(this.button, null, "ui-state-disabled", value);

            this.element.prop("disabled", value);
            if (value) {
                this.button.attr("tabindex", -1);
                this.close();
            } else {
                this.button.attr("tabindex", 0);
            }
        },

        _appendTo: function () {
            var element = this.options.appendTo;

            if (element) {
                element = element.jquery || element.nodeType ?
                    $(element) :
                    this.document.find(element).eq(0);
            }

            if (!element || !element[0]) {
                element = this.element.closest(".ui-front, dialog");
            }

            if (!element.length) {
                element = this.document[0].body;
            }

            return element;
        },

        _toggleAttr: function () {
            this.button.attr("aria-expanded", this.isOpen);

            // We can't use two _toggleClass() calls here, because we need to make sure
            // we always remove classes first and add them second, otherwise if both classes have the
            // same theme class, it will be removed after we add it.
            this._removeClass(this.button, "ui-selectmenu-button-" +
                (this.isOpen ? "closed" : "open"))
                ._addClass(this.button, "ui-selectmenu-button-" +
                (this.isOpen ? "open" : "closed"))
                ._toggleClass(this.menuWrap, "ui-selectmenu-open", null, this.isOpen);

            this.menu.attr("aria-hidden", !this.isOpen);
        },

        _resizeButton: function () {
            var width = this.options.width;

            // For 'width: false', just remove inline style and stop
            if (width === false) {
                this.button.css("width", "");
                return;
            }

            // For 'width: null', match the width of the original element
            if (width === null) {
                width = this.element.show().outerWidth();
                this.element.hide();
            }

            this.button.outerWidth(width);
        },

        _resizeMenu: function () {
            this.menu.outerWidth(Math.max(
                this.button.outerWidth(),

                // Support: IE10
                // IE10 wraps long text (possibly a rounding bug)
                // so we add 1px to avoid the wrapping
                this.menu.width("").outerWidth() + 1
            ));
        },

        _getCreateOptions: function () {
            var options = this._super();

            options.disabled = this.element.prop("disabled");

            return options;
        },

        _parseOptions: function (options) {
            var that = this,
                data = [];
            options.each(function (index, item) {
                data.push(that._parseOption($(item), index));
            });
            this.items = data;
        },

        _parseOption: function (option, index) {
            var optgroup = option.parent("optgroup");

            return {
                element: option,
                index: index,
                value: option.val(),
                label: option.text(),
                optgroup: optgroup.attr("label") || "",
                disabled: optgroup.prop("disabled") || option.prop("disabled")
            };
        },

        _destroy: function () {
            this._unbindFormResetHandler();
            this.menuWrap.remove();
            this.button.remove();
            this.element.show();
            this.element.removeUniqueId();
            this.labels.attr("for", this.ids.element);
        }
    }]);


    /*!
     * jQuery UI Slider 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Slider
    //>>group: Widgets
    //>>description: Displays a flexible slider with ranges and accessibility via keyboard.
    //>>docs: http://api.jqueryui.com/slider/
    //>>demos: http://jqueryui.com/slider/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/slider.css
    //>>css.theme: ../../themes/base/theme.css



    var widgetsSlider = $.widget("ui.slider", $.ui.mouse, {
        version: "1.12.1",
        widgetEventPrefix: "slide",

        options: {
            animate: false,
            classes: {
                "ui-slider": "ui-corner-all",
                "ui-slider-handle": "ui-corner-all",

                // Note: ui-widget-header isn't the most fittingly semantic framework class for this
                // element, but worked best visually with a variety of themes
                "ui-slider-range": "ui-corner-all ui-widget-header"
            },
            distance: 0,
            max: 100,
            min: 0,
            orientation: "horizontal",
            range: false,
            step: 1,
            value: 0,
            values: null,

            // Callbacks
            change: null,
            slide: null,
            start: null,
            stop: null
        },

        // Number of pages in a slider
        // (how many times can you page up/down to go through the whole range)
        numPages: 5,

        _create: function () {
            this._keySliding = false;
            this._mouseSliding = false;
            this._animateOff = true;
            this._handleIndex = null;
            this._detectOrientation();
            this._mouseInit();
            this._calculateNewMax();

            this._addClass("ui-slider ui-slider-" + this.orientation,
                "ui-widget ui-widget-content");

            this._refresh();

            this._animateOff = false;
        },

        _refresh: function () {
            this._createRange();
            this._createHandles();
            this._setupEvents();
            this._refreshValue();
        },

        _createHandles: function () {
            var i, handleCount,
                options = this.options,
                existingHandles = this.element.find(".ui-slider-handle"),
                handle = "<span tabindex='0'></span>",
                handles = [];

            handleCount = (options.values && options.values.length) || 1;

            if (existingHandles.length > handleCount) {
                existingHandles.slice(handleCount).remove();
                existingHandles = existingHandles.slice(0, handleCount);
            }

            for (i = existingHandles.length; i < handleCount; i++) {
                handles.push(handle);
            }

            this.handles = existingHandles.add($(handles.join("")).appendTo(this.element));

            this._addClass(this.handles, "ui-slider-handle", "ui-state-default");

            this.handle = this.handles.eq(0);

            this.handles.each(function (i) {
                $(this)
                    .data("ui-slider-handle-index", i)
                    .attr("tabIndex", 0);
            });
        },

        _createRange: function () {
            var options = this.options;

            if (options.range) {
                if (options.range === true) {
                    if (!options.values) {
                        options.values = [this._valueMin(), this._valueMin()];
                    } else if (options.values.length && options.values.length !== 2) {
                        options.values = [options.values[0], options.values[0]];
                    } else if ($.isArray(options.values)) {
                        options.values = options.values.slice(0);
                    }
                }

                if (!this.range || !this.range.length) {
                    this.range = $("<div>")
                        .appendTo(this.element);

                    this._addClass(this.range, "ui-slider-range");
                } else {
                    this._removeClass(this.range, "ui-slider-range-min ui-slider-range-max");

                    // Handle range switching from true to min/max
                    this.range.css({
                        "left": "",
                        "bottom": ""
                    });
                }
                if (options.range === "min" || options.range === "max") {
                    this._addClass(this.range, "ui-slider-range-" + options.range);
                }
            } else {
                if (this.range) {
                    this.range.remove();
                }
                this.range = null;
            }
        },

        _setupEvents: function () {
            this._off(this.handles);
            this._on(this.handles, this._handleEvents);
            this._hoverable(this.handles);
            this._focusable(this.handles);
        },

        _destroy: function () {
            this.handles.remove();
            if (this.range) {
                this.range.remove();
            }

            this._mouseDestroy();
        },

        _mouseCapture: function (event) {
            var position, normValue, distance, closestHandle, index, allowed, offset, mouseOverHandle,
                that = this,
                o = this.options;

            if (o.disabled) {
                return false;
            }

            this.elementSize = {
                width: this.element.outerWidth(),
                height: this.element.outerHeight()
            };
            this.elementOffset = this.element.offset();

            position = { x: event.pageX, y: event.pageY };
            normValue = this._normValueFromMouse(position);
            distance = this._valueMax() - this._valueMin() + 1;
            this.handles.each(function (i) {
                var thisDistance = Math.abs(normValue - that.values(i));
                if ((distance > thisDistance) ||
                    (distance === thisDistance &&
                        (i === that._lastChangedValue || that.values(i) === o.min))) {
                    distance = thisDistance;
                    closestHandle = $(this);
                    index = i;
                }
            });

            allowed = this._start(event, index);
            if (allowed === false) {
                return false;
            }
            this._mouseSliding = true;

            this._handleIndex = index;

            this._addClass(closestHandle, null, "ui-state-active");
            closestHandle.trigger("focus");

            offset = closestHandle.offset();
            mouseOverHandle = !$(event.target).parents().addBack().is(".ui-slider-handle");
            this._clickOffset = mouseOverHandle ? { left: 0, top: 0 } : {
                left: event.pageX - offset.left - (closestHandle.width() / 2),
                top: event.pageY - offset.top -
                    (closestHandle.height() / 2) -
                    (parseInt(closestHandle.css("borderTopWidth"), 10) || 0) -
                    (parseInt(closestHandle.css("borderBottomWidth"), 10) || 0) +
                    (parseInt(closestHandle.css("marginTop"), 10) || 0)
            };

            if (!this.handles.hasClass("ui-state-hover")) {
                this._slide(event, index, normValue);
            }
            this._animateOff = true;
            return true;
        },

        _mouseStart: function () {
            return true;
        },

        _mouseDrag: function (event) {
            var position = { x: event.pageX, y: event.pageY },
                normValue = this._normValueFromMouse(position);

            this._slide(event, this._handleIndex, normValue);

            return false;
        },

        _mouseStop: function (event) {
            this._removeClass(this.handles, null, "ui-state-active");
            this._mouseSliding = false;

            this._stop(event, this._handleIndex);
            this._change(event, this._handleIndex);

            this._handleIndex = null;
            this._clickOffset = null;
            this._animateOff = false;

            return false;
        },

        _detectOrientation: function () {
            this.orientation = (this.options.orientation === "vertical") ? "vertical" : "horizontal";
        },

        _normValueFromMouse: function (position) {
            var pixelTotal,
                pixelMouse,
                percentMouse,
                valueTotal,
                valueMouse;

            if (this.orientation === "horizontal") {
                pixelTotal = this.elementSize.width;
                pixelMouse = position.x - this.elementOffset.left -
                    (this._clickOffset ? this._clickOffset.left : 0);
            } else {
                pixelTotal = this.elementSize.height;
                pixelMouse = position.y - this.elementOffset.top -
                    (this._clickOffset ? this._clickOffset.top : 0);
            }

            percentMouse = (pixelMouse / pixelTotal);
            if (percentMouse > 1) {
                percentMouse = 1;
            }
            if (percentMouse < 0) {
                percentMouse = 0;
            }
            if (this.orientation === "vertical") {
                percentMouse = 1 - percentMouse;
            }

            valueTotal = this._valueMax() - this._valueMin();
            valueMouse = this._valueMin() + percentMouse * valueTotal;

            return this._trimAlignValue(valueMouse);
        },

        _uiHash: function (index, value, values) {
            var uiHash = {
                handle: this.handles[index],
                handleIndex: index,
                value: value !== undefined ? value : this.value()
            };

            if (this._hasMultipleValues()) {
                uiHash.value = value !== undefined ? value : this.values(index);
                uiHash.values = values || this.values();
            }

            return uiHash;
        },

        _hasMultipleValues: function () {
            return this.options.values && this.options.values.length;
        },

        _start: function (event, index) {
            return this._trigger("start", event, this._uiHash(index));
        },

        _slide: function (event, index, newVal) {
            var allowed, otherVal,
                currentValue = this.value(),
                newValues = this.values();

            if (this._hasMultipleValues()) {
                otherVal = this.values(index ? 0 : 1);
                currentValue = this.values(index);

                if (this.options.values.length === 2 && this.options.range === true) {
                    newVal = index === 0 ? Math.min(otherVal, newVal) : Math.max(otherVal, newVal);
                }

                newValues[index] = newVal;
            }

            if (newVal === currentValue) {
                return;
            }

            allowed = this._trigger("slide", event, this._uiHash(index, newVal, newValues));

            // A slide can be canceled by returning false from the slide callback
            if (allowed === false) {
                return;
            }

            if (this._hasMultipleValues()) {
                this.values(index, newVal);
            } else {
                this.value(newVal);
            }
        },

        _stop: function (event, index) {
            this._trigger("stop", event, this._uiHash(index));
        },

        _change: function (event, index) {
            if (!this._keySliding && !this._mouseSliding) {

                //store the last changed value index for reference when handles overlap
                this._lastChangedValue = index;
                this._trigger("change", event, this._uiHash(index));
            }
        },

        value: function (newValue) {
            if (arguments.length) {
                this.options.value = this._trimAlignValue(newValue);
                this._refreshValue();
                this._change(null, 0);
                return;
            }

            return this._value();
        },

        values: function (index, newValue) {
            var vals,
                newValues,
                i;

            if (arguments.length > 1) {
                this.options.values[index] = this._trimAlignValue(newValue);
                this._refreshValue();
                this._change(null, index);
                return;
            }

            if (arguments.length) {
                if ($.isArray(arguments[0])) {
                    vals = this.options.values;
                    newValues = arguments[0];
                    for (i = 0; i < vals.length; i += 1) {
                        vals[i] = this._trimAlignValue(newValues[i]);
                        this._change(null, i);
                    }
                    this._refreshValue();
                } else {
                    if (this._hasMultipleValues()) {
                        return this._values(index);
                    } else {
                        return this.value();
                    }
                }
            } else {
                return this._values();
            }
        },

        _setOption: function (key, value) {
            var i,
                valsLength = 0;

            if (key === "range" && this.options.range === true) {
                if (value === "min") {
                    this.options.value = this._values(0);
                    this.options.values = null;
                } else if (value === "max") {
                    this.options.value = this._values(this.options.values.length - 1);
                    this.options.values = null;
                }
            }

            if ($.isArray(this.options.values)) {
                valsLength = this.options.values.length;
            }

            this._super(key, value);

            switch (key) {
                case "orientation":
                    this._detectOrientation();
                    this._removeClass("ui-slider-horizontal ui-slider-vertical")
                        ._addClass("ui-slider-" + this.orientation);
                    this._refreshValue();
                    if (this.options.range) {
                        this._refreshRange(value);
                    }

                    // Reset positioning from previous orientation
                    this.handles.css(value === "horizontal" ? "bottom" : "left", "");
                    break;
                case "value":
                    this._animateOff = true;
                    this._refreshValue();
                    this._change(null, 0);
                    this._animateOff = false;
                    break;
                case "values":
                    this._animateOff = true;
                    this._refreshValue();

                    // Start from the last handle to prevent unreachable handles (#9046)
                    for (i = valsLength - 1; i >= 0; i--) {
                        this._change(null, i);
                    }
                    this._animateOff = false;
                    break;
                case "step":
                case "min":
                case "max":
                    this._animateOff = true;
                    this._calculateNewMax();
                    this._refreshValue();
                    this._animateOff = false;
                    break;
                case "range":
                    this._animateOff = true;
                    this._refresh();
                    this._animateOff = false;
                    break;
            }
        },

        _setOptionDisabled: function (value) {
            this._super(value);

            this._toggleClass(null, "ui-state-disabled", !!value);
        },

        //internal value getter
        // _value() returns value trimmed by min and max, aligned by step
        _value: function () {
            var val = this.options.value;
            val = this._trimAlignValue(val);

            return val;
        },

        //internal values getter
        // _values() returns array of values trimmed by min and max, aligned by step
        // _values( index ) returns single value trimmed by min and max, aligned by step
        _values: function (index) {
            var val,
                vals,
                i;

            if (arguments.length) {
                val = this.options.values[index];
                val = this._trimAlignValue(val);

                return val;
            } else if (this._hasMultipleValues()) {

                // .slice() creates a copy of the array
                // this copy gets trimmed by min and max and then returned
                vals = this.options.values.slice();
                for (i = 0; i < vals.length; i += 1) {
                    vals[i] = this._trimAlignValue(vals[i]);
                }

                return vals;
            } else {
                return [];
            }
        },

        // Returns the step-aligned value that val is closest to, between (inclusive) min and max
        _trimAlignValue: function (val) {
            if (val <= this._valueMin()) {
                return this._valueMin();
            }
            if (val >= this._valueMax()) {
                return this._valueMax();
            }
            var step = (this.options.step > 0) ? this.options.step : 1,
                valModStep = (val - this._valueMin()) % step,
                alignValue = val - valModStep;

            if (Math.abs(valModStep) * 2 >= step) {
                alignValue += (valModStep > 0) ? step : (-step);
            }

            // Since JavaScript has problems with large floats, round
            // the final value to 5 digits after the decimal point (see #4124)
            return parseFloat(alignValue.toFixed(5));
        },

        _calculateNewMax: function () {
            var max = this.options.max,
                min = this._valueMin(),
                step = this.options.step,
                aboveMin = Math.round((max - min) / step) * step;
            max = aboveMin + min;
            if (max > this.options.max) {

                //If max is not divisible by step, rounding off may increase its value
                max -= step;
            }
            this.max = parseFloat(max.toFixed(this._precision()));
        },

        _precision: function () {
            var precision = this._precisionOf(this.options.step);
            if (this.options.min !== null) {
                precision = Math.max(precision, this._precisionOf(this.options.min));
            }
            return precision;
        },

        _precisionOf: function (num) {
            var str = num.toString(),
                decimal = str.indexOf(".");
            return decimal === -1 ? 0 : str.length - decimal - 1;
        },

        _valueMin: function () {
            return this.options.min;
        },

        _valueMax: function () {
            return this.max;
        },

        _refreshRange: function (orientation) {
            if (orientation === "vertical") {
                this.range.css({ "width": "", "left": "" });
            }
            if (orientation === "horizontal") {
                this.range.css({ "height": "", "bottom": "" });
            }
        },

        _refreshValue: function () {
            var lastValPercent, valPercent, value, valueMin, valueMax,
                oRange = this.options.range,
                o = this.options,
                that = this,
                animate = (!this._animateOff) ? o.animate : false,
                _set = {};

            if (this._hasMultipleValues()) {
                this.handles.each(function (i) {
                    valPercent = (that.values(i) - that._valueMin()) / (that._valueMax() -
                        that._valueMin()) * 100;
                    _set[that.orientation === "horizontal" ? "left" : "bottom"] = valPercent + "%";
                    $(this).stop(1, 1)[animate ? "animate" : "css"](_set, o.animate);
                    if (that.options.range === true) {
                        if (that.orientation === "horizontal") {
                            if (i === 0) {
                                that.range.stop(1, 1)[animate ? "animate" : "css"]({
                                    left: valPercent + "%"
                                }, o.animate);
                            }
                            if (i === 1) {
                                that.range[animate ? "animate" : "css"]({
                                    width: (valPercent - lastValPercent) + "%"
                                }, {
                                        queue: false,
                                        duration: o.animate
                                    });
                            }
                        } else {
                            if (i === 0) {
                                that.range.stop(1, 1)[animate ? "animate" : "css"]({
                                    bottom: (valPercent) + "%"
                                }, o.animate);
                            }
                            if (i === 1) {
                                that.range[animate ? "animate" : "css"]({
                                    height: (valPercent - lastValPercent) + "%"
                                }, {
                                        queue: false,
                                        duration: o.animate
                                    });
                            }
                        }
                    }
                    lastValPercent = valPercent;
                });
            } else {
                value = this.value();
                valueMin = this._valueMin();
                valueMax = this._valueMax();
                valPercent = (valueMax !== valueMin) ?
                    (value - valueMin) / (valueMax - valueMin) * 100 :
                    0;
                _set[this.orientation === "horizontal" ? "left" : "bottom"] = valPercent + "%";
                this.handle.stop(1, 1)[animate ? "animate" : "css"](_set, o.animate);

                if (oRange === "min" && this.orientation === "horizontal") {
                    this.range.stop(1, 1)[animate ? "animate" : "css"]({
                        width: valPercent + "%"
                    }, o.animate);
                }
                if (oRange === "max" && this.orientation === "horizontal") {
                    this.range.stop(1, 1)[animate ? "animate" : "css"]({
                        width: (100 - valPercent) + "%"
                    }, o.animate);
                }
                if (oRange === "min" && this.orientation === "vertical") {
                    this.range.stop(1, 1)[animate ? "animate" : "css"]({
                        height: valPercent + "%"
                    }, o.animate);
                }
                if (oRange === "max" && this.orientation === "vertical") {
                    this.range.stop(1, 1)[animate ? "animate" : "css"]({
                        height: (100 - valPercent) + "%"
                    }, o.animate);
                }
            }
        },

        _handleEvents: {
            keydown: function (event) {
                var allowed, curVal, newVal, step,
                    index = $(event.target).data("ui-slider-handle-index");

                switch (event.keyCode) {
                    case $.ui.keyCode.HOME:
                    case $.ui.keyCode.END:
                    case $.ui.keyCode.PAGE_UP:
                    case $.ui.keyCode.PAGE_DOWN:
                    case $.ui.keyCode.UP:
                    case $.ui.keyCode.RIGHT:
                    case $.ui.keyCode.DOWN:
                    case $.ui.keyCode.LEFT:
                        event.preventDefault();
                        if (!this._keySliding) {
                            this._keySliding = true;
                            this._addClass($(event.target), null, "ui-state-active");
                            allowed = this._start(event, index);
                            if (allowed === false) {
                                return;
                            }
                        }
                        break;
                }

                step = this.options.step;
                if (this._hasMultipleValues()) {
                    curVal = newVal = this.values(index);
                } else {
                    curVal = newVal = this.value();
                }

                switch (event.keyCode) {
                    case $.ui.keyCode.HOME:
                        newVal = this._valueMin();
                        break;
                    case $.ui.keyCode.END:
                        newVal = this._valueMax();
                        break;
                    case $.ui.keyCode.PAGE_UP:
                        newVal = this._trimAlignValue(
                            curVal + ((this._valueMax() - this._valueMin()) / this.numPages)
                        );
                        break;
                    case $.ui.keyCode.PAGE_DOWN:
                        newVal = this._trimAlignValue(
                            curVal - ((this._valueMax() - this._valueMin()) / this.numPages));
                        break;
                    case $.ui.keyCode.UP:
                    case $.ui.keyCode.RIGHT:
                        if (curVal === this._valueMax()) {
                            return;
                        }
                        newVal = this._trimAlignValue(curVal + step);
                        break;
                    case $.ui.keyCode.DOWN:
                    case $.ui.keyCode.LEFT:
                        if (curVal === this._valueMin()) {
                            return;
                        }
                        newVal = this._trimAlignValue(curVal - step);
                        break;
                }

                this._slide(event, index, newVal);
            },
            keyup: function (event) {
                var index = $(event.target).data("ui-slider-handle-index");

                if (this._keySliding) {
                    this._keySliding = false;
                    this._stop(event, index);
                    this._change(event, index);
                    this._removeClass($(event.target), null, "ui-state-active");
                }
            }
        }
    });


    /*!
     * jQuery UI Spinner 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Spinner
    //>>group: Widgets
    //>>description: Displays buttons to easily input numbers via the keyboard or mouse.
    //>>docs: http://api.jqueryui.com/spinner/
    //>>demos: http://jqueryui.com/spinner/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/spinner.css
    //>>css.theme: ../../themes/base/theme.css



    function spinnerModifer(fn) {
        return function () {
            var previous = this.element.val();
            fn.apply(this, arguments);
            this._refresh();
            if (previous !== this.element.val()) {
                this._trigger("change");
            }
        };
    }

    $.widget("ui.spinner", {
        version: "1.12.1",
        defaultElement: "<input>",
        widgetEventPrefix: "spin",
        options: {
            classes: {
                "ui-spinner": "ui-corner-all",
                "ui-spinner-down": "ui-corner-br",
                "ui-spinner-up": "ui-corner-tr"
            },
            culture: null,
            icons: {
                down: "ui-icon-triangle-1-s",
                up: "ui-icon-triangle-1-n"
            },
            incremental: true,
            max: null,
            min: null,
            numberFormat: null,
            page: 10,
            step: 1,

            change: null,
            spin: null,
            start: null,
            stop: null
        },

        _create: function () {

            // handle string values that need to be parsed
            this._setOption("max", this.options.max);
            this._setOption("min", this.options.min);
            this._setOption("step", this.options.step);

            // Only format if there is a value, prevents the field from being marked
            // as invalid in Firefox, see #9573.
            if (this.value() !== "") {

                // Format the value, but don't constrain.
                this._value(this.element.val(), true);
            }

            this._draw();
            this._on(this._events);
            this._refresh();

            // Turning off autocomplete prevents the browser from remembering the
            // value when navigating through history, so we re-enable autocomplete
            // if the page is unloaded before the widget is destroyed. #7790
            this._on(this.window, {
                beforeunload: function () {
                    this.element.removeAttr("autocomplete");
                }
            });
        },

        _getCreateOptions: function () {
            var options = this._super();
            var element = this.element;

            $.each(["min", "max", "step"], function (i, option) {
                var value = element.attr(option);
                if (value != null && value.length) {
                    options[option] = value;
                }
            });

            return options;
        },

        _events: {
            keydown: function (event) {
                if (this._start(event) && this._keydown(event)) {
                    event.preventDefault();
                }
            },
            keyup: "_stop",
            focus: function () {
                this.previous = this.element.val();
            },
            blur: function (event) {
                if (this.cancelBlur) {
                    delete this.cancelBlur;
                    return;
                }

                this._stop();
                this._refresh();
                if (this.previous !== this.element.val()) {
                    this._trigger("change", event);
                }
            },
            mousewheel: function (event, delta) {
                if (!delta) {
                    return;
                }
                if (!this.spinning && !this._start(event)) {
                    return false;
                }

                this._spin((delta > 0 ? 1 : -1) * this.options.step, event);
                clearTimeout(this.mousewheelTimer);
                this.mousewheelTimer = this._delay(function () {
                    if (this.spinning) {
                        this._stop(event);
                    }
                }, 100);
                event.preventDefault();
            },
            "mousedown .ui-spinner-button": function (event) {
                var previous;

                // We never want the buttons to have focus; whenever the user is
                // interacting with the spinner, the focus should be on the input.
                // If the input is focused then this.previous is properly set from
                // when the input first received focus. If the input is not focused
                // then we need to set this.previous based on the value before spinning.
                previous = this.element[0] === $.ui.safeActiveElement(this.document[0]) ?
                    this.previous : this.element.val();
                function checkFocus() {
                    var isActive = this.element[0] === $.ui.safeActiveElement(this.document[0]);
                    if (!isActive) {
                        this.element.trigger("focus");
                        this.previous = previous;

                        // support: IE
                        // IE sets focus asynchronously, so we need to check if focus
                        // moved off of the input because the user clicked on the button.
                        this._delay(function () {
                            this.previous = previous;
                        });
                    }
                }

                // Ensure focus is on (or stays on) the text field
                event.preventDefault();
                checkFocus.call(this);

                // Support: IE
                // IE doesn't prevent moving focus even with event.preventDefault()
                // so we set a flag to know when we should ignore the blur event
                // and check (again) if focus moved off of the input.
                this.cancelBlur = true;
                this._delay(function () {
                    delete this.cancelBlur;
                    checkFocus.call(this);
                });

                if (this._start(event) === false) {
                    return;
                }

                this._repeat(null, $(event.currentTarget)
                    .hasClass("ui-spinner-up") ? 1 : -1, event);
            },
            "mouseup .ui-spinner-button": "_stop",
            "mouseenter .ui-spinner-button": function (event) {

                // button will add ui-state-active if mouse was down while mouseleave and kept down
                if (!$(event.currentTarget).hasClass("ui-state-active")) {
                    return;
                }

                if (this._start(event) === false) {
                    return false;
                }
                this._repeat(null, $(event.currentTarget)
                    .hasClass("ui-spinner-up") ? 1 : -1, event);
            },

            // TODO: do we really want to consider this a stop?
            // shouldn't we just stop the repeater and wait until mouseup before
            // we trigger the stop event?
            "mouseleave .ui-spinner-button": "_stop"
        },

        // Support mobile enhanced option and make backcompat more sane
        _enhance: function () {
            this.uiSpinner = this.element
                .attr("autocomplete", "off")
                .wrap("<span>")
                .parent()

                // Add buttons
                .append(
                "<a></a><a></a>"
                );
        },

        _draw: function () {
            this._enhance();

            this._addClass(this.uiSpinner, "ui-spinner", "ui-widget ui-widget-content");
            this._addClass("ui-spinner-input");

            this.element.attr("role", "spinbutton");

            // Button bindings
            this.buttons = this.uiSpinner.children("a")
                .attr("tabIndex", -1)
                .attr("aria-hidden", true)
                .button({
                    classes: {
                        "ui-button": ""
                    }
                });

            // TODO: Right now button does not support classes this is already updated in button PR
            this._removeClass(this.buttons, "ui-corner-all");

            this._addClass(this.buttons.first(), "ui-spinner-button ui-spinner-up");
            this._addClass(this.buttons.last(), "ui-spinner-button ui-spinner-down");
            this.buttons.first().button({
                "icon": this.options.icons.up,
                "showLabel": false
            });
            this.buttons.last().button({
                "icon": this.options.icons.down,
                "showLabel": false
            });

            // IE 6 doesn't understand height: 50% for the buttons
            // unless the wrapper has an explicit height
            if (this.buttons.height() > Math.ceil(this.uiSpinner.height() * 0.5) &&
                this.uiSpinner.height() > 0) {
                this.uiSpinner.height(this.uiSpinner.height());
            }
        },

        _keydown: function (event) {
            var options = this.options,
                keyCode = $.ui.keyCode;

            switch (event.keyCode) {
                case keyCode.UP:
                    this._repeat(null, 1, event);
                    return true;
                case keyCode.DOWN:
                    this._repeat(null, -1, event);
                    return true;
                case keyCode.PAGE_UP:
                    this._repeat(null, options.page, event);
                    return true;
                case keyCode.PAGE_DOWN:
                    this._repeat(null, -options.page, event);
                    return true;
            }

            return false;
        },

        _start: function (event) {
            if (!this.spinning && this._trigger("start", event) === false) {
                return false;
            }

            if (!this.counter) {
                this.counter = 1;
            }
            this.spinning = true;
            return true;
        },

        _repeat: function (i, steps, event) {
            i = i || 500;

            clearTimeout(this.timer);
            this.timer = this._delay(function () {
                this._repeat(40, steps, event);
            }, i);

            this._spin(steps * this.options.step, event);
        },

        _spin: function (step, event) {
            var value = this.value() || 0;

            if (!this.counter) {
                this.counter = 1;
            }

            value = this._adjustValue(value + step * this._increment(this.counter));

            if (!this.spinning || this._trigger("spin", event, { value: value }) !== false) {
                this._value(value);
                this.counter++;
            }
        },

        _increment: function (i) {
            var incremental = this.options.incremental;

            if (incremental) {
                return $.isFunction(incremental) ?
                    incremental(i) :
                    Math.floor(i * i * i / 50000 - i * i / 500 + 17 * i / 200 + 1);
            }

            return 1;
        },

        _precision: function () {
            var precision = this._precisionOf(this.options.step);
            if (this.options.min !== null) {
                precision = Math.max(precision, this._precisionOf(this.options.min));
            }
            return precision;
        },

        _precisionOf: function (num) {
            var str = num.toString(),
                decimal = str.indexOf(".");
            return decimal === -1 ? 0 : str.length - decimal - 1;
        },

        _adjustValue: function (value) {
            var base, aboveMin,
                options = this.options;

            // Make sure we're at a valid step
            // - find out where we are relative to the base (min or 0)
            base = options.min !== null ? options.min : 0;
            aboveMin = value - base;

            // - round to the nearest step
            aboveMin = Math.round(aboveMin / options.step) * options.step;

            // - rounding is based on 0, so adjust back to our base
            value = base + aboveMin;

            // Fix precision from bad JS floating point math
            value = parseFloat(value.toFixed(this._precision()));

            // Clamp the value
            if (options.max !== null && value > options.max) {
                return options.max;
            }
            if (options.min !== null && value < options.min) {
                return options.min;
            }

            return value;
        },

        _stop: function (event) {
            if (!this.spinning) {
                return;
            }

            clearTimeout(this.timer);
            clearTimeout(this.mousewheelTimer);
            this.counter = 0;
            this.spinning = false;
            this._trigger("stop", event);
        },

        _setOption: function (key, value) {
            var prevValue, first, last;

            if (key === "culture" || key === "numberFormat") {
                prevValue = this._parse(this.element.val());
                this.options[key] = value;
                this.element.val(this._format(prevValue));
                return;
            }

            if (key === "max" || key === "min" || key === "step") {
                if (typeof value === "string") {
                    value = this._parse(value);
                }
            }
            if (key === "icons") {
                first = this.buttons.first().find(".ui-icon");
                this._removeClass(first, null, this.options.icons.up);
                this._addClass(first, null, value.up);
                last = this.buttons.last().find(".ui-icon");
                this._removeClass(last, null, this.options.icons.down);
                this._addClass(last, null, value.down);
            }

            this._super(key, value);
        },

        _setOptionDisabled: function (value) {
            this._super(value);

            this._toggleClass(this.uiSpinner, null, "ui-state-disabled", !!value);
            this.element.prop("disabled", !!value);
            this.buttons.button(value ? "disable" : "enable");
        },

        _setOptions: spinnerModifer(function (options) {
            this._super(options);
        }),

        _parse: function (val) {
            if (typeof val === "string" && val !== "") {
                val = window.Globalize && this.options.numberFormat ?
                    Globalize.parseFloat(val, 10, this.options.culture) : +val;
            }
            return val === "" || isNaN(val) ? null : val;
        },

        _format: function (value) {
            if (value === "") {
                return "";
            }
            return window.Globalize && this.options.numberFormat ?
                Globalize.format(value, this.options.numberFormat, this.options.culture) :
                value;
        },

        _refresh: function () {
            this.element.attr({
                "aria-valuemin": this.options.min,
                "aria-valuemax": this.options.max,

                // TODO: what should we do with values that can't be parsed?
                "aria-valuenow": this._parse(this.element.val())
            });
        },

        isValid: function () {
            var value = this.value();

            // Null is invalid
            if (value === null) {
                return false;
            }

            // If value gets adjusted, it's invalid
            return value === this._adjustValue(value);
        },

        // Update the value without triggering change
        _value: function (value, allowAny) {
            var parsed;
            if (value !== "") {
                parsed = this._parse(value);
                if (parsed !== null) {
                    if (!allowAny) {
                        parsed = this._adjustValue(parsed);
                    }
                    value = this._format(parsed);
                }
            }
            this.element.val(value);
            this._refresh();
        },

        _destroy: function () {
            this.element
                .prop("disabled", false)
                .removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow");

            this.uiSpinner.replaceWith(this.element);
        },

        stepUp: spinnerModifer(function (steps) {
            this._stepUp(steps);
        }),
        _stepUp: function (steps) {
            if (this._start()) {
                this._spin((steps || 1) * this.options.step);
                this._stop();
            }
        },

        stepDown: spinnerModifer(function (steps) {
            this._stepDown(steps);
        }),
        _stepDown: function (steps) {
            if (this._start()) {
                this._spin((steps || 1) * -this.options.step);
                this._stop();
            }
        },

        pageUp: spinnerModifer(function (pages) {
            this._stepUp((pages || 1) * this.options.page);
        }),

        pageDown: spinnerModifer(function (pages) {
            this._stepDown((pages || 1) * this.options.page);
        }),

        value: function (newVal) {
            if (!arguments.length) {
                return this._parse(this.element.val());
            }
            spinnerModifer(this._value).call(this, newVal);
        },

        widget: function () {
            return this.uiSpinner;
        }
    });

    // DEPRECATED
    // TODO: switch return back to widget declaration at top of file when this is removed
    if ($.uiBackCompat !== false) {

        // Backcompat for spinner html extension points
        $.widget("ui.spinner", $.ui.spinner, {
            _enhance: function () {
                this.uiSpinner = this.element
                    .attr("autocomplete", "off")
                    .wrap(this._uiSpinnerHtml())
                    .parent()

                    // Add buttons
                    .append(this._buttonHtml());
            },
            _uiSpinnerHtml: function () {
                return "<span>";
            },

            _buttonHtml: function () {
                return "<a></a><a></a>";
            }
        });
    }

    var widgetsSpinner = $.ui.spinner;


    /*!
     * jQuery UI Tabs 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Tabs
    //>>group: Widgets
    //>>description: Transforms a set of container elements into a tab structure.
    //>>docs: http://api.jqueryui.com/tabs/
    //>>demos: http://jqueryui.com/tabs/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/tabs.css
    //>>css.theme: ../../themes/base/theme.css



    $.widget("ui.tabs", {
        version: "1.12.1",
        delay: 300,
        options: {
            active: null,
            classes: {
                "ui-tabs": "ui-corner-all",
                "ui-tabs-nav": "ui-corner-all",
                "ui-tabs-panel": "ui-corner-bottom",
                "ui-tabs-tab": "ui-corner-top"
            },
            collapsible: false,
            event: "click",
            heightStyle: "content",
            hide: null,
            show: null,

            // Callbacks
            activate: null,
            beforeActivate: null,
            beforeLoad: null,
            load: null
        },

        _isLocal: (function () {
            var rhash = /#.*$/;

            return function (anchor) {
                var anchorUrl, locationUrl;

                anchorUrl = anchor.href.replace(rhash, "");
                locationUrl = location.href.replace(rhash, "");

                // Decoding may throw an error if the URL isn't UTF-8 (#9518)
                try {
                    anchorUrl = decodeURIComponent(anchorUrl);
                } catch (error) { }
                try {
                    locationUrl = decodeURIComponent(locationUrl);
                } catch (error) { }

                return anchor.hash.length > 1 && anchorUrl === locationUrl;
            };
        })(),

        _create: function () {
            var that = this,
                options = this.options;

            this.running = false;

            this._addClass("ui-tabs", "ui-widget ui-widget-content");
            this._toggleClass("ui-tabs-collapsible", null, options.collapsible);

            this._processTabs();
            options.active = this._initialActive();

            // Take disabling tabs via class attribute from HTML
            // into account and update option properly.
            if ($.isArray(options.disabled)) {
                options.disabled = $.unique(options.disabled.concat(
                    $.map(this.tabs.filter(".ui-state-disabled"), function (li) {
                        return that.tabs.index(li);
                    })
                )).sort();
            }

            // Check for length avoids error when initializing empty list
            if (this.options.active !== false && this.anchors.length) {
                this.active = this._findActive(options.active);
            } else {
                this.active = $();
            }

            this._refresh();

            if (this.active.length) {
                this.load(options.active);
            }
        },

        _initialActive: function () {
            var active = this.options.active,
                collapsible = this.options.collapsible,
                locationHash = location.hash.substring(1);

            if (active === null) {

                // check the fragment identifier in the URL
                if (locationHash) {
                    this.tabs.each(function (i, tab) {
                        if ($(tab).attr("aria-controls") === locationHash) {
                            active = i;
                            return false;
                        }
                    });
                }

                // Check for a tab marked active via a class
                if (active === null) {
                    active = this.tabs.index(this.tabs.filter(".ui-tabs-active"));
                }

                // No active tab, set to false
                if (active === null || active === -1) {
                    active = this.tabs.length ? 0 : false;
                }
            }

            // Handle numbers: negative, out of range
            if (active !== false) {
                active = this.tabs.index(this.tabs.eq(active));
                if (active === -1) {
                    active = collapsible ? false : 0;
                }
            }

            // Don't allow collapsible: false and active: false
            if (!collapsible && active === false && this.anchors.length) {
                active = 0;
            }

            return active;
        },

        _getCreateEventData: function () {
            return {
                tab: this.active,
                panel: !this.active.length ? $() : this._getPanelForTab(this.active)
            };
        },

        _tabKeydown: function (event) {
            var focusedTab = $($.ui.safeActiveElement(this.document[0])).closest("li"),
                selectedIndex = this.tabs.index(focusedTab),
                goingForward = true;

            if (this._handlePageNav(event)) {
                return;
            }

            switch (event.keyCode) {
                case $.ui.keyCode.RIGHT:
                case $.ui.keyCode.DOWN:
                    selectedIndex++;
                    break;
                case $.ui.keyCode.UP:
                case $.ui.keyCode.LEFT:
                    goingForward = false;
                    selectedIndex--;
                    break;
                case $.ui.keyCode.END:
                    selectedIndex = this.anchors.length - 1;
                    break;
                case $.ui.keyCode.HOME:
                    selectedIndex = 0;
                    break;
                case $.ui.keyCode.SPACE:

                    // Activate only, no collapsing
                    event.preventDefault();
                    clearTimeout(this.activating);
                    this._activate(selectedIndex);
                    return;
                case $.ui.keyCode.ENTER:

                    // Toggle (cancel delayed activation, allow collapsing)
                    event.preventDefault();
                    clearTimeout(this.activating);

                    // Determine if we should collapse or activate
                    this._activate(selectedIndex === this.options.active ? false : selectedIndex);
                    return;
                default:
                    return;
            }

            // Focus the appropriate tab, based on which key was pressed
            event.preventDefault();
            clearTimeout(this.activating);
            selectedIndex = this._focusNextTab(selectedIndex, goingForward);

            // Navigating with control/command key will prevent automatic activation
            if (!event.ctrlKey && !event.metaKey) {

                // Update aria-selected immediately so that AT think the tab is already selected.
                // Otherwise AT may confuse the user by stating that they need to activate the tab,
                // but the tab will already be activated by the time the announcement finishes.
                focusedTab.attr("aria-selected", "false");
                this.tabs.eq(selectedIndex).attr("aria-selected", "true");

                this.activating = this._delay(function () {
                    this.option("active", selectedIndex);
                }, this.delay);
            }
        },

        _panelKeydown: function (event) {
            if (this._handlePageNav(event)) {
                return;
            }

            // Ctrl+up moves focus to the current tab
            if (event.ctrlKey && event.keyCode === $.ui.keyCode.UP) {
                event.preventDefault();
                this.active.trigger("focus");
            }
        },

        // Alt+page up/down moves focus to the previous/next tab (and activates)
        _handlePageNav: function (event) {
            if (event.altKey && event.keyCode === $.ui.keyCode.PAGE_UP) {
                this._activate(this._focusNextTab(this.options.active - 1, false));
                return true;
            }
            if (event.altKey && event.keyCode === $.ui.keyCode.PAGE_DOWN) {
                this._activate(this._focusNextTab(this.options.active + 1, true));
                return true;
            }
        },

        _findNextTab: function (index, goingForward) {
            var lastTabIndex = this.tabs.length - 1;

            function constrain() {
                if (index > lastTabIndex) {
                    index = 0;
                }
                if (index < 0) {
                    index = lastTabIndex;
                }
                return index;
            }

            while ($.inArray(constrain(), this.options.disabled) !== -1) {
                index = goingForward ? index + 1 : index - 1;
            }

            return index;
        },

        _focusNextTab: function (index, goingForward) {
            index = this._findNextTab(index, goingForward);
            this.tabs.eq(index).trigger("focus");
            return index;
        },

        _setOption: function (key, value) {
            if (key === "active") {

                // _activate() will handle invalid values and update this.options
                this._activate(value);
                return;
            }

            this._super(key, value);

            if (key === "collapsible") {
                this._toggleClass("ui-tabs-collapsible", null, value);

                // Setting collapsible: false while collapsed; open first panel
                if (!value && this.options.active === false) {
                    this._activate(0);
                }
            }

            if (key === "event") {
                this._setupEvents(value);
            }

            if (key === "heightStyle") {
                this._setupHeightStyle(value);
            }
        },

        _sanitizeSelector: function (hash) {
            return hash ? hash.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^'{|}~]/g, "\\$&") : "";
        },

        refresh: function () {
            var options = this.options,
                lis = this.tablist.children(":has(a[href])");

            // Get disabled tabs from class attribute from HTML
            // this will get converted to a boolean if needed in _refresh()
            options.disabled = $.map(lis.filter(".ui-state-disabled"), function (tab) {
                return lis.index(tab);
            });

            this._processTabs();

            // Was collapsed or no tabs
            if (options.active === false || !this.anchors.length) {
                options.active = false;
                this.active = $();

                // was active, but active tab is gone
            } else if (this.active.length && !$.contains(this.tablist[0], this.active[0])) {

                // all remaining tabs are disabled
                if (this.tabs.length === options.disabled.length) {
                    options.active = false;
                    this.active = $();

                    // activate previous tab
                } else {
                    this._activate(this._findNextTab(Math.max(0, options.active - 1), false));
                }

                // was active, active tab still exists
            } else {

                // make sure active index is correct
                options.active = this.tabs.index(this.active);
            }

            this._refresh();
        },

        _refresh: function () {
            this._setOptionDisabled(this.options.disabled);
            this._setupEvents(this.options.event);
            this._setupHeightStyle(this.options.heightStyle);

            this.tabs.not(this.active).attr({
                "aria-selected": "false",
                "aria-expanded": "false",
                tabIndex: -1
            });
            this.panels.not(this._getPanelForTab(this.active))
                .hide()
                .attr({
                    "aria-hidden": "true"
                });

            // Make sure one tab is in the tab order
            if (!this.active.length) {
                this.tabs.eq(0).attr("tabIndex", 0);
            } else {
                this.active
                    .attr({
                        "aria-selected": "true",
                        "aria-expanded": "true",
                        tabIndex: 0
                    });
                this._addClass(this.active, "ui-tabs-active", "ui-state-active");
                this._getPanelForTab(this.active)
                    .show()
                    .attr({
                        "aria-hidden": "false"
                    });
            }
        },

        _processTabs: function () {
            var that = this,
                prevTabs = this.tabs,
                prevAnchors = this.anchors,
                prevPanels = this.panels;

            this.tablist = this._getList().attr("role", "tablist");
            this._addClass(this.tablist, "ui-tabs-nav",
                "ui-helper-reset ui-helper-clearfix ui-widget-header");

            // Prevent users from focusing disabled tabs via click
            this.tablist
                .on("mousedown" + this.eventNamespace, "> li", function (event) {
                    if ($(this).is(".ui-state-disabled")) {
                        event.preventDefault();
                    }
                })

                // Support: IE <9
                // Preventing the default action in mousedown doesn't prevent IE
                // from focusing the element, so if the anchor gets focused, blur.
                // We don't have to worry about focusing the previously focused
                // element since clicking on a non-focusable element should focus
                // the body anyway.
                .on("focus" + this.eventNamespace, ".ui-tabs-anchor", function () {
                    if ($(this).closest("li").is(".ui-state-disabled")) {
                        this.blur();
                    }
                });

            this.tabs = this.tablist.find("> li:has(a[href])")
                .attr({
                    role: "tab",
                    tabIndex: -1
                });
            this._addClass(this.tabs, "ui-tabs-tab", "ui-state-default");

            this.anchors = this.tabs.map(function () {
                return $("a", this)[0];
            })
                .attr({
                    role: "presentation",
                    tabIndex: -1
                });
            this._addClass(this.anchors, "ui-tabs-anchor");

            this.panels = $();

            this.anchors.each(function (i, anchor) {
                var selector, panel, panelId,
                    anchorId = $(anchor).uniqueId().attr("id"),
                    tab = $(anchor).closest("li"),
                    originalAriaControls = tab.attr("aria-controls");

                // Inline tab
                if (that._isLocal(anchor)) {
                    selector = anchor.hash;
                    panelId = selector.substring(1);
                    panel = that.element.find(that._sanitizeSelector(selector));

                    // remote tab
                } else {

                    // If the tab doesn't already have aria-controls,
                    // generate an id by using a throw-away element
                    panelId = tab.attr("aria-controls") || $({}).uniqueId()[0].id;
                    selector = "#" + panelId;
                    panel = that.element.find(selector);
                    if (!panel.length) {
                        panel = that._createPanel(panelId);
                        panel.insertAfter(that.panels[i - 1] || that.tablist);
                    }
                    panel.attr("aria-live", "polite");
                }

                if (panel.length) {
                    that.panels = that.panels.add(panel);
                }
                if (originalAriaControls) {
                    tab.data("ui-tabs-aria-controls", originalAriaControls);
                }
                tab.attr({
                    "aria-controls": panelId,
                    "aria-labelledby": anchorId
                });
                panel.attr("aria-labelledby", anchorId);
            });

            this.panels.attr("role", "tabpanel");
            this._addClass(this.panels, "ui-tabs-panel", "ui-widget-content");

            // Avoid memory leaks (#10056)
            if (prevTabs) {
                this._off(prevTabs.not(this.tabs));
                this._off(prevAnchors.not(this.anchors));
                this._off(prevPanels.not(this.panels));
            }
        },

        // Allow overriding how to find the list for rare usage scenarios (#7715)
        _getList: function () {
            return this.tablist || this.element.find("ol, ul").eq(0);
        },

        _createPanel: function (id) {
            return $("<div>")
                .attr("id", id)
                .data("ui-tabs-destroy", true);
        },

        _setOptionDisabled: function (disabled) {
            var currentItem, li, i;

            if ($.isArray(disabled)) {
                if (!disabled.length) {
                    disabled = false;
                } else if (disabled.length === this.anchors.length) {
                    disabled = true;
                }
            }

            // Disable tabs
            for (i = 0; (li = this.tabs[i]); i++) {
                currentItem = $(li);
                if (disabled === true || $.inArray(i, disabled) !== -1) {
                    currentItem.attr("aria-disabled", "true");
                    this._addClass(currentItem, null, "ui-state-disabled");
                } else {
                    currentItem.removeAttr("aria-disabled");
                    this._removeClass(currentItem, null, "ui-state-disabled");
                }
            }

            this.options.disabled = disabled;

            this._toggleClass(this.widget(), this.widgetFullName + "-disabled", null,
                disabled === true);
        },

        _setupEvents: function (event) {
            var events = {};
            if (event) {
                $.each(event.split(" "), function (index, eventName) {
                    events[eventName] = "_eventHandler";
                });
            }

            this._off(this.anchors.add(this.tabs).add(this.panels));

            // Always prevent the default action, even when disabled
            this._on(true, this.anchors, {
                click: function (event) {
                    event.preventDefault();
                }
            });
            this._on(this.anchors, events);
            this._on(this.tabs, { keydown: "_tabKeydown" });
            this._on(this.panels, { keydown: "_panelKeydown" });

            this._focusable(this.tabs);
            this._hoverable(this.tabs);
        },

        _setupHeightStyle: function (heightStyle) {
            var maxHeight,
                parent = this.element.parent();

            if (heightStyle === "fill") {
                maxHeight = parent.height();
                maxHeight -= this.element.outerHeight() - this.element.height();

                this.element.siblings(":visible").each(function () {
                    var elem = $(this),
                        position = elem.css("position");

                    if (position === "absolute" || position === "fixed") {
                        return;
                    }
                    maxHeight -= elem.outerHeight(true);
                });

                this.element.children().not(this.panels).each(function () {
                    maxHeight -= $(this).outerHeight(true);
                });

                this.panels.each(function () {
                    $(this).height(Math.max(0, maxHeight -
                        $(this).innerHeight() + $(this).height()));
                })
                    .css("overflow", "auto");
            } else if (heightStyle === "auto") {
                maxHeight = 0;
                this.panels.each(function () {
                    maxHeight = Math.max(maxHeight, $(this).height("").height());
                }).height(maxHeight);
            }
        },

        _eventHandler: function (event) {
            var options = this.options,
                active = this.active,
                anchor = $(event.currentTarget),
                tab = anchor.closest("li"),
                clickedIsActive = tab[0] === active[0],
                collapsing = clickedIsActive && options.collapsible,
                toShow = collapsing ? $() : this._getPanelForTab(tab),
                toHide = !active.length ? $() : this._getPanelForTab(active),
                eventData = {
                    oldTab: active,
                    oldPanel: toHide,
                    newTab: collapsing ? $() : tab,
                    newPanel: toShow
                };

            event.preventDefault();

            if (tab.hasClass("ui-state-disabled") ||

                // tab is already loading
                tab.hasClass("ui-tabs-loading") ||

                // can't switch durning an animation
                this.running ||

                // click on active header, but not collapsible
                (clickedIsActive && !options.collapsible) ||

                // allow canceling activation
                (this._trigger("beforeActivate", event, eventData) === false)) {
                return;
            }

            options.active = collapsing ? false : this.tabs.index(tab);

            this.active = clickedIsActive ? $() : tab;
            if (this.xhr) {
                this.xhr.abort();
            }

            if (!toHide.length && !toShow.length) {
                $.error("jQuery UI Tabs: Mismatching fragment identifier.");
            }

            if (toShow.length) {
                this.load(this.tabs.index(tab), event);
            }
            this._toggle(event, eventData);
        },

        // Handles show/hide for selecting tabs
        _toggle: function (event, eventData) {
            var that = this,
                toShow = eventData.newPanel,
                toHide = eventData.oldPanel;

            this.running = true;

            function complete() {
                that.running = false;
                that._trigger("activate", event, eventData);
            }

            function show() {
                that._addClass(eventData.newTab.closest("li"), "ui-tabs-active", "ui-state-active");

                if (toShow.length && that.options.show) {
                    that._show(toShow, that.options.show, complete);
                } else {
                    toShow.show();
                    complete();
                }
            }

            // Start out by hiding, then showing, then completing
            if (toHide.length && this.options.hide) {
                this._hide(toHide, this.options.hide, function () {
                    that._removeClass(eventData.oldTab.closest("li"),
                        "ui-tabs-active", "ui-state-active");
                    show();
                });
            } else {
                this._removeClass(eventData.oldTab.closest("li"),
                    "ui-tabs-active", "ui-state-active");
                toHide.hide();
                show();
            }

            toHide.attr("aria-hidden", "true");
            eventData.oldTab.attr({
                "aria-selected": "false",
                "aria-expanded": "false"
            });

            // If we're switching tabs, remove the old tab from the tab order.
            // If we're opening from collapsed state, remove the previous tab from the tab order.
            // If we're collapsing, then keep the collapsing tab in the tab order.
            if (toShow.length && toHide.length) {
                eventData.oldTab.attr("tabIndex", -1);
            } else if (toShow.length) {
                this.tabs.filter(function () {
                    return $(this).attr("tabIndex") === 0;
                })
                    .attr("tabIndex", -1);
            }

            toShow.attr("aria-hidden", "false");
            eventData.newTab.attr({
                "aria-selected": "true",
                "aria-expanded": "true",
                tabIndex: 0
            });
        },

        _activate: function (index) {
            var anchor,
                active = this._findActive(index);

            // Trying to activate the already active panel
            if (active[0] === this.active[0]) {
                return;
            }

            // Trying to collapse, simulate a click on the current active header
            if (!active.length) {
                active = this.active;
            }

            anchor = active.find(".ui-tabs-anchor")[0];
            this._eventHandler({
                target: anchor,
                currentTarget: anchor,
                preventDefault: $.noop
            });
        },

        _findActive: function (index) {
            return index === false ? $() : this.tabs.eq(index);
        },

        _getIndex: function (index) {

            // meta-function to give users option to provide a href string instead of a numerical index.
            if (typeof index === "string") {
                index = this.anchors.index(this.anchors.filter("[href$='" +
                    $.ui.escapeSelector(index) + "']"));
            }

            return index;
        },

        _destroy: function () {
            if (this.xhr) {
                this.xhr.abort();
            }

            this.tablist
                .removeAttr("role")
                .off(this.eventNamespace);

            this.anchors
                .removeAttr("role tabIndex")
                .removeUniqueId();

            this.tabs.add(this.panels).each(function () {
                if ($.data(this, "ui-tabs-destroy")) {
                    $(this).remove();
                } else {
                    $(this).removeAttr("role tabIndex " +
                        "aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded");
                }
            });

            this.tabs.each(function () {
                var li = $(this),
                    prev = li.data("ui-tabs-aria-controls");
                if (prev) {
                    li
                        .attr("aria-controls", prev)
                        .removeData("ui-tabs-aria-controls");
                } else {
                    li.removeAttr("aria-controls");
                }
            });

            this.panels.show();

            if (this.options.heightStyle !== "content") {
                this.panels.css("height", "");
            }
        },

        enable: function (index) {
            var disabled = this.options.disabled;
            if (disabled === false) {
                return;
            }

            if (index === undefined) {
                disabled = false;
            } else {
                index = this._getIndex(index);
                if ($.isArray(disabled)) {
                    disabled = $.map(disabled, function (num) {
                        return num !== index ? num : null;
                    });
                } else {
                    disabled = $.map(this.tabs, function (li, num) {
                        return num !== index ? num : null;
                    });
                }
            }
            this._setOptionDisabled(disabled);
        },

        disable: function (index) {
            var disabled = this.options.disabled;
            if (disabled === true) {
                return;
            }

            if (index === undefined) {
                disabled = true;
            } else {
                index = this._getIndex(index);
                if ($.inArray(index, disabled) !== -1) {
                    return;
                }
                if ($.isArray(disabled)) {
                    disabled = $.merge([index], disabled).sort();
                } else {
                    disabled = [index];
                }
            }
            this._setOptionDisabled(disabled);
        },

        load: function (index, event) {
            index = this._getIndex(index);
            var that = this,
                tab = this.tabs.eq(index),
                anchor = tab.find(".ui-tabs-anchor"),
                panel = this._getPanelForTab(tab),
                eventData = {
                    tab: tab,
                    panel: panel
                },
                complete = function (jqXHR, status) {
                    if (status === "abort") {
                        that.panels.stop(false, true);
                    }

                    that._removeClass(tab, "ui-tabs-loading");
                    panel.removeAttr("aria-busy");

                    if (jqXHR === that.xhr) {
                        delete that.xhr;
                    }
                };

            // Not remote
            if (this._isLocal(anchor[0])) {
                return;
            }

            this.xhr = $.ajax(this._ajaxSettings(anchor, event, eventData));

            // Support: jQuery <1.8
            // jQuery <1.8 returns false if the request is canceled in beforeSend,
            // but as of 1.8, $.ajax() always returns a jqXHR object.
            if (this.xhr && this.xhr.statusText !== "canceled") {
                this._addClass(tab, "ui-tabs-loading");
                panel.attr("aria-busy", "true");

                this.xhr
                    .done(function (response, status, jqXHR) {

                        // support: jQuery <1.8
                        // http://bugs.jquery.com/ticket/11778
                        setTimeout(function () {
                            panel.html(response);
                            that._trigger("load", event, eventData);

                            complete(jqXHR, status);
                        }, 1);
                    })
                    .fail(function (jqXHR, status) {

                        // support: jQuery <1.8
                        // http://bugs.jquery.com/ticket/11778
                        setTimeout(function () {
                            complete(jqXHR, status);
                        }, 1);
                    });
            }
        },

        _ajaxSettings: function (anchor, event, eventData) {
            var that = this;
            return {

                // Support: IE <11 only
                // Strip any hash that exists to prevent errors with the Ajax request
                url: anchor.attr("href").replace(/#.*$/, ""),
                beforeSend: function (jqXHR, settings) {
                    return that._trigger("beforeLoad", event,
                        $.extend({ jqXHR: jqXHR, ajaxSettings: settings }, eventData));
                }
            };
        },

        _getPanelForTab: function (tab) {
            var id = $(tab).attr("aria-controls");
            return this.element.find(this._sanitizeSelector("#" + id));
        }
    });

    // DEPRECATED
    // TODO: Switch return back to widget declaration at top of file when this is removed
    if ($.uiBackCompat !== false) {

        // Backcompat for ui-tab class (now ui-tabs-tab)
        $.widget("ui.tabs", $.ui.tabs, {
            _processTabs: function () {
                this._superApply(arguments);
                this._addClass(this.tabs, "ui-tab");
            }
        });
    }

    var widgetsTabs = $.ui.tabs;


    /*!
     * jQuery UI Tooltip 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Tooltip
    //>>group: Widgets
    //>>description: Shows additional information for any element on hover or focus.
    //>>docs: http://api.jqueryui.com/tooltip/
    //>>demos: http://jqueryui.com/tooltip/
    //>>css.structure: ../../themes/base/core.css
    //>>css.structure: ../../themes/base/tooltip.css
    //>>css.theme: ../../themes/base/theme.css



    $.widget("ui.tooltip", {
        version: "1.12.1",
        options: {
            classes: {
                "ui-tooltip": "ui-corner-all ui-widget-shadow"
            },
            content: function () {

                // support: IE<9, Opera in jQuery <1.7
                // .text() can't accept undefined, so coerce to a string
                var title = $(this).attr("title") || "";

                // Escape title, since we're going from an attribute to raw HTML
                return $("<a>").text(title).html();
            },
            hide: true,

            // Disabled elements have inconsistent behavior across browsers (#8661)
            items: "[title]:not([disabled])",
            position: {
                my: "left top+15",
                at: "left bottom",
                collision: "flipfit flip"
            },
            show: true,
            track: false,

            // Callbacks
            close: null,
            open: null
        },

        _addDescribedBy: function (elem, id) {
            var describedby = (elem.attr("aria-describedby") || "").split(/\s+/);
            describedby.push(id);
            elem
                .data("ui-tooltip-id", id)
                .attr("aria-describedby", $.trim(describedby.join(" ")));
        },

        _removeDescribedBy: function (elem) {
            var id = elem.data("ui-tooltip-id"),
                describedby = (elem.attr("aria-describedby") || "").split(/\s+/),
                index = $.inArray(id, describedby);

            if (index !== -1) {
                describedby.splice(index, 1);
            }

            elem.removeData("ui-tooltip-id");
            describedby = $.trim(describedby.join(" "));
            if (describedby) {
                elem.attr("aria-describedby", describedby);
            } else {
                elem.removeAttr("aria-describedby");
            }
        },

        _create: function () {
            this._on({
                mouseover: "open",
                focusin: "open"
            });

            // IDs of generated tooltips, needed for destroy
            this.tooltips = {};

            // IDs of parent tooltips where we removed the title attribute
            this.parents = {};

            // Append the aria-live region so tooltips announce correctly
            this.liveRegion = $("<div>")
                .attr({
                    role: "log",
                    "aria-live": "assertive",
                    "aria-relevant": "additions"
                })
                .appendTo(this.document[0].body);
            this._addClass(this.liveRegion, null, "ui-helper-hidden-accessible");

            this.disabledTitles = $([]);
        },

        _setOption: function (key, value) {
            var that = this;

            this._super(key, value);

            if (key === "content") {
                $.each(this.tooltips, function (id, tooltipData) {
                    that._updateContent(tooltipData.element);
                });
            }
        },

        _setOptionDisabled: function (value) {
            this[value ? "_disable" : "_enable"]();
        },

        _disable: function () {
            var that = this;

            // Close open tooltips
            $.each(this.tooltips, function (id, tooltipData) {
                var event = $.Event("blur");
                event.target = event.currentTarget = tooltipData.element[0];
                that.close(event, true);
            });

            // Remove title attributes to prevent native tooltips
            this.disabledTitles = this.disabledTitles.add(
                this.element.find(this.options.items).addBack()
                    .filter(function () {
                        var element = $(this);
                        if (element.is("[title]")) {
                            return element
                                .data("ui-tooltip-title", element.attr("title"))
                                .removeAttr("title");
                        }
                    })
            );
        },

        _enable: function () {

            // restore title attributes
            this.disabledTitles.each(function () {
                var element = $(this);
                if (element.data("ui-tooltip-title")) {
                    element.attr("title", element.data("ui-tooltip-title"));
                }
            });
            this.disabledTitles = $([]);
        },

        open: function (event) {
            var that = this,
                target = $(event ? event.target : this.element)

                    // we need closest here due to mouseover bubbling,
                    // but always pointing at the same event target
                    .closest(this.options.items);

            // No element to show a tooltip for or the tooltip is already open
            if (!target.length || target.data("ui-tooltip-id")) {
                return;
            }

            if (target.attr("title")) {
                target.data("ui-tooltip-title", target.attr("title"));
            }

            target.data("ui-tooltip-open", true);

            // Kill parent tooltips, custom or native, for hover
            if (event && event.type === "mouseover") {
                target.parents().each(function () {
                    var parent = $(this),
                        blurEvent;
                    if (parent.data("ui-tooltip-open")) {
                        blurEvent = $.Event("blur");
                        blurEvent.target = blurEvent.currentTarget = this;
                        that.close(blurEvent, true);
                    }
                    if (parent.attr("title")) {
                        parent.uniqueId();
                        that.parents[this.id] = {
                            element: this,
                            title: parent.attr("title")
                        };
                        parent.attr("title", "");
                    }
                });
            }

            this._registerCloseHandlers(event, target);
            this._updateContent(target, event);
        },

        _updateContent: function (target, event) {
            var content,
                contentOption = this.options.content,
                that = this,
                eventType = event ? event.type : null;

            if (typeof contentOption === "string" || contentOption.nodeType ||
                contentOption.jquery) {
                return this._open(event, target, contentOption);
            }

            content = contentOption.call(target[0], function (response) {

                // IE may instantly serve a cached response for ajax requests
                // delay this call to _open so the other call to _open runs first
                that._delay(function () {

                    // Ignore async response if tooltip was closed already
                    if (!target.data("ui-tooltip-open")) {
                        return;
                    }

                    // JQuery creates a special event for focusin when it doesn't
                    // exist natively. To improve performance, the native event
                    // object is reused and the type is changed. Therefore, we can't
                    // rely on the type being correct after the event finished
                    // bubbling, so we set it back to the previous value. (#8740)
                    if (event) {
                        event.type = eventType;
                    }
                    this._open(event, target, response);
                });
            });
            if (content) {
                this._open(event, target, content);
            }
        },

        _open: function (event, target, content) {
            var tooltipData, tooltip, delayedShow, a11yContent,
                positionOption = $.extend({}, this.options.position);

            if (!content) {
                return;
            }

            // Content can be updated multiple times. If the tooltip already
            // exists, then just update the content and bail.
            tooltipData = this._find(target);
            if (tooltipData) {
                tooltipData.tooltip.find(".ui-tooltip-content").html(content);
                return;
            }

            // If we have a title, clear it to prevent the native tooltip
            // we have to check first to avoid defining a title if none exists
            // (we don't want to cause an element to start matching [title])
            //
            // We use removeAttr only for key events, to allow IE to export the correct
            // accessible attributes. For mouse events, set to empty string to avoid
            // native tooltip showing up (happens only when removing inside mouseover).
            if (target.is("[title]")) {
                if (event && event.type === "mouseover") {
                    target.attr("title", "");
                } else {
                    target.removeAttr("title");
                }
            }

            tooltipData = this._tooltip(target);
            tooltip = tooltipData.tooltip;
            this._addDescribedBy(target, tooltip.attr("id"));
            tooltip.find(".ui-tooltip-content").html(content);

            // Support: Voiceover on OS X, JAWS on IE <= 9
            // JAWS announces deletions even when aria-relevant="additions"
            // Voiceover will sometimes re-read the entire log region's contents from the beginning
            this.liveRegion.children().hide();
            a11yContent = $("<div>").html(tooltip.find(".ui-tooltip-content").html());
            a11yContent.removeAttr("name").find("[name]").removeAttr("name");
            a11yContent.removeAttr("id").find("[id]").removeAttr("id");
            a11yContent.appendTo(this.liveRegion);

            function position(event) {
                positionOption.of = event;
                if (tooltip.is(":hidden")) {
                    return;
                }
                tooltip.position(positionOption);
            }
            if (this.options.track && event && /^mouse/.test(event.type)) {
                this._on(this.document, {
                    mousemove: position
                });

                // trigger once to override element-relative positioning
                position(event);
            } else {
                tooltip.position($.extend({
                    of: target
                }, this.options.position));
            }

            tooltip.hide();

            this._show(tooltip, this.options.show);

            // Handle tracking tooltips that are shown with a delay (#8644). As soon
            // as the tooltip is visible, position the tooltip using the most recent
            // event.
            // Adds the check to add the timers only when both delay and track options are set (#14682)
            if (this.options.track && this.options.show && this.options.show.delay) {
                delayedShow = this.delayedShow = setInterval(function () {
                    if (tooltip.is(":visible")) {
                        position(positionOption.of);
                        clearInterval(delayedShow);
                    }
                }, $.fx.interval);
            }

            this._trigger("open", event, { tooltip: tooltip });
        },

        _registerCloseHandlers: function (event, target) {
            var events = {
                keyup: function (event) {
                    if (event.keyCode === $.ui.keyCode.ESCAPE) {
                        var fakeEvent = $.Event(event);
                        fakeEvent.currentTarget = target[0];
                        this.close(fakeEvent, true);
                    }
                }
            };

            // Only bind remove handler for delegated targets. Non-delegated
            // tooltips will handle this in destroy.
            if (target[0] !== this.element[0]) {
                events.remove = function () {
                    this._removeTooltip(this._find(target).tooltip);
                };
            }

            if (!event || event.type === "mouseover") {
                events.mouseleave = "close";
            }
            if (!event || event.type === "focusin") {
                events.focusout = "close";
            }
            this._on(true, target, events);
        },

        close: function (event) {
            var tooltip,
                that = this,
                target = $(event ? event.currentTarget : this.element),
                tooltipData = this._find(target);

            // The tooltip may already be closed
            if (!tooltipData) {

                // We set ui-tooltip-open immediately upon open (in open()), but only set the
                // additional data once there's actually content to show (in _open()). So even if the
                // tooltip doesn't have full data, we always remove ui-tooltip-open in case we're in
                // the period between open() and _open().
                target.removeData("ui-tooltip-open");
                return;
            }

            tooltip = tooltipData.tooltip;

            // Disabling closes the tooltip, so we need to track when we're closing
            // to avoid an infinite loop in case the tooltip becomes disabled on close
            if (tooltipData.closing) {
                return;
            }

            // Clear the interval for delayed tracking tooltips
            clearInterval(this.delayedShow);

            // Only set title if we had one before (see comment in _open())
            // If the title attribute has changed since open(), don't restore
            if (target.data("ui-tooltip-title") && !target.attr("title")) {
                target.attr("title", target.data("ui-tooltip-title"));
            }

            this._removeDescribedBy(target);

            tooltipData.hiding = true;
            tooltip.stop(true);
            this._hide(tooltip, this.options.hide, function () {
                that._removeTooltip($(this));
            });

            target.removeData("ui-tooltip-open");
            this._off(target, "mouseleave focusout keyup");

            // Remove 'remove' binding only on delegated targets
            if (target[0] !== this.element[0]) {
                this._off(target, "remove");
            }
            this._off(this.document, "mousemove");

            if (event && event.type === "mouseleave") {
                $.each(this.parents, function (id, parent) {
                    $(parent.element).attr("title", parent.title);
                    delete that.parents[id];
                });
            }

            tooltipData.closing = true;
            this._trigger("close", event, { tooltip: tooltip });
            if (!tooltipData.hiding) {
                tooltipData.closing = false;
            }
        },

        _tooltip: function (element) {
            var tooltip = $("<div>").attr("role", "tooltip"),
                content = $("<div>").appendTo(tooltip),
                id = tooltip.uniqueId().attr("id");

            this._addClass(content, "ui-tooltip-content");
            this._addClass(tooltip, "ui-tooltip", "ui-widget ui-widget-content");

            tooltip.appendTo(this._appendTo(element));

            return this.tooltips[id] = {
                element: element,
                tooltip: tooltip
            };
        },

        _find: function (target) {
            var id = target.data("ui-tooltip-id");
            return id ? this.tooltips[id] : null;
        },

        _removeTooltip: function (tooltip) {
            tooltip.remove();
            delete this.tooltips[tooltip.attr("id")];
        },

        _appendTo: function (target) {
            var element = target.closest(".ui-front, dialog");

            if (!element.length) {
                element = this.document[0].body;
            }

            return element;
        },

        _destroy: function () {
            var that = this;

            // Close open tooltips
            $.each(this.tooltips, function (id, tooltipData) {

                // Delegate to close method to handle common cleanup
                var event = $.Event("blur"),
                    element = tooltipData.element;
                event.target = event.currentTarget = element[0];
                that.close(event, true);

                // Remove immediately; destroying an open tooltip doesn't use the
                // hide animation
                $("#" + id).remove();

                // Restore the title
                if (element.data("ui-tooltip-title")) {

                    // If the title attribute has changed since open(), don't restore
                    if (!element.attr("title")) {
                        element.attr("title", element.data("ui-tooltip-title"));
                    }
                    element.removeData("ui-tooltip-title");
                }
            });
            this.liveRegion.remove();
        }
    });

    // DEPRECATED
    // TODO: Switch return back to widget declaration at top of file when this is removed
    if ($.uiBackCompat !== false) {

        // Backcompat for tooltipClass option
        $.widget("ui.tooltip", $.ui.tooltip, {
            options: {
                tooltipClass: null
            },
            _tooltip: function () {
                var tooltipData = this._superApply(arguments);
                if (this.options.tooltipClass) {
                    tooltipData.tooltip.addClass(this.options.tooltipClass);
                }
                return tooltipData;
            }
        });
    }

    var widgetsTooltip = $.ui.tooltip;


    /*!
     * jQuery UI Effects 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Effects Core
    //>>group: Effects
    // jscs:disable maximumLineLength
    //>>description: Extends the internal jQuery effects. Includes morphing and easing. Required by all other effects.
    // jscs:enable maximumLineLength
    //>>docs: http://api.jqueryui.com/category/effects-core/
    //>>demos: http://jqueryui.com/effect/



    var dataSpace = "ui-effects-",
        dataSpaceStyle = "ui-effects-style",
        dataSpaceAnimated = "ui-effects-animated",

        // Create a local jQuery because jQuery Color relies on it and the
        // global may not exist with AMD and a custom build (#10199)
        jQuery = $;

    $.effects = {
        effect: {}
    };

    /*!
     * jQuery Color Animations v2.1.2
     * https://github.com/jquery/jquery-color
     *
     * Copyright 2014 jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     *
     * Date: Wed Jan 16 08:47:09 2013 -0600
     */
    (function (jQuery, undefined) {

        var stepHooks = "backgroundColor borderBottomColor borderLeftColor borderRightColor " +
            "borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",

            // Plusequals test for += 100 -= 100
            rplusequals = /^([\-+])=\s*(\d+\.?\d*)/,

            // A set of RE's that can match strings and generate color tuples.
            stringParsers = [{
                re: /rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                parse: function (execResult) {
                    return [
                        execResult[1],
                        execResult[2],
                        execResult[3],
                        execResult[4]
                    ];
                }
            }, {
                re: /rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                parse: function (execResult) {
                    return [
                        execResult[1] * 2.55,
                        execResult[2] * 2.55,
                        execResult[3] * 2.55,
                        execResult[4]
                    ];
                }
            }, {

                // This regex ignores A-F because it's compared against an already lowercased string
                re: /#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,
                parse: function (execResult) {
                    return [
                        parseInt(execResult[1], 16),
                        parseInt(execResult[2], 16),
                        parseInt(execResult[3], 16)
                    ];
                }
            }, {

                // This regex ignores A-F because it's compared against an already lowercased string
                re: /#([a-f0-9])([a-f0-9])([a-f0-9])/,
                parse: function (execResult) {
                    return [
                        parseInt(execResult[1] + execResult[1], 16),
                        parseInt(execResult[2] + execResult[2], 16),
                        parseInt(execResult[3] + execResult[3], 16)
                    ];
                }
            }, {
                re: /hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                space: "hsla",
                parse: function (execResult) {
                    return [
                        execResult[1],
                        execResult[2] / 100,
                        execResult[3] / 100,
                        execResult[4]
                    ];
                }
            }],

            // JQuery.Color( )
            color = jQuery.Color = function (color, green, blue, alpha) {
                return new jQuery.Color.fn.parse(color, green, blue, alpha);
            },
            spaces = {
                rgba: {
                    props: {
                        red: {
                            idx: 0,
                            type: "byte"
                        },
                        green: {
                            idx: 1,
                            type: "byte"
                        },
                        blue: {
                            idx: 2,
                            type: "byte"
                        }
                    }
                },

                hsla: {
                    props: {
                        hue: {
                            idx: 0,
                            type: "degrees"
                        },
                        saturation: {
                            idx: 1,
                            type: "percent"
                        },
                        lightness: {
                            idx: 2,
                            type: "percent"
                        }
                    }
                }
            },
            propTypes = {
                "byte": {
                    floor: true,
                    max: 255
                },
                "percent": {
                    max: 1
                },
                "degrees": {
                    mod: 360,
                    floor: true
                }
            },
            support = color.support = {},

            // Element for support tests
            supportElem = jQuery("<p>")[0],

            // Colors = jQuery.Color.names
            colors,

            // Local aliases of functions called often
            each = jQuery.each;

        // Determine rgba support immediately
        supportElem.style.cssText = "background-color:rgba(1,1,1,.5)";
        support.rgba = supportElem.style.backgroundColor.indexOf("rgba") > -1;

        // Define cache name and alpha properties
        // for rgba and hsla spaces
        each(spaces, function (spaceName, space) {
            space.cache = "_" + spaceName;
            space.props.alpha = {
                idx: 3,
                type: "percent",
                def: 1
            };
        });

        function clamp(value, prop, allowEmpty) {
            var type = propTypes[prop.type] || {};

            if (value == null) {
                return (allowEmpty || !prop.def) ? null : prop.def;
            }

            // ~~ is an short way of doing floor for positive numbers
            value = type.floor ? ~~value : parseFloat(value);

            // IE will pass in empty strings as value for alpha,
            // which will hit this case
            if (isNaN(value)) {
                return prop.def;
            }

            if (type.mod) {

                // We add mod before modding to make sure that negatives values
                // get converted properly: -10 -> 350
                return (value + type.mod) % type.mod;
            }

            // For now all property types without mod have min and max
            return 0 > value ? 0 : type.max < value ? type.max : value;
        }

        function stringParse(string) {
            var inst = color(),
                rgba = inst._rgba = [];

            string = string.toLowerCase();

            each(stringParsers, function (i, parser) {
                var parsed,
                    match = parser.re.exec(string),
                    values = match && parser.parse(match),
                    spaceName = parser.space || "rgba";

                if (values) {
                    parsed = inst[spaceName](values);

                    // If this was an rgba parse the assignment might happen twice
                    // oh well....
                    inst[spaces[spaceName].cache] = parsed[spaces[spaceName].cache];
                    rgba = inst._rgba = parsed._rgba;

                    // Exit each( stringParsers ) here because we matched
                    return false;
                }
            });

            // Found a stringParser that handled it
            if (rgba.length) {

                // If this came from a parsed string, force "transparent" when alpha is 0
                // chrome, (and maybe others) return "transparent" as rgba(0,0,0,0)
                if (rgba.join() === "0,0,0,0") {
                    jQuery.extend(rgba, colors.transparent);
                }
                return inst;
            }

            // Named colors
            return colors[string];
        }

        color.fn = jQuery.extend(color.prototype, {
            parse: function (red, green, blue, alpha) {
                if (red === undefined) {
                    this._rgba = [null, null, null, null];
                    return this;
                }
                if (red.jquery || red.nodeType) {
                    red = jQuery(red).css(green);
                    green = undefined;
                }

                var inst = this,
                    type = jQuery.type(red),
                    rgba = this._rgba = [];

                // More than 1 argument specified - assume ( red, green, blue, alpha )
                if (green !== undefined) {
                    red = [red, green, blue, alpha];
                    type = "array";
                }

                if (type === "string") {
                    return this.parse(stringParse(red) || colors._default);
                }

                if (type === "array") {
                    each(spaces.rgba.props, function (key, prop) {
                        rgba[prop.idx] = clamp(red[prop.idx], prop);
                    });
                    return this;
                }

                if (type === "object") {
                    if (red instanceof color) {
                        each(spaces, function (spaceName, space) {
                            if (red[space.cache]) {
                                inst[space.cache] = red[space.cache].slice();
                            }
                        });
                    } else {
                        each(spaces, function (spaceName, space) {
                            var cache = space.cache;
                            each(space.props, function (key, prop) {

                                // If the cache doesn't exist, and we know how to convert
                                if (!inst[cache] && space.to) {

                                    // If the value was null, we don't need to copy it
                                    // if the key was alpha, we don't need to copy it either
                                    if (key === "alpha" || red[key] == null) {
                                        return;
                                    }
                                    inst[cache] = space.to(inst._rgba);
                                }

                                // This is the only case where we allow nulls for ALL properties.
                                // call clamp with alwaysAllowEmpty
                                inst[cache][prop.idx] = clamp(red[key], prop, true);
                            });

                            // Everything defined but alpha?
                            if (inst[cache] &&
                                jQuery.inArray(null, inst[cache].slice(0, 3)) < 0) {

                                // Use the default of 1
                                inst[cache][3] = 1;
                                if (space.from) {
                                    inst._rgba = space.from(inst[cache]);
                                }
                            }
                        });
                    }
                    return this;
                }
            },
            is: function (compare) {
                var is = color(compare),
                    same = true,
                    inst = this;

                each(spaces, function (_, space) {
                    var localCache,
                        isCache = is[space.cache];
                    if (isCache) {
                        localCache = inst[space.cache] || space.to && space.to(inst._rgba) || [];
                        each(space.props, function (_, prop) {
                            if (isCache[prop.idx] != null) {
                                same = (isCache[prop.idx] === localCache[prop.idx]);
                                return same;
                            }
                        });
                    }
                    return same;
                });
                return same;
            },
            _space: function () {
                var used = [],
                    inst = this;
                each(spaces, function (spaceName, space) {
                    if (inst[space.cache]) {
                        used.push(spaceName);
                    }
                });
                return used.pop();
            },
            transition: function (other, distance) {
                var end = color(other),
                    spaceName = end._space(),
                    space = spaces[spaceName],
                    startColor = this.alpha() === 0 ? color("transparent") : this,
                    start = startColor[space.cache] || space.to(startColor._rgba),
                    result = start.slice();

                end = end[space.cache];
                each(space.props, function (key, prop) {
                    var index = prop.idx,
                        startValue = start[index],
                        endValue = end[index],
                        type = propTypes[prop.type] || {};

                    // If null, don't override start value
                    if (endValue === null) {
                        return;
                    }

                    // If null - use end
                    if (startValue === null) {
                        result[index] = endValue;
                    } else {
                        if (type.mod) {
                            if (endValue - startValue > type.mod / 2) {
                                startValue += type.mod;
                            } else if (startValue - endValue > type.mod / 2) {
                                startValue -= type.mod;
                            }
                        }
                        result[index] = clamp((endValue - startValue) * distance + startValue, prop);
                    }
                });
                return this[spaceName](result);
            },
            blend: function (opaque) {

                // If we are already opaque - return ourself
                if (this._rgba[3] === 1) {
                    return this;
                }

                var rgb = this._rgba.slice(),
                    a = rgb.pop(),
                    blend = color(opaque)._rgba;

                return color(jQuery.map(rgb, function (v, i) {
                    return (1 - a) * blend[i] + a * v;
                }));
            },
            toRgbaString: function () {
                var prefix = "rgba(",
                    rgba = jQuery.map(this._rgba, function (v, i) {
                        return v == null ? (i > 2 ? 1 : 0) : v;
                    });

                if (rgba[3] === 1) {
                    rgba.pop();
                    prefix = "rgb(";
                }

                return prefix + rgba.join() + ")";
            },
            toHslaString: function () {
                var prefix = "hsla(",
                    hsla = jQuery.map(this.hsla(), function (v, i) {
                        if (v == null) {
                            v = i > 2 ? 1 : 0;
                        }

                        // Catch 1 and 2
                        if (i && i < 3) {
                            v = Math.round(v * 100) + "%";
                        }
                        return v;
                    });

                if (hsla[3] === 1) {
                    hsla.pop();
                    prefix = "hsl(";
                }
                return prefix + hsla.join() + ")";
            },
            toHexString: function (includeAlpha) {
                var rgba = this._rgba.slice(),
                    alpha = rgba.pop();

                if (includeAlpha) {
                    rgba.push(~~(alpha * 255));
                }

                return "#" + jQuery.map(rgba, function (v) {

                    // Default to 0 when nulls exist
                    v = (v || 0).toString(16);
                    return v.length === 1 ? "0" + v : v;
                }).join("");
            },
            toString: function () {
                return this._rgba[3] === 0 ? "transparent" : this.toRgbaString();
            }
        });
        color.fn.parse.prototype = color.fn;

        // Hsla conversions adapted from:
        // https://code.google.com/p/maashaack/source/browse/packages/graphics/trunk/src/graphics/colors/HUE2RGB.as?r=5021

        function hue2rgb(p, q, h) {
            h = (h + 1) % 1;
            if (h * 6 < 1) {
                return p + (q - p) * h * 6;
            }
            if (h * 2 < 1) {
                return q;
            }
            if (h * 3 < 2) {
                return p + (q - p) * ((2 / 3) - h) * 6;
            }
            return p;
        }

        spaces.hsla.to = function (rgba) {
            if (rgba[0] == null || rgba[1] == null || rgba[2] == null) {
                return [null, null, null, rgba[3]];
            }
            var r = rgba[0] / 255,
                g = rgba[1] / 255,
                b = rgba[2] / 255,
                a = rgba[3],
                max = Math.max(r, g, b),
                min = Math.min(r, g, b),
                diff = max - min,
                add = max + min,
                l = add * 0.5,
                h, s;

            if (min === max) {
                h = 0;
            } else if (r === max) {
                h = (60 * (g - b) / diff) + 360;
            } else if (g === max) {
                h = (60 * (b - r) / diff) + 120;
            } else {
                h = (60 * (r - g) / diff) + 240;
            }

            // Chroma (diff) == 0 means greyscale which, by definition, saturation = 0%
            // otherwise, saturation is based on the ratio of chroma (diff) to lightness (add)
            if (diff === 0) {
                s = 0;
            } else if (l <= 0.5) {
                s = diff / add;
            } else {
                s = diff / (2 - add);
            }
            return [Math.round(h) % 360, s, l, a == null ? 1 : a];
        };

        spaces.hsla.from = function (hsla) {
            if (hsla[0] == null || hsla[1] == null || hsla[2] == null) {
                return [null, null, null, hsla[3]];
            }
            var h = hsla[0] / 360,
                s = hsla[1],
                l = hsla[2],
                a = hsla[3],
                q = l <= 0.5 ? l * (1 + s) : l + s - l * s,
                p = 2 * l - q;

            return [
                Math.round(hue2rgb(p, q, h + (1 / 3)) * 255),
                Math.round(hue2rgb(p, q, h) * 255),
                Math.round(hue2rgb(p, q, h - (1 / 3)) * 255),
                a
            ];
        };

        each(spaces, function (spaceName, space) {
            var props = space.props,
                cache = space.cache,
                to = space.to,
                from = space.from;

            // Makes rgba() and hsla()
            color.fn[spaceName] = function (value) {

                // Generate a cache for this space if it doesn't exist
                if (to && !this[cache]) {
                    this[cache] = to(this._rgba);
                }
                if (value === undefined) {
                    return this[cache].slice();
                }

                var ret,
                    type = jQuery.type(value),
                    arr = (type === "array" || type === "object") ? value : arguments,
                    local = this[cache].slice();

                each(props, function (key, prop) {
                    var val = arr[type === "object" ? key : prop.idx];
                    if (val == null) {
                        val = local[prop.idx];
                    }
                    local[prop.idx] = clamp(val, prop);
                });

                if (from) {
                    ret = color(from(local));
                    ret[cache] = local;
                    return ret;
                } else {
                    return color(local);
                }
            };

            // Makes red() green() blue() alpha() hue() saturation() lightness()
            each(props, function (key, prop) {

                // Alpha is included in more than one space
                if (color.fn[key]) {
                    return;
                }
                color.fn[key] = function (value) {
                    var vtype = jQuery.type(value),
                        fn = (key === "alpha" ? (this._hsla ? "hsla" : "rgba") : spaceName),
                        local = this[fn](),
                        cur = local[prop.idx],
                        match;

                    if (vtype === "undefined") {
                        return cur;
                    }

                    if (vtype === "function") {
                        value = value.call(this, cur);
                        vtype = jQuery.type(value);
                    }
                    if (value == null && prop.empty) {
                        return this;
                    }
                    if (vtype === "string") {
                        match = rplusequals.exec(value);
                        if (match) {
                            value = cur + parseFloat(match[2]) * (match[1] === "+" ? 1 : -1);
                        }
                    }
                    local[prop.idx] = value;
                    return this[fn](local);
                };
            });
        });

        // Add cssHook and .fx.step function for each named hook.
        // accept a space separated string of properties
        color.hook = function (hook) {
            var hooks = hook.split(" ");
            each(hooks, function (i, hook) {
                jQuery.cssHooks[hook] = {
                    set: function (elem, value) {
                        var parsed, curElem,
                            backgroundColor = "";

                        if (value !== "transparent" && (jQuery.type(value) !== "string" ||
                            (parsed = stringParse(value)))) {
                            value = color(parsed || value);
                            if (!support.rgba && value._rgba[3] !== 1) {
                                curElem = hook === "backgroundColor" ? elem.parentNode : elem;
                                while (
                                    (backgroundColor === "" || backgroundColor === "transparent") &&
                                    curElem && curElem.style
                                ) {
                                    try {
                                        backgroundColor = jQuery.css(curElem, "backgroundColor");
                                        curElem = curElem.parentNode;
                                    } catch (e) {
                                    }
                                }

                                value = value.blend(backgroundColor && backgroundColor !== "transparent" ?
                                    backgroundColor :
                                    "_default");
                            }

                            value = value.toRgbaString();
                        }
                        try {
                            elem.style[hook] = value;
                        } catch (e) {

                            // Wrapped to prevent IE from throwing errors on "invalid" values like
                            // 'auto' or 'inherit'
                        }
                    }
                };
                jQuery.fx.step[hook] = function (fx) {
                    if (!fx.colorInit) {
                        fx.start = color(fx.elem, hook);
                        fx.end = color(fx.end);
                        fx.colorInit = true;
                    }
                    jQuery.cssHooks[hook].set(fx.elem, fx.start.transition(fx.end, fx.pos));
                };
            });

        };

        color.hook(stepHooks);

        jQuery.cssHooks.borderColor = {
            expand: function (value) {
                var expanded = {};

                each(["Top", "Right", "Bottom", "Left"], function (i, part) {
                    expanded["border" + part + "Color"] = value;
                });
                return expanded;
            }
        };

        // Basic color names only.
        // Usage of any of the other color names requires adding yourself or including
        // jquery.color.svg-names.js.
        colors = jQuery.Color.names = {

            // 4.1. Basic color keywords
            aqua: "#00ffff",
            black: "#000000",
            blue: "#0000ff",
            fuchsia: "#ff00ff",
            gray: "#808080",
            green: "#008000",
            lime: "#00ff00",
            maroon: "#800000",
            navy: "#000080",
            olive: "#808000",
            purple: "#800080",
            red: "#ff0000",
            silver: "#c0c0c0",
            teal: "#008080",
            white: "#ffffff",
            yellow: "#ffff00",

            // 4.2.3. "transparent" color keyword
            transparent: [null, null, null, 0],

            _default: "#ffffff"
        };

    })(jQuery);

    /******************************************************************************/
    /****************************** CLASS ANIMATIONS ******************************/
    /******************************************************************************/
    (function () {

        var classAnimationActions = ["add", "remove", "toggle"],
            shorthandStyles = {
                border: 1,
                borderBottom: 1,
                borderColor: 1,
                borderLeft: 1,
                borderRight: 1,
                borderTop: 1,
                borderWidth: 1,
                margin: 1,
                padding: 1
            };

        $.each(
            ["borderLeftStyle", "borderRightStyle", "borderBottomStyle", "borderTopStyle"],
            function (_, prop) {
                $.fx.step[prop] = function (fx) {
                    if (fx.end !== "none" && !fx.setAttr || fx.pos === 1 && !fx.setAttr) {
                        jQuery.style(fx.elem, prop, fx.end);
                        fx.setAttr = true;
                    }
                };
            }
        );

        function getElementStyles(elem) {
            var key, len,
                style = elem.ownerDocument.defaultView ?
                    elem.ownerDocument.defaultView.getComputedStyle(elem, null) :
                    elem.currentStyle,
                styles = {};

            if (style && style.length && style[0] && style[style[0]]) {
                len = style.length;
                while (len--) {
                    key = style[len];
                    if (typeof style[key] === "string") {
                        styles[$.camelCase(key)] = style[key];
                    }
                }

                // Support: Opera, IE <9
            } else {
                for (key in style) {
                    if (typeof style[key] === "string") {
                        styles[key] = style[key];
                    }
                }
            }

            return styles;
        }

        function styleDifference(oldStyle, newStyle) {
            var diff = {},
                name, value;

            for (name in newStyle) {
                value = newStyle[name];
                if (oldStyle[name] !== value) {
                    if (!shorthandStyles[name]) {
                        if ($.fx.step[name] || !isNaN(parseFloat(value))) {
                            diff[name] = value;
                        }
                    }
                }
            }

            return diff;
        }

        // Support: jQuery <1.8
        if (!$.fn.addBack) {
            $.fn.addBack = function (selector) {
                return this.add(selector == null ?
                    this.prevObject : this.prevObject.filter(selector)
                );
            };
        }

        $.effects.animateClass = function (value, duration, easing, callback) {
            var o = $.speed(duration, easing, callback);

            return this.queue(function () {
                var animated = $(this),
                    baseClass = animated.attr("class") || "",
                    applyClassChange,
                    allAnimations = o.children ? animated.find("*").addBack() : animated;

                // Map the animated objects to store the original styles.
                allAnimations = allAnimations.map(function () {
                    var el = $(this);
                    return {
                        el: el,
                        start: getElementStyles(this)
                    };
                });

                // Apply class change
                applyClassChange = function () {
                    $.each(classAnimationActions, function (i, action) {
                        if (value[action]) {
                            animated[action + "Class"](value[action]);
                        }
                    });
                };
                applyClassChange();

                // Map all animated objects again - calculate new styles and diff
                allAnimations = allAnimations.map(function () {
                    this.end = getElementStyles(this.el[0]);
                    this.diff = styleDifference(this.start, this.end);
                    return this;
                });

                // Apply original class
                animated.attr("class", baseClass);

                // Map all animated objects again - this time collecting a promise
                allAnimations = allAnimations.map(function () {
                    var styleInfo = this,
                        dfd = $.Deferred(),
                        opts = $.extend({}, o, {
                            queue: false,
                            complete: function () {
                                dfd.resolve(styleInfo);
                            }
                        });

                    this.el.animate(this.diff, opts);
                    return dfd.promise();
                });

                // Once all animations have completed:
                $.when.apply($, allAnimations.get()).done(function () {

                    // Set the final class
                    applyClassChange();

                    // For each animated element,
                    // clear all css properties that were animated
                    $.each(arguments, function () {
                        var el = this.el;
                        $.each(this.diff, function (key) {
                            el.css(key, "");
                        });
                    });

                    // This is guarnteed to be there if you use jQuery.speed()
                    // it also handles dequeuing the next anim...
                    o.complete.call(animated[0]);
                });
            });
        };

        $.fn.extend({
            addClass: (function (orig) {
                return function (classNames, speed, easing, callback) {
                    return speed ?
                        $.effects.animateClass.call(this,
                            { add: classNames }, speed, easing, callback) :
                        orig.apply(this, arguments);
                };
            })($.fn.addClass),

            removeClass: (function (orig) {
                return function (classNames, speed, easing, callback) {
                    return arguments.length > 1 ?
                        $.effects.animateClass.call(this,
                            { remove: classNames }, speed, easing, callback) :
                        orig.apply(this, arguments);
                };
            })($.fn.removeClass),

            toggleClass: (function (orig) {
                return function (classNames, force, speed, easing, callback) {
                    if (typeof force === "boolean" || force === undefined) {
                        if (!speed) {

                            // Without speed parameter
                            return orig.apply(this, arguments);
                        } else {
                            return $.effects.animateClass.call(this,
                                (force ? { add: classNames } : { remove: classNames }),
                                speed, easing, callback);
                        }
                    } else {

                        // Without force parameter
                        return $.effects.animateClass.call(this,
                            { toggle: classNames }, force, speed, easing);
                    }
                };
            })($.fn.toggleClass),

            switchClass: function (remove, add, speed, easing, callback) {
                return $.effects.animateClass.call(this, {
                    add: add,
                    remove: remove
                }, speed, easing, callback);
            }
        });

    })();

    /******************************************************************************/
    /*********************************** EFFECTS **********************************/
    /******************************************************************************/

    (function () {

        if ($.expr && $.expr.filters && $.expr.filters.animated) {
            $.expr.filters.animated = (function (orig) {
                return function (elem) {
                    return !!$(elem).data(dataSpaceAnimated) || orig(elem);
                };
            })($.expr.filters.animated);
        }

        if ($.uiBackCompat !== false) {
            $.extend($.effects, {

                // Saves a set of properties in a data storage
                save: function (element, set) {
                    var i = 0, length = set.length;
                    for (; i < length; i++) {
                        if (set[i] !== null) {
                            element.data(dataSpace + set[i], element[0].style[set[i]]);
                        }
                    }
                },

                // Restores a set of previously saved properties from a data storage
                restore: function (element, set) {
                    var val, i = 0, length = set.length;
                    for (; i < length; i++) {
                        if (set[i] !== null) {
                            val = element.data(dataSpace + set[i]);
                            element.css(set[i], val);
                        }
                    }
                },

                setMode: function (el, mode) {
                    if (mode === "toggle") {
                        mode = el.is(":hidden") ? "show" : "hide";
                    }
                    return mode;
                },

                // Wraps the element around a wrapper that copies position properties
                createWrapper: function (element) {

                    // If the element is already wrapped, return it
                    if (element.parent().is(".ui-effects-wrapper")) {
                        return element.parent();
                    }

                    // Wrap the element
                    var props = {
                        width: element.outerWidth(true),
                        height: element.outerHeight(true),
                        "float": element.css("float")
                    },
                        wrapper = $("<div></div>")
                            .addClass("ui-effects-wrapper")
                            .css({
                                fontSize: "100%",
                                background: "transparent",
                                border: "none",
                                margin: 0,
                                padding: 0
                            }),

                        // Store the size in case width/height are defined in % - Fixes #5245
                        size = {
                            width: element.width(),
                            height: element.height()
                        },
                        active = document.activeElement;

                    // Support: Firefox
                    // Firefox incorrectly exposes anonymous content
                    // https://bugzilla.mozilla.org/show_bug.cgi?id=561664
                    try {
                        active.id;
                    } catch (e) {
                        active = document.body;
                    }

                    element.wrap(wrapper);

                    // Fixes #7595 - Elements lose focus when wrapped.
                    if (element[0] === active || $.contains(element[0], active)) {
                        $(active).trigger("focus");
                    }

                    // Hotfix for jQuery 1.4 since some change in wrap() seems to actually
                    // lose the reference to the wrapped element
                    wrapper = element.parent();

                    // Transfer positioning properties to the wrapper
                    if (element.css("position") === "static") {
                        wrapper.css({ position: "relative" });
                        element.css({ position: "relative" });
                    } else {
                        $.extend(props, {
                            position: element.css("position"),
                            zIndex: element.css("z-index")
                        });
                        $.each(["top", "left", "bottom", "right"], function (i, pos) {
                            props[pos] = element.css(pos);
                            if (isNaN(parseInt(props[pos], 10))) {
                                props[pos] = "auto";
                            }
                        });
                        element.css({
                            position: "relative",
                            top: 0,
                            left: 0,
                            right: "auto",
                            bottom: "auto"
                        });
                    }
                    element.css(size);

                    return wrapper.css(props).show();
                },

                removeWrapper: function (element) {
                    var active = document.activeElement;

                    if (element.parent().is(".ui-effects-wrapper")) {
                        element.parent().replaceWith(element);

                        // Fixes #7595 - Elements lose focus when wrapped.
                        if (element[0] === active || $.contains(element[0], active)) {
                            $(active).trigger("focus");
                        }
                    }

                    return element;
                }
            });
        }

        $.extend($.effects, {
            version: "1.12.1",

            define: function (name, mode, effect) {
                if (!effect) {
                    effect = mode;
                    mode = "effect";
                }

                $.effects.effect[name] = effect;
                $.effects.effect[name].mode = mode;

                return effect;
            },

            scaledDimensions: function (element, percent, direction) {
                if (percent === 0) {
                    return {
                        height: 0,
                        width: 0,
                        outerHeight: 0,
                        outerWidth: 0
                    };
                }

                var x = direction !== "horizontal" ? ((percent || 100) / 100) : 1,
                    y = direction !== "vertical" ? ((percent || 100) / 100) : 1;

                return {
                    height: element.height() * y,
                    width: element.width() * x,
                    outerHeight: element.outerHeight() * y,
                    outerWidth: element.outerWidth() * x
                };

            },

            clipToBox: function (animation) {
                return {
                    width: animation.clip.right - animation.clip.left,
                    height: animation.clip.bottom - animation.clip.top,
                    left: animation.clip.left,
                    top: animation.clip.top
                };
            },

            // Injects recently queued functions to be first in line (after "inprogress")
            unshift: function (element, queueLength, count) {
                var queue = element.queue();

                if (queueLength > 1) {
                    queue.splice.apply(queue,
                        [1, 0].concat(queue.splice(queueLength, count)));
                }
                element.dequeue();
            },

            saveStyle: function (element) {
                element.data(dataSpaceStyle, element[0].style.cssText);
            },

            restoreStyle: function (element) {
                element[0].style.cssText = element.data(dataSpaceStyle) || "";
                element.removeData(dataSpaceStyle);
            },

            mode: function (element, mode) {
                var hidden = element.is(":hidden");

                if (mode === "toggle") {
                    mode = hidden ? "show" : "hide";
                }
                if (hidden ? mode === "hide" : mode === "show") {
                    mode = "none";
                }
                return mode;
            },

            // Translates a [top,left] array into a baseline value
            getBaseline: function (origin, original) {
                var y, x;

                switch (origin[0]) {
                    case "top":
                        y = 0;
                        break;
                    case "middle":
                        y = 0.5;
                        break;
                    case "bottom":
                        y = 1;
                        break;
                    default:
                        y = origin[0] / original.height;
                }

                switch (origin[1]) {
                    case "left":
                        x = 0;
                        break;
                    case "center":
                        x = 0.5;
                        break;
                    case "right":
                        x = 1;
                        break;
                    default:
                        x = origin[1] / original.width;
                }

                return {
                    x: x,
                    y: y
                };
            },

            // Creates a placeholder element so that the original element can be made absolute
            createPlaceholder: function (element) {
                var placeholder,
                    cssPosition = element.css("position"),
                    position = element.position();

                // Lock in margins first to account for form elements, which
                // will change margin if you explicitly set height
                // see: http://jsfiddle.net/JZSMt/3/ https://bugs.webkit.org/show_bug.cgi?id=107380
                // Support: Safari
                element.css({
                    marginTop: element.css("marginTop"),
                    marginBottom: element.css("marginBottom"),
                    marginLeft: element.css("marginLeft"),
                    marginRight: element.css("marginRight")
                })
                    .outerWidth(element.outerWidth())
                    .outerHeight(element.outerHeight());

                if (/^(static|relative)/.test(cssPosition)) {
                    cssPosition = "absolute";

                    placeholder = $("<" + element[0].nodeName + ">").insertAfter(element).css({

                        // Convert inline to inline block to account for inline elements
                        // that turn to inline block based on content (like img)
                        display: /^(inline|ruby)/.test(element.css("display")) ?
                            "inline-block" :
                            "block",
                        visibility: "hidden",

                        // Margins need to be set to account for margin collapse
                        marginTop: element.css("marginTop"),
                        marginBottom: element.css("marginBottom"),
                        marginLeft: element.css("marginLeft"),
                        marginRight: element.css("marginRight"),
                        "float": element.css("float")
                    })
                        .outerWidth(element.outerWidth())
                        .outerHeight(element.outerHeight())
                        .addClass("ui-effects-placeholder");

                    element.data(dataSpace + "placeholder", placeholder);
                }

                element.css({
                    position: cssPosition,
                    left: position.left,
                    top: position.top
                });

                return placeholder;
            },

            removePlaceholder: function (element) {
                var dataKey = dataSpace + "placeholder",
                    placeholder = element.data(dataKey);

                if (placeholder) {
                    placeholder.remove();
                    element.removeData(dataKey);
                }
            },

            // Removes a placeholder if it exists and restores
            // properties that were modified during placeholder creation
            cleanUp: function (element) {
                $.effects.restoreStyle(element);
                $.effects.removePlaceholder(element);
            },

            setTransition: function (element, list, factor, value) {
                value = value || {};
                $.each(list, function (i, x) {
                    var unit = element.cssUnit(x);
                    if (unit[0] > 0) {
                        value[x] = unit[0] * factor + unit[1];
                    }
                });
                return value;
            }
        });

        // Return an effect options object for the given parameters:
        function _normalizeArguments(effect, options, speed, callback) {

            // Allow passing all options as the first parameter
            if ($.isPlainObject(effect)) {
                options = effect;
                effect = effect.effect;
            }

            // Convert to an object
            effect = { effect: effect };

            // Catch (effect, null, ...)
            if (options == null) {
                options = {};
            }

            // Catch (effect, callback)
            if ($.isFunction(options)) {
                callback = options;
                speed = null;
                options = {};
            }

            // Catch (effect, speed, ?)
            if (typeof options === "number" || $.fx.speeds[options]) {
                callback = speed;
                speed = options;
                options = {};
            }

            // Catch (effect, options, callback)
            if ($.isFunction(speed)) {
                callback = speed;
                speed = null;
            }

            // Add options to effect
            if (options) {
                $.extend(effect, options);
            }

            speed = speed || options.duration;
            effect.duration = $.fx.off ? 0 :
                typeof speed === "number" ? speed :
                    speed in $.fx.speeds ? $.fx.speeds[speed] :
                        $.fx.speeds._default;

            effect.complete = callback || options.complete;

            return effect;
        }

        function standardAnimationOption(option) {

            // Valid standard speeds (nothing, number, named speed)
            if (!option || typeof option === "number" || $.fx.speeds[option]) {
                return true;
            }

            // Invalid strings - treat as "normal" speed
            if (typeof option === "string" && !$.effects.effect[option]) {
                return true;
            }

            // Complete callback
            if ($.isFunction(option)) {
                return true;
            }

            // Options hash (but not naming an effect)
            if (typeof option === "object" && !option.effect) {
                return true;
            }

            // Didn't match any standard API
            return false;
        }

        $.fn.extend({
            effect: function ( /* effect, options, speed, callback */) {
                var args = _normalizeArguments.apply(this, arguments),
                    effectMethod = $.effects.effect[args.effect],
                    defaultMode = effectMethod.mode,
                    queue = args.queue,
                    queueName = queue || "fx",
                    complete = args.complete,
                    mode = args.mode,
                    modes = [],
                    prefilter = function (next) {
                        var el = $(this),
                            normalizedMode = $.effects.mode(el, mode) || defaultMode;

                        // Sentinel for duck-punching the :animated psuedo-selector
                        el.data(dataSpaceAnimated, true);

                        // Save effect mode for later use,
                        // we can't just call $.effects.mode again later,
                        // as the .show() below destroys the initial state
                        modes.push(normalizedMode);

                        // See $.uiBackCompat inside of run() for removal of defaultMode in 1.13
                        if (defaultMode && (normalizedMode === "show" ||
                            (normalizedMode === defaultMode && normalizedMode === "hide"))) {
                            el.show();
                        }

                        if (!defaultMode || normalizedMode !== "none") {
                            $.effects.saveStyle(el);
                        }

                        if ($.isFunction(next)) {
                            next();
                        }
                    };

                if ($.fx.off || !effectMethod) {

                    // Delegate to the original method (e.g., .show()) if possible
                    if (mode) {
                        return this[mode](args.duration, complete);
                    } else {
                        return this.each(function () {
                            if (complete) {
                                complete.call(this);
                            }
                        });
                    }
                }

                function run(next) {
                    var elem = $(this);

                    function cleanup() {
                        elem.removeData(dataSpaceAnimated);

                        $.effects.cleanUp(elem);

                        if (args.mode === "hide") {
                            elem.hide();
                        }

                        done();
                    }

                    function done() {
                        if ($.isFunction(complete)) {
                            complete.call(elem[0]);
                        }

                        if ($.isFunction(next)) {
                            next();
                        }
                    }

                    // Override mode option on a per element basis,
                    // as toggle can be either show or hide depending on element state
                    args.mode = modes.shift();

                    if ($.uiBackCompat !== false && !defaultMode) {
                        if (elem.is(":hidden") ? mode === "hide" : mode === "show") {

                            // Call the core method to track "olddisplay" properly
                            elem[mode]();
                            done();
                        } else {
                            effectMethod.call(elem[0], args, done);
                        }
                    } else {
                        if (args.mode === "none") {

                            // Call the core method to track "olddisplay" properly
                            elem[mode]();
                            done();
                        } else {
                            effectMethod.call(elem[0], args, cleanup);
                        }
                    }
                }

                // Run prefilter on all elements first to ensure that
                // any showing or hiding happens before placeholder creation,
                // which ensures that any layout changes are correctly captured.
                return queue === false ?
                    this.each(prefilter).each(run) :
                    this.queue(queueName, prefilter).queue(queueName, run);
            },

            show: (function (orig) {
                return function (option) {
                    if (standardAnimationOption(option)) {
                        return orig.apply(this, arguments);
                    } else {
                        var args = _normalizeArguments.apply(this, arguments);
                        args.mode = "show";
                        return this.effect.call(this, args);
                    }
                };
            })($.fn.show),

            hide: (function (orig) {
                return function (option) {
                    if (standardAnimationOption(option)) {
                        return orig.apply(this, arguments);
                    } else {
                        var args = _normalizeArguments.apply(this, arguments);
                        args.mode = "hide";
                        return this.effect.call(this, args);
                    }
                };
            })($.fn.hide),

            toggle: (function (orig) {
                return function (option) {
                    if (standardAnimationOption(option) || typeof option === "boolean") {
                        return orig.apply(this, arguments);
                    } else {
                        var args = _normalizeArguments.apply(this, arguments);
                        args.mode = "toggle";
                        return this.effect.call(this, args);
                    }
                };
            })($.fn.toggle),

            cssUnit: function (key) {
                var style = this.css(key),
                    val = [];

                $.each(["em", "px", "%", "pt"], function (i, unit) {
                    if (style.indexOf(unit) > 0) {
                        val = [parseFloat(style), unit];
                    }
                });
                return val;
            },

            cssClip: function (clipObj) {
                if (clipObj) {
                    return this.css("clip", "rect(" + clipObj.top + "px " + clipObj.right + "px " +
                        clipObj.bottom + "px " + clipObj.left + "px)");
                }
                return parseClip(this.css("clip"), this);
            },

            transfer: function (options, done) {
                var element = $(this),
                    target = $(options.to),
                    targetFixed = target.css("position") === "fixed",
                    body = $("body"),
                    fixTop = targetFixed ? body.scrollTop() : 0,
                    fixLeft = targetFixed ? body.scrollLeft() : 0,
                    endPosition = target.offset(),
                    animation = {
                        top: endPosition.top - fixTop,
                        left: endPosition.left - fixLeft,
                        height: target.innerHeight(),
                        width: target.innerWidth()
                    },
                    startPosition = element.offset(),
                    transfer = $("<div class='ui-effects-transfer'></div>")
                        .appendTo("body")
                        .addClass(options.className)
                        .css({
                            top: startPosition.top - fixTop,
                            left: startPosition.left - fixLeft,
                            height: element.innerHeight(),
                            width: element.innerWidth(),
                            position: targetFixed ? "fixed" : "absolute"
                        })
                        .animate(animation, options.duration, options.easing, function () {
                            transfer.remove();
                            if ($.isFunction(done)) {
                                done();
                            }
                        });
            }
        });

        function parseClip(str, element) {
            var outerWidth = element.outerWidth(),
                outerHeight = element.outerHeight(),
                clipRegex = /^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,
                values = clipRegex.exec(str) || ["", 0, outerWidth, outerHeight, 0];

            return {
                top: parseFloat(values[1]) || 0,
                right: values[2] === "auto" ? outerWidth : parseFloat(values[2]),
                bottom: values[3] === "auto" ? outerHeight : parseFloat(values[3]),
                left: parseFloat(values[4]) || 0
            };
        }

        $.fx.step.clip = function (fx) {
            if (!fx.clipInit) {
                fx.start = $(fx.elem).cssClip();
                if (typeof fx.end === "string") {
                    fx.end = parseClip(fx.end, fx.elem);
                }
                fx.clipInit = true;
            }

            $(fx.elem).cssClip({
                top: fx.pos * (fx.end.top - fx.start.top) + fx.start.top,
                right: fx.pos * (fx.end.right - fx.start.right) + fx.start.right,
                bottom: fx.pos * (fx.end.bottom - fx.start.bottom) + fx.start.bottom,
                left: fx.pos * (fx.end.left - fx.start.left) + fx.start.left
            });
        };

    })();

    /******************************************************************************/
    /*********************************** EASING ***********************************/
    /******************************************************************************/

    (function () {

        // Based on easing equations from Robert Penner (http://www.robertpenner.com/easing)

        var baseEasings = {};

        $.each(["Quad", "Cubic", "Quart", "Quint", "Expo"], function (i, name) {
            baseEasings[name] = function (p) {
                return Math.pow(p, i + 2);
            };
        });

        $.extend(baseEasings, {
            Sine: function (p) {
                return 1 - Math.cos(p * Math.PI / 2);
            },
            Circ: function (p) {
                return 1 - Math.sqrt(1 - p * p);
            },
            Elastic: function (p) {
                return p === 0 || p === 1 ? p :
                    -Math.pow(2, 8 * (p - 1)) * Math.sin(((p - 1) * 80 - 7.5) * Math.PI / 15);
            },
            Back: function (p) {
                return p * p * (3 * p - 2);
            },
            Bounce: function (p) {
                var pow2,
                    bounce = 4;

                while (p < ((pow2 = Math.pow(2, --bounce)) - 1) / 11) { }
                return 1 / Math.pow(4, 3 - bounce) - 7.5625 * Math.pow((pow2 * 3 - 2) / 22 - p, 2);
            }
        });

        $.each(baseEasings, function (name, easeIn) {
            $.easing["easeIn" + name] = easeIn;
            $.easing["easeOut" + name] = function (p) {
                return 1 - easeIn(1 - p);
            };
            $.easing["easeInOut" + name] = function (p) {
                return p < 0.5 ?
                    easeIn(p * 2) / 2 :
                    1 - easeIn(p * -2 + 2) / 2;
            };
        });

    })();

    var effect = $.effects;


    /*!
     * jQuery UI Effects Blind 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Blind Effect
    //>>group: Effects
    //>>description: Blinds the element.
    //>>docs: http://api.jqueryui.com/blind-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectBlind = $.effects.define("blind", "hide", function (options, done) {
        var map = {
            up: ["bottom", "top"],
            vertical: ["bottom", "top"],
            down: ["top", "bottom"],
            left: ["right", "left"],
            horizontal: ["right", "left"],
            right: ["left", "right"]
        },
            element = $(this),
            direction = options.direction || "up",
            start = element.cssClip(),
            animate = { clip: $.extend({}, start) },
            placeholder = $.effects.createPlaceholder(element);

        animate.clip[map[direction][0]] = animate.clip[map[direction][1]];

        if (options.mode === "show") {
            element.cssClip(animate.clip);
            if (placeholder) {
                placeholder.css($.effects.clipToBox(animate));
            }

            animate.clip = start;
        }

        if (placeholder) {
            placeholder.animate($.effects.clipToBox(animate), options.duration, options.easing);
        }

        element.animate(animate, {
            queue: false,
            duration: options.duration,
            easing: options.easing,
            complete: done
        });
    });


    /*!
     * jQuery UI Effects Bounce 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Bounce Effect
    //>>group: Effects
    //>>description: Bounces an element horizontally or vertically n times.
    //>>docs: http://api.jqueryui.com/bounce-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectBounce = $.effects.define("bounce", function (options, done) {
        var upAnim, downAnim, refValue,
            element = $(this),

            // Defaults:
            mode = options.mode,
            hide = mode === "hide",
            show = mode === "show",
            direction = options.direction || "up",
            distance = options.distance,
            times = options.times || 5,

            // Number of internal animations
            anims = times * 2 + (show || hide ? 1 : 0),
            speed = options.duration / anims,
            easing = options.easing,

            // Utility:
            ref = (direction === "up" || direction === "down") ? "top" : "left",
            motion = (direction === "up" || direction === "left"),
            i = 0,

            queuelen = element.queue().length;

        $.effects.createPlaceholder(element);

        refValue = element.css(ref);

        // Default distance for the BIGGEST bounce is the outer Distance / 3
        if (!distance) {
            distance = element[ref === "top" ? "outerHeight" : "outerWidth"]() / 3;
        }

        if (show) {
            downAnim = { opacity: 1 };
            downAnim[ref] = refValue;

            // If we are showing, force opacity 0 and set the initial position
            // then do the "first" animation
            element
                .css("opacity", 0)
                .css(ref, motion ? -distance * 2 : distance * 2)
                .animate(downAnim, speed, easing);
        }

        // Start at the smallest distance if we are hiding
        if (hide) {
            distance = distance / Math.pow(2, times - 1);
        }

        downAnim = {};
        downAnim[ref] = refValue;

        // Bounces up/down/left/right then back to 0 -- times * 2 animations happen here
        for (; i < times; i++) {
            upAnim = {};
            upAnim[ref] = (motion ? "-=" : "+=") + distance;

            element
                .animate(upAnim, speed, easing)
                .animate(downAnim, speed, easing);

            distance = hide ? distance * 2 : distance / 2;
        }

        // Last Bounce when Hiding
        if (hide) {
            upAnim = { opacity: 0 };
            upAnim[ref] = (motion ? "-=" : "+=") + distance;

            element.animate(upAnim, speed, easing);
        }

        element.queue(done);

        $.effects.unshift(element, queuelen, anims + 1);
    });


    /*!
     * jQuery UI Effects Clip 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Clip Effect
    //>>group: Effects
    //>>description: Clips the element on and off like an old TV.
    //>>docs: http://api.jqueryui.com/clip-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectClip = $.effects.define("clip", "hide", function (options, done) {
        var start,
            animate = {},
            element = $(this),
            direction = options.direction || "vertical",
            both = direction === "both",
            horizontal = both || direction === "horizontal",
            vertical = both || direction === "vertical";

        start = element.cssClip();
        animate.clip = {
            top: vertical ? (start.bottom - start.top) / 2 : start.top,
            right: horizontal ? (start.right - start.left) / 2 : start.right,
            bottom: vertical ? (start.bottom - start.top) / 2 : start.bottom,
            left: horizontal ? (start.right - start.left) / 2 : start.left
        };

        $.effects.createPlaceholder(element);

        if (options.mode === "show") {
            element.cssClip(animate.clip);
            animate.clip = start;
        }

        element.animate(animate, {
            queue: false,
            duration: options.duration,
            easing: options.easing,
            complete: done
        });

    });


    /*!
     * jQuery UI Effects Drop 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Drop Effect
    //>>group: Effects
    //>>description: Moves an element in one direction and hides it at the same time.
    //>>docs: http://api.jqueryui.com/drop-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectDrop = $.effects.define("drop", "hide", function (options, done) {

        var distance,
            element = $(this),
            mode = options.mode,
            show = mode === "show",
            direction = options.direction || "left",
            ref = (direction === "up" || direction === "down") ? "top" : "left",
            motion = (direction === "up" || direction === "left") ? "-=" : "+=",
            oppositeMotion = (motion === "+=") ? "-=" : "+=",
            animation = {
                opacity: 0
            };

        $.effects.createPlaceholder(element);

        distance = options.distance ||
            element[ref === "top" ? "outerHeight" : "outerWidth"](true) / 2;

        animation[ref] = motion + distance;

        if (show) {
            element.css(animation);

            animation[ref] = oppositeMotion + distance;
            animation.opacity = 1;
        }

        // Animate
        element.animate(animation, {
            queue: false,
            duration: options.duration,
            easing: options.easing,
            complete: done
        });
    });


    /*!
     * jQuery UI Effects Explode 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Explode Effect
    //>>group: Effects
    // jscs:disable maximumLineLength
    //>>description: Explodes an element in all directions into n pieces. Implodes an element to its original wholeness.
    // jscs:enable maximumLineLength
    //>>docs: http://api.jqueryui.com/explode-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectExplode = $.effects.define("explode", "hide", function (options, done) {

        var i, j, left, top, mx, my,
            rows = options.pieces ? Math.round(Math.sqrt(options.pieces)) : 3,
            cells = rows,
            element = $(this),
            mode = options.mode,
            show = mode === "show",

            // Show and then visibility:hidden the element before calculating offset
            offset = element.show().css("visibility", "hidden").offset(),

            // Width and height of a piece
            width = Math.ceil(element.outerWidth() / cells),
            height = Math.ceil(element.outerHeight() / rows),
            pieces = [];

        // Children animate complete:
        function childComplete() {
            pieces.push(this);
            if (pieces.length === rows * cells) {
                animComplete();
            }
        }

        // Clone the element for each row and cell.
        for (i = 0; i < rows; i++) { // ===>
            top = offset.top + i * height;
            my = i - (rows - 1) / 2;

            for (j = 0; j < cells; j++) { // |||
                left = offset.left + j * width;
                mx = j - (cells - 1) / 2;

                // Create a clone of the now hidden main element that will be absolute positioned
                // within a wrapper div off the -left and -top equal to size of our pieces
                element
                    .clone()
                    .appendTo("body")
                    .wrap("<div></div>")
                    .css({
                        position: "absolute",
                        visibility: "visible",
                        left: -j * width,
                        top: -i * height
                    })

                    // Select the wrapper - make it overflow: hidden and absolute positioned based on
                    // where the original was located +left and +top equal to the size of pieces
                    .parent()
                    .addClass("ui-effects-explode")
                    .css({
                        position: "absolute",
                        overflow: "hidden",
                        width: width,
                        height: height,
                        left: left + (show ? mx * width : 0),
                        top: top + (show ? my * height : 0),
                        opacity: show ? 0 : 1
                    })
                    .animate({
                        left: left + (show ? 0 : mx * width),
                        top: top + (show ? 0 : my * height),
                        opacity: show ? 1 : 0
                    }, options.duration || 500, options.easing, childComplete);
            }
        }

        function animComplete() {
            element.css({
                visibility: "visible"
            });
            $(pieces).remove();
            done();
        }
    });


    /*!
     * jQuery UI Effects Fade 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Fade Effect
    //>>group: Effects
    //>>description: Fades the element.
    //>>docs: http://api.jqueryui.com/fade-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectFade = $.effects.define("fade", "toggle", function (options, done) {
        var show = options.mode === "show";

        $(this)
            .css("opacity", show ? 0 : 1)
            .animate({
                opacity: show ? 1 : 0
            }, {
                queue: false,
                duration: options.duration,
                easing: options.easing,
                complete: done
            });
    });


    /*!
     * jQuery UI Effects Fold 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Fold Effect
    //>>group: Effects
    //>>description: Folds an element first horizontally and then vertically.
    //>>docs: http://api.jqueryui.com/fold-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectFold = $.effects.define("fold", "hide", function (options, done) {

        // Create element
        var element = $(this),
            mode = options.mode,
            show = mode === "show",
            hide = mode === "hide",
            size = options.size || 15,
            percent = /([0-9]+)%/.exec(size),
            horizFirst = !!options.horizFirst,
            ref = horizFirst ? ["right", "bottom"] : ["bottom", "right"],
            duration = options.duration / 2,

            placeholder = $.effects.createPlaceholder(element),

            start = element.cssClip(),
            animation1 = { clip: $.extend({}, start) },
            animation2 = { clip: $.extend({}, start) },

            distance = [start[ref[0]], start[ref[1]]],

            queuelen = element.queue().length;

        if (percent) {
            size = parseInt(percent[1], 10) / 100 * distance[hide ? 0 : 1];
        }
        animation1.clip[ref[0]] = size;
        animation2.clip[ref[0]] = size;
        animation2.clip[ref[1]] = 0;

        if (show) {
            element.cssClip(animation2.clip);
            if (placeholder) {
                placeholder.css($.effects.clipToBox(animation2));
            }

            animation2.clip = start;
        }

        // Animate
        element
            .queue(function (next) {
                if (placeholder) {
                    placeholder
                        .animate($.effects.clipToBox(animation1), duration, options.easing)
                        .animate($.effects.clipToBox(animation2), duration, options.easing);
                }

                next();
            })
            .animate(animation1, duration, options.easing)
            .animate(animation2, duration, options.easing)
            .queue(done);

        $.effects.unshift(element, queuelen, 4);
    });


    /*!
     * jQuery UI Effects Highlight 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Highlight Effect
    //>>group: Effects
    //>>description: Highlights the background of an element in a defined color for a custom duration.
    //>>docs: http://api.jqueryui.com/highlight-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectHighlight = $.effects.define("highlight", "show", function (options, done) {
        var element = $(this),
            animation = {
                backgroundColor: element.css("backgroundColor")
            };

        if (options.mode === "hide") {
            animation.opacity = 0;
        }

        $.effects.saveStyle(element);

        element
            .css({
                backgroundImage: "none",
                backgroundColor: options.color || "#ffff99"
            })
            .animate(animation, {
                queue: false,
                duration: options.duration,
                easing: options.easing,
                complete: done
            });
    });


    /*!
     * jQuery UI Effects Size 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Size Effect
    //>>group: Effects
    //>>description: Resize an element to a specified width and height.
    //>>docs: http://api.jqueryui.com/size-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectSize = $.effects.define("size", function (options, done) {

        // Create element
        var baseline, factor, temp,
            element = $(this),

            // Copy for children
            cProps = ["fontSize"],
            vProps = ["borderTopWidth", "borderBottomWidth", "paddingTop", "paddingBottom"],
            hProps = ["borderLeftWidth", "borderRightWidth", "paddingLeft", "paddingRight"],

            // Set options
            mode = options.mode,
            restore = mode !== "effect",
            scale = options.scale || "both",
            origin = options.origin || ["middle", "center"],
            position = element.css("position"),
            pos = element.position(),
            original = $.effects.scaledDimensions(element),
            from = options.from || original,
            to = options.to || $.effects.scaledDimensions(element, 0);

        $.effects.createPlaceholder(element);

        if (mode === "show") {
            temp = from;
            from = to;
            to = temp;
        }

        // Set scaling factor
        factor = {
            from: {
                y: from.height / original.height,
                x: from.width / original.width
            },
            to: {
                y: to.height / original.height,
                x: to.width / original.width
            }
        };

        // Scale the css box
        if (scale === "box" || scale === "both") {

            // Vertical props scaling
            if (factor.from.y !== factor.to.y) {
                from = $.effects.setTransition(element, vProps, factor.from.y, from);
                to = $.effects.setTransition(element, vProps, factor.to.y, to);
            }

            // Horizontal props scaling
            if (factor.from.x !== factor.to.x) {
                from = $.effects.setTransition(element, hProps, factor.from.x, from);
                to = $.effects.setTransition(element, hProps, factor.to.x, to);
            }
        }

        // Scale the content
        if (scale === "content" || scale === "both") {

            // Vertical props scaling
            if (factor.from.y !== factor.to.y) {
                from = $.effects.setTransition(element, cProps, factor.from.y, from);
                to = $.effects.setTransition(element, cProps, factor.to.y, to);
            }
        }

        // Adjust the position properties based on the provided origin points
        if (origin) {
            baseline = $.effects.getBaseline(origin, original);
            from.top = (original.outerHeight - from.outerHeight) * baseline.y + pos.top;
            from.left = (original.outerWidth - from.outerWidth) * baseline.x + pos.left;
            to.top = (original.outerHeight - to.outerHeight) * baseline.y + pos.top;
            to.left = (original.outerWidth - to.outerWidth) * baseline.x + pos.left;
        }
        element.css(from);

        // Animate the children if desired
        if (scale === "content" || scale === "both") {

            vProps = vProps.concat(["marginTop", "marginBottom"]).concat(cProps);
            hProps = hProps.concat(["marginLeft", "marginRight"]);

            // Only animate children with width attributes specified
            // TODO: is this right? should we include anything with css width specified as well
            element.find("*[width]").each(function () {
                var child = $(this),
                    childOriginal = $.effects.scaledDimensions(child),
                    childFrom = {
                        height: childOriginal.height * factor.from.y,
                        width: childOriginal.width * factor.from.x,
                        outerHeight: childOriginal.outerHeight * factor.from.y,
                        outerWidth: childOriginal.outerWidth * factor.from.x
                    },
                    childTo = {
                        height: childOriginal.height * factor.to.y,
                        width: childOriginal.width * factor.to.x,
                        outerHeight: childOriginal.height * factor.to.y,
                        outerWidth: childOriginal.width * factor.to.x
                    };

                // Vertical props scaling
                if (factor.from.y !== factor.to.y) {
                    childFrom = $.effects.setTransition(child, vProps, factor.from.y, childFrom);
                    childTo = $.effects.setTransition(child, vProps, factor.to.y, childTo);
                }

                // Horizontal props scaling
                if (factor.from.x !== factor.to.x) {
                    childFrom = $.effects.setTransition(child, hProps, factor.from.x, childFrom);
                    childTo = $.effects.setTransition(child, hProps, factor.to.x, childTo);
                }

                if (restore) {
                    $.effects.saveStyle(child);
                }

                // Animate children
                child.css(childFrom);
                child.animate(childTo, options.duration, options.easing, function () {

                    // Restore children
                    if (restore) {
                        $.effects.restoreStyle(child);
                    }
                });
            });
        }

        // Animate
        element.animate(to, {
            queue: false,
            duration: options.duration,
            easing: options.easing,
            complete: function () {

                var offset = element.offset();

                if (to.opacity === 0) {
                    element.css("opacity", from.opacity);
                }

                if (!restore) {
                    element
                        .css("position", position === "static" ? "relative" : position)
                        .offset(offset);

                    // Need to save style here so that automatic style restoration
                    // doesn't restore to the original styles from before the animation.
                    $.effects.saveStyle(element);
                }

                done();
            }
        });

    });


    /*!
     * jQuery UI Effects Scale 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Scale Effect
    //>>group: Effects
    //>>description: Grows or shrinks an element and its content.
    //>>docs: http://api.jqueryui.com/scale-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectScale = $.effects.define("scale", function (options, done) {

        // Create element
        var el = $(this),
            mode = options.mode,
            percent = parseInt(options.percent, 10) ||
                (parseInt(options.percent, 10) === 0 ? 0 : (mode !== "effect" ? 0 : 100)),

            newOptions = $.extend(true, {
                from: $.effects.scaledDimensions(el),
                to: $.effects.scaledDimensions(el, percent, options.direction || "both"),
                origin: options.origin || ["middle", "center"]
            }, options);

        // Fade option to support puff
        if (options.fade) {
            newOptions.from.opacity = 1;
            newOptions.to.opacity = 0;
        }

        $.effects.effect.size.call(this, newOptions, done);
    });


    /*!
     * jQuery UI Effects Puff 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Puff Effect
    //>>group: Effects
    //>>description: Creates a puff effect by scaling the element up and hiding it at the same time.
    //>>docs: http://api.jqueryui.com/puff-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectPuff = $.effects.define("puff", "hide", function (options, done) {
        var newOptions = $.extend(true, {}, options, {
            fade: true,
            percent: parseInt(options.percent, 10) || 150
        });

        $.effects.effect.scale.call(this, newOptions, done);
    });


    /*!
     * jQuery UI Effects Pulsate 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Pulsate Effect
    //>>group: Effects
    //>>description: Pulsates an element n times by changing the opacity to zero and back.
    //>>docs: http://api.jqueryui.com/pulsate-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectPulsate = $.effects.define("pulsate", "show", function (options, done) {
        var element = $(this),
            mode = options.mode,
            show = mode === "show",
            hide = mode === "hide",
            showhide = show || hide,

            // Showing or hiding leaves off the "last" animation
            anims = ((options.times || 5) * 2) + (showhide ? 1 : 0),
            duration = options.duration / anims,
            animateTo = 0,
            i = 1,
            queuelen = element.queue().length;

        if (show || !element.is(":visible")) {
            element.css("opacity", 0).show();
            animateTo = 1;
        }

        // Anims - 1 opacity "toggles"
        for (; i < anims; i++) {
            element.animate({ opacity: animateTo }, duration, options.easing);
            animateTo = 1 - animateTo;
        }

        element.animate({ opacity: animateTo }, duration, options.easing);

        element.queue(done);

        $.effects.unshift(element, queuelen, anims + 1);
    });


    /*!
     * jQuery UI Effects Shake 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Shake Effect
    //>>group: Effects
    //>>description: Shakes an element horizontally or vertically n times.
    //>>docs: http://api.jqueryui.com/shake-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectShake = $.effects.define("shake", function (options, done) {

        var i = 1,
            element = $(this),
            direction = options.direction || "left",
            distance = options.distance || 20,
            times = options.times || 3,
            anims = times * 2 + 1,
            speed = Math.round(options.duration / anims),
            ref = (direction === "up" || direction === "down") ? "top" : "left",
            positiveMotion = (direction === "up" || direction === "left"),
            animation = {},
            animation1 = {},
            animation2 = {},

            queuelen = element.queue().length;

        $.effects.createPlaceholder(element);

        // Animation
        animation[ref] = (positiveMotion ? "-=" : "+=") + distance;
        animation1[ref] = (positiveMotion ? "+=" : "-=") + distance * 2;
        animation2[ref] = (positiveMotion ? "-=" : "+=") + distance * 2;

        // Animate
        element.animate(animation, speed, options.easing);

        // Shakes
        for (; i < times; i++) {
            element
                .animate(animation1, speed, options.easing)
                .animate(animation2, speed, options.easing);
        }

        element
            .animate(animation1, speed, options.easing)
            .animate(animation, speed / 2, options.easing)
            .queue(done);

        $.effects.unshift(element, queuelen, anims + 1);
    });


    /*!
     * jQuery UI Effects Slide 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Slide Effect
    //>>group: Effects
    //>>description: Slides an element in and out of the viewport.
    //>>docs: http://api.jqueryui.com/slide-effect/
    //>>demos: http://jqueryui.com/effect/



    var effectsEffectSlide = $.effects.define("slide", "show", function (options, done) {
        var startClip, startRef,
            element = $(this),
            map = {
                up: ["bottom", "top"],
                down: ["top", "bottom"],
                left: ["right", "left"],
                right: ["left", "right"]
            },
            mode = options.mode,
            direction = options.direction || "left",
            ref = (direction === "up" || direction === "down") ? "top" : "left",
            positiveMotion = (direction === "up" || direction === "left"),
            distance = options.distance ||
                element[ref === "top" ? "outerHeight" : "outerWidth"](true),
            animation = {};

        $.effects.createPlaceholder(element);

        startClip = element.cssClip();
        startRef = element.position()[ref];

        // Define hide animation
        animation[ref] = (positiveMotion ? -1 : 1) * distance + startRef;
        animation.clip = element.cssClip();
        animation.clip[map[direction][1]] = animation.clip[map[direction][0]];

        // Reverse the animation if we're showing
        if (mode === "show") {
            element.cssClip(animation.clip);
            element.css(ref, animation[ref]);
            animation.clip = startClip;
            animation[ref] = startRef;
        }

        // Actually animate
        element.animate(animation, {
            queue: false,
            duration: options.duration,
            easing: options.easing,
            complete: done
        });
    });


    /*!
     * jQuery UI Effects Transfer 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */

    //>>label: Transfer Effect
    //>>group: Effects
    //>>description: Displays a transfer effect from one element to another.
    //>>docs: http://api.jqueryui.com/transfer-effect/
    //>>demos: http://jqueryui.com/effect/



    var effect;
    if ($.uiBackCompat !== false) {
        effect = $.effects.define("transfer", function (options, done) {
            $(this).transfer(options, done);
        });
    }
    var effectsEffectTransfer = effect;




}));

// jQuery SerializeToJSON v1.2.1
// github.com/raphaelm22/jquery.serializeToJSON
!function (e) { "use strict"; e.fn.serializeToJSON = function (t) { var a = { settings: e.extend(!0, {}, e.fn.serializeToJSON.defaults, t), getValue: function (t) { var a = t.val(); if (t.is(":radio") && (a = t.filter(":checked").val() || null), t.is(":checkbox") && (a = e(t).prop("checked")), this.settings.parseBooleans) { var n = (a + "").toLowerCase(); "true" !== n && "false" !== n || (a = "true" === n) } var r = this.settings.parseFloat.condition; return void 0 !== r && ("string" == typeof r && t.is(r) || "function" == typeof r && r(t)) && (a = this.settings.parseFloat.getInputValue(t), a = Number(a), this.settings.parseFloat.nanToZero && isNaN(a) && (a = 0)), a }, createProperty: function (t, a, n, r) { for (var i = t, s = 0; s < n.length; s++) { var l = n[s]; if (s === n.length - 1) { var o = r.is("select") && r.prop("multiple"); o && null !== a ? (i[l] = new Array, Array.isArray(a) ? e(a).each(function () { i[l].push(this) }) : i[l].push(a)) : i[l] = a } else { var u = /\[\w+\]/g.exec(l), c = null != u && u.length > 0; if (c) { l = l.substr(0, l.indexOf("[")), this.settings.associativeArrays ? i.hasOwnProperty(l) || (i[l] = {}) : Array.isArray(i[l]) || (i[l] = new Array), i = i[l]; var h = u[0].replace(/[\[\]]/g, ""); l = h } i.hasOwnProperty(l) || (i[l] = {}), i = i[l] } } }, includeUncheckValues: function (t, a) { e(":radio", t).each(function () { var t = 0 === e("input[name='" + this.name + "']:radio:checked").length; t && a.push({ name: this.name, value: null }) }), e("select[multiple]", t).each(function () { null === e(this).val() && a.push({ name: this.name, value: null }) }) }, serializer: function (t) { var a = this, n = e(t).serializeArray(); this.includeUncheckValues(t, n); var r = {}; return e.each(n, function (n, i) { var s = e(":input[name='" + i.name + "']", t), l = a.getValue(s), o = i.name.split("."); a.createProperty(r, l, o, s) }), r } }; return a.serializer(this) }, e.fn.serializeToJSON.defaults = { associativeArrays: !0, parseBooleans: !0, parseFloat: { condition: void 0, nanToZero: !0, getInputValue: function (e) { return e.val().split(",").join("") } } } }(jQuery);
/* NUGET: BEGIN LICENSE TEXT
 *
 * Microsoft grants you the right to use these script files for the sole
 * purpose of either: (i) interacting through your browser with the Microsoft
 * website or online service, subject to the applicable licensing or use
 * terms; or (ii) using the files as included with a Microsoft product subject
 * to that product's license terms. Microsoft reserves all other rights to the
 * files not expressly granted by Microsoft, whether by implication, estoppel
 * or otherwise. Insofar as a script file is dual licensed under GPL,
 * Microsoft neither took the code under GPL nor distributes it thereunder but
 * under the terms set out in this paragraph. All notices and licenses
 * below are for informational purposes only.
 *
 * NUGET: END LICENSE TEXT */
/*! jQuery Validation Plugin - v1.11.1 - 3/22/2013\n* https://github.com/jzaefferer/jquery-validation
* Copyright (c) 2013 JÃ¶rn Zaefferer; Licensed MIT */(function (t) { t.extend(t.fn, { validate: function (e) { if (!this.length) return e && e.debug && window.console && console.warn("Nothing selected, can't validate, returning nothing."), void 0; var i = t.data(this[0], "validator"); return i ? i : (this.attr("novalidate", "novalidate"), i = new t.validator(e, this[0]), t.data(this[0], "validator", i), i.settings.onsubmit && (this.validateDelegate(":submit", "click", function (e) { i.settings.submitHandler && (i.submitButton = e.target), t(e.target).hasClass("cancel") && (i.cancelSubmit = !0), void 0 !== t(e.target).attr("formnovalidate") && (i.cancelSubmit = !0) }), this.submit(function (e) { function s() { var s; return i.settings.submitHandler ? (i.submitButton && (s = t("<input type='hidden'/>").attr("name", i.submitButton.name).val(t(i.submitButton).val()).appendTo(i.currentForm)), i.settings.submitHandler.call(i, i.currentForm, e), i.submitButton && s.remove(), !1) : !0 } return i.settings.debug && e.preventDefault(), i.cancelSubmit ? (i.cancelSubmit = !1, s()) : i.form() ? i.pendingRequest ? (i.formSubmitted = !0, !1) : s() : (i.focusInvalid(), !1) })), i) }, valid: function () { if (t(this[0]).is("form")) return this.validate().form(); var e = !0, i = t(this[0].form).validate(); return this.each(function () { e = e && i.element(this) }), e }, removeAttrs: function (e) { var i = {}, s = this; return t.each(e.split(/\s/), function (t, e) { i[e] = s.attr(e), s.removeAttr(e) }), i }, rules: function (e, i) { var s = this[0]; if (e) { var r = t.data(s.form, "validator").settings, n = r.rules, a = t.validator.staticRules(s); switch (e) { case "add": t.extend(a, t.validator.normalizeRule(i)), delete a.messages, n[s.name] = a, i.messages && (r.messages[s.name] = t.extend(r.messages[s.name], i.messages)); break; case "remove": if (!i) return delete n[s.name], a; var u = {}; return t.each(i.split(/\s/), function (t, e) { u[e] = a[e], delete a[e] }), u } } var o = t.validator.normalizeRules(t.extend({}, t.validator.classRules(s), t.validator.attributeRules(s), t.validator.dataRules(s), t.validator.staticRules(s)), s); if (o.required) { var l = o.required; delete o.required, o = t.extend({ required: l }, o) } return o } }), t.extend(t.expr[":"], { blank: function (e) { return !t.trim("" + t(e).val()) }, filled: function (e) { return !!t.trim("" + t(e).val()) }, unchecked: function (e) { return !t(e).prop("checked") } }), t.validator = function (e, i) { this.settings = t.extend(!0, {}, t.validator.defaults, e), this.currentForm = i, this.init() }, t.validator.format = function (e, i) { return 1 === arguments.length ? function () { var i = t.makeArray(arguments); return i.unshift(e), t.validator.format.apply(this, i) } : (arguments.length > 2 && i.constructor !== Array && (i = t.makeArray(arguments).slice(1)), i.constructor !== Array && (i = [i]), t.each(i, function (t, i) { e = e.replace(RegExp("\\{" + t + "\\}", "g"), function () { return i }) }), e) }, t.extend(t.validator, { defaults: { messages: {}, groups: {}, rules: {}, errorClass: "error", validClass: "valid", errorElement: "label", focusInvalid: !0, errorContainer: t([]), errorLabelContainer: t([]), onsubmit: !0, ignore: ":hidden", ignoreTitle: !1, onfocusin: function (t) { this.lastActive = t, this.settings.focusCleanup && !this.blockFocusCleanup && (this.settings.unhighlight && this.settings.unhighlight.call(this, t, this.settings.errorClass, this.settings.validClass), this.addWrapper(this.errorsFor(t)).hide()) }, onfocusout: function (t) { this.checkable(t) || !(t.name in this.submitted) && this.optional(t) || this.element(t) }, onkeyup: function (t, e) { (9 !== e.which || "" !== this.elementValue(t)) && (t.name in this.submitted || t === this.lastElement) && this.element(t) }, onclick: function (t) { t.name in this.submitted ? this.element(t) : t.parentNode.name in this.submitted && this.element(t.parentNode) }, highlight: function (e, i, s) { "radio" === e.type ? this.findByName(e.name).addClass(i).removeClass(s) : t(e).addClass(i).removeClass(s) }, unhighlight: function (e, i, s) { "radio" === e.type ? this.findByName(e.name).removeClass(i).addClass(s) : t(e).removeClass(i).addClass(s) } }, setDefaults: function (e) { t.extend(t.validator.defaults, e) }, messages: { required: "This field is required.", remote: "Please fix this field.", email: "Please enter a valid email address.", url: "Please enter a valid URL.", date: "Please enter a valid date.", dateISO: "Please enter a valid date (ISO).", number: "Please enter a valid number.", digits: "Please enter only digits.", creditcard: "Please enter a valid credit card number.", equalTo: "Please enter the same value again.", maxlength: t.validator.format("Please enter no more than {0} characters."), minlength: t.validator.format("Please enter at least {0} characters."), rangelength: t.validator.format("Please enter a value between {0} and {1} characters long."), range: t.validator.format("Please enter a value between {0} and {1}."), max: t.validator.format("Please enter a value less than or equal to {0}."), min: t.validator.format("Please enter a value greater than or equal to {0}.") }, autoCreateRanges: !1, prototype: { init: function () { function e(e) { var i = t.data(this[0].form, "validator"), s = "on" + e.type.replace(/^validate/, ""); i.settings[s] && i.settings[s].call(i, this[0], e) } this.labelContainer = t(this.settings.errorLabelContainer), this.errorContext = this.labelContainer.length && this.labelContainer || t(this.currentForm), this.containers = t(this.settings.errorContainer).add(this.settings.errorLabelContainer), this.submitted = {}, this.valueCache = {}, this.pendingRequest = 0, this.pending = {}, this.invalid = {}, this.reset(); var i = this.groups = {}; t.each(this.settings.groups, function (e, s) { "string" == typeof s && (s = s.split(/\s/)), t.each(s, function (t, s) { i[s] = e }) }); var s = this.settings.rules; t.each(s, function (e, i) { s[e] = t.validator.normalizeRule(i) }), t(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ", "focusin focusout keyup", e).validateDelegate("[type='radio'], [type='checkbox'], select, option", "click", e), this.settings.invalidHandler && t(this.currentForm).bind("invalid-form.validate", this.settings.invalidHandler) }, form: function () { return this.checkForm(), t.extend(this.submitted, this.errorMap), this.invalid = t.extend({}, this.errorMap), this.valid() || t(this.currentForm).triggerHandler("invalid-form", [this]), this.showErrors(), this.valid() }, checkForm: function () { this.prepareForm(); for (var t = 0, e = this.currentElements = this.elements(); e[t]; t++)this.check(e[t]); return this.valid() }, element: function (e) { e = this.validationTargetFor(this.clean(e)), this.lastElement = e, this.prepareElement(e), this.currentElements = t(e); var i = this.check(e) !== !1; return i ? delete this.invalid[e.name] : this.invalid[e.name] = !0, this.numberOfInvalids() || (this.toHide = this.toHide.add(this.containers)), this.showErrors(), i }, showErrors: function (e) { if (e) { t.extend(this.errorMap, e), this.errorList = []; for (var i in e) this.errorList.push({ message: e[i], element: this.findByName(i)[0] }); this.successList = t.grep(this.successList, function (t) { return !(t.name in e) }) } this.settings.showErrors ? this.settings.showErrors.call(this, this.errorMap, this.errorList) : this.defaultShowErrors() }, resetForm: function () { t.fn.resetForm && t(this.currentForm).resetForm(), this.submitted = {}, this.lastElement = null, this.prepareForm(), this.hideErrors(), this.elements().removeClass(this.settings.errorClass).removeData("previousValue") }, numberOfInvalids: function () { return this.objectLength(this.invalid) }, objectLength: function (t) { var e = 0; for (var i in t) e++; return e }, hideErrors: function () { this.addWrapper(this.toHide).hide() }, valid: function () { return 0 === this.size() }, size: function () { return this.errorList.length }, focusInvalid: function () { if (this.settings.focusInvalid) try { t(this.findLastActive() || this.errorList.length && this.errorList[0].element || []).filter(":visible").focus().trigger("focusin") } catch (e) { } }, findLastActive: function () { var e = this.lastActive; return e && 1 === t.grep(this.errorList, function (t) { return t.element.name === e.name }).length && e }, elements: function () { var e = this, i = {}; return t(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function () { return !this.name && e.settings.debug && window.console && console.error("%o has no name assigned", this), this.name in i || !e.objectLength(t(this).rules()) ? !1 : (i[this.name] = !0, !0) }) }, clean: function (e) { return t(e)[0] }, errors: function () { var e = this.settings.errorClass.replace(" ", "."); return t(this.settings.errorElement + "." + e, this.errorContext) }, reset: function () { this.successList = [], this.errorList = [], this.errorMap = {}, this.toShow = t([]), this.toHide = t([]), this.currentElements = t([]) }, prepareForm: function () { this.reset(), this.toHide = this.errors().add(this.containers) }, prepareElement: function (t) { this.reset(), this.toHide = this.errorsFor(t) }, elementValue: function (e) { var i = t(e).attr("type"), s = t(e).val(); return "radio" === i || "checkbox" === i ? t("input[name='" + t(e).attr("name") + "']:checked").val() : "string" == typeof s ? s.replace(/\r/g, "") : s }, check: function (e) { e = this.validationTargetFor(this.clean(e)); var i, s = t(e).rules(), r = !1, n = this.elementValue(e); for (var a in s) { var u = { method: a, parameters: s[a] }; try { if (i = t.validator.methods[a].call(this, n, e, u.parameters), "dependency-mismatch" === i) { r = !0; continue } if (r = !1, "pending" === i) return this.toHide = this.toHide.not(this.errorsFor(e)), void 0; if (!i) return this.formatAndAdd(e, u), !1 } catch (o) { throw this.settings.debug && window.console && console.log("Exception occurred when checking element " + e.id + ", check the '" + u.method + "' method.", o), o } } return r ? void 0 : (this.objectLength(s) && this.successList.push(e), !0) }, customDataMessage: function (e, i) { return t(e).data("msg-" + i.toLowerCase()) || e.attributes && t(e).attr("data-msg-" + i.toLowerCase()) }, customMessage: function (t, e) { var i = this.settings.messages[t]; return i && (i.constructor === String ? i : i[e]) }, findDefined: function () { for (var t = 0; arguments.length > t; t++)if (void 0 !== arguments[t]) return arguments[t]; return void 0 }, defaultMessage: function (e, i) { return this.findDefined(this.customMessage(e.name, i), this.customDataMessage(e, i), !this.settings.ignoreTitle && e.title || void 0, t.validator.messages[i], "<strong>Warning: No message defined for " + e.name + "</strong>") }, formatAndAdd: function (e, i) { var s = this.defaultMessage(e, i.method), r = /\$?\{(\d+)\}/g; "function" == typeof s ? s = s.call(this, i.parameters, e) : r.test(s) && (s = t.validator.format(s.replace(r, "{$1}"), i.parameters)), this.errorList.push({ message: s, element: e }), this.errorMap[e.name] = s, this.submitted[e.name] = s }, addWrapper: function (t) { return this.settings.wrapper && (t = t.add(t.parent(this.settings.wrapper))), t }, defaultShowErrors: function () { var t, e; for (t = 0; this.errorList[t]; t++) { var i = this.errorList[t]; this.settings.highlight && this.settings.highlight.call(this, i.element, this.settings.errorClass, this.settings.validClass), this.showLabel(i.element, i.message) } if (this.errorList.length && (this.toShow = this.toShow.add(this.containers)), this.settings.success) for (t = 0; this.successList[t]; t++)this.showLabel(this.successList[t]); if (this.settings.unhighlight) for (t = 0, e = this.validElements(); e[t]; t++)this.settings.unhighlight.call(this, e[t], this.settings.errorClass, this.settings.validClass); this.toHide = this.toHide.not(this.toShow), this.hideErrors(), this.addWrapper(this.toShow).show() }, validElements: function () { return this.currentElements.not(this.invalidElements()) }, invalidElements: function () { return t(this.errorList).map(function () { return this.element }) }, showLabel: function (e, i) { var s = this.errorsFor(e); s.length ? (s.removeClass(this.settings.validClass).addClass(this.settings.errorClass), s.html(i)) : (s = t("<" + this.settings.errorElement + ">").attr("for", this.idOrName(e)).addClass(this.settings.errorClass).html(i || ""), this.settings.wrapper && (s = s.hide().show().wrap("<" + this.settings.wrapper + "/>").parent()), this.labelContainer.append(s).length || (this.settings.errorPlacement ? this.settings.errorPlacement(s, t(e)) : s.insertAfter(e))), !i && this.settings.success && (s.text(""), "string" == typeof this.settings.success ? s.addClass(this.settings.success) : this.settings.success(s, e)), this.toShow = this.toShow.add(s) }, errorsFor: function (e) { var i = this.idOrName(e); return this.errors().filter(function () { return t(this).attr("for") === i }) }, idOrName: function (t) { return this.groups[t.name] || (this.checkable(t) ? t.name : t.id || t.name) }, validationTargetFor: function (t) { return this.checkable(t) && (t = this.findByName(t.name).not(this.settings.ignore)[0]), t }, checkable: function (t) { return /radio|checkbox/i.test(t.type) }, findByName: function (e) { return t(this.currentForm).find("[name='" + e + "']") }, getLength: function (e, i) { switch (i.nodeName.toLowerCase()) { case "select": return t("option:selected", i).length; case "input": if (this.checkable(i)) return this.findByName(i.name).filter(":checked").length }return e.length }, depend: function (t, e) { return this.dependTypes[typeof t] ? this.dependTypes[typeof t](t, e) : !0 }, dependTypes: { "boolean": function (t) { return t }, string: function (e, i) { return !!t(e, i.form).length }, "function": function (t, e) { return t(e) } }, optional: function (e) { var i = this.elementValue(e); return !t.validator.methods.required.call(this, i, e) && "dependency-mismatch" }, startRequest: function (t) { this.pending[t.name] || (this.pendingRequest++ , this.pending[t.name] = !0) }, stopRequest: function (e, i) { this.pendingRequest-- , 0 > this.pendingRequest && (this.pendingRequest = 0), delete this.pending[e.name], i && 0 === this.pendingRequest && this.formSubmitted && this.form() ? (t(this.currentForm).submit(), this.formSubmitted = !1) : !i && 0 === this.pendingRequest && this.formSubmitted && (t(this.currentForm).triggerHandler("invalid-form", [this]), this.formSubmitted = !1) }, previousValue: function (e) { return t.data(e, "previousValue") || t.data(e, "previousValue", { old: null, valid: !0, message: this.defaultMessage(e, "remote") }) } }, classRuleSettings: { required: { required: !0 }, email: { email: !0 }, url: { url: !0 }, date: { date: !0 }, dateISO: { dateISO: !0 }, number: { number: !0 }, digits: { digits: !0 }, creditcard: { creditcard: !0 } }, addClassRules: function (e, i) { e.constructor === String ? this.classRuleSettings[e] = i : t.extend(this.classRuleSettings, e) }, classRules: function (e) { var i = {}, s = t(e).attr("class"); return s && t.each(s.split(" "), function () { this in t.validator.classRuleSettings && t.extend(i, t.validator.classRuleSettings[this]) }), i }, attributeRules: function (e) { var i = {}, s = t(e), r = s[0].getAttribute("type"); for (var n in t.validator.methods) { var a; "required" === n ? (a = s.get(0).getAttribute(n), "" === a && (a = !0), a = !!a) : a = s.attr(n), /min|max/.test(n) && (null === r || /number|range|text/.test(r)) && (a = Number(a)), a ? i[n] = a : r === n && "range" !== r && (i[n] = !0) } return i.maxlength && /-1|2147483647|524288/.test(i.maxlength) && delete i.maxlength, i }, dataRules: function (e) { var i, s, r = {}, n = t(e); for (i in t.validator.methods) s = n.data("rule-" + i.toLowerCase()), void 0 !== s && (r[i] = s); return r }, staticRules: function (e) { var i = {}, s = t.data(e.form, "validator"); return s.settings.rules && (i = t.validator.normalizeRule(s.settings.rules[e.name]) || {}), i }, normalizeRules: function (e, i) { return t.each(e, function (s, r) { if (r === !1) return delete e[s], void 0; if (r.param || r.depends) { var n = !0; switch (typeof r.depends) { case "string": n = !!t(r.depends, i.form).length; break; case "function": n = r.depends.call(i, i) }n ? e[s] = void 0 !== r.param ? r.param : !0 : delete e[s] } }), t.each(e, function (s, r) { e[s] = t.isFunction(r) ? r(i) : r }), t.each(["minlength", "maxlength"], function () { e[this] && (e[this] = Number(e[this])) }), t.each(["rangelength", "range"], function () { var i; e[this] && (t.isArray(e[this]) ? e[this] = [Number(e[this][0]), Number(e[this][1])] : "string" == typeof e[this] && (i = e[this].split(/[\s,]+/), e[this] = [Number(i[0]), Number(i[1])])) }), t.validator.autoCreateRanges && (e.min && e.max && (e.range = [e.min, e.max], delete e.min, delete e.max), e.minlength && e.maxlength && (e.rangelength = [e.minlength, e.maxlength], delete e.minlength, delete e.maxlength)), e }, normalizeRule: function (e) { if ("string" == typeof e) { var i = {}; t.each(e.split(/\s/), function () { i[this] = !0 }), e = i } return e }, addMethod: function (e, i, s) { t.validator.methods[e] = i, t.validator.messages[e] = void 0 !== s ? s : t.validator.messages[e], 3 > i.length && t.validator.addClassRules(e, t.validator.normalizeRule(e)) }, methods: { required: function (e, i, s) { if (!this.depend(s, i)) return "dependency-mismatch"; if ("select" === i.nodeName.toLowerCase()) { var r = t(i).val(); return r && r.length > 0 } return this.checkable(i) ? this.getLength(e, i) > 0 : t.trim(e).length > 0 }, email: function (t, e) { return this.optional(e) || /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_'{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_'{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(t) }, url: function (t, e) { return this.optional(e) || /^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t) }, date: function (t, e) { return this.optional(e) || !/Invalid|NaN/.test("" + new Date(t)) }, dateISO: function (t, e) { return this.optional(e) || /^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(t) }, number: function (t, e) { return this.optional(e) || /^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t) }, digits: function (t, e) { return this.optional(e) || /^\d+$/.test(t) }, creditcard: function (t, e) { if (this.optional(e)) return "dependency-mismatch"; if (/[^0-9 \-]+/.test(t)) return !1; var i = 0, s = 0, r = !1; t = t.replace(/\D/g, ""); for (var n = t.length - 1; n >= 0; n--) { var a = t.charAt(n); s = parseInt(a, 10), r && (s *= 2) > 9 && (s -= 9), i += s, r = !r } return 0 === i % 10 }, minlength: function (e, i, s) { var r = t.isArray(e) ? e.length : this.getLength(t.trim(e), i); return this.optional(i) || r >= s }, maxlength: function (e, i, s) { var r = t.isArray(e) ? e.length : this.getLength(t.trim(e), i); return this.optional(i) || s >= r }, rangelength: function (e, i, s) { var r = t.isArray(e) ? e.length : this.getLength(t.trim(e), i); return this.optional(i) || r >= s[0] && s[1] >= r }, min: function (t, e, i) { return this.optional(e) || t >= i }, max: function (t, e, i) { return this.optional(e) || i >= t }, range: function (t, e, i) { return this.optional(e) || t >= i[0] && i[1] >= t }, equalTo: function (e, i, s) { var r = t(s); return this.settings.onfocusout && r.unbind(".validate-equalTo").bind("blur.validate-equalTo", function () { t(i).valid() }), e === r.val() }, remote: function (e, i, s) { if (this.optional(i)) return "dependency-mismatch"; var r = this.previousValue(i); if (this.settings.messages[i.name] || (this.settings.messages[i.name] = {}), r.originalMessage = this.settings.messages[i.name].remote, this.settings.messages[i.name].remote = r.message, s = "string" == typeof s && { url: s } || s, r.old === e) return r.valid; r.old = e; var n = this; this.startRequest(i); var a = {}; return a[i.name] = e, t.ajax(t.extend(!0, { url: s, mode: "abort", port: "validate" + i.name, dataType: "json", data: a, success: function (s) { n.settings.messages[i.name].remote = r.originalMessage; var a = s === !0 || "true" === s; if (a) { var u = n.formSubmitted; n.prepareElement(i), n.formSubmitted = u, n.successList.push(i), delete n.invalid[i.name], n.showErrors() } else { var o = {}, l = s || n.defaultMessage(i, "remote"); o[i.name] = r.message = t.isFunction(l) ? l(e) : l, n.invalid[i.name] = !0, n.showErrors(o) } r.valid = a, n.stopRequest(i, a) } }, s)), "pending" } } }), t.format = t.validator.format })(jQuery), function (t) { var e = {}; if (t.ajaxPrefilter) t.ajaxPrefilter(function (t, i, s) { var r = t.port; "abort" === t.mode && (e[r] && e[r].abort(), e[r] = s) }); else { var i = t.ajax; t.ajax = function (s) { var r = ("mode" in s ? s : t.ajaxSettings).mode, n = ("port" in s ? s : t.ajaxSettings).port; return "abort" === r ? (e[n] && e[n].abort(), e[n] = i.apply(this, arguments), e[n]) : i.apply(this, arguments) } } }(jQuery), function (t) { t.extend(t.fn, { validateDelegate: function (e, i, s) { return this.bind(i, function (i) { var r = t(i.target); return r.is(e) ? s.apply(r, arguments) : void 0 }) } }) }(jQuery);
/*
 * This combined file was created by the DataTables downloader builder:
 *   https://datatables.net/download
 *
 * To rebuild or modify this file with the latest versions of the included
 * software please visit:
 *   https://datatables.net/download/#dt/dt-1.10.16
 *
 * Included libraries:
 *   DataTables 1.10.16
 */

/*!
 DataTables 1.10.16
 Â©2008-2017 SpryMedia Ltd - datatables.net/license
*/
(function (h) { "function" === typeof define && define.amd ? define(["jquery"], function (E) { return h(E, window, document) }) : "object" === typeof exports ? module.exports = function (E, G) { E || (E = window); G || (G = "undefined" !== typeof window ? require("jquery") : require("jquery")(E)); return h(G, E, E.document) } : h(jQuery, window, document) })(function (h, E, G, k) {
    function X(a) {
        var b, c, d = {}; h.each(a, function (e) {
            if ((b = e.match(/^([^A-Z]+?)([A-Z])/)) && -1 !== "a aa ai ao as b fn i m o s ".indexOf(b[1] + " ")) c = e.replace(b[0], b[2].toLowerCase()),
                d[c] = e, "o" === b[1] && X(a[e])
        }); a._hungarianMap = d
    } function I(a, b, c) { a._hungarianMap || X(a); var d; h.each(b, function (e) { d = a._hungarianMap[e]; if (d !== k && (c || b[d] === k)) "o" === d.charAt(0) ? (b[d] || (b[d] = {}), h.extend(!0, b[d], b[e]), I(a[d], b[d], c)) : b[d] = b[e] }) } function Ca(a) {
        var b = m.defaults.oLanguage, c = a.sZeroRecords; !a.sEmptyTable && (c && "No data available in table" === b.sEmptyTable) && F(a, a, "sZeroRecords", "sEmptyTable"); !a.sLoadingRecords && (c && "Loading..." === b.sLoadingRecords) && F(a, a, "sZeroRecords", "sLoadingRecords");
        a.sInfoThousands && (a.sThousands = a.sInfoThousands); (a = a.sDecimal) && cb(a)
    } function db(a) {
        A(a, "ordering", "bSort"); A(a, "orderMulti", "bSortMulti"); A(a, "orderClasses", "bSortClasses"); A(a, "orderCellsTop", "bSortCellsTop"); A(a, "order", "aaSorting"); A(a, "orderFixed", "aaSortingFixed"); A(a, "paging", "bPaginate"); A(a, "pagingType", "sPaginationType"); A(a, "pageLength", "iDisplayLength"); A(a, "searching", "bFilter"); "boolean" === typeof a.sScrollX && (a.sScrollX = a.sScrollX ? "100%" : ""); "boolean" === typeof a.scrollX && (a.scrollX =
            a.scrollX ? "100%" : ""); if (a = a.aoSearchCols) for (var b = 0, c = a.length; b < c; b++)a[b] && I(m.models.oSearch, a[b])
    } function eb(a) { A(a, "orderable", "bSortable"); A(a, "orderData", "aDataSort"); A(a, "orderSequence", "asSorting"); A(a, "orderDataType", "sortDataType"); var b = a.aDataSort; "number" === typeof b && !h.isArray(b) && (a.aDataSort = [b]) } function fb(a) {
        if (!m.__browser) {
            var b = {}; m.__browser = b; var c = h("<div/>").css({ position: "fixed", top: 0, left: -1 * h(E).scrollLeft(), height: 1, width: 1, overflow: "hidden" }).append(h("<div/>").css({
                position: "absolute",
                top: 1, left: 1, width: 100, overflow: "scroll"
            }).append(h("<div/>").css({ width: "100%", height: 10 }))).appendTo("body"), d = c.children(), e = d.children(); b.barWidth = d[0].offsetWidth - d[0].clientWidth; b.bScrollOversize = 100 === e[0].offsetWidth && 100 !== d[0].clientWidth; b.bScrollbarLeft = 1 !== Math.round(e.offset().left); b.bBounding = c[0].getBoundingClientRect().width ? !0 : !1; c.remove()
        } h.extend(a.oBrowser, m.__browser); a.oScroll.iBarWidth = m.__browser.barWidth
    } function gb(a, b, c, d, e, f) {
        var g, j = !1; c !== k && (g = c, j = !0); for (; d !==
            e;)a.hasOwnProperty(d) && (g = j ? b(g, a[d], d, a) : a[d], j = !0, d += f); return g
    } function Da(a, b) { var c = m.defaults.column, d = a.aoColumns.length, c = h.extend({}, m.models.oColumn, c, { nTh: b ? b : G.createElement("th"), sTitle: c.sTitle ? c.sTitle : b ? b.innerHTML : "", aDataSort: c.aDataSort ? c.aDataSort : [d], mData: c.mData ? c.mData : d, idx: d }); a.aoColumns.push(c); c = a.aoPreSearchCols; c[d] = h.extend({}, m.models.oSearch, c[d]); ja(a, d, h(b).data()) } function ja(a, b, c) {
        var b = a.aoColumns[b], d = a.oClasses, e = h(b.nTh); if (!b.sWidthOrig) {
        b.sWidthOrig =
            e.attr("width") || null; var f = (e.attr("style") || "").match(/width:\s*(\d+[pxem%]+)/); f && (b.sWidthOrig = f[1])
        } c !== k && null !== c && (eb(c), I(m.defaults.column, c), c.mDataProp !== k && !c.mData && (c.mData = c.mDataProp), c.sType && (b._sManualType = c.sType), c.className && !c.sClass && (c.sClass = c.className), c.sClass && e.addClass(c.sClass), h.extend(b, c), F(b, c, "sWidth", "sWidthOrig"), c.iDataSort !== k && (b.aDataSort = [c.iDataSort]), F(b, c, "aDataSort")); var g = b.mData, j = Q(g), i = b.mRender ? Q(b.mRender) : null, c = function (a) {
            return "string" ===
                typeof a && -1 !== a.indexOf("@")
        }; b._bAttrSrc = h.isPlainObject(g) && (c(g.sort) || c(g.type) || c(g.filter)); b._setter = null; b.fnGetData = function (a, b, c) { var d = j(a, b, k, c); return i && b ? i(d, b, a, c) : d }; b.fnSetData = function (a, b, c) { return R(g)(a, b, c) }; "number" !== typeof g && (a._rowReadObject = !0); a.oFeatures.bSort || (b.bSortable = !1, e.addClass(d.sSortableNone)); a = -1 !== h.inArray("asc", b.asSorting); c = -1 !== h.inArray("desc", b.asSorting); !b.bSortable || !a && !c ? (b.sSortingClass = d.sSortableNone, b.sSortingClassJUI = "") : a && !c ? (b.sSortingClass =
            d.sSortableAsc, b.sSortingClassJUI = d.sSortJUIAscAllowed) : !a && c ? (b.sSortingClass = d.sSortableDesc, b.sSortingClassJUI = d.sSortJUIDescAllowed) : (b.sSortingClass = d.sSortable, b.sSortingClassJUI = d.sSortJUI)
    } function Y(a) { if (!1 !== a.oFeatures.bAutoWidth) { var b = a.aoColumns; Ea(a); for (var c = 0, d = b.length; c < d; c++)b[c].nTh.style.width = b[c].sWidth } b = a.oScroll; ("" !== b.sY || "" !== b.sX) && ka(a); r(a, null, "column-sizing", [a]) } function Z(a, b) { var c = la(a, "bVisible"); return "number" === typeof c[b] ? c[b] : null } function $(a, b) {
        var c =
            la(a, "bVisible"), c = h.inArray(b, c); return -1 !== c ? c : null
    } function aa(a) { var b = 0; h.each(a.aoColumns, function (a, d) { d.bVisible && "none" !== h(d.nTh).css("display") && b++ }); return b } function la(a, b) { var c = []; h.map(a.aoColumns, function (a, e) { a[b] && c.push(e) }); return c } function Fa(a) {
        var b = a.aoColumns, c = a.aoData, d = m.ext.type.detect, e, f, g, j, i, h, l, q, t; e = 0; for (f = b.length; e < f; e++)if (l = b[e], t = [], !l.sType && l._sManualType) l.sType = l._sManualType; else if (!l.sType) {
            g = 0; for (j = d.length; g < j; g++) {
                i = 0; for (h = c.length; i < h; i++) {
                t[i] ===
                    k && (t[i] = B(a, i, e, "type")); q = d[g](t[i], a); if (!q && g !== d.length - 1) break; if ("html" === q) break
                } if (q) { l.sType = q; break }
            } l.sType || (l.sType = "string")
        }
    } function hb(a, b, c, d) {
        var e, f, g, j, i, n, l = a.aoColumns; if (b) for (e = b.length - 1; 0 <= e; e--) {
            n = b[e]; var q = n.targets !== k ? n.targets : n.aTargets; h.isArray(q) || (q = [q]); f = 0; for (g = q.length; f < g; f++)if ("number" === typeof q[f] && 0 <= q[f]) { for (; l.length <= q[f];)Da(a); d(q[f], n) } else if ("number" === typeof q[f] && 0 > q[f]) d(l.length + q[f], n); else if ("string" === typeof q[f]) {
                j = 0; for (i = l.length; j <
                    i; j++)("_all" == q[f] || h(l[j].nTh).hasClass(q[f])) && d(j, n)
            }
        } if (c) { e = 0; for (a = c.length; e < a; e++)d(e, c[e]) }
    } function M(a, b, c, d) { var e = a.aoData.length, f = h.extend(!0, {}, m.models.oRow, { src: c ? "dom" : "data", idx: e }); f._aData = b; a.aoData.push(f); for (var g = a.aoColumns, j = 0, i = g.length; j < i; j++)g[j].sType = null; a.aiDisplayMaster.push(e); b = a.rowIdFn(b); b !== k && (a.aIds[b] = f); (c || !a.oFeatures.bDeferRender) && Ga(a, e, c, d); return e } function ma(a, b) {
        var c; b instanceof h || (b = h(b)); return b.map(function (b, e) {
            c = Ha(a, e); return M(a,
                c.data, e, c.cells)
        })
    } function B(a, b, c, d) { var e = a.iDraw, f = a.aoColumns[c], g = a.aoData[b]._aData, j = f.sDefaultContent, i = f.fnGetData(g, d, { settings: a, row: b, col: c }); if (i === k) return a.iDrawError != e && null === j && (J(a, 0, "Requested unknown parameter " + ("function" == typeof f.mData ? "{function}" : "'" + f.mData + "'") + " for row " + b + ", column " + c, 4), a.iDrawError = e), j; if ((i === g || null === i) && null !== j && d !== k) i = j; else if ("function" === typeof i) return i.call(g); return null === i && "display" == d ? "" : i } function ib(a, b, c, d) {
    a.aoColumns[c].fnSetData(a.aoData[b]._aData,
        d, { settings: a, row: b, col: c })
    } function Ia(a) { return h.map(a.match(/(\\.|[^\.])+/g) || [""], function (a) { return a.replace(/\\\./g, ".") }) } function Q(a) {
        if (h.isPlainObject(a)) { var b = {}; h.each(a, function (a, c) { c && (b[a] = Q(c)) }); return function (a, c, f, g) { var j = b[c] || b._; return j !== k ? j(a, c, f, g) : a } } if (null === a) return function (a) { return a }; if ("function" === typeof a) return function (b, c, f, g) { return a(b, c, f, g) }; if ("string" === typeof a && (-1 !== a.indexOf(".") || -1 !== a.indexOf("[") || -1 !== a.indexOf("("))) {
            var c = function (a,
                b, f) { var g, j; if ("" !== f) { j = Ia(f); for (var i = 0, n = j.length; i < n; i++) { f = j[i].match(ba); g = j[i].match(U); if (f) { j[i] = j[i].replace(ba, ""); "" !== j[i] && (a = a[j[i]]); g = []; j.splice(0, i + 1); j = j.join("."); if (h.isArray(a)) { i = 0; for (n = a.length; i < n; i++)g.push(c(a[i], b, j)) } a = f[0].substring(1, f[0].length - 1); a = "" === a ? g : g.join(a); break } else if (g) { j[i] = j[i].replace(U, ""); a = a[j[i]](); continue } if (null === a || a[j[i]] === k) return k; a = a[j[i]] } } return a }; return function (b, e) { return c(b, e, a) }
        } return function (b) { return b[a] }
    } function R(a) {
        if (h.isPlainObject(a)) return R(a._);
        if (null === a) return function () { }; if ("function" === typeof a) return function (b, d, e) { a(b, "set", d, e) }; if ("string" === typeof a && (-1 !== a.indexOf(".") || -1 !== a.indexOf("[") || -1 !== a.indexOf("("))) {
            var b = function (a, d, e) {
                var e = Ia(e), f; f = e[e.length - 1]; for (var g, j, i = 0, n = e.length - 1; i < n; i++) {
                    g = e[i].match(ba); j = e[i].match(U); if (g) { e[i] = e[i].replace(ba, ""); a[e[i]] = []; f = e.slice(); f.splice(0, i + 1); g = f.join("."); if (h.isArray(d)) { j = 0; for (n = d.length; j < n; j++)f = {}, b(f, d[j], g), a[e[i]].push(f) } else a[e[i]] = d; return } j && (e[i] = e[i].replace(U,
                        ""), a = a[e[i]](d)); if (null === a[e[i]] || a[e[i]] === k) a[e[i]] = {}; a = a[e[i]]
                } if (f.match(U)) a[f.replace(U, "")](d); else a[f.replace(ba, "")] = d
            }; return function (c, d) { return b(c, d, a) }
        } return function (b, d) { b[a] = d }
    } function Ja(a) { return D(a.aoData, "_aData") } function na(a) { a.aoData.length = 0; a.aiDisplayMaster.length = 0; a.aiDisplay.length = 0; a.aIds = {} } function oa(a, b, c) { for (var d = -1, e = 0, f = a.length; e < f; e++)a[e] == b ? d = e : a[e] > b && a[e]--; -1 != d && c === k && a.splice(d, 1) } function ca(a, b, c, d) {
        var e = a.aoData[b], f, g = function (c, d) {
            for (; c.childNodes.length;)c.removeChild(c.firstChild);
            c.innerHTML = B(a, b, d, "display")
        }; if ("dom" === c || (!c || "auto" === c) && "dom" === e.src) e._aData = Ha(a, e, d, d === k ? k : e._aData).data; else { var j = e.anCells; if (j) if (d !== k) g(j[d], d); else { c = 0; for (f = j.length; c < f; c++)g(j[c], c) } } e._aSortData = null; e._aFilterData = null; g = a.aoColumns; if (d !== k) g[d].sType = null; else { c = 0; for (f = g.length; c < f; c++)g[c].sType = null; Ka(a, e) }
    } function Ha(a, b, c, d) {
        var e = [], f = b.firstChild, g, j, i = 0, n, l = a.aoColumns, q = a._rowReadObject, d = d !== k ? d : q ? {} : [], t = function (a, b) {
            if ("string" === typeof a) {
                var c = a.indexOf("@");
                -1 !== c && (c = a.substring(c + 1), R(a)(d, b.getAttribute(c)))
            }
        }, m = function (a) { if (c === k || c === i) j = l[i], n = h.trim(a.innerHTML), j && j._bAttrSrc ? (R(j.mData._)(d, n), t(j.mData.sort, a), t(j.mData.type, a), t(j.mData.filter, a)) : q ? (j._setter || (j._setter = R(j.mData)), j._setter(d, n)) : d[i] = n; i++ }; if (f) for (; f;) { g = f.nodeName.toUpperCase(); if ("TD" == g || "TH" == g) m(f), e.push(f); f = f.nextSibling } else { e = b.anCells; f = 0; for (g = e.length; f < g; f++)m(e[f]) } if (b = b.firstChild ? b : b.nTr) (b = b.getAttribute("id")) && R(a.rowId)(d, b); return { data: d, cells: e }
    }
    function Ga(a, b, c, d) {
        var e = a.aoData[b], f = e._aData, g = [], j, i, n, l, q; if (null === e.nTr) {
            j = c || G.createElement("tr"); e.nTr = j; e.anCells = g; j._DT_RowIndex = b; Ka(a, e); l = 0; for (q = a.aoColumns.length; l < q; l++) {
                n = a.aoColumns[l]; i = c ? d[l] : G.createElement(n.sCellType); i._DT_CellIndex = { row: b, column: l }; g.push(i); if ((!c || n.mRender || n.mData !== l) && (!h.isPlainObject(n.mData) || n.mData._ !== l + ".display")) i.innerHTML = B(a, b, l, "display"); n.sClass && (i.className += " " + n.sClass); n.bVisible && !c ? j.appendChild(i) : !n.bVisible && c && i.parentNode.removeChild(i);
                n.fnCreatedCell && n.fnCreatedCell.call(a.oInstance, i, B(a, b, l), f, b, l)
            } r(a, "aoRowCreatedCallback", null, [j, f, b])
        } e.nTr.setAttribute("role", "row")
    } function Ka(a, b) { var c = b.nTr, d = b._aData; if (c) { var e = a.rowIdFn(d); e && (c.id = e); d.DT_RowClass && (e = d.DT_RowClass.split(" "), b.__rowc = b.__rowc ? qa(b.__rowc.concat(e)) : e, h(c).removeClass(b.__rowc.join(" ")).addClass(d.DT_RowClass)); d.DT_RowAttr && h(c).attr(d.DT_RowAttr); d.DT_RowData && h(c).data(d.DT_RowData) } } function jb(a) {
        var b, c, d, e, f, g = a.nTHead, j = a.nTFoot, i = 0 ===
            h("th, td", g).length, n = a.oClasses, l = a.aoColumns; i && (e = h("<tr/>").appendTo(g)); b = 0; for (c = l.length; b < c; b++)f = l[b], d = h(f.nTh).addClass(f.sClass), i && d.appendTo(e), a.oFeatures.bSort && (d.addClass(f.sSortingClass), !1 !== f.bSortable && (d.attr("tabindex", a.iTabIndex).attr("aria-controls", a.sTableId), La(a, f.nTh, b))), f.sTitle != d[0].innerHTML && d.html(f.sTitle), Ma(a, "header")(a, d, f, n); i && da(a.aoHeader, g); h(g).find(">tr").attr("role", "row"); h(g).find(">tr>th, >tr>td").addClass(n.sHeaderTH); h(j).find(">tr>th, >tr>td").addClass(n.sFooterTH);
        if (null !== j) { a = a.aoFooter[0]; b = 0; for (c = a.length; b < c; b++)f = l[b], f.nTf = a[b].cell, f.sClass && h(f.nTf).addClass(f.sClass) }
    } function ea(a, b, c) {
        var d, e, f, g = [], j = [], i = a.aoColumns.length, n; if (b) {
        c === k && (c = !1); d = 0; for (e = b.length; d < e; d++) { g[d] = b[d].slice(); g[d].nTr = b[d].nTr; for (f = i - 1; 0 <= f; f--)!a.aoColumns[f].bVisible && !c && g[d].splice(f, 1); j.push([]) } d = 0; for (e = g.length; d < e; d++) {
            if (a = g[d].nTr) for (; f = a.firstChild;)a.removeChild(f); f = 0; for (b = g[d].length; f < b; f++)if (n = i = 1, j[d][f] === k) {
                a.appendChild(g[d][f].cell);
                for (j[d][f] = 1; g[d + i] !== k && g[d][f].cell == g[d + i][f].cell;)j[d + i][f] = 1, i++; for (; g[d][f + n] !== k && g[d][f].cell == g[d][f + n].cell;) { for (c = 0; c < i; c++)j[d + c][f + n] = 1; n++ } h(g[d][f].cell).attr("rowspan", i).attr("colspan", n)
            }
        }
        }
    } function N(a) {
        var b = r(a, "aoPreDrawCallback", "preDraw", [a]); if (-1 !== h.inArray(!1, b)) C(a, !1); else {
            var b = [], c = 0, d = a.asStripeClasses, e = d.length, f = a.oLanguage, g = a.iInitDisplayStart, j = "ssp" == y(a), i = a.aiDisplay; a.bDrawing = !0; g !== k && -1 !== g && (a._iDisplayStart = j ? g : g >= a.fnRecordsDisplay() ? 0 : g, a.iInitDisplayStart =
                -1); var g = a._iDisplayStart, n = a.fnDisplayEnd(); if (a.bDeferLoading) a.bDeferLoading = !1, a.iDraw++ , C(a, !1); else if (j) { if (!a.bDestroying && !kb(a)) return } else a.iDraw++; if (0 !== i.length) { f = j ? a.aoData.length : n; for (j = j ? 0 : g; j < f; j++) { var l = i[j], q = a.aoData[l]; null === q.nTr && Ga(a, l); l = q.nTr; if (0 !== e) { var t = d[c % e]; q._sRowStripe != t && (h(l).removeClass(q._sRowStripe).addClass(t), q._sRowStripe = t) } r(a, "aoRowCallback", null, [l, q._aData, c, j]); b.push(l); c++ } } else c = f.sZeroRecords, 1 == a.iDraw && "ajax" == y(a) ? c = f.sLoadingRecords :
                    f.sEmptyTable && 0 === a.fnRecordsTotal() && (c = f.sEmptyTable), b[0] = h("<tr/>", { "class": e ? d[0] : "" }).append(h("<td />", { valign: "top", colSpan: aa(a), "class": a.oClasses.sRowEmpty }).html(c))[0]; r(a, "aoHeaderCallback", "header", [h(a.nTHead).children("tr")[0], Ja(a), g, n, i]); r(a, "aoFooterCallback", "footer", [h(a.nTFoot).children("tr")[0], Ja(a), g, n, i]); d = h(a.nTBody); d.children().detach(); d.append(h(b)); r(a, "aoDrawCallback", "draw", [a]); a.bSorted = !1; a.bFiltered = !1; a.bDrawing = !1
        }
    } function S(a, b) {
        var c = a.oFeatures, d = c.bFilter;
        c.bSort && lb(a); d ? fa(a, a.oPreviousSearch) : a.aiDisplay = a.aiDisplayMaster.slice(); !0 !== b && (a._iDisplayStart = 0); a._drawHold = b; N(a); a._drawHold = !1
    } function mb(a) {
        var b = a.oClasses, c = h(a.nTable), c = h("<div/>").insertBefore(c), d = a.oFeatures, e = h("<div/>", { id: a.sTableId + "_wrapper", "class": b.sWrapper + (a.nTFoot ? "" : " " + b.sNoFooter) }); a.nHolding = c[0]; a.nTableWrapper = e[0]; a.nTableReinsertBefore = a.nTable.nextSibling; for (var f = a.sDom.split(""), g, j, i, n, l, q, k = 0; k < f.length; k++) {
            g = null; j = f[k]; if ("<" == j) {
                i = h("<div/>")[0];
                n = f[k + 1]; if ("'" == n || '"' == n) { l = ""; for (q = 2; f[k + q] != n;)l += f[k + q], q++; "H" == l ? l = b.sJUIHeader : "F" == l && (l = b.sJUIFooter); -1 != l.indexOf(".") ? (n = l.split("."), i.id = n[0].substr(1, n[0].length - 1), i.className = n[1]) : "#" == l.charAt(0) ? i.id = l.substr(1, l.length - 1) : i.className = l; k += q } e.append(i); e = h(i)
            } else if (">" == j) e = e.parent(); else if ("l" == j && d.bPaginate && d.bLengthChange) g = nb(a); else if ("f" == j && d.bFilter) g = ob(a); else if ("r" == j && d.bProcessing) g = pb(a); else if ("t" == j) g = qb(a); else if ("i" == j && d.bInfo) g = rb(a); else if ("p" ==
                j && d.bPaginate) g = sb(a); else if (0 !== m.ext.feature.length) { i = m.ext.feature; q = 0; for (n = i.length; q < n; q++)if (j == i[q].cFeature) { g = i[q].fnInit(a); break } } g && (i = a.aanFeatures, i[j] || (i[j] = []), i[j].push(g), e.append(g))
        } c.replaceWith(e); a.nHolding = null
    } function da(a, b) {
        var c = h(b).children("tr"), d, e, f, g, j, i, n, l, q, k; a.splice(0, a.length); f = 0; for (i = c.length; f < i; f++)a.push([]); f = 0; for (i = c.length; f < i; f++) {
            d = c[f]; for (e = d.firstChild; e;) {
                if ("TD" == e.nodeName.toUpperCase() || "TH" == e.nodeName.toUpperCase()) {
                    l = 1 * e.getAttribute("colspan");
                    q = 1 * e.getAttribute("rowspan"); l = !l || 0 === l || 1 === l ? 1 : l; q = !q || 0 === q || 1 === q ? 1 : q; g = 0; for (j = a[f]; j[g];)g++; n = g; k = 1 === l ? !0 : !1; for (j = 0; j < l; j++)for (g = 0; g < q; g++)a[f + g][n + j] = { cell: e, unique: k }, a[f + g].nTr = d
                } e = e.nextSibling
            }
        }
    } function ra(a, b, c) { var d = []; c || (c = a.aoHeader, b && (c = [], da(c, b))); for (var b = 0, e = c.length; b < e; b++)for (var f = 0, g = c[b].length; f < g; f++)if (c[b][f].unique && (!d[f] || !a.bSortCellsTop)) d[f] = c[b][f].cell; return d } function sa(a, b, c) {
        r(a, "aoServerParams", "serverParams", [b]); if (b && h.isArray(b)) {
            var d = {},
            e = /(.*?)\[\]$/; h.each(b, function (a, b) { var c = b.name.match(e); c ? (c = c[0], d[c] || (d[c] = []), d[c].push(b.value)) : d[b.name] = b.value }); b = d
        } var f, g = a.ajax, j = a.oInstance, i = function (b) { r(a, null, "xhr", [a, b, a.jqXHR]); c(b) }; if (h.isPlainObject(g) && g.data) { f = g.data; var n = h.isFunction(f) ? f(b, a) : f, b = h.isFunction(f) && n ? n : h.extend(!0, b, n); delete g.data } n = {
            data: b, success: function (b) { var c = b.error || b.sError; c && J(a, 0, c); a.json = b; i(b) }, dataType: "json", cache: !1, type: a.sServerMethod, error: function (b, c) {
                var d = r(a, null, "xhr",
                    [a, null, a.jqXHR]); -1 === h.inArray(!0, d) && ("parsererror" == c ? J(a, 0, "Invalid JSON response", 1) : 4 === b.readyState && J(a, 0, "Ajax error", 7)); C(a, !1)
            }
        }; a.oAjaxData = b; r(a, null, "preXhr", [a, b]); a.fnServerData ? a.fnServerData.call(j, a.sAjaxSource, h.map(b, function (a, b) { return { name: b, value: a } }), i, a) : a.sAjaxSource || "string" === typeof g ? a.jqXHR = h.ajax(h.extend(n, { url: g || a.sAjaxSource })) : h.isFunction(g) ? a.jqXHR = g.call(j, b, i, a) : (a.jqXHR = h.ajax(h.extend(n, g)), g.data = f)
    } function kb(a) {
        return a.bAjaxDataGet ? (a.iDraw++ , C(a,
            !0), sa(a, tb(a), function (b) { ub(a, b) }), !1) : !0
    } function tb(a) {
        var b = a.aoColumns, c = b.length, d = a.oFeatures, e = a.oPreviousSearch, f = a.aoPreSearchCols, g, j = [], i, n, l, k = V(a); g = a._iDisplayStart; i = !1 !== d.bPaginate ? a._iDisplayLength : -1; var t = function (a, b) { j.push({ name: a, value: b }) }; t("sEcho", a.iDraw); t("iColumns", c); t("sColumns", D(b, "sName").join(",")); t("iDisplayStart", g); t("iDisplayLength", i); var pa = { draw: a.iDraw, columns: [], order: [], start: g, length: i, search: { value: e.sSearch, regex: e.bRegex } }; for (g = 0; g < c; g++)n = b[g],
            l = f[g], i = "function" == typeof n.mData ? "function" : n.mData, pa.columns.push({ data: i, name: n.sName, searchable: n.bSearchable, orderable: n.bSortable, search: { value: l.sSearch, regex: l.bRegex } }), t("mDataProp_" + g, i), d.bFilter && (t("sSearch_" + g, l.sSearch), t("bRegex_" + g, l.bRegex), t("bSearchable_" + g, n.bSearchable)), d.bSort && t("bSortable_" + g, n.bSortable); d.bFilter && (t("sSearch", e.sSearch), t("bRegex", e.bRegex)); d.bSort && (h.each(k, function (a, b) {
                pa.order.push({ column: b.col, dir: b.dir }); t("iSortCol_" + a, b.col); t("sSortDir_" +
                    a, b.dir)
            }), t("iSortingCols", k.length)); b = m.ext.legacy.ajax; return null === b ? a.sAjaxSource ? j : pa : b ? j : pa
    } function ub(a, b) {
        var c = ta(a, b), d = b.sEcho !== k ? b.sEcho : b.draw, e = b.iTotalRecords !== k ? b.iTotalRecords : b.recordsTotal, f = b.iTotalDisplayRecords !== k ? b.iTotalDisplayRecords : b.recordsFiltered; if (d) { if (1 * d < a.iDraw) return; a.iDraw = 1 * d } na(a); a._iRecordsTotal = parseInt(e, 10); a._iRecordsDisplay = parseInt(f, 10); d = 0; for (e = c.length; d < e; d++)M(a, c[d]); a.aiDisplay = a.aiDisplayMaster.slice(); a.bAjaxDataGet = !1; N(a); a._bInitComplete ||
            ua(a, b); a.bAjaxDataGet = !0; C(a, !1)
    } function ta(a, b) { var c = h.isPlainObject(a.ajax) && a.ajax.dataSrc !== k ? a.ajax.dataSrc : a.sAjaxDataProp; return "data" === c ? b.aaData || b[c] : "" !== c ? Q(c)(b) : b } function ob(a) {
        var b = a.oClasses, c = a.sTableId, d = a.oLanguage, e = a.oPreviousSearch, f = a.aanFeatures, g = '<input type="search" class="' + b.sFilterInput + '"/>', j = d.sSearch, j = j.match(/_INPUT_/) ? j.replace("_INPUT_", g) : j + g, b = h("<div/>", { id: !f.f ? c + "_filter" : null, "class": b.sFilter }).append(h("<label/>").append(j)), f = function () {
            var b = !this.value ?
                "" : this.value; b != e.sSearch && (fa(a, { sSearch: b, bRegex: e.bRegex, bSmart: e.bSmart, bCaseInsensitive: e.bCaseInsensitive }), a._iDisplayStart = 0, N(a))
        }, g = null !== a.searchDelay ? a.searchDelay : "ssp" === y(a) ? 400 : 0, i = h("input", b).val(e.sSearch).attr("placeholder", d.sSearchPlaceholder).on("keyup.DT search.DT input.DT paste.DT cut.DT", g ? Na(f, g) : f).on("keypress.DT", function (a) { if (13 == a.keyCode) return !1 }).attr("aria-controls", c); h(a.nTable).on("search.dt.DT", function (b, c) { if (a === c) try { i[0] !== G.activeElement && i.val(e.sSearch) } catch (d) { } });
        return b[0]
    } function fa(a, b, c) { var d = a.oPreviousSearch, e = a.aoPreSearchCols, f = function (a) { d.sSearch = a.sSearch; d.bRegex = a.bRegex; d.bSmart = a.bSmart; d.bCaseInsensitive = a.bCaseInsensitive }; Fa(a); if ("ssp" != y(a)) { vb(a, b.sSearch, c, b.bEscapeRegex !== k ? !b.bEscapeRegex : b.bRegex, b.bSmart, b.bCaseInsensitive); f(b); for (b = 0; b < e.length; b++)wb(a, e[b].sSearch, b, e[b].bEscapeRegex !== k ? !e[b].bEscapeRegex : e[b].bRegex, e[b].bSmart, e[b].bCaseInsensitive); xb(a) } else f(b); a.bFiltered = !0; r(a, null, "search", [a]) } function xb(a) {
        for (var b =
            m.ext.search, c = a.aiDisplay, d, e, f = 0, g = b.length; f < g; f++) { for (var j = [], i = 0, n = c.length; i < n; i++)e = c[i], d = a.aoData[e], b[f](a, d._aFilterData, e, d._aData, i) && j.push(e); c.length = 0; h.merge(c, j) }
    } function wb(a, b, c, d, e, f) { if ("" !== b) { for (var g = [], j = a.aiDisplay, d = Oa(b, d, e, f), e = 0; e < j.length; e++)b = a.aoData[j[e]]._aFilterData[c], d.test(b) && g.push(j[e]); a.aiDisplay = g } } function vb(a, b, c, d, e, f) {
        var d = Oa(b, d, e, f), f = a.oPreviousSearch.sSearch, g = a.aiDisplayMaster, j, e = []; 0 !== m.ext.search.length && (c = !0); j = yb(a); if (0 >= b.length) a.aiDisplay =
            g.slice(); else { if (j || c || f.length > b.length || 0 !== b.indexOf(f) || a.bSorted) a.aiDisplay = g.slice(); b = a.aiDisplay; for (c = 0; c < b.length; c++)d.test(a.aoData[b[c]]._sFilterRow) && e.push(b[c]); a.aiDisplay = e }
    } function Oa(a, b, c, d) { a = b ? a : Pa(a); c && (a = "^(?=.*?" + h.map(a.match(/"[^"]+"|[^ ]+/g) || [""], function (a) { if ('"' === a.charAt(0)) var b = a.match(/^"(.*)"$/), a = b ? b[1] : a; return a.replace('"', "") }).join(")(?=.*?") + ").*$"); return RegExp(a, d ? "i" : "") } function yb(a) {
        var b = a.aoColumns, c, d, e, f, g, j, i, h, l = m.ext.type.search; c = !1;
        d = 0; for (f = a.aoData.length; d < f; d++)if (h = a.aoData[d], !h._aFilterData) { j = []; e = 0; for (g = b.length; e < g; e++)c = b[e], c.bSearchable ? (i = B(a, d, e, "filter"), l[c.sType] && (i = l[c.sType](i)), null === i && (i = ""), "string" !== typeof i && i.toString && (i = i.toString())) : i = "", i.indexOf && -1 !== i.indexOf("&") && (va.innerHTML = i, i = Wb ? va.textContent : va.innerText), i.replace && (i = i.replace(/[\r\n]/g, "")), j.push(i); h._aFilterData = j; h._sFilterRow = j.join("  "); c = !0 } return c
    } function zb(a) {
        return {
            search: a.sSearch, smart: a.bSmart, regex: a.bRegex,
            caseInsensitive: a.bCaseInsensitive
        }
    } function Ab(a) { return { sSearch: a.search, bSmart: a.smart, bRegex: a.regex, bCaseInsensitive: a.caseInsensitive } } function rb(a) { var b = a.sTableId, c = a.aanFeatures.i, d = h("<div/>", { "class": a.oClasses.sInfo, id: !c ? b + "_info" : null }); c || (a.aoDrawCallback.push({ fn: Bb, sName: "information" }), d.attr("role", "status").attr("aria-live", "polite"), h(a.nTable).attr("aria-describedby", b + "_info")); return d[0] } function Bb(a) {
        var b = a.aanFeatures.i; if (0 !== b.length) {
            var c = a.oLanguage, d = a._iDisplayStart +
                1, e = a.fnDisplayEnd(), f = a.fnRecordsTotal(), g = a.fnRecordsDisplay(), j = g ? c.sInfo : c.sInfoEmpty; g !== f && (j += " " + c.sInfoFiltered); j += c.sInfoPostFix; j = Cb(a, j); c = c.fnInfoCallback; null !== c && (j = c.call(a.oInstance, a, d, e, f, g, j)); h(b).html(j)
        }
    } function Cb(a, b) {
        var c = a.fnFormatNumber, d = a._iDisplayStart + 1, e = a._iDisplayLength, f = a.fnRecordsDisplay(), g = -1 === e; return b.replace(/_START_/g, c.call(a, d)).replace(/_END_/g, c.call(a, a.fnDisplayEnd())).replace(/_MAX_/g, c.call(a, a.fnRecordsTotal())).replace(/_TOTAL_/g, c.call(a,
            f)).replace(/_PAGE_/g, c.call(a, g ? 1 : Math.ceil(d / e))).replace(/_PAGES_/g, c.call(a, g ? 1 : Math.ceil(f / e)))
    } function ga(a) {
        var b, c, d = a.iInitDisplayStart, e = a.aoColumns, f; c = a.oFeatures; var g = a.bDeferLoading; if (a.bInitialised) {
            mb(a); jb(a); ea(a, a.aoHeader); ea(a, a.aoFooter); C(a, !0); c.bAutoWidth && Ea(a); b = 0; for (c = e.length; b < c; b++)f = e[b], f.sWidth && (f.nTh.style.width = v(f.sWidth)); r(a, null, "preInit", [a]); S(a); e = y(a); if ("ssp" != e || g) "ajax" == e ? sa(a, [], function (c) {
                var f = ta(a, c); for (b = 0; b < f.length; b++)M(a, f[b]); a.iInitDisplayStart =
                    d; S(a); C(a, !1); ua(a, c)
            }, a) : (C(a, !1), ua(a))
        } else setTimeout(function () { ga(a) }, 200)
    } function ua(a, b) { a._bInitComplete = !0; (b || a.oInit.aaData) && Y(a); r(a, null, "plugin-init", [a, b]); r(a, "aoInitComplete", "init", [a, b]) } function Qa(a, b) { var c = parseInt(b, 10); a._iDisplayLength = c; Ra(a); r(a, null, "length", [a, c]) } function nb(a) {
        for (var b = a.oClasses, c = a.sTableId, d = a.aLengthMenu, e = h.isArray(d[0]), f = e ? d[0] : d, d = e ? d[1] : d, e = h("<select/>", { name: c + "_length", "aria-controls": c, "class": b.sLengthSelect }), g = 0, j = f.length; g < j; g++)e[0][g] =
            new Option("number" === typeof d[g] ? a.fnFormatNumber(d[g]) : d[g], f[g]); var i = h("<div><label/></div>").addClass(b.sLength); a.aanFeatures.l || (i[0].id = c + "_length"); i.children().append(a.oLanguage.sLengthMenu.replace("_MENU_", e[0].outerHTML)); h("select", i).val(a._iDisplayLength).on("change.DT", function () { Qa(a, h(this).val()); N(a) }); h(a.nTable).on("length.dt.DT", function (b, c, d) { a === c && h("select", i).val(d) }); return i[0]
    } function sb(a) {
        var b = a.sPaginationType, c = m.ext.pager[b], d = "function" === typeof c, e = function (a) { N(a) },
        b = h("<div/>").addClass(a.oClasses.sPaging + b)[0], f = a.aanFeatures; d || c.fnInit(a, b, e); f.p || (b.id = a.sTableId + "_paginate", a.aoDrawCallback.push({ fn: function (a) { if (d) { var b = a._iDisplayStart, i = a._iDisplayLength, h = a.fnRecordsDisplay(), l = -1 === i, b = l ? 0 : Math.ceil(b / i), i = l ? 1 : Math.ceil(h / i), h = c(b, i), k, l = 0; for (k = f.p.length; l < k; l++)Ma(a, "pageButton")(a, f.p[l], l, h, b, i) } else c.fnUpdate(a, e) }, sName: "pagination" })); return b
    } function Sa(a, b, c) {
        var d = a._iDisplayStart, e = a._iDisplayLength, f = a.fnRecordsDisplay(); 0 === f || -1 ===
            e ? d = 0 : "number" === typeof b ? (d = b * e, d > f && (d = 0)) : "first" == b ? d = 0 : "previous" == b ? (d = 0 <= e ? d - e : 0, 0 > d && (d = 0)) : "next" == b ? d + e < f && (d += e) : "last" == b ? d = Math.floor((f - 1) / e) * e : J(a, 0, "Unknown paging action: " + b, 5); b = a._iDisplayStart !== d; a._iDisplayStart = d; b && (r(a, null, "page", [a]), c && N(a)); return b
    } function pb(a) { return h("<div/>", { id: !a.aanFeatures.r ? a.sTableId + "_processing" : null, "class": a.oClasses.sProcessing }).html(a.oLanguage.sProcessing).insertBefore(a.nTable)[0] } function C(a, b) {
        a.oFeatures.bProcessing && h(a.aanFeatures.r).css("display",
            b ? "block" : "none"); r(a, null, "processing", [a, b])
    } function qb(a) {
        var b = h(a.nTable); b.attr("role", "grid"); var c = a.oScroll; if ("" === c.sX && "" === c.sY) return a.nTable; var d = c.sX, e = c.sY, f = a.oClasses, g = b.children("caption"), j = g.length ? g[0]._captionSide : null, i = h(b[0].cloneNode(!1)), n = h(b[0].cloneNode(!1)), l = b.children("tfoot"); l.length || (l = null); i = h("<div/>", { "class": f.sScrollWrapper }).append(h("<div/>", { "class": f.sScrollHead }).css({ overflow: "hidden", position: "relative", border: 0, width: d ? !d ? null : v(d) : "100%" }).append(h("<div/>",
            { "class": f.sScrollHeadInner }).css({ "box-sizing": "content-box", width: c.sXInner || "100%" }).append(i.removeAttr("id").css("margin-left", 0).append("top" === j ? g : null).append(b.children("thead"))))).append(h("<div/>", { "class": f.sScrollBody }).css({ position: "relative", overflow: "auto", width: !d ? null : v(d) }).append(b)); l && i.append(h("<div/>", { "class": f.sScrollFoot }).css({ overflow: "hidden", border: 0, width: d ? !d ? null : v(d) : "100%" }).append(h("<div/>", { "class": f.sScrollFootInner }).append(n.removeAttr("id").css("margin-left",
                0).append("bottom" === j ? g : null).append(b.children("tfoot"))))); var b = i.children(), k = b[0], f = b[1], t = l ? b[2] : null; if (d) h(f).on("scroll.DT", function () { var a = this.scrollLeft; k.scrollLeft = a; l && (t.scrollLeft = a) }); h(f).css(e && c.bCollapse ? "max-height" : "height", e); a.nScrollHead = k; a.nScrollBody = f; a.nScrollFoot = t; a.aoDrawCallback.push({ fn: ka, sName: "scrolling" }); return i[0]
    } function ka(a) {
        var b = a.oScroll, c = b.sX, d = b.sXInner, e = b.sY, b = b.iBarWidth, f = h(a.nScrollHead), g = f[0].style, j = f.children("div"), i = j[0].style, n = j.children("table"),
        j = a.nScrollBody, l = h(j), q = j.style, t = h(a.nScrollFoot).children("div"), m = t.children("table"), o = h(a.nTHead), p = h(a.nTable), s = p[0], r = s.style, u = a.nTFoot ? h(a.nTFoot) : null, x = a.oBrowser, T = x.bScrollOversize, Xb = D(a.aoColumns, "nTh"), O, K, P, w, Ta = [], y = [], z = [], A = [], B, C = function (a) { a = a.style; a.paddingTop = "0"; a.paddingBottom = "0"; a.borderTopWidth = "0"; a.borderBottomWidth = "0"; a.height = 0 }; K = j.scrollHeight > j.clientHeight; if (a.scrollBarVis !== K && a.scrollBarVis !== k) a.scrollBarVis = K, Y(a); else {
        a.scrollBarVis = K; p.children("thead, tfoot").remove();
            u && (P = u.clone().prependTo(p), O = u.find("tr"), P = P.find("tr")); w = o.clone().prependTo(p); o = o.find("tr"); K = w.find("tr"); w.find("th, td").removeAttr("tabindex"); c || (q.width = "100%", f[0].style.width = "100%"); h.each(ra(a, w), function (b, c) { B = Z(a, b); c.style.width = a.aoColumns[B].sWidth }); u && H(function (a) { a.style.width = "" }, P); f = p.outerWidth(); if ("" === c) { r.width = "100%"; if (T && (p.find("tbody").height() > j.offsetHeight || "scroll" == l.css("overflow-y"))) r.width = v(p.outerWidth() - b); f = p.outerWidth() } else "" !== d && (r.width =
                v(d), f = p.outerWidth()); H(C, K); H(function (a) { z.push(a.innerHTML); Ta.push(v(h(a).css("width"))) }, K); H(function (a, b) { if (h.inArray(a, Xb) !== -1) a.style.width = Ta[b] }, o); h(K).height(0); u && (H(C, P), H(function (a) { A.push(a.innerHTML); y.push(v(h(a).css("width"))) }, P), H(function (a, b) { a.style.width = y[b] }, O), h(P).height(0)); H(function (a, b) { a.innerHTML = '<div class="dataTables_sizing" style="height:0;overflow:hidden;">' + z[b] + "</div>"; a.style.width = Ta[b] }, K); u && H(function (a, b) {
                a.innerHTML = '<div class="dataTables_sizing" style="height:0;overflow:hidden;">' +
                    A[b] + "</div>"; a.style.width = y[b]
                }, P); if (p.outerWidth() < f) { O = j.scrollHeight > j.offsetHeight || "scroll" == l.css("overflow-y") ? f + b : f; if (T && (j.scrollHeight > j.offsetHeight || "scroll" == l.css("overflow-y"))) r.width = v(O - b); ("" === c || "" !== d) && J(a, 1, "Possible column misalignment", 6) } else O = "100%"; q.width = v(O); g.width = v(O); u && (a.nScrollFoot.style.width = v(O)); !e && T && (q.height = v(s.offsetHeight + b)); c = p.outerWidth(); n[0].style.width = v(c); i.width = v(c); d = p.height() > j.clientHeight || "scroll" == l.css("overflow-y"); e = "padding" +
                    (x.bScrollbarLeft ? "Left" : "Right"); i[e] = d ? b + "px" : "0px"; u && (m[0].style.width = v(c), t[0].style.width = v(c), t[0].style[e] = d ? b + "px" : "0px"); p.children("colgroup").insertBefore(p.children("thead")); l.scroll(); if ((a.bSorted || a.bFiltered) && !a._drawHold) j.scrollTop = 0
        }
    } function H(a, b, c) { for (var d = 0, e = 0, f = b.length, g, j; e < f;) { g = b[e].firstChild; for (j = c ? c[e].firstChild : null; g;)1 === g.nodeType && (c ? a(g, j, d) : a(g, d), d++), g = g.nextSibling, j = c ? j.nextSibling : null; e++ } } function Ea(a) {
        var b = a.nTable, c = a.aoColumns, d = a.oScroll,
        e = d.sY, f = d.sX, g = d.sXInner, j = c.length, i = la(a, "bVisible"), n = h("th", a.nTHead), l = b.getAttribute("width"), k = b.parentNode, t = !1, m, o, p = a.oBrowser, d = p.bScrollOversize; (m = b.style.width) && -1 !== m.indexOf("%") && (l = m); for (m = 0; m < i.length; m++)o = c[i[m]], null !== o.sWidth && (o.sWidth = Db(o.sWidthOrig, k), t = !0); if (d || !t && !f && !e && j == aa(a) && j == n.length) for (m = 0; m < j; m++)i = Z(a, m), null !== i && (c[i].sWidth = v(n.eq(m).width())); else {
            j = h(b).clone().css("visibility", "hidden").removeAttr("id"); j.find("tbody tr").remove(); var s = h("<tr/>").appendTo(j.find("tbody"));
            j.find("thead, tfoot").remove(); j.append(h(a.nTHead).clone()).append(h(a.nTFoot).clone()); j.find("tfoot th, tfoot td").css("width", ""); n = ra(a, j.find("thead")[0]); for (m = 0; m < i.length; m++)o = c[i[m]], n[m].style.width = null !== o.sWidthOrig && "" !== o.sWidthOrig ? v(o.sWidthOrig) : "", o.sWidthOrig && f && h(n[m]).append(h("<div/>").css({ width: o.sWidthOrig, margin: 0, padding: 0, border: 0, height: 1 })); if (a.aoData.length) for (m = 0; m < i.length; m++)t = i[m], o = c[t], h(Eb(a, t)).clone(!1).append(o.sContentPadding).appendTo(s); h("[name]",
                j).removeAttr("name"); o = h("<div/>").css(f || e ? { position: "absolute", top: 0, left: 0, height: 1, right: 0, overflow: "hidden" } : {}).append(j).appendTo(k); f && g ? j.width(g) : f ? (j.css("width", "auto"), j.removeAttr("width"), j.width() < k.clientWidth && l && j.width(k.clientWidth)) : e ? j.width(k.clientWidth) : l && j.width(l); for (m = e = 0; m < i.length; m++)k = h(n[m]), g = k.outerWidth() - k.width(), k = p.bBounding ? Math.ceil(n[m].getBoundingClientRect().width) : k.outerWidth(), e += k, c[i[m]].sWidth = v(k - g); b.style.width = v(e); o.remove()
        } l && (b.style.width =
            v(l)); if ((l || f) && !a._reszEvt) b = function () { h(E).on("resize.DT-" + a.sInstance, Na(function () { Y(a) })) }, d ? setTimeout(b, 1E3) : b(), a._reszEvt = !0
    } function Db(a, b) { if (!a) return 0; var c = h("<div/>").css("width", v(a)).appendTo(b || G.body), d = c[0].offsetWidth; c.remove(); return d } function Eb(a, b) { var c = Fb(a, b); if (0 > c) return null; var d = a.aoData[c]; return !d.nTr ? h("<td/>").html(B(a, c, b, "display"))[0] : d.anCells[b] } function Fb(a, b) {
        for (var c, d = -1, e = -1, f = 0, g = a.aoData.length; f < g; f++)c = B(a, f, b, "display") + "", c = c.replace(Yb,
            ""), c = c.replace(/&nbsp;/g, " "), c.length > d && (d = c.length, e = f); return e
    } function v(a) { return null === a ? "0px" : "number" == typeof a ? 0 > a ? "0px" : a + "px" : a.match(/\d$/) ? a + "px" : a } function V(a) {
        var b, c, d = [], e = a.aoColumns, f, g, j, i; b = a.aaSortingFixed; c = h.isPlainObject(b); var n = []; f = function (a) { a.length && !h.isArray(a[0]) ? n.push(a) : h.merge(n, a) }; h.isArray(b) && f(b); c && b.pre && f(b.pre); f(a.aaSorting); c && b.post && f(b.post); for (a = 0; a < n.length; a++) {
            i = n[a][0]; f = e[i].aDataSort; b = 0; for (c = f.length; b < c; b++)g = f[b], j = e[g].sType ||
                "string", n[a]._idx === k && (n[a]._idx = h.inArray(n[a][1], e[g].asSorting)), d.push({ src: i, col: g, dir: n[a][1], index: n[a]._idx, type: j, formatter: m.ext.type.order[j + "-pre"] })
        } return d
    } function lb(a) {
        var b, c, d = [], e = m.ext.type.order, f = a.aoData, g = 0, j, i = a.aiDisplayMaster, h; Fa(a); h = V(a); b = 0; for (c = h.length; b < c; b++)j = h[b], j.formatter && g++ , Gb(a, j.col); if ("ssp" != y(a) && 0 !== h.length) {
            b = 0; for (c = i.length; b < c; b++)d[i[b]] = b; g === h.length ? i.sort(function (a, b) {
                var c, e, g, j, i = h.length, k = f[a]._aSortData, m = f[b]._aSortData; for (g =
                    0; g < i; g++)if (j = h[g], c = k[j.col], e = m[j.col], c = c < e ? -1 : c > e ? 1 : 0, 0 !== c) return "asc" === j.dir ? c : -c; c = d[a]; e = d[b]; return c < e ? -1 : c > e ? 1 : 0
            }) : i.sort(function (a, b) { var c, g, j, i, k = h.length, m = f[a]._aSortData, o = f[b]._aSortData; for (j = 0; j < k; j++)if (i = h[j], c = m[i.col], g = o[i.col], i = e[i.type + "-" + i.dir] || e["string-" + i.dir], c = i(c, g), 0 !== c) return c; c = d[a]; g = d[b]; return c < g ? -1 : c > g ? 1 : 0 })
        } a.bSorted = !0
    } function Hb(a) {
        for (var b, c, d = a.aoColumns, e = V(a), a = a.oLanguage.oAria, f = 0, g = d.length; f < g; f++) {
            c = d[f]; var j = c.asSorting; b = c.sTitle.replace(/<.*?>/g,
                ""); var i = c.nTh; i.removeAttribute("aria-sort"); c.bSortable && (0 < e.length && e[0].col == f ? (i.setAttribute("aria-sort", "asc" == e[0].dir ? "ascending" : "descending"), c = j[e[0].index + 1] || j[0]) : c = j[0], b += "asc" === c ? a.sSortAscending : a.sSortDescending); i.setAttribute("aria-label", b)
        }
    } function Ua(a, b, c, d) {
        var e = a.aaSorting, f = a.aoColumns[b].asSorting, g = function (a, b) { var c = a._idx; c === k && (c = h.inArray(a[1], f)); return c + 1 < f.length ? c + 1 : b ? null : 0 }; "number" === typeof e[0] && (e = a.aaSorting = [e]); c && a.oFeatures.bSortMulti ? (c = h.inArray(b,
            D(e, "0")), -1 !== c ? (b = g(e[c], !0), null === b && 1 === e.length && (b = 0), null === b ? e.splice(c, 1) : (e[c][1] = f[b], e[c]._idx = b)) : (e.push([b, f[0], 0]), e[e.length - 1]._idx = 0)) : e.length && e[0][0] == b ? (b = g(e[0]), e.length = 1, e[0][1] = f[b], e[0]._idx = b) : (e.length = 0, e.push([b, f[0]]), e[0]._idx = 0); S(a); "function" == typeof d && d(a)
    } function La(a, b, c, d) { var e = a.aoColumns[c]; Va(b, {}, function (b) { !1 !== e.bSortable && (a.oFeatures.bProcessing ? (C(a, !0), setTimeout(function () { Ua(a, c, b.shiftKey, d); "ssp" !== y(a) && C(a, !1) }, 0)) : Ua(a, c, b.shiftKey, d)) }) }
    function wa(a) { var b = a.aLastSort, c = a.oClasses.sSortColumn, d = V(a), e = a.oFeatures, f, g; if (e.bSort && e.bSortClasses) { e = 0; for (f = b.length; e < f; e++)g = b[e].src, h(D(a.aoData, "anCells", g)).removeClass(c + (2 > e ? e + 1 : 3)); e = 0; for (f = d.length; e < f; e++)g = d[e].src, h(D(a.aoData, "anCells", g)).addClass(c + (2 > e ? e + 1 : 3)) } a.aLastSort = d } function Gb(a, b) {
        var c = a.aoColumns[b], d = m.ext.order[c.sSortDataType], e; d && (e = d.call(a.oInstance, a, b, $(a, b))); for (var f, g = m.ext.type.order[c.sType + "-pre"], j = 0, i = a.aoData.length; j < i; j++)if (c = a.aoData[j],
            c._aSortData || (c._aSortData = []), !c._aSortData[b] || d) f = d ? e[j] : B(a, j, b, "sort"), c._aSortData[b] = g ? g(f) : f
    } function xa(a) {
        if (a.oFeatures.bStateSave && !a.bDestroying) {
            var b = { time: +new Date, start: a._iDisplayStart, length: a._iDisplayLength, order: h.extend(!0, [], a.aaSorting), search: zb(a.oPreviousSearch), columns: h.map(a.aoColumns, function (b, d) { return { visible: b.bVisible, search: zb(a.aoPreSearchCols[d]) } }) }; r(a, "aoStateSaveParams", "stateSaveParams", [a, b]); a.oSavedState = b; a.fnStateSaveCallback.call(a.oInstance, a,
                b)
        }
    } function Ib(a, b, c) {
        var d, e, f = a.aoColumns, b = function (b) {
            if (b && b.time) {
                var g = r(a, "aoStateLoadParams", "stateLoadParams", [a, b]); if (-1 === h.inArray(!1, g) && (g = a.iStateDuration, !(0 < g && b.time < +new Date - 1E3 * g) && !(b.columns && f.length !== b.columns.length))) {
                a.oLoadedState = h.extend(!0, {}, b); b.start !== k && (a._iDisplayStart = b.start, a.iInitDisplayStart = b.start); b.length !== k && (a._iDisplayLength = b.length); b.order !== k && (a.aaSorting = [], h.each(b.order, function (b, c) { a.aaSorting.push(c[0] >= f.length ? [0, c[1]] : c) })); b.search !==
                    k && h.extend(a.oPreviousSearch, Ab(b.search)); if (b.columns) { d = 0; for (e = b.columns.length; d < e; d++)g = b.columns[d], g.visible !== k && (f[d].bVisible = g.visible), g.search !== k && h.extend(a.aoPreSearchCols[d], Ab(g.search)) } r(a, "aoStateLoaded", "stateLoaded", [a, b])
                }
            } c()
        }; if (a.oFeatures.bStateSave) { var g = a.fnStateLoadCallback.call(a.oInstance, a, b); g !== k && b(g) } else c()
    } function ya(a) { var b = m.settings, a = h.inArray(a, D(b, "nTable")); return -1 !== a ? b[a] : null } function J(a, b, c, d) {
        c = "DataTables warning: " + (a ? "table id=" + a.sTableId +
            " - " : "") + c; d && (c += ". For more information about this error, please see http://datatables.net/tn/" + d); if (b) E.console && console.log && console.log(c); else if (b = m.ext, b = b.sErrMode || b.errMode, a && r(a, null, "error", [a, d, c]), "alert" == b) alert(c); else { if ("throw" == b) throw Error(c); "function" == typeof b && b(a, d, c) }
    } function F(a, b, c, d) { h.isArray(c) ? h.each(c, function (c, d) { h.isArray(d) ? F(a, b, d[0], d[1]) : F(a, b, d) }) : (d === k && (d = c), b[c] !== k && (a[d] = b[c])) } function Jb(a, b, c) {
        var d, e; for (e in b) b.hasOwnProperty(e) && (d = b[e],
            h.isPlainObject(d) ? (h.isPlainObject(a[e]) || (a[e] = {}), h.extend(!0, a[e], d)) : a[e] = c && "data" !== e && "aaData" !== e && h.isArray(d) ? d.slice() : d); return a
    } function Va(a, b, c) { h(a).on("click.DT", b, function (b) { a.blur(); c(b) }).on("keypress.DT", b, function (a) { 13 === a.which && (a.preventDefault(), c(a)) }).on("selectstart.DT", function () { return !1 }) } function z(a, b, c, d) { c && a[b].push({ fn: c, sName: d }) } function r(a, b, c, d) {
        var e = []; b && (e = h.map(a[b].slice().reverse(), function (b) { return b.fn.apply(a.oInstance, d) })); null !== c && (b = h.Event(c +
            ".dt"), h(a.nTable).trigger(b, d), e.push(b.result)); return e
    } function Ra(a) { var b = a._iDisplayStart, c = a.fnDisplayEnd(), d = a._iDisplayLength; b >= c && (b = c - d); b -= b % d; if (-1 === d || 0 > b) b = 0; a._iDisplayStart = b } function Ma(a, b) { var c = a.renderer, d = m.ext.renderer[b]; return h.isPlainObject(c) && c[b] ? d[c[b]] || d._ : "string" === typeof c ? d[c] || d._ : d._ } function y(a) { return a.oFeatures.bServerSide ? "ssp" : a.ajax || a.sAjaxSource ? "ajax" : "dom" } function ha(a, b) {
        var c = [], c = Kb.numbers_length, d = Math.floor(c / 2); b <= c ? c = W(0, b) : a <= d ? (c = W(0,
            c - 2), c.push("ellipsis"), c.push(b - 1)) : (a >= b - 1 - d ? c = W(b - (c - 2), b) : (c = W(a - d + 2, a + d - 1), c.push("ellipsis"), c.push(b - 1)), c.splice(0, 0, "ellipsis"), c.splice(0, 0, 0)); c.DT_el = "span"; return c
    } function cb(a) { h.each({ num: function (b) { return za(b, a) }, "num-fmt": function (b) { return za(b, a, Wa) }, "html-num": function (b) { return za(b, a, Aa) }, "html-num-fmt": function (b) { return za(b, a, Aa, Wa) } }, function (b, c) { x.type.order[b + a + "-pre"] = c; b.match(/^html\-/) && (x.type.search[b + a] = x.type.search.html) }) } function Lb(a) {
        return function () {
            var b =
                [ya(this[m.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments)); return m.ext.internal[a].apply(this, b)
        }
    } var m = function (a) {
    this.$ = function (a, b) { return this.api(!0).$(a, b) }; this._ = function (a, b) { return this.api(!0).rows(a, b).data() }; this.api = function (a) { return a ? new s(ya(this[x.iApiIndex])) : new s(this) }; this.fnAddData = function (a, b) { var c = this.api(!0), d = h.isArray(a) && (h.isArray(a[0]) || h.isPlainObject(a[0])) ? c.rows.add(a) : c.row.add(a); (b === k || b) && c.draw(); return d.flatten().toArray() }; this.fnAdjustColumnSizing =
        function (a) { var b = this.api(!0).columns.adjust(), c = b.settings()[0], d = c.oScroll; a === k || a ? b.draw(!1) : ("" !== d.sX || "" !== d.sY) && ka(c) }; this.fnClearTable = function (a) { var b = this.api(!0).clear(); (a === k || a) && b.draw() }; this.fnClose = function (a) { this.api(!0).row(a).child.hide() }; this.fnDeleteRow = function (a, b, c) { var d = this.api(!0), a = d.rows(a), e = a.settings()[0], h = e.aoData[a[0][0]]; a.remove(); b && b.call(this, e, h); (c === k || c) && d.draw(); return h }; this.fnDestroy = function (a) { this.api(!0).destroy(a) }; this.fnDraw = function (a) { this.api(!0).draw(a) };
        this.fnFilter = function (a, b, c, d, e, h) { e = this.api(!0); null === b || b === k ? e.search(a, c, d, h) : e.column(b).search(a, c, d, h); e.draw() }; this.fnGetData = function (a, b) { var c = this.api(!0); if (a !== k) { var d = a.nodeName ? a.nodeName.toLowerCase() : ""; return b !== k || "td" == d || "th" == d ? c.cell(a, b).data() : c.row(a).data() || null } return c.data().toArray() }; this.fnGetNodes = function (a) { var b = this.api(!0); return a !== k ? b.row(a).node() : b.rows().nodes().flatten().toArray() }; this.fnGetPosition = function (a) {
            var b = this.api(!0), c = a.nodeName.toUpperCase();
            return "TR" == c ? b.row(a).index() : "TD" == c || "TH" == c ? (a = b.cell(a).index(), [a.row, a.columnVisible, a.column]) : null
        }; this.fnIsOpen = function (a) { return this.api(!0).row(a).child.isShown() }; this.fnOpen = function (a, b, c) { return this.api(!0).row(a).child(b, c).show().child()[0] }; this.fnPageChange = function (a, b) { var c = this.api(!0).page(a); (b === k || b) && c.draw(!1) }; this.fnSetColumnVis = function (a, b, c) { a = this.api(!0).column(a).visible(b); (c === k || c) && a.columns.adjust().draw() }; this.fnSettings = function () { return ya(this[x.iApiIndex]) };
        this.fnSort = function (a) { this.api(!0).order(a).draw() }; this.fnSortListener = function (a, b, c) { this.api(!0).order.listener(a, b, c) }; this.fnUpdate = function (a, b, c, d, e) { var h = this.api(!0); c === k || null === c ? h.row(b).data(a) : h.cell(b, c).data(a); (e === k || e) && h.columns.adjust(); (d === k || d) && h.draw(); return 0 }; this.fnVersionCheck = x.fnVersionCheck; var b = this, c = a === k, d = this.length; c && (a = {}); this.oApi = this.internal = x.internal; for (var e in m.ext.internal) e && (this[e] = Lb(e)); this.each(function () {
            var e = {}, g = 1 < d ? Jb(e, a, !0) :
                a, j = 0, i, e = this.getAttribute("id"), n = !1, l = m.defaults, q = h(this); if ("table" != this.nodeName.toLowerCase()) J(null, 0, "Non-table node initialisation (" + this.nodeName + ")", 2); else {
                    db(l); eb(l.column); I(l, l, !0); I(l.column, l.column, !0); I(l, h.extend(g, q.data())); var t = m.settings, j = 0; for (i = t.length; j < i; j++) {
                        var o = t[j]; if (o.nTable == this || o.nTHead.parentNode == this || o.nTFoot && o.nTFoot.parentNode == this) {
                            var s = g.bRetrieve !== k ? g.bRetrieve : l.bRetrieve; if (c || s) return o.oInstance; if (g.bDestroy !== k ? g.bDestroy : l.bDestroy) {
                                o.oInstance.fnDestroy();
                                break
                            } else { J(o, 0, "Cannot reinitialise DataTable", 3); return }
                        } if (o.sTableId == this.id) { t.splice(j, 1); break }
                    } if (null === e || "" === e) this.id = e = "DataTables_Table_" + m.ext._unique++; var p = h.extend(!0, {}, m.models.oSettings, { sDestroyWidth: q[0].style.width, sInstance: e, sTableId: e }); p.nTable = this; p.oApi = b.internal; p.oInit = g; t.push(p); p.oInstance = 1 === b.length ? b : q.dataTable(); db(g); g.oLanguage && Ca(g.oLanguage); g.aLengthMenu && !g.iDisplayLength && (g.iDisplayLength = h.isArray(g.aLengthMenu[0]) ? g.aLengthMenu[0][0] : g.aLengthMenu[0]);
                    g = Jb(h.extend(!0, {}, l), g); F(p.oFeatures, g, "bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" ")); F(p, g, ["asStripeClasses", "ajax", "fnServerData", "fnFormatNumber", "sServerMethod", "aaSorting", "aaSortingFixed", "aLengthMenu", "sPaginationType", "sAjaxSource", "sAjaxDataProp", "iStateDuration", "sDom", "bSortCellsTop", "iTabIndex", "fnStateLoadCallback", "fnStateSaveCallback", "renderer", "searchDelay", "rowId", ["iCookieDuration", "iStateDuration"],
                        ["oSearch", "oPreviousSearch"], ["aoSearchCols", "aoPreSearchCols"], ["iDisplayLength", "_iDisplayLength"]]); F(p.oScroll, g, [["sScrollX", "sX"], ["sScrollXInner", "sXInner"], ["sScrollY", "sY"], ["bScrollCollapse", "bCollapse"]]); F(p.oLanguage, g, "fnInfoCallback"); z(p, "aoDrawCallback", g.fnDrawCallback, "user"); z(p, "aoServerParams", g.fnServerParams, "user"); z(p, "aoStateSaveParams", g.fnStateSaveParams, "user"); z(p, "aoStateLoadParams", g.fnStateLoadParams, "user"); z(p, "aoStateLoaded", g.fnStateLoaded, "user"); z(p, "aoRowCallback",
                            g.fnRowCallback, "user"); z(p, "aoRowCreatedCallback", g.fnCreatedRow, "user"); z(p, "aoHeaderCallback", g.fnHeaderCallback, "user"); z(p, "aoFooterCallback", g.fnFooterCallback, "user"); z(p, "aoInitComplete", g.fnInitComplete, "user"); z(p, "aoPreDrawCallback", g.fnPreDrawCallback, "user"); p.rowIdFn = Q(g.rowId); fb(p); var u = p.oClasses; h.extend(u, m.ext.classes, g.oClasses); q.addClass(u.sTable); p.iInitDisplayStart === k && (p.iInitDisplayStart = g.iDisplayStart, p._iDisplayStart = g.iDisplayStart); null !== g.iDeferLoading && (p.bDeferLoading =
                                !0, e = h.isArray(g.iDeferLoading), p._iRecordsDisplay = e ? g.iDeferLoading[0] : g.iDeferLoading, p._iRecordsTotal = e ? g.iDeferLoading[1] : g.iDeferLoading); var v = p.oLanguage; h.extend(!0, v, g.oLanguage); v.sUrl && (h.ajax({ dataType: "json", url: v.sUrl, success: function (a) { Ca(a); I(l.oLanguage, a); h.extend(true, v, a); ga(p) }, error: function () { ga(p) } }), n = !0); null === g.asStripeClasses && (p.asStripeClasses = [u.sStripeOdd, u.sStripeEven]); var e = p.asStripeClasses, x = q.children("tbody").find("tr").eq(0); -1 !== h.inArray(!0, h.map(e, function (a) { return x.hasClass(a) })) &&
                                    (h("tbody tr", this).removeClass(e.join(" ")), p.asDestroyStripes = e.slice()); e = []; t = this.getElementsByTagName("thead"); 0 !== t.length && (da(p.aoHeader, t[0]), e = ra(p)); if (null === g.aoColumns) { t = []; j = 0; for (i = e.length; j < i; j++)t.push(null) } else t = g.aoColumns; j = 0; for (i = t.length; j < i; j++)Da(p, e ? e[j] : null); hb(p, g.aoColumnDefs, t, function (a, b) { ja(p, a, b) }); if (x.length) {
                                        var w = function (a, b) { return a.getAttribute("data-" + b) !== null ? b : null }; h(x[0]).children("th, td").each(function (a, b) {
                                            var c = p.aoColumns[a]; if (c.mData ===
                                                a) { var d = w(b, "sort") || w(b, "order"), e = w(b, "filter") || w(b, "search"); if (d !== null || e !== null) { c.mData = { _: a + ".display", sort: d !== null ? a + ".@data-" + d : k, type: d !== null ? a + ".@data-" + d : k, filter: e !== null ? a + ".@data-" + e : k }; ja(p, a) } }
                                        })
                                    } var T = p.oFeatures, e = function () {
                                        if (g.aaSorting === k) { var a = p.aaSorting; j = 0; for (i = a.length; j < i; j++)a[j][1] = p.aoColumns[j].asSorting[0] } wa(p); T.bSort && z(p, "aoDrawCallback", function () { if (p.bSorted) { var a = V(p), b = {}; h.each(a, function (a, c) { b[c.src] = c.dir }); r(p, null, "order", [p, a, b]); Hb(p) } });
                                        z(p, "aoDrawCallback", function () { (p.bSorted || y(p) === "ssp" || T.bDeferRender) && wa(p) }, "sc"); var a = q.children("caption").each(function () { this._captionSide = h(this).css("caption-side") }), b = q.children("thead"); b.length === 0 && (b = h("<thead/>").appendTo(q)); p.nTHead = b[0]; b = q.children("tbody"); b.length === 0 && (b = h("<tbody/>").appendTo(q)); p.nTBody = b[0]; b = q.children("tfoot"); if (b.length === 0 && a.length > 0 && (p.oScroll.sX !== "" || p.oScroll.sY !== "")) b = h("<tfoot/>").appendTo(q); if (b.length === 0 || b.children().length === 0) q.addClass(u.sNoFooter);
                                        else if (b.length > 0) { p.nTFoot = b[0]; da(p.aoFooter, p.nTFoot) } if (g.aaData) for (j = 0; j < g.aaData.length; j++)M(p, g.aaData[j]); else (p.bDeferLoading || y(p) == "dom") && ma(p, h(p.nTBody).children("tr")); p.aiDisplay = p.aiDisplayMaster.slice(); p.bInitialised = true; n === false && ga(p)
                                    }; g.bStateSave ? (T.bStateSave = !0, z(p, "aoDrawCallback", xa, "state_save"), Ib(p, g, e)) : e()
                }
        }); b = null; return this
    }, x, s, o, u, Xa = {}, Mb = /[\r\n]/g, Aa = /<.*?>/g, Zb = /^\d{2,4}[\.\/\-]\d{1,2}[\.\/\-]\d{1,2}([T ]{1}\d{1,2}[:\.]\d{2}([\.:]\d{2})?)?$/, $b = RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)",
        "g"), Wa = /[',$Â£â‚¬Â¥%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi, L = function (a) { return !a || !0 === a || "-" === a ? !0 : !1 }, Nb = function (a) { var b = parseInt(a, 10); return !isNaN(b) && isFinite(a) ? b : null }, Ob = function (a, b) { Xa[b] || (Xa[b] = RegExp(Pa(b), "g")); return "string" === typeof a && "." !== b ? a.replace(/\./g, "").replace(Xa[b], ".") : a }, Ya = function (a, b, c) { var d = "string" === typeof a; if (L(a)) return !0; b && d && (a = Ob(a, b)); c && d && (a = a.replace(Wa, "")); return !isNaN(parseFloat(a)) && isFinite(a) }, Pb = function (a, b, c) {
            return L(a) ? !0 : !(L(a) || "string" ===
                typeof a) ? null : Ya(a.replace(Aa, ""), b, c) ? !0 : null
        }, D = function (a, b, c) { var d = [], e = 0, f = a.length; if (c !== k) for (; e < f; e++)a[e] && a[e][b] && d.push(a[e][b][c]); else for (; e < f; e++)a[e] && d.push(a[e][b]); return d }, ia = function (a, b, c, d) { var e = [], f = 0, g = b.length; if (d !== k) for (; f < g; f++)a[b[f]][c] && e.push(a[b[f]][c][d]); else for (; f < g; f++)e.push(a[b[f]][c]); return e }, W = function (a, b) { var c = [], d; b === k ? (b = 0, d = a) : (d = b, b = a); for (var e = b; e < d; e++)c.push(e); return c }, Qb = function (a) {
            for (var b = [], c = 0, d = a.length; c < d; c++)a[c] && b.push(a[c]);
            return b
        }, qa = function (a) { var b; a: { if (!(2 > a.length)) { b = a.slice().sort(); for (var c = b[0], d = 1, e = b.length; d < e; d++) { if (b[d] === c) { b = !1; break a } c = b[d] } } b = !0 } if (b) return a.slice(); b = []; var e = a.length, f, g = 0, d = 0; a: for (; d < e; d++) { c = a[d]; for (f = 0; f < g; f++)if (b[f] === c) continue a; b.push(c); g++ } return b }; m.util = {
            throttle: function (a, b) { var c = b !== k ? b : 200, d, e; return function () { var b = this, g = +new Date, j = arguments; d && g < d + c ? (clearTimeout(e), e = setTimeout(function () { d = k; a.apply(b, j) }, c)) : (d = g, a.apply(b, j)) } }, escapeRegex: function (a) {
                return a.replace($b,
                    "\\$1")
            }
        }; var A = function (a, b, c) { a[b] !== k && (a[c] = a[b]) }, ba = /\[.*?\]$/, U = /\(\)$/, Pa = m.util.escapeRegex, va = h("<div>")[0], Wb = va.textContent !== k, Yb = /<.*?>/g, Na = m.util.throttle, Rb = [], w = Array.prototype, ac = function (a) {
            var b, c, d = m.settings, e = h.map(d, function (a) { return a.nTable }); if (a) {
                if (a.nTable && a.oApi) return [a]; if (a.nodeName && "table" === a.nodeName.toLowerCase()) return b = h.inArray(a, e), -1 !== b ? [d[b]] : null; if (a && "function" === typeof a.settings) return a.settings().toArray(); "string" === typeof a ? c = h(a) : a instanceof
                    h && (c = a)
            } else return []; if (c) return c.map(function () { b = h.inArray(this, e); return -1 !== b ? d[b] : null }).toArray()
        }; s = function (a, b) { if (!(this instanceof s)) return new s(a, b); var c = [], d = function (a) { (a = ac(a)) && (c = c.concat(a)) }; if (h.isArray(a)) for (var e = 0, f = a.length; e < f; e++)d(a[e]); else d(a); this.context = qa(c); b && h.merge(this, b); this.selector = { rows: null, cols: null, opts: null }; s.extend(this, this, Rb) }; m.Api = s; h.extend(s.prototype, {
            any: function () { return 0 !== this.count() }, concat: w.concat, context: [], count: function () { return this.flatten().length },
            each: function (a) { for (var b = 0, c = this.length; b < c; b++)a.call(this, this[b], b, this); return this }, eq: function (a) { var b = this.context; return b.length > a ? new s(b[a], this[a]) : null }, filter: function (a) { var b = []; if (w.filter) b = w.filter.call(this, a, this); else for (var c = 0, d = this.length; c < d; c++)a.call(this, this[c], c, this) && b.push(this[c]); return new s(this.context, b) }, flatten: function () { var a = []; return new s(this.context, a.concat.apply(a, this.toArray())) }, join: w.join, indexOf: w.indexOf || function (a, b) {
                for (var c = b || 0,
                    d = this.length; c < d; c++)if (this[c] === a) return c; return -1
            }, iterator: function (a, b, c, d) {
                var e = [], f, g, j, h, n, l = this.context, m, o, u = this.selector; "string" === typeof a && (d = c, c = b, b = a, a = !1); g = 0; for (j = l.length; g < j; g++) {
                    var r = new s(l[g]); if ("table" === b) f = c.call(r, l[g], g), f !== k && e.push(f); else if ("columns" === b || "rows" === b) f = c.call(r, l[g], this[g], g), f !== k && e.push(f); else if ("column" === b || "column-rows" === b || "row" === b || "cell" === b) {
                        o = this[g]; "column-rows" === b && (m = Ba(l[g], u.opts)); h = 0; for (n = o.length; h < n; h++)f = o[h], f =
                            "cell" === b ? c.call(r, l[g], f.row, f.column, g, h) : c.call(r, l[g], f, g, h, m), f !== k && e.push(f)
                    }
                } return e.length || d ? (a = new s(l, a ? e.concat.apply([], e) : e), b = a.selector, b.rows = u.rows, b.cols = u.cols, b.opts = u.opts, a) : this
            }, lastIndexOf: w.lastIndexOf || function (a, b) { return this.indexOf.apply(this.toArray.reverse(), arguments) }, length: 0, map: function (a) { var b = []; if (w.map) b = w.map.call(this, a, this); else for (var c = 0, d = this.length; c < d; c++)b.push(a.call(this, this[c], c)); return new s(this.context, b) }, pluck: function (a) { return this.map(function (b) { return b[a] }) },
            pop: w.pop, push: w.push, reduce: w.reduce || function (a, b) { return gb(this, a, b, 0, this.length, 1) }, reduceRight: w.reduceRight || function (a, b) { return gb(this, a, b, this.length - 1, -1, -1) }, reverse: w.reverse, selector: null, shift: w.shift, slice: function () { return new s(this.context, this) }, sort: w.sort, splice: w.splice, toArray: function () { return w.slice.call(this) }, to$: function () { return h(this) }, toJQuery: function () { return h(this) }, unique: function () { return new s(this.context, qa(this)) }, unshift: w.unshift
        }); s.extend = function (a,
            b, c) { if (c.length && b && (b instanceof s || b.__dt_wrapper)) { var d, e, f, g = function (a, b, c) { return function () { var d = b.apply(a, arguments); s.extend(d, d, c.methodExt); return d } }; d = 0; for (e = c.length; d < e; d++)f = c[d], b[f.name] = "function" === typeof f.val ? g(a, f.val, f) : h.isPlainObject(f.val) ? {} : f.val, b[f.name].__dt_wrapper = !0, s.extend(a, b[f.name], f.propExt) } }; s.register = o = function (a, b) {
                if (h.isArray(a)) for (var c = 0, d = a.length; c < d; c++)s.register(a[c], b); else for (var e = a.split("."), f = Rb, g, j, c = 0, d = e.length; c < d; c++) {
                    g = (j = -1 !==
                        e[c].indexOf("()")) ? e[c].replace("()", "") : e[c]; var i; a: { i = 0; for (var n = f.length; i < n; i++)if (f[i].name === g) { i = f[i]; break a } i = null } i || (i = { name: g, val: {}, methodExt: [], propExt: [] }, f.push(i)); c === d - 1 ? i.val = b : f = j ? i.methodExt : i.propExt
                }
            }; s.registerPlural = u = function (a, b, c) { s.register(a, c); s.register(b, function () { var a = c.apply(this, arguments); return a === this ? this : a instanceof s ? a.length ? h.isArray(a[0]) ? new s(a.context, a[0]) : a[0] : k : a }) }; o("tables()", function (a) {
                var b; if (a) {
                    b = s; var c = this.context; if ("number" ===
                        typeof a) a = [c[a]]; else var d = h.map(c, function (a) { return a.nTable }), a = h(d).filter(a).map(function () { var a = h.inArray(this, d); return c[a] }).toArray(); b = new b(a)
                } else b = this; return b
            }); o("table()", function (a) { var a = this.tables(a), b = a.context; return b.length ? new s(b[0]) : a }); u("tables().nodes()", "table().node()", function () { return this.iterator("table", function (a) { return a.nTable }, 1) }); u("tables().body()", "table().body()", function () { return this.iterator("table", function (a) { return a.nTBody }, 1) }); u("tables().header()",
                "table().header()", function () { return this.iterator("table", function (a) { return a.nTHead }, 1) }); u("tables().footer()", "table().footer()", function () { return this.iterator("table", function (a) { return a.nTFoot }, 1) }); u("tables().containers()", "table().container()", function () { return this.iterator("table", function (a) { return a.nTableWrapper }, 1) }); o("draw()", function (a) { return this.iterator("table", function (b) { "page" === a ? N(b) : ("string" === typeof a && (a = "full-hold" === a ? !1 : !0), S(b, !1 === a)) }) }); o("page()", function (a) {
                    return a ===
                        k ? this.page.info().page : this.iterator("table", function (b) { Sa(b, a) })
                }); o("page.info()", function () { if (0 === this.context.length) return k; var a = this.context[0], b = a._iDisplayStart, c = a.oFeatures.bPaginate ? a._iDisplayLength : -1, d = a.fnRecordsDisplay(), e = -1 === c; return { page: e ? 0 : Math.floor(b / c), pages: e ? 1 : Math.ceil(d / c), start: b, end: a.fnDisplayEnd(), length: c, recordsTotal: a.fnRecordsTotal(), recordsDisplay: d, serverSide: "ssp" === y(a) } }); o("page.len()", function (a) {
                    return a === k ? 0 !== this.context.length ? this.context[0]._iDisplayLength :
                        k : this.iterator("table", function (b) { Qa(b, a) })
                }); var Sb = function (a, b, c) { if (c) { var d = new s(a); d.one("draw", function () { c(d.ajax.json()) }) } if ("ssp" == y(a)) S(a, b); else { C(a, !0); var e = a.jqXHR; e && 4 !== e.readyState && e.abort(); sa(a, [], function (c) { na(a); for (var c = ta(a, c), d = 0, e = c.length; d < e; d++)M(a, c[d]); S(a, b); C(a, !1) }) } }; o("ajax.json()", function () { var a = this.context; if (0 < a.length) return a[0].json }); o("ajax.params()", function () { var a = this.context; if (0 < a.length) return a[0].oAjaxData }); o("ajax.reload()", function (a,
                    b) { return this.iterator("table", function (c) { Sb(c, !1 === b, a) }) }); o("ajax.url()", function (a) { var b = this.context; if (a === k) { if (0 === b.length) return k; b = b[0]; return b.ajax ? h.isPlainObject(b.ajax) ? b.ajax.url : b.ajax : b.sAjaxSource } return this.iterator("table", function (b) { h.isPlainObject(b.ajax) ? b.ajax.url = a : b.ajax = a }) }); o("ajax.url().load()", function (a, b) { return this.iterator("table", function (c) { Sb(c, !1 === b, a) }) }); var Za = function (a, b, c, d, e) {
                        var f = [], g, j, i, n, l, m; i = typeof b; if (!b || "string" === i || "function" ===
                            i || b.length === k) b = [b]; i = 0; for (n = b.length; i < n; i++) { j = b[i] && b[i].split && !b[i].match(/[\[\(:]/) ? b[i].split(",") : [b[i]]; l = 0; for (m = j.length; l < m; l++)(g = c("string" === typeof j[l] ? h.trim(j[l]) : j[l])) && g.length && (f = f.concat(g)) } a = x.selector[a]; if (a.length) { i = 0; for (n = a.length; i < n; i++)f = a[i](d, e, f) } return qa(f)
                    }, $a = function (a) { a || (a = {}); a.filter && a.search === k && (a.search = a.filter); return h.extend({ search: "none", order: "current", page: "all" }, a) }, ab = function (a) {
                        for (var b = 0, c = a.length; b < c; b++)if (0 < a[b].length) return a[0] =
                            a[b], a[0].length = 1, a.length = 1, a.context = [a.context[b]], a; a.length = 0; return a
                    }, Ba = function (a, b) {
                        var c, d, e, f = [], g = a.aiDisplay; c = a.aiDisplayMaster; var j = b.search; d = b.order; e = b.page; if ("ssp" == y(a)) return "removed" === j ? [] : W(0, c.length); if ("current" == e) { c = a._iDisplayStart; for (d = a.fnDisplayEnd(); c < d; c++)f.push(g[c]) } else if ("current" == d || "applied" == d) f = "none" == j ? c.slice() : "applied" == j ? g.slice() : h.map(c, function (a) { return -1 === h.inArray(a, g) ? a : null }); else if ("index" == d || "original" == d) {
                            c = 0; for (d = a.aoData.length; c <
                                d; c++)"none" == j ? f.push(c) : (e = h.inArray(c, g), (-1 === e && "removed" == j || 0 <= e && "applied" == j) && f.push(c))
                        } return f
                    }; o("rows()", function (a, b) {
                        a === k ? a = "" : h.isPlainObject(a) && (b = a, a = ""); var b = $a(b), c = this.iterator("table", function (c) {
                            var e = b, f; return Za("row", a, function (a) {
                                var b = Nb(a); if (b !== null && !e) return [b]; f || (f = Ba(c, e)); if (b !== null && h.inArray(b, f) !== -1) return [b]; if (a === null || a === k || a === "") return f; if (typeof a === "function") return h.map(f, function (b) { var e = c.aoData[b]; return a(b, e._aData, e.nTr) ? b : null });
                                b = Qb(ia(c.aoData, f, "nTr")); if (a.nodeName) { if (a._DT_RowIndex !== k) return [a._DT_RowIndex]; if (a._DT_CellIndex) return [a._DT_CellIndex.row]; b = h(a).closest("*[data-dt-row]"); return b.length ? [b.data("dt-row")] : [] } if (typeof a === "string" && a.charAt(0) === "#") { var i = c.aIds[a.replace(/^#/, "")]; if (i !== k) return [i.idx] } return h(b).filter(a).map(function () { return this._DT_RowIndex }).toArray()
                            }, c, e)
                        }, 1); c.selector.rows = a; c.selector.opts = b; return c
                    }); o("rows().nodes()", function () {
                        return this.iterator("row", function (a,
                            b) { return a.aoData[b].nTr || k }, 1)
                    }); o("rows().data()", function () { return this.iterator(!0, "rows", function (a, b) { return ia(a.aoData, b, "_aData") }, 1) }); u("rows().cache()", "row().cache()", function (a) { return this.iterator("row", function (b, c) { var d = b.aoData[c]; return "search" === a ? d._aFilterData : d._aSortData }, 1) }); u("rows().invalidate()", "row().invalidate()", function (a) { return this.iterator("row", function (b, c) { ca(b, c, a) }) }); u("rows().indexes()", "row().index()", function () {
                        return this.iterator("row", function (a,
                            b) { return b }, 1)
                    }); u("rows().ids()", "row().id()", function (a) { for (var b = [], c = this.context, d = 0, e = c.length; d < e; d++)for (var f = 0, g = this[d].length; f < g; f++) { var h = c[d].rowIdFn(c[d].aoData[this[d][f]]._aData); b.push((!0 === a ? "#" : "") + h) } return new s(c, b) }); u("rows().remove()", "row().remove()", function () {
                        var a = this; this.iterator("row", function (b, c, d) {
                            var e = b.aoData, f = e[c], g, h, i, n, l; e.splice(c, 1); g = 0; for (h = e.length; g < h; g++)if (i = e[g], l = i.anCells, null !== i.nTr && (i.nTr._DT_RowIndex = g), null !== l) {
                                i = 0; for (n = l.length; i <
                                    n; i++)l[i]._DT_CellIndex.row = g
                            } oa(b.aiDisplayMaster, c); oa(b.aiDisplay, c); oa(a[d], c, !1); 0 < b._iRecordsDisplay && b._iRecordsDisplay--; Ra(b); c = b.rowIdFn(f._aData); c !== k && delete b.aIds[c]
                        }); this.iterator("table", function (a) { for (var c = 0, d = a.aoData.length; c < d; c++)a.aoData[c].idx = c }); return this
                    }); o("rows.add()", function (a) {
                        var b = this.iterator("table", function (b) { var c, f, g, h = []; f = 0; for (g = a.length; f < g; f++)c = a[f], c.nodeName && "TR" === c.nodeName.toUpperCase() ? h.push(ma(b, c)[0]) : h.push(M(b, c)); return h }, 1), c = this.rows(-1);
                        c.pop(); h.merge(c, b); return c
                    }); o("row()", function (a, b) { return ab(this.rows(a, b)) }); o("row().data()", function (a) { var b = this.context; if (a === k) return b.length && this.length ? b[0].aoData[this[0]]._aData : k; b[0].aoData[this[0]]._aData = a; ca(b[0], this[0], "data"); return this }); o("row().node()", function () { var a = this.context; return a.length && this.length ? a[0].aoData[this[0]].nTr || null : null }); o("row.add()", function (a) {
                    a instanceof h && a.length && (a = a[0]); var b = this.iterator("table", function (b) {
                        return a.nodeName &&
                            "TR" === a.nodeName.toUpperCase() ? ma(b, a)[0] : M(b, a)
                    }); return this.row(b[0])
                    }); var bb = function (a, b) { var c = a.context; if (c.length && (c = c[0].aoData[b !== k ? b : a[0]]) && c._details) c._details.remove(), c._detailsShow = k, c._details = k }, Tb = function (a, b) {
                        var c = a.context; if (c.length && a.length) {
                            var d = c[0].aoData[a[0]]; if (d._details) {
                                (d._detailsShow = b) ? d._details.insertAfter(d.nTr) : d._details.detach(); var e = c[0], f = new s(e), g = e.aoData; f.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details"); 0 < D(g,
                                    "_details").length && (f.on("draw.dt.DT_details", function (a, b) { e === b && f.rows({ page: "current" }).eq(0).each(function (a) { a = g[a]; a._detailsShow && a._details.insertAfter(a.nTr) }) }), f.on("column-visibility.dt.DT_details", function (a, b) { if (e === b) for (var c, d = aa(b), f = 0, h = g.length; f < h; f++)c = g[f], c._details && c._details.children("td[colspan]").attr("colspan", d) }), f.on("destroy.dt.DT_details", function (a, b) { if (e === b) for (var c = 0, d = g.length; c < d; c++)g[c]._details && bb(f, c) }))
                            }
                        }
                    }; o("row().child()", function (a, b) {
                        var c = this.context;
                        if (a === k) return c.length && this.length ? c[0].aoData[this[0]]._details : k; if (!0 === a) this.child.show(); else if (!1 === a) bb(this); else if (c.length && this.length) {
                            var d = c[0], c = c[0].aoData[this[0]], e = [], f = function (a, b) { if (h.isArray(a) || a instanceof h) for (var c = 0, k = a.length; c < k; c++)f(a[c], b); else a.nodeName && "tr" === a.nodeName.toLowerCase() ? e.push(a) : (c = h("<tr><td/></tr>").addClass(b), h("td", c).addClass(b).html(a)[0].colSpan = aa(d), e.push(c[0])) }; f(a, b); c._details && c._details.detach(); c._details = h(e); c._detailsShow &&
                                c._details.insertAfter(c.nTr)
                        } return this
                    }); o(["row().child.show()", "row().child().show()"], function () { Tb(this, !0); return this }); o(["row().child.hide()", "row().child().hide()"], function () { Tb(this, !1); return this }); o(["row().child.remove()", "row().child().remove()"], function () { bb(this); return this }); o("row().child.isShown()", function () { var a = this.context; return a.length && this.length ? a[0].aoData[this[0]]._detailsShow || !1 : !1 }); var bc = /^([^:]+):(name|visIdx|visible)$/, Ub = function (a, b, c, d, e) {
                        for (var c =
                            [], d = 0, f = e.length; d < f; d++)c.push(B(a, e[d], b)); return c
                    }; o("columns()", function (a, b) {
                        a === k ? a = "" : h.isPlainObject(a) && (b = a, a = ""); var b = $a(b), c = this.iterator("table", function (c) {
                            var e = a, f = b, g = c.aoColumns, j = D(g, "sName"), i = D(g, "nTh"); return Za("column", e, function (a) {
                                var b = Nb(a); if (a === "") return W(g.length); if (b !== null) return [b >= 0 ? b : g.length + b]; if (typeof a === "function") { var e = Ba(c, f); return h.map(g, function (b, f) { return a(f, Ub(c, f, 0, 0, e), i[f]) ? f : null }) } var k = typeof a === "string" ? a.match(bc) : ""; if (k) switch (k[2]) {
                                    case "visIdx": case "visible": b =
                                        parseInt(k[1], 10); if (b < 0) { var m = h.map(g, function (a, b) { return a.bVisible ? b : null }); return [m[m.length + b]] } return [Z(c, b)]; case "name": return h.map(j, function (a, b) { return a === k[1] ? b : null }); default: return []
                                }if (a.nodeName && a._DT_CellIndex) return [a._DT_CellIndex.column]; b = h(i).filter(a).map(function () { return h.inArray(this, i) }).toArray(); if (b.length || !a.nodeName) return b; b = h(a).closest("*[data-dt-column]"); return b.length ? [b.data("dt-column")] : []
                            }, c, f)
                        }, 1); c.selector.cols = a; c.selector.opts = b; return c
                    }); u("columns().header()",
                        "column().header()", function () { return this.iterator("column", function (a, b) { return a.aoColumns[b].nTh }, 1) }); u("columns().footer()", "column().footer()", function () { return this.iterator("column", function (a, b) { return a.aoColumns[b].nTf }, 1) }); u("columns().data()", "column().data()", function () { return this.iterator("column-rows", Ub, 1) }); u("columns().dataSrc()", "column().dataSrc()", function () { return this.iterator("column", function (a, b) { return a.aoColumns[b].mData }, 1) }); u("columns().cache()", "column().cache()",
                            function (a) { return this.iterator("column-rows", function (b, c, d, e, f) { return ia(b.aoData, f, "search" === a ? "_aFilterData" : "_aSortData", c) }, 1) }); u("columns().nodes()", "column().nodes()", function () { return this.iterator("column-rows", function (a, b, c, d, e) { return ia(a.aoData, e, "anCells", b) }, 1) }); u("columns().visible()", "column().visible()", function (a, b) {
                                var c = this.iterator("column", function (b, c) {
                                    if (a === k) return b.aoColumns[c].bVisible; var f = b.aoColumns, g = f[c], j = b.aoData, i, n, l; if (a !== k && g.bVisible !== a) {
                                        if (a) {
                                            var m =
                                                h.inArray(!0, D(f, "bVisible"), c + 1); i = 0; for (n = j.length; i < n; i++)l = j[i].nTr, f = j[i].anCells, l && l.insertBefore(f[c], f[m] || null)
                                        } else h(D(b.aoData, "anCells", c)).detach(); g.bVisible = a; ea(b, b.aoHeader); ea(b, b.aoFooter); xa(b)
                                    }
                                }); a !== k && (this.iterator("column", function (c, e) { r(c, null, "column-visibility", [c, e, a, b]) }), (b === k || b) && this.columns.adjust()); return c
                            }); u("columns().indexes()", "column().index()", function (a) { return this.iterator("column", function (b, c) { return "visible" === a ? $(b, c) : c }, 1) }); o("columns.adjust()",
                                function () { return this.iterator("table", function (a) { Y(a) }, 1) }); o("column.index()", function (a, b) { if (0 !== this.context.length) { var c = this.context[0]; if ("fromVisible" === a || "toData" === a) return Z(c, b); if ("fromData" === a || "toVisible" === a) return $(c, b) } }); o("column()", function (a, b) { return ab(this.columns(a, b)) }); o("cells()", function (a, b, c) {
                                    h.isPlainObject(a) && (a.row === k ? (c = a, a = null) : (c = b, b = null)); h.isPlainObject(b) && (c = b, b = null); if (null === b || b === k) return this.iterator("table", function (b) {
                                        var d = a, e = $a(c), f =
                                            b.aoData, g = Ba(b, e), j = Qb(ia(f, g, "anCells")), i = h([].concat.apply([], j)), l, n = b.aoColumns.length, m, o, u, s, r, v; return Za("cell", d, function (a) {
                                                var c = typeof a === "function"; if (a === null || a === k || c) { m = []; o = 0; for (u = g.length; o < u; o++) { l = g[o]; for (s = 0; s < n; s++) { r = { row: l, column: s }; if (c) { v = f[l]; a(r, B(b, l, s), v.anCells ? v.anCells[s] : null) && m.push(r) } else m.push(r) } } return m } if (h.isPlainObject(a)) return [a]; c = i.filter(a).map(function (a, b) { return { row: b._DT_CellIndex.row, column: b._DT_CellIndex.column } }).toArray(); if (c.length ||
                                                    !a.nodeName) return c; v = h(a).closest("*[data-dt-row]"); return v.length ? [{ row: v.data("dt-row"), column: v.data("dt-column") }] : []
                                            }, b, e)
                                    }); var d = this.columns(b, c), e = this.rows(a, c), f, g, j, i, n, l = this.iterator("table", function (a, b) { f = []; g = 0; for (j = e[b].length; g < j; g++) { i = 0; for (n = d[b].length; i < n; i++)f.push({ row: e[b][g], column: d[b][i] }) } return f }, 1); h.extend(l.selector, { cols: b, rows: a, opts: c }); return l
                                }); u("cells().nodes()", "cell().node()", function () {
                                    return this.iterator("cell", function (a, b, c) {
                                        return (a = a.aoData[b]) &&
                                            a.anCells ? a.anCells[c] : k
                                    }, 1)
                                }); o("cells().data()", function () { return this.iterator("cell", function (a, b, c) { return B(a, b, c) }, 1) }); u("cells().cache()", "cell().cache()", function (a) { a = "search" === a ? "_aFilterData" : "_aSortData"; return this.iterator("cell", function (b, c, d) { return b.aoData[c][a][d] }, 1) }); u("cells().render()", "cell().render()", function (a) { return this.iterator("cell", function (b, c, d) { return B(b, c, d, a) }, 1) }); u("cells().indexes()", "cell().index()", function () {
                                    return this.iterator("cell", function (a,
                                        b, c) { return { row: b, column: c, columnVisible: $(a, c) } }, 1)
                                }); u("cells().invalidate()", "cell().invalidate()", function (a) { return this.iterator("cell", function (b, c, d) { ca(b, c, a, d) }) }); o("cell()", function (a, b, c) { return ab(this.cells(a, b, c)) }); o("cell().data()", function (a) { var b = this.context, c = this[0]; if (a === k) return b.length && c.length ? B(b[0], c[0].row, c[0].column) : k; ib(b[0], c[0].row, c[0].column, a); ca(b[0], c[0].row, "data", c[0].column); return this }); o("order()", function (a, b) {
                                    var c = this.context; if (a === k) return 0 !==
                                        c.length ? c[0].aaSorting : k; "number" === typeof a ? a = [[a, b]] : a.length && !h.isArray(a[0]) && (a = Array.prototype.slice.call(arguments)); return this.iterator("table", function (b) { b.aaSorting = a.slice() })
                                }); o("order.listener()", function (a, b, c) { return this.iterator("table", function (d) { La(d, a, b, c) }) }); o("order.fixed()", function (a) { if (!a) { var b = this.context, b = b.length ? b[0].aaSortingFixed : k; return h.isArray(b) ? { pre: b } : b } return this.iterator("table", function (b) { b.aaSortingFixed = h.extend(!0, {}, a) }) }); o(["columns().order()",
                                    "column().order()"], function (a) { var b = this; return this.iterator("table", function (c, d) { var e = []; h.each(b[d], function (b, c) { e.push([c, a]) }); c.aaSorting = e }) }); o("search()", function (a, b, c, d) { var e = this.context; return a === k ? 0 !== e.length ? e[0].oPreviousSearch.sSearch : k : this.iterator("table", function (e) { e.oFeatures.bFilter && fa(e, h.extend({}, e.oPreviousSearch, { sSearch: a + "", bRegex: null === b ? !1 : b, bSmart: null === c ? !0 : c, bCaseInsensitive: null === d ? !0 : d }), 1) }) }); u("columns().search()", "column().search()", function (a,
                                        b, c, d) { return this.iterator("column", function (e, f) { var g = e.aoPreSearchCols; if (a === k) return g[f].sSearch; e.oFeatures.bFilter && (h.extend(g[f], { sSearch: a + "", bRegex: null === b ? !1 : b, bSmart: null === c ? !0 : c, bCaseInsensitive: null === d ? !0 : d }), fa(e, e.oPreviousSearch, 1)) }) }); o("state()", function () { return this.context.length ? this.context[0].oSavedState : null }); o("state.clear()", function () { return this.iterator("table", function (a) { a.fnStateSaveCallback.call(a.oInstance, a, {}) }) }); o("state.loaded()", function () {
                                            return this.context.length ?
                                                this.context[0].oLoadedState : null
                                        }); o("state.save()", function () { return this.iterator("table", function (a) { xa(a) }) }); m.versionCheck = m.fnVersionCheck = function (a) { for (var b = m.version.split("."), a = a.split("."), c, d, e = 0, f = a.length; e < f; e++)if (c = parseInt(b[e], 10) || 0, d = parseInt(a[e], 10) || 0, c !== d) return c > d; return !0 }; m.isDataTable = m.fnIsDataTable = function (a) {
                                            var b = h(a).get(0), c = !1; if (a instanceof m.Api) return !0; h.each(m.settings, function (a, e) {
                                                var f = e.nScrollHead ? h("table", e.nScrollHead)[0] : null, g = e.nScrollFoot ?
                                                    h("table", e.nScrollFoot)[0] : null; if (e.nTable === b || f === b || g === b) c = !0
                                            }); return c
                                        }; m.tables = m.fnTables = function (a) { var b = !1; h.isPlainObject(a) && (b = a.api, a = a.visible); var c = h.map(m.settings, function (b) { if (!a || a && h(b.nTable).is(":visible")) return b.nTable }); return b ? new s(c) : c }; m.camelToHungarian = I; o("$()", function (a, b) { var c = this.rows(b).nodes(), c = h(c); return h([].concat(c.filter(a).toArray(), c.find(a).toArray())) }); h.each(["on", "one", "off"], function (a, b) {
                                            o(b + "()", function () {
                                                var a = Array.prototype.slice.call(arguments);
                                                a[0] = h.map(a[0].split(/\s/), function (a) { return !a.match(/\.dt\b/) ? a + ".dt" : a }).join(" "); var d = h(this.tables().nodes()); d[b].apply(d, a); return this
                                            })
                                        }); o("clear()", function () { return this.iterator("table", function (a) { na(a) }) }); o("settings()", function () { return new s(this.context, this.context) }); o("init()", function () { var a = this.context; return a.length ? a[0].oInit : null }); o("data()", function () { return this.iterator("table", function (a) { return D(a.aoData, "_aData") }).flatten() }); o("destroy()", function (a) {
                                            a = a ||
                                            !1; return this.iterator("table", function (b) {
                                                var c = b.nTableWrapper.parentNode, d = b.oClasses, e = b.nTable, f = b.nTBody, g = b.nTHead, j = b.nTFoot, i = h(e), f = h(f), k = h(b.nTableWrapper), l = h.map(b.aoData, function (a) { return a.nTr }), o; b.bDestroying = !0; r(b, "aoDestroyCallback", "destroy", [b]); a || (new s(b)).columns().visible(!0); k.off(".DT").find(":not(tbody *)").off(".DT"); h(E).off(".DT-" + b.sInstance); e != g.parentNode && (i.children("thead").detach(), i.append(g)); j && e != j.parentNode && (i.children("tfoot").detach(), i.append(j));
                                                b.aaSorting = []; b.aaSortingFixed = []; wa(b); h(l).removeClass(b.asStripeClasses.join(" ")); h("th, td", g).removeClass(d.sSortable + " " + d.sSortableAsc + " " + d.sSortableDesc + " " + d.sSortableNone); f.children().detach(); f.append(l); g = a ? "remove" : "detach"; i[g](); k[g](); !a && c && (c.insertBefore(e, b.nTableReinsertBefore), i.css("width", b.sDestroyWidth).removeClass(d.sTable), (o = b.asDestroyStripes.length) && f.children().each(function (a) { h(this).addClass(b.asDestroyStripes[a % o]) })); c = h.inArray(b, m.settings); -1 !== c && m.settings.splice(c,
                                                    1)
                                            })
                                        }); h.each(["column", "row", "cell"], function (a, b) { o(b + "s().every()", function (a) { var d = this.selector.opts, e = this; return this.iterator(b, function (f, g, h, i, n) { a.call(e[b](g, "cell" === b ? h : d, "cell" === b ? d : k), g, h, i, n) }) }) }); o("i18n()", function (a, b, c) { var d = this.context[0], a = Q(a)(d.oLanguage); a === k && (a = b); c !== k && h.isPlainObject(a) && (a = a[c] !== k ? a[c] : a._); return a.replace("%d", c) }); m.version = "1.10.16"; m.settings = []; m.models = {}; m.models.oSearch = { bCaseInsensitive: !0, sSearch: "", bRegex: !1, bSmart: !0 }; m.models.oRow =
                                            { nTr: null, anCells: null, _aData: [], _aSortData: null, _aFilterData: null, _sFilterRow: null, _sRowStripe: "", src: null, idx: -1 }; m.models.oColumn = {
                                                idx: null, aDataSort: null, asSorting: null, bSearchable: null, bSortable: null, bVisible: null, _sManualType: null, _bAttrSrc: !1, fnCreatedCell: null, fnGetData: null, fnSetData: null, mData: null, mRender: null, nTh: null, nTf: null, sClass: null, sContentPadding: null, sDefaultContent: null, sName: null, sSortDataType: "std", sSortingClass: null, sSortingClassJUI: null, sTitle: null, sType: null, sWidth: null,
                                                sWidthOrig: null
                                            }; m.defaults = {
                                                aaData: null, aaSorting: [[0, "asc"]], aaSortingFixed: [], ajax: null, aLengthMenu: [10, 25, 50, 100], aoColumns: null, aoColumnDefs: null, aoSearchCols: [], asStripeClasses: null, bAutoWidth: !0, bDeferRender: !1, bDestroy: !1, bFilter: !0, bInfo: !0, bLengthChange: !0, bPaginate: !0, bProcessing: !1, bRetrieve: !1, bScrollCollapse: !1, bServerSide: !1, bSort: !0, bSortMulti: !0, bSortCellsTop: !1, bSortClasses: !0, bStateSave: !1, fnCreatedRow: null, fnDrawCallback: null, fnFooterCallback: null, fnFormatNumber: function (a) {
                                                    return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,
                                                        this.oLanguage.sThousands)
                                                }, fnHeaderCallback: null, fnInfoCallback: null, fnInitComplete: null, fnPreDrawCallback: null, fnRowCallback: null, fnServerData: null, fnServerParams: null, fnStateLoadCallback: function (a) { try { return JSON.parse((-1 === a.iStateDuration ? sessionStorage : localStorage).getItem("DataTables_" + a.sInstance + "_" + location.pathname)) } catch (b) { } }, fnStateLoadParams: null, fnStateLoaded: null, fnStateSaveCallback: function (a, b) {
                                                    try {
                                                        (-1 === a.iStateDuration ? sessionStorage : localStorage).setItem("DataTables_" + a.sInstance +
                                                            "_" + location.pathname, JSON.stringify(b))
                                                    } catch (c) { }
                                                }, fnStateSaveParams: null, iStateDuration: 7200, iDeferLoading: null, iDisplayLength: 10, iDisplayStart: 0, iTabIndex: 0, oClasses: {}, oLanguage: {
                                                    oAria: { sSortAscending: ": activate to sort column ascending", sSortDescending: ": activate to sort column descending" }, oPaginate: { sFirst: "First", sLast: "Last", sNext: "Next", sPrevious: "Previous" }, sEmptyTable: "No data available in table", sInfo: "Showing _START_ to _END_ of _TOTAL_ entries", sInfoEmpty: "Showing 0 to 0 of 0 entries",
                                                    sInfoFiltered: "(filtered from _MAX_ total entries)", sInfoPostFix: "", sDecimal: "", sThousands: ",", sLengthMenu: "Show _MENU_ entries", sLoadingRecords: "Loading...", sProcessing: "Processing...", sSearch: "Search:", sSearchPlaceholder: "", sUrl: "", sZeroRecords: "No matching records found"
                                                }, oSearch: h.extend({}, m.models.oSearch), sAjaxDataProp: "data", sAjaxSource: null, sDom: "lfrtip", searchDelay: null, sPaginationType: "simple_numbers", sScrollX: "", sScrollXInner: "", sScrollY: "", sServerMethod: "GET", renderer: null, rowId: "DT_RowId"
                                            };
    X(m.defaults); m.defaults.column = { aDataSort: null, iDataSort: -1, asSorting: ["asc", "desc"], bSearchable: !0, bSortable: !0, bVisible: !0, fnCreatedCell: null, mData: null, mRender: null, sCellType: "td", sClass: "", sContentPadding: "", sDefaultContent: null, sName: "", sSortDataType: "std", sTitle: null, sType: null, sWidth: null }; X(m.defaults.column); m.models.oSettings = {
        oFeatures: {
            bAutoWidth: null, bDeferRender: null, bFilter: null, bInfo: null, bLengthChange: null, bPaginate: null, bProcessing: null, bServerSide: null, bSort: null, bSortMulti: null,
            bSortClasses: null, bStateSave: null
        }, oScroll: { bCollapse: null, iBarWidth: 0, sX: null, sXInner: null, sY: null }, oLanguage: { fnInfoCallback: null }, oBrowser: { bScrollOversize: !1, bScrollbarLeft: !1, bBounding: !1, barWidth: 0 }, ajax: null, aanFeatures: [], aoData: [], aiDisplay: [], aiDisplayMaster: [], aIds: {}, aoColumns: [], aoHeader: [], aoFooter: [], oPreviousSearch: {}, aoPreSearchCols: [], aaSorting: null, aaSortingFixed: [], asStripeClasses: null, asDestroyStripes: [], sDestroyWidth: 0, aoRowCallback: [], aoHeaderCallback: [], aoFooterCallback: [],
        aoDrawCallback: [], aoRowCreatedCallback: [], aoPreDrawCallback: [], aoInitComplete: [], aoStateSaveParams: [], aoStateLoadParams: [], aoStateLoaded: [], sTableId: "", nTable: null, nTHead: null, nTFoot: null, nTBody: null, nTableWrapper: null, bDeferLoading: !1, bInitialised: !1, aoOpenRows: [], sDom: null, searchDelay: null, sPaginationType: "two_button", iStateDuration: 0, aoStateSave: [], aoStateLoad: [], oSavedState: null, oLoadedState: null, sAjaxSource: null, sAjaxDataProp: null, bAjaxDataGet: !0, jqXHR: null, json: k, oAjaxData: k, fnServerData: null,
        aoServerParams: [], sServerMethod: null, fnFormatNumber: null, aLengthMenu: null, iDraw: 0, bDrawing: !1, iDrawError: -1, _iDisplayLength: 10, _iDisplayStart: 0, _iRecordsTotal: 0, _iRecordsDisplay: 0, oClasses: {}, bFiltered: !1, bSorted: !1, bSortCellsTop: null, oInit: null, aoDestroyCallback: [], fnRecordsTotal: function () { return "ssp" == y(this) ? 1 * this._iRecordsTotal : this.aiDisplayMaster.length }, fnRecordsDisplay: function () { return "ssp" == y(this) ? 1 * this._iRecordsDisplay : this.aiDisplay.length }, fnDisplayEnd: function () {
            var a = this._iDisplayLength,
            b = this._iDisplayStart, c = b + a, d = this.aiDisplay.length, e = this.oFeatures, f = e.bPaginate; return e.bServerSide ? !1 === f || -1 === a ? b + d : Math.min(b + a, this._iRecordsDisplay) : !f || c > d || -1 === a ? d : c
        }, oInstance: null, sInstance: null, iTabIndex: 0, nScrollHead: null, nScrollFoot: null, aLastSort: [], oPlugins: {}, rowIdFn: null, rowId: null
    }; m.ext = x = {
        buttons: {}, classes: {}, build: "dt/dt-1.10.16", errMode: "alert", feature: [], search: [], selector: { cell: [], column: [], row: [] }, internal: {}, legacy: { ajax: null }, pager: {}, renderer: { pageButton: {}, header: {} },
        order: {}, type: { detect: [], search: {}, order: {} }, _unique: 0, fnVersionCheck: m.fnVersionCheck, iApiIndex: 0, oJUIClasses: {}, sVersion: m.version
    }; h.extend(x, { afnFiltering: x.search, aTypes: x.type.detect, ofnSearch: x.type.search, oSort: x.type.order, afnSortData: x.order, aoFeatures: x.feature, oApi: x.internal, oStdClasses: x.classes, oPagination: x.pager }); h.extend(m.ext.classes, {
        sTable: "dataTable", sNoFooter: "no-footer", sPageButton: "paginate_button", sPageButtonActive: "current", sPageButtonDisabled: "disabled", sStripeOdd: "odd",
        sStripeEven: "even", sRowEmpty: "dataTables_empty", sWrapper: "dataTables_wrapper", sFilter: "dataTables_filter", sInfo: "dataTables_info", sPaging: "dataTables_paginate paging_", sLength: "dataTables_length", sProcessing: "dataTables_processing", sSortAsc: "sorting_asc", sSortDesc: "sorting_desc", sSortable: "sorting", sSortableAsc: "sorting_asc_disabled", sSortableDesc: "sorting_desc_disabled", sSortableNone: "sorting_disabled", sSortColumn: "sorting_", sFilterInput: "", sLengthSelect: "", sScrollWrapper: "dataTables_scroll", sScrollHead: "dataTables_scrollHead",
        sScrollHeadInner: "dataTables_scrollHeadInner", sScrollBody: "dataTables_scrollBody", sScrollFoot: "dataTables_scrollFoot", sScrollFootInner: "dataTables_scrollFootInner", sHeaderTH: "", sFooterTH: "", sSortJUIAsc: "", sSortJUIDesc: "", sSortJUI: "", sSortJUIAscAllowed: "", sSortJUIDescAllowed: "", sSortJUIWrapper: "", sSortIcon: "", sJUIHeader: "", sJUIFooter: ""
    }); var Kb = m.ext.pager; h.extend(Kb, {
        simple: function () { return ["previous", "next"] }, full: function () { return ["first", "previous", "next", "last"] }, numbers: function (a, b) {
            return [ha(a,
                b)]
        }, simple_numbers: function (a, b) { return ["previous", ha(a, b), "next"] }, full_numbers: function (a, b) { return ["first", "previous", ha(a, b), "next", "last"] }, first_last_numbers: function (a, b) { return ["first", ha(a, b), "last"] }, _numbers: ha, numbers_length: 7
    }); h.extend(!0, m.ext.renderer, {
        pageButton: {
            _: function (a, b, c, d, e, f) {
                var g = a.oClasses, j = a.oLanguage.oPaginate, i = a.oLanguage.oAria.paginate || {}, n, l, m = 0, o = function (b, d) {
                    var k, s, u, r, v = function (b) { Sa(a, b.data.action, true) }; k = 0; for (s = d.length; k < s; k++) {
                        r = d[k]; if (h.isArray(r)) {
                            u =
                            h("<" + (r.DT_el || "div") + "/>").appendTo(b); o(u, r)
                        } else {
                            n = null; l = ""; switch (r) { case "ellipsis": b.append('<span class="ellipsis">&#x2026;</span>'); break; case "first": n = j.sFirst; l = r + (e > 0 ? "" : " " + g.sPageButtonDisabled); break; case "previous": n = j.sPrevious; l = r + (e > 0 ? "" : " " + g.sPageButtonDisabled); break; case "next": n = j.sNext; l = r + (e < f - 1 ? "" : " " + g.sPageButtonDisabled); break; case "last": n = j.sLast; l = r + (e < f - 1 ? "" : " " + g.sPageButtonDisabled); break; default: n = r + 1; l = e === r ? g.sPageButtonActive : "" }if (n !== null) {
                                u = h("<a>", {
                                    "class": g.sPageButton +
                                        " " + l, "aria-controls": a.sTableId, "aria-label": i[r], "data-dt-idx": m, tabindex: a.iTabIndex, id: c === 0 && typeof r === "string" ? a.sTableId + "_" + r : null
                                }).html(n).appendTo(b); Va(u, { action: r }, v); m++
                            }
                        }
                    }
                }, s; try { s = h(b).find(G.activeElement).data("dt-idx") } catch (u) { } o(h(b).empty(), d); s !== k && h(b).find("[data-dt-idx=" + s + "]").focus()
            }
        }
    }); h.extend(m.ext.type.detect, [function (a, b) { var c = b.oLanguage.sDecimal; return Ya(a, c) ? "num" + c : null }, function (a) {
        if (a && !(a instanceof Date) && !Zb.test(a)) return null; var b = Date.parse(a);
        return null !== b && !isNaN(b) || L(a) ? "date" : null
    }, function (a, b) { var c = b.oLanguage.sDecimal; return Ya(a, c, !0) ? "num-fmt" + c : null }, function (a, b) { var c = b.oLanguage.sDecimal; return Pb(a, c) ? "html-num" + c : null }, function (a, b) { var c = b.oLanguage.sDecimal; return Pb(a, c, !0) ? "html-num-fmt" + c : null }, function (a) { return L(a) || "string" === typeof a && -1 !== a.indexOf("<") ? "html" : null }]); h.extend(m.ext.type.search, {
        html: function (a) { return L(a) ? a : "string" === typeof a ? a.replace(Mb, " ").replace(Aa, "") : "" }, string: function (a) {
            return L(a) ?
                a : "string" === typeof a ? a.replace(Mb, " ") : a
        }
    }); var za = function (a, b, c, d) { if (0 !== a && (!a || "-" === a)) return -Infinity; b && (a = Ob(a, b)); a.replace && (c && (a = a.replace(c, "")), d && (a = a.replace(d, ""))); return 1 * a }; h.extend(x.type.order, {
        "date-pre": function (a) { return Date.parse(a) || -Infinity }, "html-pre": function (a) { return L(a) ? "" : a.replace ? a.replace(/<.*?>/g, "").toLowerCase() : a + "" }, "string-pre": function (a) { return L(a) ? "" : "string" === typeof a ? a.toLowerCase() : !a.toString ? "" : a.toString() }, "string-asc": function (a, b) {
            return a <
                b ? -1 : a > b ? 1 : 0
        }, "string-desc": function (a, b) { return a < b ? 1 : a > b ? -1 : 0 }
    }); cb(""); h.extend(!0, m.ext.renderer, {
        header: {
            _: function (a, b, c, d) { h(a.nTable).on("order.dt.DT", function (e, f, g, h) { if (a === f) { e = c.idx; b.removeClass(c.sSortingClass + " " + d.sSortAsc + " " + d.sSortDesc).addClass(h[e] == "asc" ? d.sSortAsc : h[e] == "desc" ? d.sSortDesc : c.sSortingClass) } }) }, jqueryui: function (a, b, c, d) {
                h("<div/>").addClass(d.sSortJUIWrapper).append(b.contents()).append(h("<span/>").addClass(d.sSortIcon + " " + c.sSortingClassJUI)).appendTo(b);
                h(a.nTable).on("order.dt.DT", function (e, f, g, h) { if (a === f) { e = c.idx; b.removeClass(d.sSortAsc + " " + d.sSortDesc).addClass(h[e] == "asc" ? d.sSortAsc : h[e] == "desc" ? d.sSortDesc : c.sSortingClass); b.find("span." + d.sSortIcon).removeClass(d.sSortJUIAsc + " " + d.sSortJUIDesc + " " + d.sSortJUI + " " + d.sSortJUIAscAllowed + " " + d.sSortJUIDescAllowed).addClass(h[e] == "asc" ? d.sSortJUIAsc : h[e] == "desc" ? d.sSortJUIDesc : c.sSortingClassJUI) } })
            }
        }
    }); var Vb = function (a) {
        return "string" === typeof a ? a.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g,
            "&quot;") : a
    }; m.render = { number: function (a, b, c, d, e) { return { display: function (f) { if ("number" !== typeof f && "string" !== typeof f) return f; var g = 0 > f ? "-" : "", h = parseFloat(f); if (isNaN(h)) return Vb(f); h = h.toFixed(c); f = Math.abs(h); h = parseInt(f, 10); f = c ? b + (f - h).toFixed(c).substring(2) : ""; return g + (d || "") + h.toString().replace(/\B(?=(\d{3})+(?!\d))/g, a) + f + (e || "") } } }, text: function () { return { display: Vb } } }; h.extend(m.ext.internal, {
        _fnExternApiFunc: Lb, _fnBuildAjax: sa, _fnAjaxUpdate: kb, _fnAjaxParameters: tb, _fnAjaxUpdateDraw: ub,
        _fnAjaxDataSrc: ta, _fnAddColumn: Da, _fnColumnOptions: ja, _fnAdjustColumnSizing: Y, _fnVisibleToColumnIndex: Z, _fnColumnIndexToVisible: $, _fnVisbleColumns: aa, _fnGetColumns: la, _fnColumnTypes: Fa, _fnApplyColumnDefs: hb, _fnHungarianMap: X, _fnCamelToHungarian: I, _fnLanguageCompat: Ca, _fnBrowserDetect: fb, _fnAddData: M, _fnAddTr: ma, _fnNodeToDataIndex: function (a, b) { return b._DT_RowIndex !== k ? b._DT_RowIndex : null }, _fnNodeToColumnIndex: function (a, b, c) { return h.inArray(c, a.aoData[b].anCells) }, _fnGetCellData: B, _fnSetCellData: ib,
        _fnSplitObjNotation: Ia, _fnGetObjectDataFn: Q, _fnSetObjectDataFn: R, _fnGetDataMaster: Ja, _fnClearTable: na, _fnDeleteIndex: oa, _fnInvalidate: ca, _fnGetRowElements: Ha, _fnCreateTr: Ga, _fnBuildHead: jb, _fnDrawHead: ea, _fnDraw: N, _fnReDraw: S, _fnAddOptionsHtml: mb, _fnDetectHeader: da, _fnGetUniqueThs: ra, _fnFeatureHtmlFilter: ob, _fnFilterComplete: fa, _fnFilterCustom: xb, _fnFilterColumn: wb, _fnFilter: vb, _fnFilterCreateSearch: Oa, _fnEscapeRegex: Pa, _fnFilterData: yb, _fnFeatureHtmlInfo: rb, _fnUpdateInfo: Bb, _fnInfoMacros: Cb, _fnInitialise: ga,
        _fnInitComplete: ua, _fnLengthChange: Qa, _fnFeatureHtmlLength: nb, _fnFeatureHtmlPaginate: sb, _fnPageChange: Sa, _fnFeatureHtmlProcessing: pb, _fnProcessingDisplay: C, _fnFeatureHtmlTable: qb, _fnScrollDraw: ka, _fnApplyToChildren: H, _fnCalculateColumnWidths: Ea, _fnThrottle: Na, _fnConvertToWidth: Db, _fnGetWidestNode: Eb, _fnGetMaxLenString: Fb, _fnStringToCss: v, _fnSortFlatten: V, _fnSort: lb, _fnSortAria: Hb, _fnSortListener: Ua, _fnSortAttachListener: La, _fnSortingClasses: wa, _fnSortData: Gb, _fnSaveState: xa, _fnLoadState: Ib, _fnSettingsFromNode: ya,
        _fnLog: J, _fnMap: F, _fnBindAction: Va, _fnCallbackReg: z, _fnCallbackFire: r, _fnLengthOverflow: Ra, _fnRenderer: Ma, _fnDataSource: y, _fnRowAttributes: Ka, _fnCalculateEnd: function () { }
    }); h.fn.dataTable = m; m.$ = h; h.fn.dataTableSettings = m.settings; h.fn.dataTableExt = m.ext; h.fn.DataTable = function (a) { return h(this).dataTable(a).api() }; h.each(m, function (a, b) { h.fn.DataTable[a] = b }); return h.fn.dataTable
});



/*!
 DataTables Bootstrap 3 integration
 Â©2011-2015 SpryMedia Ltd - datatables.net/license
*/
(function (b) { "function" === typeof define && define.amd ? define(["jquery", "datatables.net"], function (a) { return b(a, window, document) }) : "object" === typeof exports ? module.exports = function (a, d) { a || (a = window); if (!d || !d.fn.dataTable) d = require("datatables.net")(a, d).$; return b(d, a, a.document) } : b(jQuery, window, document) })(function (b, a, d) {
    var f = b.fn.dataTable; b.extend(!0, f.defaults, { dom: /*<'col-sm-2'f> */"<'row'<'col-sm-12'l>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>", renderer: "bootstrap" }); b.extend(f.ext.classes,
        { sWrapper: "dataTables_wrapper form-inline dt-bootstrap", sFilterInput: "form-control input-sm", sLengthSelect: "form-control input-sm", sProcessing: "dataTables_processing panel panel-default" }); f.ext.renderer.pageButton.bootstrap = function (a, h, r, m, j, n) {
            var o = new f.Api(a), s = a.oClasses, k = a.oLanguage.oPaginate, t = a.oLanguage.oAria.paginate || {}, e, g, p = 0, q = function (d, f) {
                var l, h, i, c, m = function (a) { a.preventDefault(); !b(a.currentTarget).hasClass("disabled") && o.page() != a.data.action && o.page(a.data.action).draw("page") };
                l = 0; for (h = f.length; l < h; l++)if (c = f[l], b.isArray(c)) q(d, c); else {
                    g = e = ""; switch (c) { case "ellipsis": e = "&#x2026;"; g = "disabled"; break; case "first": e = k.sFirst; g = c + (0 < j ? "" : " disabled"); break; case "previous": e = k.sPrevious; g = c + (0 < j ? "" : " disabled"); break; case "next": e = k.sNext; g = c + (j < n - 1 ? "" : " disabled"); break; case "last": e = k.sLast; g = c + (j < n - 1 ? "" : " disabled"); break; default: e = c + 1, g = j === c ? "active" : "" }e && (i = b("<li>", { "class": s.sPageButton + " " + g, id: 0 === r && "string" === typeof c ? a.sTableId + "_" + c : null }).append(b("<a>", {
                        href: "#",
                        "aria-controls": a.sTableId, "aria-label": t[c], "data-dt-idx": p, tabindex: a.iTabIndex
                    }).html(e)).appendTo(d), a.oApi._fnBindAction(i, { action: c }, m), p++)
                }
            }, i; try { i = b(h).find(d.activeElement).data("dt-idx") } catch (u) { } q(b(h).empty().html('<ul class="pagination"/>').children("ul"), m); i && b(h).find("[data-dt-idx=" + i + "]").focus()
        }; return f
});

/*! Responsive 2.1.0
 * 2014-2016 SpryMedia Ltd - datatables.net/license
 */

/**
 * @summary     Responsive
 * @description Responsive tables plug-in for DataTables
 * @version     2.1.0
 * @file        dataTables.responsive.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2014-2016 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
(function (factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD
        define(['jquery', 'datatables.net'], function ($) {
            return factory($, window, document);
        });
    }
    else if (typeof exports === 'object') {
        // CommonJS
        module.exports = function (root, $) {
            if (!root) {
                root = window;
            }

            if (!$ || !$.fn.dataTable) {
                $ = require('datatables.net')(root, $).$;
            }

            return factory($, root, root.document);
        };
    }
    else {
        // Browser
        factory(jQuery, window, document);
    }
}(function ($, window, document, undefined) {
    'use strict';
    var DataTable = $.fn.dataTable;


    /**
     * Responsive is a plug-in for the DataTables library that makes use of
     * DataTables' ability to change the visibility of columns, changing the
     * visibility of columns so the displayed columns fit into the table container.
     * The end result is that complex tables will be dynamically adjusted to fit
     * into the viewport, be it on a desktop, tablet or mobile browser.
     *
     * Responsive for DataTables has two modes of operation, which can used
     * individually or combined:
     *
     * * Class name based control - columns assigned class names that match the
     *   breakpoint logic can be shown / hidden as required for each breakpoint.
     * * Automatic control - columns are automatically hidden when there is no
     *   room left to display them. Columns removed from the right.
     *
     * In additional to column visibility control, Responsive also has built into
     * options to use DataTables' child row display to show / hide the information
     * from the table that has been hidden. There are also two modes of operation
     * for this child row display:
     *
     * * Inline - when the control element that the user can use to show / hide
     *   child rows is displayed inside the first column of the table.
     * * Column - where a whole column is dedicated to be the show / hide control.
     *
     * Initialisation of Responsive is performed by:
     *
     * * Adding the class 'responsive' or 'dt-responsive' to the table. In this case
     *   Responsive will automatically be initialised with the default configuration
     *   options when the DataTable is created.
     * * Using the 'responsive' option in the DataTables configuration options. This
     *   can also be used to specify the configuration options, or simply set to
     *   'true' to use the defaults.
     *
     *  @class
     *  @param {object} settings DataTables settings object for the host table
     *  @param {object} [opts] Configuration options
     *  @requires jQuery 1.7+
     *  @requires DataTables 1.10.3+
     *
     *  @example
     *      $('#example').DataTable( {
     *        responsive: true
     *      } );
     *    } );
     */
    var Responsive = function (settings, opts) {
        // Sanity check that we are using DataTables 1.10 or newer
        if (!DataTable.versionCheck || !DataTable.versionCheck('1.10.3')) {
            throw 'DataTables Responsive requires DataTables 1.10.3 or newer';
        }

        this.s = {
            dt: new DataTable.Api(settings),
            columns: [],
            current: []
        };

        // Check if responsive has already been initialised on this table
        if (this.s.dt.settings()[0].responsive) {
            return;
        }

        // details is an object, but for simplicity the user can give it as a string
        // or a boolean
        if (opts && typeof opts.details === 'string') {
            opts.details = { type: opts.details };
        }
        else if (opts && opts.details === false) {
            opts.details = { type: false };
        }
        else if (opts && opts.details === true) {
            opts.details = { type: 'inline' };
        }

        this.c = $.extend(true, {}, Responsive.defaults, DataTable.defaults.responsive, opts);
        settings.responsive = this;
        this._constructor();
    };

    $.extend(Responsive.prototype, {
        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         * Constructor
         */

        /**
         * Initialise the Responsive instance
         *
         * @private
         */
        _constructor: function () {
            var that = this;
            var dt = this.s.dt;
            var dtPrivateSettings = dt.settings()[0];
            var oldWindowWidth = $(window).width();

            dt.settings()[0]._responsive = this;

            // Use DataTables' throttle function to avoid processor thrashing on
            // resize
            $(window).on('resize.dtr orientationchange.dtr', DataTable.util.throttle(function () {
                // iOS has a bug whereby resize can fire when only scrolling
                // See: http://stackoverflow.com/questions/8898412
                var width = $(window).width();

                if (width !== oldWindowWidth) {
                    that._resize();
                    oldWindowWidth = width;
                }
            }));

            // DataTables doesn't currently trigger an event when a row is added, so
            // we need to hook into its private API to enforce the hidden rows when
            // new data is added
            dtPrivateSettings.oApi._fnCallbackReg(dtPrivateSettings, 'aoRowCreatedCallback', function (tr, data, idx) {
                if ($.inArray(false, that.s.current) !== -1) {
                    $('td, th', tr).each(function (i) {
                        var idx = dt.column.index('toData', i);

                        if (that.s.current[idx] === false) {
                            $(this).css('display', 'none');
                        }
                    });
                }
            });

            // Destroy event handler
            dt.on('destroy.dtr', function () {
                dt.off('.dtr');
                $(dt.table().body()).off('.dtr');
                $(window).off('resize.dtr orientationchange.dtr');

                // Restore the columns that we've hidden
                $.each(that.s.current, function (i, val) {
                    if (val === false) {
                        that._setColumnVis(i, true);
                    }
                });
            });

            // Reorder the breakpoints array here in case they have been added out
            // of order
            this.c.breakpoints.sort(function (a, b) {
                return a.width < b.width ? 1 :
                    a.width > b.width ? -1 : 0;
            });

            this._classLogic();
            this._resizeAuto();

            // Details handler
            var details = this.c.details;

            if (details.type !== false) {
                that._detailsInit();

                // DataTables will trigger this event on every column it shows and
                // hides individually
                dt.on('column-visibility.dtr', function (e, ctx, col, vis) {
                    that._classLogic();
                    that._resizeAuto();
                    that._resize();
                });

                // Redraw the details box on each draw which will happen if the data
                // has changed. This is used until DataTables implements a native
                // 'updated' event for rows
                dt.on('draw.dtr', function () {
                    that._redrawChildren();
                });

                $(dt.table().node()).addClass('dtr-' + details.type);
            }

            dt.on('column-reorder.dtr', function (e, settings, details) {
                that._classLogic();
                that._resizeAuto();
                that._resize();
            });

            // Change in column sizes means we need to calc
            dt.on('column-sizing.dtr', function () {
                that._resizeAuto();
                that._resize();
            });

            dt.on('init.dtr', function (e, settings, details) {
                that._resizeAuto();
                that._resize();

                // If columns were hidden, then DataTables needs to adjust the
                // column sizing
                if ($.inArray(false, that.s.current)) {
                    dt.columns.adjust();
                }
            });

            // First pass - draw the table for the current viewport size
            this._resize();
        },


        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         * Private methods
         */

        /**
         * Calculate the visibility for the columns in a table for a given
         * breakpoint. The result is pre-determined based on the class logic if
         * class names are used to control all columns, but the width of the table
         * is also used if there are columns which are to be automatically shown
         * and hidden.
         *
         * @param  {string} breakpoint Breakpoint name to use for the calculation
         * @return {array} Array of boolean values initiating the visibility of each
         *   column.
         *  @private
         */
        _columnsVisiblity: function (breakpoint) {
            var dt = this.s.dt;
            var columns = this.s.columns;
            var i, ien;

            // Create an array that defines the column ordering based first on the
            // column's priority, and secondly the column index. This allows the
            // columns to be removed from the right if the priority matches
            var order = columns
                .map(function (col, idx) {
                    return {
                        columnIdx: idx,
                        priority: col.priority
                    };
                })
                .sort(function (a, b) {
                    if (a.priority !== b.priority) {
                        return a.priority - b.priority;
                    }
                    return a.columnIdx - b.columnIdx;
                });

            // Class logic - determine which columns are in this breakpoint based
            // on the classes. If no class control (i.e. 'auto') then '-' is used
            // to indicate this to the rest of the function
            var display = $.map(columns, function (col) {
                return col.auto && col.minWidth === null ?
                    false :
                    col.auto === true ?
                        '-' :
                        $.inArray(breakpoint, col.includeIn) !== -1;
            });

            // Auto column control - first pass: how much width is taken by the
            // ones that must be included from the non-auto columns
            var requiredWidth = 0;
            for (i = 0, ien = display.length; i < ien; i++) {
                if (display[i] === true) {
                    requiredWidth += columns[i].minWidth;
                }
            }

            // Second pass, use up any remaining width for other columns. For
            // scrolling tables we need to subtract the width of the scrollbar. It
            // may not be requires which makes this sub-optimal, but it would
            // require another full redraw to make complete use of those extra few
            // pixels
            var scrolling = dt.settings()[0].oScroll;
            var bar = scrolling.sY || scrolling.sX ? scrolling.iBarWidth : 0;
            var widthAvailable = dt.table().container().offsetWidth - bar;
            var usedWidth = widthAvailable - requiredWidth;

            // Control column needs to always be included. This makes it sub-
            // optimal in terms of using the available with, but to stop layout
            // thrashing or overflow. Also we need to account for the control column
            // width first so we know how much width is available for the other
            // columns, since the control column might not be the first one shown
            for (i = 0, ien = display.length; i < ien; i++) {
                if (columns[i].control) {
                    usedWidth -= columns[i].minWidth;
                }
            }

            // Allow columns to be shown (counting by priority and then right to
            // left) until we run out of room
            var empty = false;
            for (i = 0, ien = order.length; i < ien; i++) {
                var colIdx = order[i].columnIdx;

                if (display[colIdx] === '-' && !columns[colIdx].control && columns[colIdx].minWidth) {
                    // Once we've found a column that won't fit we don't let any
                    // others display either, or columns might disappear in the
                    // middle of the table
                    if (empty || usedWidth - columns[colIdx].minWidth < 0) {
                        empty = true;
                        display[colIdx] = false;
                    }
                    else {
                        display[colIdx] = true;
                    }

                    usedWidth -= columns[colIdx].minWidth;
                }
            }

            // Determine if the 'control' column should be shown (if there is one).
            // This is the case when there is a hidden column (that is not the
            // control column). The two loops look inefficient here, but they are
            // trivial and will fly through. We need to know the outcome from the
            // first , before the action in the second can be taken
            var showControl = false;

            for (i = 0, ien = columns.length; i < ien; i++) {
                if (!columns[i].control && !columns[i].never && !display[i]) {
                    showControl = true;
                    break;
                }
            }

            for (i = 0, ien = columns.length; i < ien; i++) {
                if (columns[i].control) {
                    display[i] = showControl;
                }
            }

            // Finally we need to make sure that there is at least one column that
            // is visible
            if ($.inArray(true, display) === -1) {
                display[0] = true;
            }

            return display;
        },


        /**
         * Create the internal 'columns' array with information about the columns
         * for the table. This includes determining which breakpoints the column
         * will appear in, based upon class names in the column, which makes up the
         * vast majority of this method.
         *
         * @private
         */
        _classLogic: function () {
            var that = this;
            var calc = {};
            var breakpoints = this.c.breakpoints;
            var dt = this.s.dt;
            var columns = dt.columns().eq(0).map(function (i) {
                var column = this.column(i);
                var className = column.header().className;
                var priority = dt.settings()[0].aoColumns[i].responsivePriority;

                if (priority === undefined) {
                    var dataPriority = $(column.header()).data('priority');

                    priority = dataPriority !== undefined ?
                        dataPriority * 1 :
                        10000;
                }

                return {
                    className: className,
                    includeIn: [],
                    auto: false,
                    control: false,
                    never: className.match(/\bnever\b/) ? true : false,
                    priority: priority
                };
            });

            // Simply add a breakpoint to 'includeIn' array, ensuring that there are
            // no duplicates
            var add = function (colIdx, name) {
                var includeIn = columns[colIdx].includeIn;

                if ($.inArray(name, includeIn) === -1) {
                    includeIn.push(name);
                }
            };

            var column = function (colIdx, name, operator, matched) {
                var size, i, ien;

                if (!operator) {
                    columns[colIdx].includeIn.push(name);
                }
                else if (operator === 'max-') {
                    // Add this breakpoint and all smaller
                    size = that._find(name).width;

                    for (i = 0, ien = breakpoints.length; i < ien; i++) {
                        if (breakpoints[i].width <= size) {
                            add(colIdx, breakpoints[i].name);
                        }
                    }
                }
                else if (operator === 'min-') {
                    // Add this breakpoint and all larger
                    size = that._find(name).width;

                    for (i = 0, ien = breakpoints.length; i < ien; i++) {
                        if (breakpoints[i].width >= size) {
                            add(colIdx, breakpoints[i].name);
                        }
                    }
                }
                else if (operator === 'not-') {
                    // Add all but this breakpoint
                    for (i = 0, ien = breakpoints.length; i < ien; i++) {
                        if (breakpoints[i].name.indexOf(matched) === -1) {
                            add(colIdx, breakpoints[i].name);
                        }
                    }
                }
            };

            // Loop over each column and determine if it has a responsive control
            // class
            columns.each(function (col, i) {
                var classNames = col.className.split(' ');
                var hasClass = false;

                // Split the class name up so multiple rules can be applied if needed
                for (var k = 0, ken = classNames.length; k < ken; k++) {
                    var className = $.trim(classNames[k]);

                    if (className === 'all') {
                        // Include in all
                        hasClass = true;
                        col.includeIn = $.map(breakpoints, function (a) {
                            return a.name;
                        });
                        return;
                    }
                    else if (className === 'none' || col.never) {
                        // Include in none (default) and no auto
                        hasClass = true;
                        return;
                    }
                    else if (className === 'control') {
                        // Special column that is only visible, when one of the other
                        // columns is hidden. This is used for the details control
                        hasClass = true;
                        col.control = true;
                        return;
                    }

                    $.each(breakpoints, function (j, breakpoint) {
                        // Does this column have a class that matches this breakpoint?
                        var brokenPoint = breakpoint.name.split('-');
                        var re = new RegExp('(min\\-|max\\-|not\\-)?(' + brokenPoint[0] + ')(\\-[_a-zA-Z0-9])?');
                        var match = className.match(re);

                        if (match) {
                            hasClass = true;

                            if (match[2] === brokenPoint[0] && match[3] === '-' + brokenPoint[1]) {
                                // Class name matches breakpoint name fully
                                column(i, breakpoint.name, match[1], match[2] + match[3]);
                            }
                            else if (match[2] === brokenPoint[0] && !match[3]) {
                                // Class name matched primary breakpoint name with no qualifier
                                column(i, breakpoint.name, match[1], match[2]);
                            }
                        }
                    });
                }

                // If there was no control class, then automatic sizing is used
                if (!hasClass) {
                    col.auto = true;
                }
            });

            this.s.columns = columns;
        },


        /**
         * Show the details for the child row
         *
         * @param  {DataTables.Api} row    API instance for the row
         * @param  {boolean}        update Update flag
         * @private
         */
        _detailsDisplay: function (row, update) {
            var that = this;
            var dt = this.s.dt;
            var details = this.c.details;

            if (details && details.type !== false) {
                var res = details.display(row, update, function () {
                    return details.renderer(
                        dt, row[0], that._detailsObj(row[0])
                    );
                });

                if (res === true || res === false) {
                    $(dt.table().node()).triggerHandler('responsive-display.dt', [dt, row, res, update]);
                }
            }
        },


        /**
         * Initialisation for the details handler
         *
         * @private
         */
        _detailsInit: function () {
            var that = this;
            var dt = this.s.dt;
            var details = this.c.details;

            // The inline type always uses the first child as the target
            if (details.type === 'inline') {
                details.target = 'td:first-child, th:first-child';
            }

            // Keyboard accessibility
            dt.on('draw.dtr', function () {
                that._tabIndexes();
            });
            that._tabIndexes(); // Initial draw has already happened

            $(dt.table().body()).on('keyup.dtr', 'td, th', function (e) {
                if (e.keyCode === 13 && $(this).data('dtr-keyboard')) {
                    $(this).click();
                }
            });

            // type.target can be a string jQuery selector or a column index
            var target = details.target;
            var selector = typeof target === 'string' ? target : 'td, th';

            // Click handler to show / hide the details rows when they are available
            $(dt.table().body())
                .on('click.dtr mousedown.dtr mouseup.dtr', selector, function (e) {
                    // If the table is not collapsed (i.e. there is no hidden columns)
                    // then take no action
                    if (!$(dt.table().node()).hasClass('collapsed')) {
                        return;
                    }

                    // Check that the row is actually a DataTable's controlled node
                    if (!dt.row($(this).closest('tr')).length) {
                        return;
                    }

                    // For column index, we determine if we should act or not in the
                    // handler - otherwise it is already okay
                    if (typeof target === 'number') {
                        var targetIdx = target < 0 ?
                            dt.columns().eq(0).length + target :
                            target;

                        if (dt.cell(this).index().column !== targetIdx) {
                            return;
                        }
                    }

                    // $().closest() includes itself in its check
                    var row = dt.row($(this).closest('tr'));

                    // Check event type to do an action
                    if (e.type === 'click') {
                        // The renderer is given as a function so the caller can execute it
                        // only when they need (i.e. if hiding there is no point is running
                        // the renderer)
                        that._detailsDisplay(row, false);
                    }
                    else if (e.type === 'mousedown') {
                        // For mouse users, prevent the focus ring from showing
                        $(this).css('outline', 'none');
                    }
                    else if (e.type === 'mouseup') {
                        // And then re-allow at the end of the click
                        $(this).blur().css('outline', '');
                    }
                });
        },


        /**
         * Get the details to pass to a renderer for a row
         * @param  {int} rowIdx Row index
         * @private
         */
        _detailsObj: function (rowIdx) {
            var that = this;
            var dt = this.s.dt;

            return $.map(this.s.columns, function (col, i) {
                // Never and control columns should not be passed to the renderer
                if (col.never || col.control) {
                    return;
                }

                return {
                    title: dt.settings()[0].aoColumns[i].sTitle,
                    data: dt.cell(rowIdx, i).render(that.c.orthogonal),
                    hidden: dt.column(i).visible() && !that.s.current[i],
                    columnIndex: i,
                    rowIndex: rowIdx
                };
            });
        },


        /**
         * Find a breakpoint object from a name
         *
         * @param  {string} name Breakpoint name to find
         * @return {object}      Breakpoint description object
         * @private
         */
        _find: function (name) {
            var breakpoints = this.c.breakpoints;

            for (var i = 0, ien = breakpoints.length; i < ien; i++) {
                if (breakpoints[i].name === name) {
                    return breakpoints[i];
                }
            }
        },


        /**
         * Re-create the contents of the child rows as the display has changed in
         * some way.
         *
         * @private
         */
        _redrawChildren: function () {
            var that = this;
            var dt = this.s.dt;

            dt.rows({ page: 'current' }).iterator('row', function (settings, idx) {
                var row = dt.row(idx);

                that._detailsDisplay(dt.row(idx), true);
            });
        },


        /**
         * Alter the table display for a resized viewport. This involves first
         * determining what breakpoint the window currently is in, getting the
         * column visibilities to apply and then setting them.
         *
         * @private
         */
        _resize: function () {
            var that = this;
            var dt = this.s.dt;
            var width = $(window).width();
            var breakpoints = this.c.breakpoints;
            var breakpoint = breakpoints[0].name;
            var columns = this.s.columns;
            var i, ien;
            var oldVis = this.s.current.slice();

            // Determine what breakpoint we are currently at
            for (i = breakpoints.length - 1; i >= 0; i--) {
                if (width <= breakpoints[i].width) {
                    breakpoint = breakpoints[i].name;
                    break;
                }
            }

            // Show the columns for that break point
            var columnsVis = this._columnsVisiblity(breakpoint);
            this.s.current = columnsVis;

            // Set the class before the column visibility is changed so event
            // listeners know what the state is. Need to determine if there are
            // any columns that are not visible but can be shown
            var collapsedClass = false;
            for (i = 0, ien = columns.length; i < ien; i++) {
                if (columnsVis[i] === false && !columns[i].never && !columns[i].control) {
                    collapsedClass = true;
                    break;
                }
            }

            $(dt.table().node()).toggleClass('collapsed', collapsedClass);

            var changed = false;

            dt.columns().eq(0).each(function (colIdx, i) {
                if (columnsVis[i] !== oldVis[i]) {
                    changed = true;
                    that._setColumnVis(colIdx, columnsVis[i]);
                }
            });

            if (changed) {
                this._redrawChildren();

                // Inform listeners of the change
                $(dt.table().node()).trigger('responsive-resize.dt', [dt, this.s.current]);
            }
        },


        /**
         * Determine the width of each column in the table so the auto column hiding
         * has that information to work with. This method is never going to be 100%
         * perfect since column widths can change slightly per page, but without
         * seriously compromising performance this is quite effective.
         *
         * @private
         */
        _resizeAuto: function () {
            var dt = this.s.dt;
            var columns = this.s.columns;

            // Are we allowed to do auto sizing?
            if (!this.c.auto) {
                return;
            }

            // Are there any columns that actually need auto-sizing, or do they all
            // have classes defined
            if ($.inArray(true, $.map(columns, function (c) { return c.auto; })) === -1) {
                return;
            }

            // Clone the table with the current data in it
            var tableWidth = dt.table().node().offsetWidth;
            var columnWidths = dt.columns;
            var clonedTable = dt.table().node().cloneNode(false);
            var clonedHeader = $(dt.table().header().cloneNode(false)).appendTo(clonedTable);
            var clonedBody = $(dt.table().body()).clone(false, false).empty().appendTo(clonedTable); // use jQuery because of IE8

            // Header
            var headerCells = dt.columns()
                .header()
                .filter(function (idx) {
                    return dt.column(idx).visible();
                })
                .to$()
                .clone(false)
                .css('display', 'table-cell');

            // Body rows - we don't need to take account of DataTables' column
            // visibility since we implement our own here (hence the 'display' set)
            $(clonedBody)
                .append($(dt.rows({ page: 'current' }).nodes()).clone(false))
                .find('th, td').css('display', '');

            // Footer
            var footer = dt.table().footer();
            if (footer) {
                var clonedFooter = $(footer.cloneNode(false)).appendTo(clonedTable);
                var footerCells = dt.columns()
                    .footer()
                    .filter(function (idx) {
                        return dt.column(idx).visible();
                    })
                    .to$()
                    .clone(false)
                    .css('display', 'table-cell');

                $('<tr/>')
                    .append(footerCells)
                    .appendTo(clonedFooter);
            }

            $('<tr/>')
                .append(headerCells)
                .appendTo(clonedHeader);

            // In the inline case extra padding is applied to the first column to
            // give space for the show / hide icon. We need to use this in the
            // calculation
            if (this.c.details.type === 'inline') {
                $(clonedTable).addClass('dtr-inline collapsed');
            }

            // It is unsafe to insert elements with the same name into the DOM
            // multiple times. For example, cloning and inserting a checked radio
            // clears the chcecked state of the original radio.
            $(clonedTable).find('[name]').removeAttr('name');

            var inserted = $('<div/>')
                .css({
                    width: 1,
                    height: 1,
                    overflow: 'hidden'
                })
                .append(clonedTable);

            inserted.insertBefore(dt.table().node());

            // The cloned header now contains the smallest that each column can be
            headerCells.each(function (i) {
                var idx = dt.column.index('fromVisible', i);
                columns[idx].minWidth = this.offsetWidth || 0;
            });

            inserted.remove();
        },

        /**
         * Set a column's visibility.
         *
         * We don't use DataTables' column visibility controls in order to ensure
         * that column visibility can Responsive can no-exist. Since only IE8+ is
         * supported (and all evergreen browsers of course) the control of the
         * display attribute works well.
         *
         * @param {integer} col      Column index
         * @param {boolean} showHide Show or hide (true or false)
         * @private
         */
        _setColumnVis: function (col, showHide) {
            var dt = this.s.dt;
            var display = showHide ? '' : 'none'; // empty string will remove the attr

            $(dt.column(col).header()).css('display', display);
            $(dt.column(col).footer()).css('display', display);
            dt.column(col).nodes().to$().css('display', display);
        },


        /**
         * Update the cell tab indexes for keyboard accessibility. This is called on
         * every table draw - that is potentially inefficient, but also the least
         * complex option given that column visibility can change on the fly. Its a
         * shame user-focus was removed from CSS 3 UI, as it would have solved this
         * issue with a single CSS statement.
         *
         * @private
         */
        _tabIndexes: function () {
            var dt = this.s.dt;
            var cells = dt.cells({ page: 'current' }).nodes().to$();
            var ctx = dt.settings()[0];
            var target = this.c.details.target;

            cells.filter('[data-dtr-keyboard]').removeData('[data-dtr-keyboard]');

            var selector = typeof target === 'number' ?
                ':eq(' + target + ')' :
                target;

            $(selector, dt.rows({ page: 'current' }).nodes())
                .attr('tabIndex', ctx.iTabIndex)
                .data('dtr-keyboard', 1);
        }
    });


    /**
     * List of default breakpoints. Each item in the array is an object with two
     * properties:
     *
     * * 'name' - the breakpoint name.
     * * 'width' - the breakpoint width
     *
     * @name Responsive.breakpoints
     * @static
     */
    Responsive.breakpoints = [
        { name: 'desktop', width: Infinity },
        { name: 'tablet-l', width: 1024 },
        { name: 'tablet-p', width: 768 },
        { name: 'mobile-l', width: 480 },
        { name: 'mobile-p', width: 320 }
    ];


    /**
     * Display methods - functions which define how the hidden data should be shown
     * in the table.
     *
     * @namespace
     * @name Responsive.defaults
     * @static
     */
    Responsive.display = {
        childRow: function (row, update, render) {
            if (update) {
                if ($(row.node()).hasClass('parent')) {
                    row.child(render(), 'child').show();

                    return true;
                }
            }
            else {
                if (!row.child.isShown()) {
                    row.child(render(), 'child').show();
                    $(row.node()).addClass('parent');

                    return true;
                }
                else {
                    row.child(false);
                    $(row.node()).removeClass('parent');

                    return false;
                }
            }
        },

        childRowImmediate: function (row, update, render) {
            if ((!update && row.child.isShown()) || !row.responsive.hasHidden()) {
                // User interaction and the row is show, or nothing to show
                row.child(false);
                $(row.node()).removeClass('parent');

                return false;
            }
            else {
                // Display
                row.child(render(), 'child').show();
                $(row.node()).addClass('parent');

                return true;
            }
        },

        // This is a wrapper so the modal options for Bootstrap and jQuery UI can
        // have options passed into them. This specific one doesn't need to be a
        // function but it is for consistency in the 'modal' name
        modal: function (options) {
            return function (row, update, render) {
                if (!update) {
                    // Show a modal
                    var close = function () {
                        modal.remove(); // will tidy events for us
                        $(document).off('keypress.dtr');
                    };

                    var modal = $('<div class="dtr-modal"/>')
                        .append($('<div class="dtr-modal-display"/>')
                            .append($('<div class="dtr-modal-content"/>')
                                .append(render())
                            )
                            .append($('<div class="dtr-modal-close">&times;</div>')
                                .click(function () {
                                    close();
                                })
                            )
                        )
                        .append($('<div class="dtr-modal-background"/>')
                            .click(function () {
                                close();
                            })
                        )
                        .appendTo('body');

                    $(document).on('keyup.dtr', function (e) {
                        if (e.keyCode === 27) {
                            e.stopPropagation();

                            close();
                        }
                    });
                }
                else {
                    $('div.dtr-modal-content')
                        .empty()
                        .append(render());
                }

                if (options && options.header) {
                    $('div.dtr-modal-content').prepend(
                        '<h2>' + options.header(row) + '</h2>'
                    );
                }
            };
        }
    };


    /**
     * Display methods - functions which define how the hidden data should be shown
     * in the table.
     *
     * @namespace
     * @name Responsive.defaults
     * @static
     */
    Responsive.renderer = {
        listHidden: function () {
            return function (api, rowIdx, columns) {
                var data = $.map(columns, function (col) {
                    return col.hidden ?
                        '<li data-dtr-index="' + col.columnIndex + '" data-dt-row="' + col.rowIndex + '" data-dt-column="' + col.columnIndex + '">' +
                        '<span class="dtr-title">' +
                        col.title +
                        '</span> ' +
                        '<span class="dtr-data">' +
                        col.data +
                        '</span>' +
                        '</li>' :
                        '';
                }).join('');

                return data ?
                    $('<ul data-dtr-index="' + rowIdx + '"/>').append(data) :
                    false;
            }
        },

        tableAll: function (options) {
            options = $.extend({
                tableClass: ''
            }, options);

            return function (api, rowIdx, columns) {
                var data = $.map(columns, function (col) {
                    return '<tr data-dt-row="' + col.rowIndex + '" data-dt-column="' + col.columnIndex + '">' +
                        '<td>' + col.title + ':' + '</td> ' +
                        '<td>' + col.data + '</td>' +
                        '</tr>';
                }).join('');

                return $('<table class="' + options.tableClass + '" width="100%"/>').append(data);
            }
        }
    };

    /**
     * Responsive default settings for initialisation
     *
     * @namespace
     * @name Responsive.defaults
     * @static
     */
    Responsive.defaults = {
        /**
         * List of breakpoints for the instance. Note that this means that each
         * instance can have its own breakpoints. Additionally, the breakpoints
         * cannot be changed once an instance has been creased.
         *
         * @type {Array}
         * @default Takes the value of 'Responsive.breakpoints'
         */
        breakpoints: Responsive.breakpoints,

        /**
         * Enable / disable auto hiding calculations. It can help to increase
         * performance slightly if you disable this option, but all columns would
         * need to have breakpoint classes assigned to them
         *
         * @type {Boolean}
         * @default  'true'
         */
        auto: true,

        /**
         * Details control. If given as a string value, the 'type' property of the
         * default object is set to that value, and the defaults used for the rest
         * of the object - this is for ease of implementation.
         *
         * The object consists of the following properties:
         *
         * * 'display' - A function that is used to show and hide the hidden details
         * * 'renderer' - function that is called for display of the child row data.
         *   The default function will show the data from the hidden columns
         * * 'target' - Used as the selector for what objects to attach the child
         *   open / close to
         * * 'type' - 'false' to disable the details display, 'inline' or 'column'
         *   for the two control types
         *
         * @type {Object|string}
         */
        details: {
            display: Responsive.display.childRow,

            renderer: Responsive.renderer.listHidden(),

            target: 0,

            type: 'inline'
        },

        /**
         * Orthogonal data request option. This is used to define the data type
         * requested when Responsive gets the data to show in the child row.
         *
         * @type {String}
         */
        orthogonal: 'display'
    };


    /*
     * API
     */
    var Api = $.fn.dataTable.Api;

    // Doesn't do anything - work around for a bug in DT... Not documented
    Api.register('responsive()', function () {
        return this;
    });

    Api.register('responsive.index()', function (li) {
        li = $(li);

        return {
            column: li.data('dtr-index'),
            row: li.parent().data('dtr-index')
        };
    });

    Api.register('responsive.rebuild()', function () {
        return this.iterator('table', function (ctx) {
            if (ctx._responsive) {
                ctx._responsive._classLogic();
            }
        });
    });

    Api.register('responsive.recalc()', function () {
        return this.iterator('table', function (ctx) {
            if (ctx._responsive) {
                ctx._responsive._resizeAuto();
                ctx._responsive._resize();
            }
        });
    });

    Api.register('responsive.hasHidden()', function () {
        var ctx = this.context[0];

        return ctx._responsive ?
            $.inArray(false, ctx._responsive.s.current) !== -1 :
            false;
    });


    /**
     * Version information
     *
     * @name Responsive.version
     * @static
     */
    Responsive.version = '2.1.0';


    $.fn.dataTable.Responsive = Responsive;
    $.fn.DataTable.Responsive = Responsive;

    // Attach a listener to the document which listens for DataTables initialisation
    // events so we can automatically initialise
    $(document).on('preInit.dt.dtr', function (e, settings, json) {
        if (e.namespace !== 'dt') {
            return;
        }

        if ($(settings.nTable).hasClass('responsive') ||
            $(settings.nTable).hasClass('dt-responsive') ||
            settings.oInit.responsive ||
            DataTable.defaults.responsive
        ) {
            var init = settings.oInit.responsive;

            if (init !== false) {
                new Responsive(settings, $.isPlainObject(init) ? init : {});
            }
        }
    });


    return Responsive;
}));

/*!
 Buttons for DataTables 1.2.0
 Â©2016 SpryMedia Ltd - datatables.net/license
*/
(function (d) { "function" === typeof define && define.amd ? define(["jquery", "datatables.net"], function (o) { return d(o, window, document) }) : "object" === typeof exports ? module.exports = function (o, n) { o || (o = window); if (!n || !n.fn.dataTable) n = require("datatables.net")(o, n).$; return d(n, o, o.document) } : d(jQuery, window, document) })(function (d, o, n, l) {
    var i = d.fn.dataTable, u = 0, v = 0, k = i.ext.buttons, m = function (a, b) {
    !0 === b && (b = {}); d.isArray(b) && (b = { buttons: b }); this.c = d.extend(!0, {}, m.defaults, b); b.buttons && (this.c.buttons = b.buttons);
        this.s = { dt: new i.Api(a), buttons: [], listenKeys: "", namespace: "dtb" + u++ }; this.dom = { container: d("<" + this.c.dom.container.tag + "/>").addClass(this.c.dom.container.className) }; this._constructor()
    }; d.extend(m.prototype, {
        action: function (a, b) { var c = this._nodeToButton(a); if (b === l) return c.conf.action; c.conf.action = b; return this }, active: function (a, b) { var c = this._nodeToButton(a), e = this.c.dom.button.active, c = d(c.node); if (b === l) return c.hasClass(e); c.toggleClass(e, b === l ? !0 : b); return this }, add: function (a, b) {
            var c =
                this.s.buttons; if ("string" === typeof b) { for (var e = b.split("-"), c = this.s, d = 0, h = e.length - 1; d < h; d++)c = c.buttons[1 * e[d]]; c = c.buttons; b = 1 * e[e.length - 1] } this._expandButton(c, a, !1, b); this._draw(); return this
        }, container: function () { return this.dom.container }, disable: function (a) { a = this._nodeToButton(a); d(a.node).addClass(this.c.dom.button.disabled); return this }, destroy: function () {
            d("body").off("keyup." + this.s.namespace); var a = this.s.buttons, b, c; b = 0; for (c = a.length; b < c; b++)this.remove(a[b].node); this.dom.container.remove();
            a = this.s.dt.settings()[0]; b = 0; for (c = a.length; b < c; b++)if (a.inst === this) { a.splice(b, 1); break } return this
        }, enable: function (a, b) { if (!1 === b) return this.disable(a); var c = this._nodeToButton(a); d(c.node).removeClass(this.c.dom.button.disabled); return this }, name: function () { return this.c.name }, node: function (a) { a = this._nodeToButton(a); return d(a.node) }, remove: function (a) {
            var b = this._nodeToButton(a), c = this._nodeToHost(a), e = this.s.dt; if (b.buttons.length) for (var g = b.buttons.length - 1; 0 <= g; g--)this.remove(b.buttons[g].node);
            b.conf.destroy && b.conf.destroy.call(e.button(a), e, d(a), b.conf); this._removeKey(b.conf); d(b.node).remove(); a = d.inArray(b, c); c.splice(a, 1); return this
        }, text: function (a, b) { var c = this._nodeToButton(a), e = this.c.dom.collection.buttonLiner, e = c.inCollection && e && e.tag ? e.tag : this.c.dom.buttonLiner.tag, g = this.s.dt, h = d(c.node), f = function (a) { return "function" === typeof a ? a(g, h, c.conf) : a }; if (b === l) return f(c.conf.text); c.conf.text = b; e ? h.children(e).html(f(b)) : h.html(f(b)); return this }, _constructor: function () {
            var a =
                this, b = this.s.dt, c = b.settings()[0], e = this.c.buttons; c._buttons || (c._buttons = []); c._buttons.push({ inst: this, name: this.c.name }); for (var c = 0, g = e.length; c < g; c++)this.add(e[c]); b.on("destroy", function () { a.destroy() }); d("body").on("keyup." + this.s.namespace, function (b) { if (!n.activeElement || n.activeElement === n.body) { var c = String.fromCharCode(b.keyCode).toLowerCase(); a.s.listenKeys.toLowerCase().indexOf(c) !== -1 && a._keypress(c, b) } })
        }, _addKey: function (a) {
        a.key && (this.s.listenKeys += d.isPlainObject(a.key) ? a.key.key :
            a.key)
        }, _draw: function (a, b) { a || (a = this.dom.container, b = this.s.buttons); a.children().detach(); for (var c = 0, d = b.length; c < d; c++)a.append(b[c].inserter), b[c].buttons && b[c].buttons.length && this._draw(b[c].collection, b[c].buttons) }, _expandButton: function (a, b, c, e) {
            for (var g = this.s.dt, h = 0, b = !d.isArray(b) ? [b] : b, f = 0, q = b.length; f < q; f++) {
                var j = this._resolveExtends(b[f]); if (j) if (d.isArray(j)) this._expandButton(a, j, c, e); else {
                    var p = this._buildButton(j, c); if (p) {
                        e !== l ? (a.splice(e, 0, p), e++) : a.push(p); if (p.conf.buttons) {
                            var s =
                                this.c.dom.collection; p.collection = d("<" + s.tag + "/>").addClass(s.className); p.conf._collection = p.collection; this._expandButton(p.buttons, p.conf.buttons, !0, e)
                        } j.init && j.init.call(g.button(p.node), g, d(p.node), j); h++
                    }
                }
            }
        }, _buildButton: function (a, b) {
            var c = this.c.dom.button, e = this.c.dom.buttonLiner, g = this.c.dom.collection, h = this.s.dt, f = function (b) { return "function" === typeof b ? b(h, j, a) : b }; b && g.button && (c = g.button); b && g.buttonLiner && (e = g.buttonLiner); if (a.available && !a.available(h, a)) return !1; var q = function (a,
                b, c, e) { e.action.call(b.button(c), a, b, c, e); d(b.table().node()).triggerHandler("buttons-action.dt", [b.button(c), b, c, e]) }, j = d("<" + c.tag + "/>").addClass(c.className).attr("tabindex", this.s.dt.settings()[0].iTabIndex).attr("aria-controls", this.s.dt.table().node().id).on("click.dtb", function (b) { b.preventDefault(); !j.hasClass(c.disabled) && a.action && q(b, h, j, a); j.blur() }).on("keyup.dtb", function (b) { b.keyCode === 13 && !j.hasClass(c.disabled) && a.action && q(b, h, j, a) }); "a" === c.tag.toLowerCase() && j.attr("href", "#");
            e.tag ? (g = d("<" + e.tag + "/>").html(f(a.text)).addClass(e.className), "a" === e.tag.toLowerCase() && g.attr("href", "#"), j.append(g)) : j.html(f(a.text)); !1 === a.enabled && j.addClass(c.disabled); a.className && j.addClass(a.className); a.titleAttr && j.attr("title", a.titleAttr); a.namespace || (a.namespace = ".dt-button-" + v++); e = (e = this.c.dom.buttonContainer) && e.tag ? d("<" + e.tag + "/>").addClass(e.className).append(j) : j; this._addKey(a); return { conf: a, node: j.get(0), inserter: e, buttons: [], inCollection: b, collection: null }
        }, _nodeToButton: function (a,
            b) { b || (b = this.s.buttons); for (var c = 0, d = b.length; c < d; c++) { if (b[c].node === a) return b[c]; if (b[c].buttons.length) { var g = this._nodeToButton(a, b[c].buttons); if (g) return g } } }, _nodeToHost: function (a, b) { b || (b = this.s.buttons); for (var c = 0, d = b.length; c < d; c++) { if (b[c].node === a) return b; if (b[c].buttons.length) { var g = this._nodeToHost(a, b[c].buttons); if (g) return g } } }, _keypress: function (a, b) {
                var c = function (e) {
                    for (var g = 0, h = e.length; g < h; g++) {
                        var f = e[g].conf, q = e[g].node; if (f.key) if (f.key === a) d(q).click(); else if (d.isPlainObject(f.key) &&
                            f.key.key === a && (!f.key.shiftKey || b.shiftKey)) if (!f.key.altKey || b.altKey) if (!f.key.ctrlKey || b.ctrlKey) (!f.key.metaKey || b.metaKey) && d(q).click(); e[g].buttons.length && c(e[g].buttons)
                    }
                }; c(this.s.buttons)
            }, _removeKey: function (a) { if (a.key) { var b = d.isPlainObject(a.key) ? a.key.key : a.key, a = this.s.listenKeys.split(""), b = d.inArray(b, a); a.splice(b, 1); this.s.listenKeys = a.join("") } }, _resolveExtends: function (a) {
                for (var b = this.s.dt, c, e, g = function (c) {
                    for (var e = 0; !d.isPlainObject(c) && !d.isArray(c);) {
                        if (c === l) return;
                        if ("function" === typeof c) { if (c = c(b, a), !c) return !1 } else if ("string" === typeof c) { if (!k[c]) throw "Unknown button type: " + c; c = k[c] } e++; if (30 < e) throw "Buttons: Too many iterations";
                    } return d.isArray(c) ? c : d.extend({}, c)
                }, a = g(a); a && a.extend;) {
                    if (!k[a.extend]) throw "Cannot extend unknown button type: " + a.extend; var h = g(k[a.extend]); if (d.isArray(h)) return h; if (!h) return !1; c = h.className; a = d.extend({}, h, a); c && a.className !== c && (a.className = c + " " + a.className); var f = a.postfixButtons; if (f) {
                    a.buttons || (a.buttons = []);
                        c = 0; for (e = f.length; c < e; c++)a.buttons.push(f[c]); a.postfixButtons = null
                    } if (f = a.prefixButtons) { a.buttons || (a.buttons = []); c = 0; for (e = f.length; c < e; c++)a.buttons.splice(c, 0, f[c]); a.prefixButtons = null } a.extend = h.extend
                } return a
            }
    }); m.background = function (a, b, c) { c === l && (c = 400); a ? d("<div/>").addClass(b).css("display", "none").appendTo("body").fadeIn(c) : d("body > div." + b).fadeOut(c, function () { d(this).remove() }) }; m.instanceSelector = function (a, b) {
        if (!a) return d.map(b, function (a) { return a.inst }); var c = [], e = d.map(b,
            function (a) { return a.name }), g = function (a) { if (d.isArray(a)) for (var f = 0, q = a.length; f < q; f++)g(a[f]); else "string" === typeof a ? -1 !== a.indexOf(",") ? g(a.split(",")) : (a = d.inArray(d.trim(a), e), -1 !== a && c.push(b[a].inst)) : "number" === typeof a && c.push(b[a].inst) }; g(a); return c
    }; m.buttonSelector = function (a, b) {
        for (var c = [], e = function (a, b, c) { for (var d, g, f = 0, h = b.length; f < h; f++)if (d = b[f]) g = c !== l ? c + f : f + "", a.push({ node: d.node, name: d.conf.name, idx: g }), d.buttons && e(a, d.buttons, g + "-") }, g = function (a, b) {
            var f, h, i = []; e(i, b.s.buttons);
            f = d.map(i, function (a) { return a.node }); if (d.isArray(a) || a instanceof d) { f = 0; for (h = a.length; f < h; f++)g(a[f], b) } else if (null === a || a === l || "*" === a) { f = 0; for (h = i.length; f < h; f++)c.push({ inst: b, node: i[f].node }) } else if ("number" === typeof a) c.push({ inst: b, node: b.s.buttons[a].node }); else if ("string" === typeof a) if (-1 !== a.indexOf(",")) { i = a.split(","); f = 0; for (h = i.length; f < h; f++)g(d.trim(i[f]), b) } else if (a.match(/^\d+(\-\d+)*$/)) f = d.map(i, function (a) { return a.idx }), c.push({ inst: b, node: i[d.inArray(a, f)].node }); else if (-1 !==
                a.indexOf(":name")) { var k = a.replace(":name", ""); f = 0; for (h = i.length; f < h; f++)i[f].name === k && c.push({ inst: b, node: i[f].node }) } else d(f).filter(a).each(function () { c.push({ inst: b, node: this }) }); else "object" === typeof a && a.nodeName && (i = d.inArray(a, f), -1 !== i && c.push({ inst: b, node: f[i] }))
        }, h = 0, f = a.length; h < f; h++)g(b, a[h]); return c
    }; m.defaults = {
        buttons: ["copy", "excel", "csv", "pdf", "print"], name: "main", tabIndex: 0, dom: {
            container: { tag: "div", className: "dt-buttons" }, collection: { tag: "div", className: "dt-button-collection" },
            button: { tag: "a", className: "dt-button", active: "active", disabled: "disabled" }, buttonLiner: { tag: "span", className: "" }
        }
    }; m.version = "1.2.0"; d.extend(k, {
        collection: {
            text: function (a) { return a.i18n("buttons.collection", "Collection") }, className: "buttons-collection", action: function (a, b, c, e) {
                var a = c.offset(), g = d(b.table().container()), h = !1; d("div.dt-button-background").length && (h = d("div.dt-button-collection").offset(), d("body").trigger("click.dtb-collection")); e._collection.addClass(e.collectionLayout).css("display",
                    "none").appendTo("body").fadeIn(e.fade); var f = e._collection.css("position"); h && "absolute" === f ? e._collection.css({ top: h.top + 5, left: h.left + 5 }) : "absolute" === f ? (e._collection.css({ top: a.top + c.outerHeight(), left: a.left }), c = a.left + e._collection.outerWidth(), g = g.offset().left + g.width(), c > g && e._collection.css("left", a.left - (c - g))) : (a = e._collection.height() / 2, a > d(o).height() / 2 && (a = d(o).height() / 2), e._collection.css("marginTop", -1 * a)); e.background && m.background(!0, e.backgroundClassName, e.fade); setTimeout(function () {
                        d("div.dt-button-background").on("click.dtb-collection",
                            function () { }); d("body").on("click.dtb-collection", function (a) { if (!d(a.target).parents().andSelf().filter(e._collection).length) { e._collection.fadeOut(e.fade, function () { e._collection.detach() }); d("div.dt-button-background").off("click.dtb-collection"); m.background(false, e.backgroundClassName, e.fade); d("body").off("click.dtb-collection"); b.off("buttons-action.b-internal") } })
                    }, 10); if (e.autoClose) b.on("buttons-action.b-internal", function () { d("div.dt-button-background").click() })
            }, background: !0, collectionLayout: "",
            backgroundClassName: "dt-button-background", autoClose: !1, fade: 400
        }, copy: function (a, b) { if (k.copyHtml5) return "copyHtml5"; if (k.copyFlash && k.copyFlash.available(a, b)) return "copyFlash" }, csv: function (a, b) { if (k.csvHtml5 && k.csvHtml5.available(a, b)) return "csvHtml5"; if (k.csvFlash && k.csvFlash.available(a, b)) return "csvFlash" }, excel: function (a, b) { if (k.excelHtml5 && k.excelHtml5.available(a, b)) return "excelHtml5"; if (k.excelFlash && k.excelFlash.available(a, b)) return "excelFlash" }, pdf: function (a, b) {
            if (k.pdfHtml5 && k.pdfHtml5.available(a,
                b)) return "pdfHtml5"; if (k.pdfFlash && k.pdfFlash.available(a, b)) return "pdfFlash"
        }, pageLength: function (a) {
            var a = a.settings()[0].aLengthMenu, b = d.isArray(a[0]) ? a[0] : a, c = d.isArray(a[0]) ? a[1] : a, e = function (a) { return a.i18n("buttons.pageLength", { "-1": "Show all rows", _: "Show %d rows" }, a.page.len()) }; return {
                extend: "collection", text: e, className: "buttons-page-length", autoClose: !0, buttons: d.map(b, function (a, b) {
                    return {
                        text: c[b], action: function (b, c) { c.page.len(a).draw() }, init: function (b, c, d) {
                            var e = this, c = function () {
                                e.active(b.page.len() ===
                                    a)
                            }; b.on("length.dt" + d.namespace, c); c()
                        }, destroy: function (a, b, c) { a.off("length.dt" + c.namespace) }
                    }
                }), init: function (a, b, c) { var d = this; a.on("length.dt" + c.namespace, function () { d.text(e(a)) }) }, destroy: function (a, b, c) { a.off("length.dt" + c.namespace) }
            }
        }
    }); i.Api.register("buttons()", function (a, b) { b === l && (b = a, a = l); return this.iterator(!0, "table", function (c) { if (c._buttons) return m.buttonSelector(m.instanceSelector(a, c._buttons), b) }, !0) }); i.Api.register("button()", function (a, b) {
        var c = this.buttons(a, b); 1 < c.length &&
            c.splice(1, c.length); return c
    }); i.Api.registerPlural("buttons().active()", "button().active()", function (a) { return a === l ? this.map(function (a) { return a.inst.active(a.node) }) : this.each(function (b) { b.inst.active(b.node, a) }) }); i.Api.registerPlural("buttons().action()", "button().action()", function (a) { return a === l ? this.map(function (a) { return a.inst.action(a.node) }) : this.each(function (b) { b.inst.action(b.node, a) }) }); i.Api.register(["buttons().enable()", "button().enable()"], function (a) {
        return this.each(function (b) {
            b.inst.enable(b.node,
                a)
        })
    }); i.Api.register(["buttons().disable()", "button().disable()"], function () { return this.each(function (a) { a.inst.disable(a.node) }) }); i.Api.registerPlural("buttons().nodes()", "button().node()", function () { var a = d(); d(this.each(function (b) { a = a.add(b.inst.node(b.node)) })); return a }); i.Api.registerPlural("buttons().text()", "button().text()", function (a) { return a === l ? this.map(function (a) { return a.inst.text(a.node) }) : this.each(function (b) { b.inst.text(b.node, a) }) }); i.Api.registerPlural("buttons().trigger()",
        "button().trigger()", function () { return this.each(function (a) { a.inst.node(a.node).trigger("click") }) }); i.Api.registerPlural("buttons().containers()", "buttons().container()", function () { var a = d(); d(this.each(function (b) { a = a.add(b.inst.container()) })); return a }); i.Api.register("button().add()", function (a, b) { 1 === this.length && this[0].inst.add(b, a); return this.button(a) }); i.Api.register("buttons().destroy()", function () { this.pluck("inst").unique().each(function (a) { a.destroy() }); return this }); i.Api.registerPlural("buttons().remove()",
            "buttons().remove()", function () { this.each(function (a) { a.inst.remove(a.node) }); return this }); var r; i.Api.register("buttons.info()", function (a, b, c) {
                var e = this; if (!1 === a) return d("#datatables_buttons_info").fadeOut(function () { d(this).remove() }), clearTimeout(r), r = null, this; r && clearTimeout(r); d("#datatables_buttons_info").length && d("#datatables_buttons_info").remove(); d('<div id="datatables_buttons_info" class="dt-button-info"/>').html(a ? "<h2>" + a + "</h2>" : "").append(d("<div/>")["string" === typeof b ? "html" :
                    "append"](b)).css("display", "none").appendTo("body").fadeIn(); c !== l && 0 !== c && (r = setTimeout(function () { e.buttons.info(!1) }, c)); return this
            }); i.Api.register("buttons.exportData()", function (a) {
                if (this.context.length) {
                    for (var b = new i.Api(this.context[0]), c = d.extend(!0, {}, { rows: null, columns: "", modifier: { search: "applied", order: "applied" }, orthogonal: "display", stripHtml: !0, stripNewlines: !0, decodeEntities: !0, trim: !0, format: { header: function (a) { return e(a) }, footer: function (a) { return e(a) }, body: function (a) { return e(a) } } },
                        a), e = function (a) { if ("string" !== typeof a) return a; c.stripHtml && (a = a.replace(/<[^>]*>/g, "")); c.trim && (a = a.replace(/^\s+|\s+$/g, "")); c.stripNewlines && (a = a.replace(/\n/g, " ")); c.decodeEntities && (t.innerHTML = a, a = t.value); return a }, a = b.columns(c.columns).indexes().map(function (a) { return c.format.header(b.column(a).header().innerHTML, a) }).toArray(), g = b.table().footer() ? b.columns(c.columns).indexes().map(function (a) { var d = b.column(a).footer(); return c.format.footer(d ? d.innerHTML : "", a) }).toArray() : null, h =
                            b.rows(c.rows, c.modifier).indexes().toArray(), h = b.cells(h, c.columns).render(c.orthogonal).toArray(), f = a.length, k = 0 < f ? h.length / f : 0, j = Array(k), m = 0, l = 0; l < k; l++) { for (var o = Array(f), n = 0; n < f; n++)o[n] = c.format.body(h[m], n, l), m++; j[l] = o } return { header: a, footer: g, body: j }
                }
            }); var t = d("<textarea/>")[0]; d.fn.dataTable.Buttons = m; d.fn.DataTable.Buttons = m; d(n).on("init.dt plugin-init.dt", function (a, b) { if ("dt" === a.namespace) { var c = b.oInit.buttons || i.defaults.buttons; c && !b._buttons && (new m(b, c)).container() } }); i.ext.feature.push({
                fnInit: function (a) {
                    var a =
                        new i.Api(a), b = a.init().buttons || i.defaults.buttons; return (new m(a, b)).container()
                }, cFeature: "B"
            }); return m
});

Math.randomString = function (n) { for (var text = "", possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", i = 0; n > i; i++)text += possible.charAt(Math.floor(Math.random() * possible.length)); return text }, String.prototype.getCss = function () { for (var css = {}, style = this.valueOf().split(";"), i = 0; i < style.length; i++)if (style[i] = $.trim(style[i]), style[i]) { var s = style[i].split(":"); css[$.trim(s[0])] = $.trim(s[1]) } return css }, String.prototype.trim = function () { return this.replace(/^\s+|\s+$/g, "") }, String.prototype.toCamel = function () { return this.replace(/(\-[a-z])/g, function ($1) { return $1.toUpperCase().replace("-", "") }) }, String.prototype.toDash = function () { return this.replace(/([A-Z])/g, function ($1) { return "-" + $1.toLowerCase() }) }, String.prototype.toUnderscore = function () { return this.replace(/([A-Z])/g, function ($1) { return "_" + $1.toLowerCase() }) }, Number.prototype.isBetween = function (num1, num2, including) { if (including) { if (this.valueOf() <= num2 && this.valueOf() >= num1) return !0 } else if (this.valueOf() < num2 && this.valueOf() > num1) return !0; return !1 }, $.fn.insertAt = function (i, selector) { var object = selector; if ("string" == typeof selector && (object = $(selector)), i = Math.min(object.children().length, i), 0 == i) return object.prepend(this), this; var oldIndex = this.data("index"); return this.attr("data-index", i), object.find(">*:nth-child(" + i + ")").after(this), object.children().each(function (index, el) { var $el = $(el); i > oldIndex && index > oldIndex && i >= index ? $el.attr("data-index", parseInt($el.data("data-index"), 10) - 1) : oldIndex >= i && index > i && oldIndex >= index && $el.attr("data-index", parseInt($el.attr("data-index"), 10) + 1) }), this }, $.fn.disableSelection = function () { return this.attr("unselectable", "on").css("user-select", "none").on("selectstart", !1) }, $.fn.enableSelection = function () { return this.removeAttr("unselectable").css("user-select", "initial").off("selectstart") }, $(function () { var LobiPanel = function ($el, options) { this.$el = null, this.$options = {}, this.hasRandomId = !1, this.storage = null; var $heading, $body, innerId, storagePrefix = "lobipanel_", me = this, _processInput = function (options) { options || (options = {}); var opts = _getOptionsFromAttributes(); options = $.extend({}, $.fn.lobiPanel.DEFAULTS, me.storage, options, opts); for (var objects = ["unpin", "reload", "expand", "minimize", "close", "editTitle"], i = 0; i < objects.length; i++) { var prop = objects[i]; "object" == typeof options[prop] && (options[prop] = $.extend({}, $.fn.lobiPanel.DEFAULTS[prop], options[prop], opts[prop])) } return options }, _init = function () { me.$el.addClass("lobipanel"), $heading.append(_generateControls()); var parent = me.$el.parent(); _appendInnerIdToParent(parent, innerId), _enableSorting(), _adjustForScreenSize(), _onToggleIconsBtnClick(), _enableResponsiveness(), _setBodyHeight(), me.$options.autoload && me.load(); var maxWidth = "calc(100% - " + $heading.find(".dropdown-menu").children().length * $heading.find(".dropdown-menu li").first().outerWidth() + "px)"; $heading.find(".panel-title").css("max-width", maxWidth), _triggerEvent("init") }, _generateControls = function () { var dropdown = _generateDropdown(), menu = dropdown.find(".dropdown-menu"); return me.$options.editTitle !== !1 && menu.append(_generateEditTitle()), me.$options.unpin !== !1 && menu.append(_generateUnpin()), me.$options.reload !== !1 && menu.append(_generateReload()), me.$options.minimize !== !1 && menu.append(_generateMinimize()), me.$options.expand !== !1 && menu.append(_generateExpand()), me.$options.close !== !1 && menu.append(_generateClose()), menu.find(">li>a").on("click", function (ev) { ev.preventDefault(), ev.stopPropagation() }), dropdown }, _generateDropdown = function () { return $('<div class="dropdown"></div>').append('<ul class="dropdown-menu dropdown-menu-right"></ul>').append('<div class="dropdown-toggle" data-toggle="dropdown"><span class="' + LobiPanel.PRIVATE_OPTIONS.iconClass + " " + me.$options.toggleIcon + '"></div>') }, _generateEditTitle = function () { var options = me.$options.editTitle, control = $('<a data-func="editTitle"></a>'); return control.append('<i class="' + LobiPanel.PRIVATE_OPTIONS.iconClass + " " + options.icon + '"></i>'), options.tooltip && "string" == typeof options.tooltip && (control.append('<span class="control-title">' + options.tooltip + "</span>"), control.attr("data-tooltip", options.tooltip)), _onEditTitleClick(control), $("<li></li>").append(control) }, _onEditTitleClick = function (control) { control.on("mousedown", function (ev) { ev.stopPropagation() }), control.on("click", function (ev) { ev.stopPropagation(), $heading.find('[data-func="editTitle"]').tooltip("hide"), me.isTitleEditing() ? me.finishTitleEditing() : me.startTitleEditing() }) }, _generateUnpin = function () { var options = me.$options.unpin, control = $('<a data-func="unpin"></a>'); return control.append('<i class="' + LobiPanel.PRIVATE_OPTIONS.iconClass + " " + options.icon + '"></i>'), options.tooltip && "string" == typeof options.tooltip && (control.append('<span class="control-title">' + options.tooltip + "</span>"), control.attr("data-tooltip", options.tooltip)), _onUnpinClick(control), $("<li></li>").append(control) }, _onUnpinClick = function (control) { control.on("mousedown", function (ev) { ev.stopPropagation() }), control.on("click", function () { me.togglePin() }) }, _generateReload = function () { var options = me.$options.reload, control = $('<a data-func="reload"></a>'); return control.append('<i class="' + LobiPanel.PRIVATE_OPTIONS.iconClass + " " + options.icon + '"></i>'), options.tooltip && "string" == typeof options.tooltip && (control.append('<span class="control-title">' + options.tooltip + "</span>"), control.attr("data-tooltip", options.tooltip)), _onReloadClick(control), $("<li></li>").append(control) }, _onReloadClick = function (control) { control.on("mousedown", function (ev) { ev.stopPropagation() }), control.on("click", function () { me.load({ callback: function () { control.tooltip("hide") } }) }) }, _generateMinimize = function () { var options = me.$options.minimize, control = $('<a data-func="minimize"></a>'); return control.append('<i class="' + LobiPanel.PRIVATE_OPTIONS.iconClass + " " + options.icon + '"></i>'), options.tooltip && "string" == typeof options.tooltip && (control.append('<span class="control-title">' + options.tooltip + "</span>"), control.attr("data-tooltip", options.tooltip)), _onMinimizeClick(control), $("<li></li>").append(control) }, _onMinimizeClick = function (control) { control.on("mousedown", function (ev) { ev.stopPropagation() }), control.on("click", function (ev) { ev.stopPropagation(), me.toggleMinimize() }) }, _generateExpand = function () { var options = me.$options.expand, control = $('<a data-func="expand"></a>'); return control.append('<i class="' + LobiPanel.PRIVATE_OPTIONS.iconClass + " " + options.icon + '"></i>'), options.tooltip && "string" == typeof options.tooltip && (control.append('<span class="control-title">' + options.tooltip + "</span>"), control.attr("data-tooltip", options.tooltip)), _onExpandClick(control), $("<li></li>").append(control) }, _onExpandClick = function (control) { control.on("mousedown", function (ev) { ev.stopPropagation() }), control.on("click", function (ev) { ev.stopPropagation(), me.toggleSize() }) }, _generateClose = function () { var options = me.$options.close, control = $('<a data-func="close"></a>'); return control.append('<i class="' + LobiPanel.PRIVATE_OPTIONS.iconClass + " " + options.icon + '"></i>'), options.tooltip && "string" == typeof options.tooltip && (control.append('<span class="control-title">' + options.tooltip + "</span>"), control.attr("data-tooltip", options.tooltip)), _onCloseClick(control), $("<li></li>").append(control) }, _onCloseClick = function (control) { control.on("mousedown", function (ev) { ev.stopPropagation() }), control.on("click", function (ev) { ev.stopPropagation(), control.tooltip("hide"), me.close() }) }, _getMaxZIndex = function () { var style, max, cur, panels = $(".lobipanel.panel-unpin:not(.panel-minimized.panel-expanded)"); if (0 === panels.length) return { id: "", "z-index": LobiPanel.PRIVATE_OPTIONS.initialZIndex }; style = $(panels[0]).attr("style"); var id = $(panels[0]).data("inner-id"); max = style ? style.getCss()["z-index"] : LobiPanel.PRIVATE_OPTIONS.initialZIndex; for (var i = 1; i < panels.length; i++)style = $(panels[i]).attr("style"), cur = style ? style.getCss()["z-index"] : 0, cur > max && (id = $(panels[i]).data("inner-id"), max = cur); return { id: id, "z-index": parseInt(max, 10) } }, _onPanelClick = function () { me.$el.on("mousedown.lobiPanel", function () { return me.isPinned() || me.isMinimized() || me.isOnFullScreen() ? !1 : void me.bringToFront() }) }, _offPanelClick = function () { me.$el.off("mousedown.lobiPanel") }, _changeClassOfControl = function (el) { el = $(el); var opts = me.$options[el.attr("data-func")]; opts.icon && el.find("." + LobiPanel.PRIVATE_OPTIONS.iconClass).toggleClass(opts.icon).toggleClass(opts.icon2) }, _getFooterForMinimizedPanels = function () { var minimizedCtr = $("." + LobiPanel.PRIVATE_OPTIONS.toolbarClass); return 0 === minimizedCtr.length && (minimizedCtr = $('<div class="' + LobiPanel.PRIVATE_OPTIONS.toolbarClass + '"></div>'), $("body").append(minimizedCtr)), minimizedCtr }, _expandOnHeaderClick = function () { $heading.on("click.lobiPanel", function () { me.maximize(), me.bringToFront() }) }, _removeExpandOnHeaderClick = function () { $heading.off("click.lobiPanel") }, _getAvailableWidth = function (calcWidth) { return me.$options.maxWidth && (calcWidth = Math.min(calcWidth, me.$options.maxWidth)), me.$options.minWidth && (calcWidth = Math.max(calcWidth, me.$options.minWidth)), calcWidth }, _getAvailableHeight = function (calcHeight) { return me.$options.maxHeight && (calcHeight = Math.min(calcHeight, me.$options.maxHeight)), me.$options.minHeight && (calcHeight = Math.max(calcHeight, me.$options.minHeight)), calcHeight }, _calculateBodyHeight = function (h) { return h - $heading.outerHeight() - me.$el.find(".panel-footer").outerHeight() }, _calculateBodyWidth = function (w) { return w - 2 }, _appendInnerIdToParent = function (parent, innerId) { if (void 0 === parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr)) parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr, innerId); else { if (parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr).indexOf(innerId) > -1) return; var innerIds = parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr); parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr, innerIds + " " + innerId) } me.$el.attr("data-index", me.$el.index()) }, _insertInParent = function () { var parent = $("[" + LobiPanel.PRIVATE_OPTIONS.parentAttr + "~=" + innerId + "]"); me.$el.insertAt(me.$el.attr("data-index"), parent) }, _generateWindow8Spinner = function () { var template = ['<div class="spinner spinner-windows8">', '<div class="wBall">', '<div class="wInnerBall">', "</div>", "</div>", '<div class="wBall">', '<div class="wInnerBall">', "</div>", "</div>", '<div class="wBall">', '<div class="wInnerBall">', "</div>", "</div>", '<div class="wBall">', '<div class="wInnerBall">', "</div>", "</div>", '<div class="wBall">', '<div class="wInnerBall">', "</div>", "</div>", "</div>"].join(""); return $('<div class="spinner-wrapper">' + template + "</div>") }, _enableSorting = function () { var parent = me.$el.parent(); parent.hasClass("ui-sortable") && parent.sortable("destroy"), me.$options.sortable ? (me.$el.addClass("lobipanel-sortable"), parent.addClass("lobipanel-parent-sortable")) : me.$el.removeClass("lobipanel-sortable"), parent.sortable({ connectWith: ".lobipanel-parent-sortable", items: ".lobipanel-sortable", handle: ".panel-heading", cursor: "move", placeholder: "lobipanel-placeholder", forcePlaceholderSize: !0, opacity: .7, revert: 300, update: function (event, ui) { var innerId = ui.item.data("inner-id"); _removeInnerIdFromParent(innerId), _appendInnerIdToParent(ui.item.parent(), innerId), _updateDataIndices(ui.item), _triggerEvent("dragged") } }) }, _disableSorting = function () { var parent = me.$el.parent(); parent.hasClass("ui-sortable") && parent.sortable("destroy") }, _updateDataIndices = function (panel) { var items = panel.parent().find("> *"); items.each(function (index, el) { $(el).attr("data-index", index) }) }, _removeInnerIdFromParent = function (innerId) { var parent = $("[" + LobiPanel.PRIVATE_OPTIONS.parentAttr + "~=" + innerId + "]"), innerIds = parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr).replace(innerId, "").trim().replace(/\s{2,}/g, " "); parent.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr, innerIds) }, _onToggleIconsBtnClick = function () { $heading.find(".toggle-controls").on("click.lobiPanel", function () { me.$el.toggleClass("controls-expanded") }) }, _adjustForScreenSize = function () { me.disableTooltips(), $(window).width() > 768 && me.$options.tooltips && me.enableTooltips(), me.isOnFullScreen() && $body.css({ width: _calculateBodyWidth(me.$el.width()), height: _calculateBodyHeight(me.$el.height()) }) }, _enableResponsiveness = function () { $(window).on("resize.lobiPanel", function () { _adjustForScreenSize() }) }, _setBodyHeight = function () { "auto" !== me.$options.bodyHeight && $body.css({ height: me.$options.bodyHeight, overflow: "auto" }) }, _getOptionsFromAttributes = function () { var $el = me.$el, options = {}; for (var key in $.fn.lobiPanel.DEFAULTS) { var k = key.toDash(), val = $el.data(k); void 0 !== val && (options[key] = "object" != typeof $.fn.lobiPanel.DEFAULTS[key] ? val : eval("(" + val + ")")) } return options }, _saveState = function (state) { !me.hasRandomId && me.$options.stateful && (me.storage.state = state, _saveLocalStorage(me.storage)) }, _saveLocalStorage = function (storage) { localStorage.setItem(storagePrefix + innerId, JSON.stringify(storage)) }, _applyState = function (state) { switch (state) { case "unpinned": me.unpin(); break; case "minimized": me.unpin(), me.minimize(); break; case "collapsed": me.minimize(); break; case "fullscreen": me.toFullScreen() } }, _applyIndex = function (index) { null !== index && me.$el.insertAt(index, me.$el.parent()) }, _triggerEvent = function (eventType) { var args = Array.prototype.slice.call(arguments, 1); args.unshift(me), me.$el.trigger(eventType + ".lobiPanel", args) }; this.isPanelInit = function () { return me.$el.hasClass("lobipanel") && me.$el.data("inner-id") }, this.isPinned = function () { return !me.$el.hasClass("panel-unpin") }, this.pin = function () { return _triggerEvent("beforePin"), $heading.find('[data-func="unpin"]').tooltip("hide"), me.disableResize(), me.disableDrag(), _enableSorting(), _offPanelClick(), me.$el.removeClass("panel-unpin").attr("old-style", me.$el.attr("style")).removeAttr("style").css("position", "relative"), $body.css({ width: "", height: "" }), _setBodyHeight(), _insertInParent(), _saveState("pinned"), _triggerEvent("onPin"), me }, this.unpin = function () { if (_triggerEvent("beforeUnpin"), me.$el.hasClass("panel-collapsed")) return me; if (_disableSorting(), $heading.find('[data-func="unpin"]').tooltip("hide"), me.$el.attr("old-style")) me.$el.attr("style", me.$el.attr("old-style")); else { var width = me.$el.width(), height = me.$el.height(), left = Math.max(0, ($(window).width() - me.$el.outerWidth()) / 2), top = Math.max(0, ($(window).height() - me.$el.outerHeight()) / 2); me.$el.css({ left: left, top: top, width: width, height: height }) } var res = _getMaxZIndex(); me.$el.css("z-index", res["z-index"] + 1), _onPanelClick(), me.$el.addClass("panel-unpin"), $("body").append(me.$el); var panelWidth = _getAvailableWidth(me.$el.width()), panelHeight = _getAvailableHeight(me.$el.height()); me.$el.css({ position: "fixed", width: panelWidth, height: panelHeight }); var bHeight = _calculateBodyHeight(panelHeight), bWidth = _calculateBodyWidth(panelWidth); return $body.css({ width: bWidth, height: bHeight }), me.$options.draggable && me.enableDrag(), "none" !== me.$options.resize && me.enableResize(), _saveState("unpinned"), _triggerEvent("onUnpin"), me }, this.togglePin = function () { return this.isPinned() ? this.unpin() : this.pin(), me }, this.isMinimized = function () { return me.$el.hasClass("panel-minimized") || me.$el.hasClass("panel-collapsed") }, this.minimize = function () { if (_triggerEvent("beforeMinimize"), me.isMinimized()) return me; if (me.isPinned()) $body.slideUp(), me.$el.find(".panel-footer").slideUp(), me.$el.addClass("panel-collapsed"), _saveState("collapsed"), _changeClassOfControl($heading.find('[data-func="minimize"]')); else { me.disableTooltips(), $heading.find('[data-func="minimize"]').tooltip("hide"); var left, top, footer = _getFooterForMinimizedPanels(), children = footer.find(">*"); if (top = footer.offset().top, 0 === children.length) left = footer.offset().left; else { var ch = $(children[children.length - 1]); left = ch.offset().left + ch.width() } me.$el.hasClass("panel-expanded") || me.$el.attr("old-style", me.$el.attr("style")), me.$el.animate({ left: left, top: top, width: 200, height: footer.height() }, 100, function () { me.$el.hasClass("panel-expanded") && (me.$el.removeClass("panel-expanded"), me.$el.find(".panel-heading [data-func=expand] ." + LobiPanel.PRIVATE_OPTIONS.iconClass).removeClass(me.$options.expand.icon2).addClass(me.$options.expand.icon)), me.$el.addClass("panel-minimized"), me.$el.removeAttr("style"), me.disableDrag(), me.disableResize(), _expandOnHeaderClick(), footer.append(me.$el), $("body").addClass("lobipanel-minimized"); var maxWidth = "calc(100% - " + $heading.find(".dropdown-menu li>a:visible").length * $heading.find(".dropdown-menu li>a:visible").first().outerWidth() + "px)"; $heading.find(".panel-title").css("max-width", maxWidth), _saveState("minimized"), _triggerEvent("onMinimize") }) } return me }, this.maximize = function () { if (_triggerEvent("beforeMaximize"), !me.isMinimized()) return me; if (me.isPinned()) $body.slideDown(), me.$el.find(".panel-footer").slideDown(), me.$el.removeClass("panel-collapsed"), _saveState("pinned"), _changeClassOfControl($heading.find('[data-func="minimize"]')); else { me.enableTooltips(); var css = me.$el.attr("old-style").getCss(); me.$el.css({ position: css.position || "fixed", "z-index": css["z-index"], left: me.$el.offset().left, top: me.$el.offset().top, width: me.$el.width(), height: me.$el.height() }), $("body").append(me.$el), delete css.position, delete css["z-index"], me.$el.animate(css, 100, function () { me.$el.css("position", ""), me.$el.removeClass("panel-minimized"), me.$el.removeAttr("old-style"), me.$options.draggable && me.enableDrag(), me.enableResize(), _removeExpandOnHeaderClick(); var footer = _getFooterForMinimizedPanels(); 0 === footer.children().length && footer.remove(), $("body").removeClass("lobipanel-minimized").addClass("lobipanel-minimized"); var maxWidth = "calc(100% - " + $heading.find(".dropdown-menu li").length * $heading.find(".dropdown-menu li").first().outerWidth() + "px)"; $heading.find(".panel-title").css("max-width", maxWidth), _saveState("unpinned"), _triggerEvent("onMaximize") }) } return me }, this.toggleMinimize = function () { return me.isMinimized() ? me.maximize() : me.minimize(), me }, this.isOnFullScreen = function () { return me.$el.hasClass("panel-expanded") }, this.toFullScreen = function () { if (_triggerEvent("beforeFullScreen"), me.$el.hasClass("panel-collapsed")) return me; _changeClassOfControl($heading.find('[data-func="expand"]')), $heading.find('[data-func="expand"]').tooltip("hide"); var res = _getMaxZIndex(); if (me.isPinned() || me.isMinimized()) { me.enableTooltips(), me.$el.css({ position: "fixed", "z-index": res["z-index"] + 1, left: me.$el.offset().left, top: me.$el.offset().top - $(window).scrollTop(), width: me.$el.width(), height: me.$el.height() }), $("body").append(me.$el); var footer = _getFooterForMinimizedPanels(); 0 === footer.children().length && footer.remove() } else $body.css({ width: "", height: "" }), _setBodyHeight(); me.isMinimized() ? (me.$el.removeClass("panel-minimized"), _removeExpandOnHeaderClick()) : (me.$el.attr("old-style", me.$el.attr("style")), me.disableResize()); var toolbar = $("." + LobiPanel.PRIVATE_OPTIONS.toolbarClass), toolbarHeight = toolbar.outerHeight() || 0; return me.$el.animate({ width: $(window).width(), height: $(window).height() - toolbarHeight, left: 0, top: 0 }, me.$options.expandAnimation, function () { me.$el.css({ width: "", height: "", right: 0, bottom: toolbarHeight }), me.$el.addClass("panel-expanded"), $("body").css("overflow", "hidden"), $body.css({ width: _calculateBodyWidth(me.$el.width()), height: _calculateBodyHeight(me.$el.height()) }), me.disableDrag(), me.isPinned() && _disableSorting(), _saveState("fullscreen"), _triggerEvent("onFullScreen") }), me }, this.toSmallSize = function () { _triggerEvent("beforeSmallSize"), _changeClassOfControl($heading.find('[data-func="expand"]')), $heading.find('[data-func="expand"]').tooltip("hide"); var css = me.$el.attr("old-style").getCss(); return me.$el.animate({ left: css.left, top: css.top, width: css.width, height: css.height, right: css.right, bottom: css.bottom }, me.$options.collapseAnimation, function () { me.$el.removeAttr("old-style"), me.$el.hasClass("panel-unpin") ? (me.$options.draggable && me.enableDrag(), me.enableResize()) : (me.$el.removeAttr("style"), _insertInParent(), _enableSorting()), me.$el.removeClass("panel-expanded"), $("body").css("overflow", "auto"); var bWidth = "", bHeight = ""; me.isPinned() ? "auto" !== me.$options.bodyHeight && (bHeight = me.$options.bodyHeight, _saveState("pinned")) : (bWidth = _calculateBodyWidth(me.getWidth()), bHeight = _calculateBodyHeight(me.getHeight()), _saveState("unpinned")), $body.css({ width: bWidth, height: bHeight }), _triggerEvent("onSmallSize") }), me }, this.toggleSize = function () { return me.isOnFullScreen() ? me.toSmallSize() : me.toFullScreen(), me }, this.close = function () { return _triggerEvent("beforeClose"), me.$el.hide(100, function () { me.isOnFullScreen() && $("body").css("overflow", "auto"), me.$el.remove(); var footer = _getFooterForMinimizedPanels(); 0 === footer.children().length && footer.remove(), _triggerEvent("onClose") }), me }, this.setPosition = function (left, top) { return me.isPinned() ? me : (me.$el.animate({ left: left, top: top }, 100), me) }, this.setWidth = function (w) { if (me.isPinned()) return me; var bWidth = _calculateBodyWidth(w); return me.$el.animate({ width: w }, 100), $body.animate({ width: bWidth }, 100), me }, this.setHeight = function (h) { if (me.isPinned()) return me; var bHeight = _calculateBodyHeight(h); return me.$el.animate({ height: h }, 100), $body.animate({ height: bHeight }, 100), me }, this.setSize = function (w, h) { if (me.isPinned()) return me; var bHeight = _calculateBodyHeight(h), bWidth = _calculateBodyWidth(w); return me.$el.animate({ height: h, width: w }, 100), $body.animate({ height: bHeight, width: bWidth }, 100), me }, this.getPosition = function () { var offset = me.$el.offset(); return { x: offset.left, y: offset.top } }, this.getWidth = function () { return me.$el.width() }, this.getHeight = function () { return me.$el.height() }, this.bringToFront = function () { _triggerEvent("beforeToFront"); var res = _getMaxZIndex(); return res.id === me.$el.data("inner-id") ? me : (me.$el.css("z-index", res["z-index"] + 1), _triggerEvent("onToFront"), me) }, this.enableDrag = function () { return me.$el.draggable({ handle: ".panel-heading" }), me }, this.disableDrag = function () { return me.$el.hasClass("ui-draggable") && me.$el.draggable("destroy"), me }, this.enableResize = function () { var handles = !1; return "vertical" === me.$options.resize ? handles = "n, s" : "horizontal" === me.$options.resize ? handles = "e, w" : "both" === me.$options.resize && (handles = "all"), handles ? (me.$el.resizable({ minWidth: me.$options.minWidth, maxWidth: me.$options.maxWidth, minHeight: me.$options.minHeight, maxHeight: me.$options.maxHeight, handles: handles, start: function () { me.$el.disableSelection(), _triggerEvent("resizeStart") }, stop: function () { me.$el.enableSelection(), _triggerEvent("resizeStop") }, resize: function () { var bHeight = _calculateBodyHeight(me.$el.height()), bWidth = _calculateBodyWidth(me.$el.width()); $body.css({ width: bWidth, height: bHeight }), _triggerEvent("onResize") } }), me) : void 0 }, this.disableResize = function () { return me.$el.hasClass("ui-resizable") && me.$el.resizable("destroy"), me }, this.startLoading = function () { var spinner = _generateWindow8Spinner(); me.$el.append(spinner); var sp = spinner.find(".spinner"); return sp.css("margin-top", 50), me }, this.stopLoading = function () { return me.$el.find(".spinner-wrapper").remove(), me }, this.setLoadUrl = function (url) { return me.$options.loadUrl = url, me }, this.load = function (params) { params = params || {}, "string" == typeof params && (params = { url: params }); var url = params.url || me.$options.loadUrl, data = params.data || {}, callback = params.callback || null; return url ? (_triggerEvent("beforeLoad"), me.startLoading(), $body.load(url, data, function (result, status, xhr) { callback && "function" == typeof callback && callback(result, status, xhr), me.stopLoading(), _triggerEvent("loaded", result, status, xhr) }), me) : me }, this.destroy = function () { return me.disableDrag(), me.disableResize(), me.$options.sortable = !1, _enableSorting(), _removeInnerIdFromParent(innerId), me.$el.removeClass("lobipanel").removeAttr("data-inner-id").removeAttr("data-index").removeData("lobiPanel"), $heading.find(".dropdown").remove(), me.$el }, this.startTitleEditing = function () { var title = $heading.find(".panel-title").text().trim(), input = $('<input value="' + title + '"/>'); return input.on("keydown", function (ev) { 13 === ev.which ? me.finishTitleEditing() : 27 === ev.which && me.cancelTitleEditing() }), $heading.find(".panel-title").data("old-title", title).html("").append(input), input[0].focus(), input[0].select(), _changeClassOfControl($heading.find('[data-func="editTitle"]')), me }, this.isTitleEditing = function () { return $heading.find(".panel-title input").length > 0 }, this.cancelTitleEditing = function () { var title = $heading.find(".panel-title"); return title.html(title.data("old-title")).find("input").remove(), _changeClassOfControl($heading.find('[data-func="editTitle"]')), me }, this.finishTitleEditing = function () { var input = $heading.find("input"); return $heading.find(".panel-title").html(input.val()), input.remove(), _changeClassOfControl($heading.find('[data-func="editTitle"]')), me }, this.enableTooltips = function () { if ($(window).width() < 768) return me; var controls = $heading.find(".dropdown-menu>li>a"); return controls.each(function (index, el) { var $el = $(el); $el.attr("data-toggle", "tooltip").attr("data-title", $el.data("tooltip")).attr("data-placement", "bottom") }), controls.each(function (ind, el) { $(el).tooltip({ container: "body", template: '<div class="tooltip lobipanel-tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>' }) }), me }, this.disableTooltips = function () { return $heading.find(".dropdown-menu>li>a").tooltip("destroy"), me }, this.$el = $el, me.$el.data("inner-id") || (me.hasRandomId = !0, me.$el.attr("data-inner-id", Math.randomString(10))), innerId = me.$el.data("inner-id"), me.hasRandomId || (me.storage = localStorage.getItem(storagePrefix + innerId), me.storage = JSON.parse(me.storage) || {}), this.$options = _processInput(options), $heading = this.$el.find(">.panel-heading"), $body = this.$el.find(">.panel-body"), _init(), _applyState(me.$options.state), _applyIndex(me.$options.initialIndex) }; $.fn.lobiPanel = function (option) { var args = arguments, ret = null; return this.each(function () { var $this = $(this), data = $this.data("lobiPanel"), options = "object" == typeof option && option; data || $this.data("lobiPanel", data = new LobiPanel($this, options)), "string" == typeof option && (args = Array.prototype.slice.call(args, 1), ret = data[option].apply(data, args)) }), ret }, LobiPanel.PRIVATE_OPTIONS = { parentAttr: "data-lobipanel-child-inner-id", toolbarClass: "lobipanel-minimized-toolbar", initialZIndex: 1e4, iconClass: "panel-control-icon" }, $.fn.lobiPanel.DEFAULTS = { draggable: !0, sortable: !1, connectWith: ".ui-sortable", resize: "both", minWidth: 200, minHeight: 100, maxWidth: 1200, maxHeight: 700, loadUrl: "", autoload: !0, bodyHeight: "auto", tooltips: !0, toggleIcon: "glyphicon glyphicon-cog", expandAnimation: 100, collapseAnimation: 100, state: "pinned", initialIndex: null, stateful: !1, unpin: { icon: "glyphicon glyphicon-move", tooltip: "Unpin" }, reload: { icon: "glyphicon glyphicon-refresh", tooltip: "Reload" }, minimize: { icon: "glyphicon glyphicon-minus", icon2: "glyphicon glyphicon-plus", tooltip: "Minimize" }, expand: { icon: "glyphicon glyphicon-resize-full", icon2: "glyphicon glyphicon-resize-small", tooltip: "Fullscreen" }, close: { icon: "glyphicon glyphicon-remove", tooltip: "Close" }, editTitle: { icon: "glyphicon glyphicon-pencil", icon2: "glyphicon glyphicon-floppy-disk", tooltip: "Edit title" } }, $(".lobipanel").lobiPanel() });
/* NUGET: BEGIN LICENSE TEXT
 *
 * Microsoft grants you the right to use these script files for the sole
 * purpose of either: (i) interacting through your browser with the Microsoft
 * website or online service, subject to the applicable licensing or use
 * terms; or (ii) using the files as included with a Microsoft product subject
 * to that product's license terms. Microsoft reserves all other rights to the
 * files not expressly granted by Microsoft, whether by implication, estoppel
 * or otherwise. Insofar as a script file is dual licensed under GPL,
 * Microsoft neither took the code under GPL nor distributes it thereunder but
 * under the terms set out in this paragraph. All notices and licenses
 * below are for informational purposes only.
 *
 * NUGET: END LICENSE TEXT */

/**
* bootstrap.js v3.0.0 by @fat and @mdo
* Copyright 2013 Twitter Inc.
* http://www.apache.org/licenses/LICENSE-2.0
*/
if (!jQuery) throw new Error("Bootstrap requires jQuery"); +function (a) { "use strict"; function b() { var a = document.createElement("bootstrap"), b = { WebkitTransition: "webkitTransitionEnd", MozTransition: "transitionend", OTransition: "oTransitionEnd otransitionend", transition: "transitionend" }; for (var c in b) if (void 0 !== a.style[c]) return { end: b[c] } } a.fn.emulateTransitionEnd = function (b) { var c = !1, d = this; a(this).one(a.support.transition.end, function () { c = !0 }); var e = function () { c || a(d).trigger(a.support.transition.end) }; return setTimeout(e, b), this }, a(function () { a.support.transition = b() }) }(window.jQuery), +function (a) { "use strict"; var b = '[data-dismiss="alert"]', c = function (c) { a(c).on("click", b, this.close) }; c.prototype.close = function (b) { function c() { f.trigger("closed.bs.alert").remove() } var d = a(this), e = d.attr("data-target"); e || (e = d.attr("href"), e = e && e.replace(/.*(?=#[^\s]*$)/, "")); var f = a(e); b && b.preventDefault(), f.length || (f = d.hasClass("alert") ? d : d.parent()), f.trigger(b = a.Event("close.bs.alert")), b.isDefaultPrevented() || (f.removeClass("in"), a.support.transition && f.hasClass("fade") ? f.one(a.support.transition.end, c).emulateTransitionEnd(150) : c()) }; var d = a.fn.alert; a.fn.alert = function (b) { return this.each(function () { var d = a(this), e = d.data("bs.alert"); e || d.data("bs.alert", e = new c(this)), "string" == typeof b && e[b].call(d) }) }, a.fn.alert.Constructor = c, a.fn.alert.noConflict = function () { return a.fn.alert = d, this }, a(document).on("click.bs.alert.data-api", b, c.prototype.close) }(window.jQuery), +function (a) { "use strict"; var b = function (c, d) { this.$element = a(c), this.options = a.extend({}, b.DEFAULTS, d) }; b.DEFAULTS = { loadingText: "loading..." }, b.prototype.setState = function (a) { var b = "disabled", c = this.$element, d = c.is("input") ? "val" : "html", e = c.data(); a += "Text", e.resetText || c.data("resetText", c[d]()), c[d](e[a] || this.options[a]), setTimeout(function () { "loadingText" == a ? c.addClass(b).attr(b, b) : c.removeClass(b).removeAttr(b) }, 0) }, b.prototype.toggle = function () { var a = this.$element.closest('[data-toggle="buttons"]'); if (a.length) { var b = this.$element.find("input").prop("checked", !this.$element.hasClass("active")).trigger("change"); "radio" === b.prop("type") && a.find(".active").removeClass("active") } this.$element.toggleClass("active") }; var c = a.fn.button; a.fn.button = function (c) { return this.each(function () { var d = a(this), e = d.data("bs.button"), f = "object" == typeof c && c; e || d.data("bs.button", e = new b(this, f)), "toggle" == c ? e.toggle() : c && e.setState(c) }) }, a.fn.button.Constructor = b, a.fn.button.noConflict = function () { return a.fn.button = c, this }, a(document).on("click.bs.button.data-api", "[data-toggle^=button]", function (b) { var c = a(b.target); c.hasClass("btn") || (c = c.closest(".btn")), c.button("toggle"), b.preventDefault() }) }(window.jQuery), +function (a) { "use strict"; var b = function (b, c) { this.$element = a(b), this.$indicators = this.$element.find(".carousel-indicators"), this.options = c, this.paused = this.sliding = this.interval = this.$active = this.$items = null, "hover" == this.options.pause && this.$element.on("mouseenter", a.proxy(this.pause, this)).on("mouseleave", a.proxy(this.cycle, this)) }; b.DEFAULTS = { interval: 5e3, pause: "hover", wrap: !0 }, b.prototype.cycle = function (b) { return b || (this.paused = !1), this.interval && clearInterval(this.interval), this.options.interval && !this.paused && (this.interval = setInterval(a.proxy(this.next, this), this.options.interval)), this }, b.prototype.getActiveIndex = function () { return this.$active = this.$element.find(".item.active"), this.$items = this.$active.parent().children(), this.$items.index(this.$active) }, b.prototype.to = function (b) { var c = this, d = this.getActiveIndex(); return b > this.$items.length - 1 || 0 > b ? void 0 : this.sliding ? this.$element.one("slid", function () { c.to(b) }) : d == b ? this.pause().cycle() : this.slide(b > d ? "next" : "prev", a(this.$items[b])) }, b.prototype.pause = function (b) { return b || (this.paused = !0), this.$element.find(".next, .prev").length && a.support.transition.end && (this.$element.trigger(a.support.transition.end), this.cycle(!0)), this.interval = clearInterval(this.interval), this }, b.prototype.next = function () { return this.sliding ? void 0 : this.slide("next") }, b.prototype.prev = function () { return this.sliding ? void 0 : this.slide("prev") }, b.prototype.slide = function (b, c) { var d = this.$element.find(".item.active"), e = c || d[b](), f = this.interval, g = "next" == b ? "left" : "right", h = "next" == b ? "first" : "last", i = this; if (!e.length) { if (!this.options.wrap) return; e = this.$element.find(".item")[h]() } this.sliding = !0, f && this.pause(); var j = a.Event("slide.bs.carousel", { relatedTarget: e[0], direction: g }); if (!e.hasClass("active")) { if (this.$indicators.length && (this.$indicators.find(".active").removeClass("active"), this.$element.one("slid", function () { var b = a(i.$indicators.children()[i.getActiveIndex()]); b && b.addClass("active") })), a.support.transition && this.$element.hasClass("slide")) { if (this.$element.trigger(j), j.isDefaultPrevented()) return; e.addClass(b), e[0].offsetWidth, d.addClass(g), e.addClass(g), d.one(a.support.transition.end, function () { e.removeClass([b, g].join(" ")).addClass("active"), d.removeClass(["active", g].join(" ")), i.sliding = !1, setTimeout(function () { i.$element.trigger("slid") }, 0) }).emulateTransitionEnd(600) } else { if (this.$element.trigger(j), j.isDefaultPrevented()) return; d.removeClass("active"), e.addClass("active"), this.sliding = !1, this.$element.trigger("slid") } return f && this.cycle(), this } }; var c = a.fn.carousel; a.fn.carousel = function (c) { return this.each(function () { var d = a(this), e = d.data("bs.carousel"), f = a.extend({}, b.DEFAULTS, d.data(), "object" == typeof c && c), g = "string" == typeof c ? c : f.slide; e || d.data("bs.carousel", e = new b(this, f)), "number" == typeof c ? e.to(c) : g ? e[g]() : f.interval && e.pause().cycle() }) }, a.fn.carousel.Constructor = b, a.fn.carousel.noConflict = function () { return a.fn.carousel = c, this }, a(document).on("click.bs.carousel.data-api", "[data-slide], [data-slide-to]", function (b) { var c, d = a(this), e = a(d.attr("data-target") || (c = d.attr("href")) && c.replace(/.*(?=#[^\s]+$)/, "")), f = a.extend({}, e.data(), d.data()), g = d.attr("data-slide-to"); g && (f.interval = !1), e.carousel(f), (g = d.attr("data-slide-to")) && e.data("bs.carousel").to(g), b.preventDefault() }), a(window).on("load", function () { a('[data-ride="carousel"]').each(function () { var b = a(this); b.carousel(b.data()) }) }) }(window.jQuery), +function (a) { "use strict"; var b = function (c, d) { this.$element = a(c), this.options = a.extend({}, b.DEFAULTS, d), this.transitioning = null, this.options.parent && (this.$parent = a(this.options.parent)), this.options.toggle && this.toggle() }; b.DEFAULTS = { toggle: !0 }, b.prototype.dimension = function () { var a = this.$element.hasClass("width"); return a ? "width" : "height" }, b.prototype.show = function () { if (!this.transitioning && !this.$element.hasClass("in")) { var b = a.Event("show.bs.collapse"); if (this.$element.trigger(b), !b.isDefaultPrevented()) { var c = this.$parent && this.$parent.find("> .panel > .in"); if (c && c.length) { var d = c.data("bs.collapse"); if (d && d.transitioning) return; c.collapse("hide"), d || c.data("bs.collapse", null) } var e = this.dimension(); this.$element.removeClass("collapse").addClass("collapsing")[e](0), this.transitioning = 1; var f = function () { this.$element.removeClass("collapsing").addClass("in")[e]("auto"), this.transitioning = 0, this.$element.trigger("shown.bs.collapse") }; if (!a.support.transition) return f.call(this); var g = a.camelCase(["scroll", e].join("-")); this.$element.one(a.support.transition.end, a.proxy(f, this)).emulateTransitionEnd(350)[e](this.$element[0][g]) } } }, b.prototype.hide = function () { if (!this.transitioning && this.$element.hasClass("in")) { var b = a.Event("hide.bs.collapse"); if (this.$element.trigger(b), !b.isDefaultPrevented()) { var c = this.dimension(); this.$element[c](this.$element[c]())[0].offsetHeight, this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"), this.transitioning = 1; var d = function () { this.transitioning = 0, this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse") }; return a.support.transition ? (this.$element[c](0).one(a.support.transition.end, a.proxy(d, this)).emulateTransitionEnd(350), void 0) : d.call(this) } } }, b.prototype.toggle = function () { this[this.$element.hasClass("in") ? "hide" : "show"]() }; var c = a.fn.collapse; a.fn.collapse = function (c) { return this.each(function () { var d = a(this), e = d.data("bs.collapse"), f = a.extend({}, b.DEFAULTS, d.data(), "object" == typeof c && c); e || d.data("bs.collapse", e = new b(this, f)), "string" == typeof c && e[c]() }) }, a.fn.collapse.Constructor = b, a.fn.collapse.noConflict = function () { return a.fn.collapse = c, this }, a(document).on("click.bs.collapse.data-api", "[data-toggle=collapse]", function (b) { var c, d = a(this), e = d.attr("data-target") || b.preventDefault() || (c = d.attr("href")) && c.replace(/.*(?=#[^\s]+$)/, ""), f = a(e), g = f.data("bs.collapse"), h = g ? "toggle" : d.data(), i = d.attr("data-parent"), j = i && a(i); g && g.transitioning || (j && j.find('[data-toggle=collapse][data-parent="' + i + '"]').not(d).addClass("collapsed"), d[f.hasClass("in") ? "addClass" : "removeClass"]("collapsed")), f.collapse(h) }) }(window.jQuery), +function (a) { "use strict"; function b() { a(d).remove(), a(e).each(function (b) { var d = c(a(this)); d.hasClass("open") && (d.trigger(b = a.Event("hide.bs.dropdown")), b.isDefaultPrevented() || d.removeClass("open").trigger("hidden.bs.dropdown")) }) } function c(b) { var c = b.attr("data-target"); c || (c = b.attr("href"), c = c && /#/.test(c) && c.replace(/.*(?=#[^\s]*$)/, "")); var d = c && a(c); return d && d.length ? d : b.parent() } var d = ".dropdown-backdrop", e = "[data-toggle=dropdown]", f = function (b) { a(b).on("click.bs.dropdown", this.toggle) }; f.prototype.toggle = function (d) { var e = a(this); if (!e.is(".disabled, :disabled")) { var f = c(e), g = f.hasClass("open"); if (b(), !g) { if ("ontouchstart" in document.documentElement && !f.closest(".navbar-nav").length && a('<div class="dropdown-backdrop"/>').insertAfter(a(this)).on("click", b), f.trigger(d = a.Event("show.bs.dropdown")), d.isDefaultPrevented()) return; f.toggleClass("open").trigger("shown.bs.dropdown"), e.focus() } return !1 } }, f.prototype.keydown = function (b) { if (/(38|40|27)/.test(b.keyCode)) { var d = a(this); if (b.preventDefault(), b.stopPropagation(), !d.is(".disabled, :disabled")) { var f = c(d), g = f.hasClass("open"); if (!g || g && 27 == b.keyCode) return 27 == b.which && f.find(e).focus(), d.click(); var h = a("[role=menu] li:not(.divider):visible a", f); if (h.length) { var i = h.index(h.filter(":focus")); 38 == b.keyCode && i > 0 && i-- , 40 == b.keyCode && i < h.length - 1 && i++ , ~i || (i = 0), h.eq(i).focus() } } } }; var g = a.fn.dropdown; a.fn.dropdown = function (b) { return this.each(function () { var c = a(this), d = c.data("dropdown"); d || c.data("dropdown", d = new f(this)), "string" == typeof b && d[b].call(c) }) }, a.fn.dropdown.Constructor = f, a.fn.dropdown.noConflict = function () { return a.fn.dropdown = g, this }, a(document).on("click.bs.dropdown.data-api", b).on("click.bs.dropdown.data-api", ".dropdown form", function (a) { a.stopPropagation() }).on("click.bs.dropdown.data-api", e, f.prototype.toggle).on("keydown.bs.dropdown.data-api", e + ", [role=menu]", f.prototype.keydown) }(window.jQuery), +function (a) { "use strict"; var b = function (b, c) { this.options = c, this.$element = a(b), this.$backdrop = this.isShown = null, this.options.remote && this.$element.load(this.options.remote) }; b.DEFAULTS = { backdrop: !0, keyboard: !0, show: !0 }, b.prototype.toggle = function (a) { return this[this.isShown ? "hide" : "show"](a) }, b.prototype.show = function (b) { var c = this, d = a.Event("show.bs.modal", { relatedTarget: b }); this.$element.trigger(d), this.isShown || d.isDefaultPrevented() || (this.isShown = !0, this.escape(), this.$element.on("click.dismiss.modal", '[data-dismiss="modal"]', a.proxy(this.hide, this)), this.backdrop(function () { var d = a.support.transition && c.$element.hasClass("fade"); c.$element.parent().length || c.$element.appendTo(document.body), c.$element.show(), d && c.$element[0].offsetWidth, c.$element.addClass("in").attr("aria-hidden", !1), c.enforceFocus(); var e = a.Event("shown.bs.modal", { relatedTarget: b }); d ? c.$element.find(".modal-dialog").one(a.support.transition.end, function () { c.$element.focus().trigger(e) }).emulateTransitionEnd(300) : c.$element.focus().trigger(e) })) }, b.prototype.hide = function (b) { b && b.preventDefault(), b = a.Event("hide.bs.modal"), this.$element.trigger(b), this.isShown && !b.isDefaultPrevented() && (this.isShown = !1, this.escape(), a(document).off("focusin.bs.modal"), this.$element.removeClass("in").attr("aria-hidden", !0).off("click.dismiss.modal"), a.support.transition && this.$element.hasClass("fade") ? this.$element.one(a.support.transition.end, a.proxy(this.hideModal, this)).emulateTransitionEnd(300) : this.hideModal()) }, b.prototype.enforceFocus = function () { a(document).off("focusin.bs.modal").on("focusin.bs.modal", a.proxy(function (a) { this.$element[0] === a.target || this.$element.has(a.target).length || this.$element.focus() }, this)) }, b.prototype.escape = function () { this.isShown && this.options.keyboard ? this.$element.on("keyup.dismiss.bs.modal", a.proxy(function (a) { 27 == a.which && this.hide() }, this)) : this.isShown || this.$element.off("keyup.dismiss.bs.modal") }, b.prototype.hideModal = function () { var a = this; this.$element.hide(), this.backdrop(function () { a.removeBackdrop(), a.$element.trigger("hidden.bs.modal") }) }, b.prototype.removeBackdrop = function () { this.$backdrop && this.$backdrop.remove(), this.$backdrop = null }, b.prototype.backdrop = function (b) { var c = this.$element.hasClass("fade") ? "fade" : ""; if (this.isShown && this.options.backdrop) { var d = a.support.transition && c; if (this.$backdrop = a('<div class="modal-backdrop ' + c + '" />').appendTo(document.body), this.$element.on("click.dismiss.modal", a.proxy(function (a) { a.target === a.currentTarget && ("static" == this.options.backdrop ? this.$element[0].focus.call(this.$element[0]) : this.hide.call(this)) }, this)), d && this.$backdrop[0].offsetWidth, this.$backdrop.addClass("in"), !b) return; d ? this.$backdrop.one(a.support.transition.end, b).emulateTransitionEnd(150) : b() } else !this.isShown && this.$backdrop ? (this.$backdrop.removeClass("in"), a.support.transition && this.$element.hasClass("fade") ? this.$backdrop.one(a.support.transition.end, b).emulateTransitionEnd(150) : b()) : b && b() }; var c = a.fn.modal; a.fn.modal = function (c, d) { return this.each(function () { var e = a(this), f = e.data("bs.modal"), g = a.extend({}, b.DEFAULTS, e.data(), "object" == typeof c && c); f || e.data("bs.modal", f = new b(this, g)), "string" == typeof c ? f[c](d) : g.show && f.show(d) }) }, a.fn.modal.Constructor = b, a.fn.modal.noConflict = function () { return a.fn.modal = c, this }, a(document).on("click.bs.modal.data-api", '[data-toggle="modal"]', function (b) { var c = a(this), d = c.attr("href"), e = a(c.attr("data-target") || d && d.replace(/.*(?=#[^\s]+$)/, "")), f = e.data("modal") ? "toggle" : a.extend({ remote: !/#/.test(d) && d }, e.data(), c.data()); b.preventDefault(), e.modal(f, this).one("hide", function () { c.is(":visible") && c.focus() }) }), a(document).on("show.bs.modal", ".modal", function () { a(document.body).addClass("modal-open") }).on("hidden.bs.modal", ".modal", function () { a(document.body).removeClass("modal-open") }) }(window.jQuery), +function (a) { "use strict"; var b = function (a, b) { this.type = this.options = this.enabled = this.timeout = this.hoverState = this.$element = null, this.init("tooltip", a, b) }; b.DEFAULTS = { animation: !0, placement: "top", selector: !1, template: '<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>', trigger: "hover focus", title: "", delay: 0, html: !1, container: !1 }, b.prototype.init = function (b, c, d) { this.enabled = !0, this.type = b, this.$element = a(c), this.options = this.getOptions(d); for (var e = this.options.trigger.split(" "), f = e.length; f--;) { var g = e[f]; if ("click" == g) this.$element.on("click." + this.type, this.options.selector, a.proxy(this.toggle, this)); else if ("manual" != g) { var h = "hover" == g ? "mouseenter" : "focus", i = "hover" == g ? "mouseleave" : "blur"; this.$element.on(h + "." + this.type, this.options.selector, a.proxy(this.enter, this)), this.$element.on(i + "." + this.type, this.options.selector, a.proxy(this.leave, this)) } } this.options.selector ? this._options = a.extend({}, this.options, { trigger: "manual", selector: "" }) : this.fixTitle() }, b.prototype.getDefaults = function () { return b.DEFAULTS }, b.prototype.getOptions = function (b) { return b = a.extend({}, this.getDefaults(), this.$element.data(), b), b.delay && "number" == typeof b.delay && (b.delay = { show: b.delay, hide: b.delay }), b }, b.prototype.getDelegateOptions = function () { var b = {}, c = this.getDefaults(); return this._options && a.each(this._options, function (a, d) { c[a] != d && (b[a] = d) }), b }, b.prototype.enter = function (b) { var c = b instanceof this.constructor ? b : a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs." + this.type); return clearTimeout(c.timeout), c.hoverState = "in", c.options.delay && c.options.delay.show ? (c.timeout = setTimeout(function () { "in" == c.hoverState && c.show() }, c.options.delay.show), void 0) : c.show() }, b.prototype.leave = function (b) { var c = b instanceof this.constructor ? b : a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs." + this.type); return clearTimeout(c.timeout), c.hoverState = "out", c.options.delay && c.options.delay.hide ? (c.timeout = setTimeout(function () { "out" == c.hoverState && c.hide() }, c.options.delay.hide), void 0) : c.hide() }, b.prototype.show = function () { var b = a.Event("show.bs." + this.type); if (this.hasContent() && this.enabled) { if (this.$element.trigger(b), b.isDefaultPrevented()) return; var c = this.tip(); this.setContent(), this.options.animation && c.addClass("fade"); var d = "function" == typeof this.options.placement ? this.options.placement.call(this, c[0], this.$element[0]) : this.options.placement, e = /\s?auto?\s?/i, f = e.test(d); f && (d = d.replace(e, "") || "top"), c.detach().css({ top: 0, left: 0, display: "block" }).addClass(d), this.options.container ? c.appendTo(this.options.container) : c.insertAfter(this.$element); var g = this.getPosition(), h = c[0].offsetWidth, i = c[0].offsetHeight; if (f) { var j = this.$element.parent(), k = d, l = document.documentElement.scrollTop || document.body.scrollTop, m = "body" == this.options.container ? window.innerWidth : j.outerWidth(), n = "body" == this.options.container ? window.innerHeight : j.outerHeight(), o = "body" == this.options.container ? 0 : j.offset().left; d = "bottom" == d && g.top + g.height + i - l > n ? "top" : "top" == d && g.top - l - i < 0 ? "bottom" : "right" == d && g.right + h > m ? "left" : "left" == d && g.left - h < o ? "right" : d, c.removeClass(k).addClass(d) } var p = this.getCalculatedOffset(d, g, h, i); this.applyPlacement(p, d), this.$element.trigger("shown.bs." + this.type) } }, b.prototype.applyPlacement = function (a, b) { var c, d = this.tip(), e = d[0].offsetWidth, f = d[0].offsetHeight, g = parseInt(d.css("margin-top"), 10), h = parseInt(d.css("margin-left"), 10); isNaN(g) && (g = 0), isNaN(h) && (h = 0), a.top = a.top + g, a.left = a.left + h, d.offset(a).addClass("in"); var i = d[0].offsetWidth, j = d[0].offsetHeight; if ("top" == b && j != f && (c = !0, a.top = a.top + f - j), /bottom|top/.test(b)) { var k = 0; a.left < 0 && (k = -2 * a.left, a.left = 0, d.offset(a), i = d[0].offsetWidth, j = d[0].offsetHeight), this.replaceArrow(k - e + i, i, "left") } else this.replaceArrow(j - f, j, "top"); c && d.offset(a) }, b.prototype.replaceArrow = function (a, b, c) { this.arrow().css(c, a ? 50 * (1 - a / b) + "%" : "") }, b.prototype.setContent = function () { var a = this.tip(), b = this.getTitle(); a.find(".tooltip-inner")[this.options.html ? "html" : "text"](b), a.removeClass("fade in top bottom left right") }, b.prototype.hide = function () { function b() { "in" != c.hoverState && d.detach() } var c = this, d = this.tip(), e = a.Event("hide.bs." + this.type); return this.$element.trigger(e), e.isDefaultPrevented() ? void 0 : (d.removeClass("in"), a.support.transition && this.$tip.hasClass("fade") ? d.one(a.support.transition.end, b).emulateTransitionEnd(150) : b(), this.$element.trigger("hidden.bs." + this.type), this) }, b.prototype.fixTitle = function () { var a = this.$element; (a.attr("title") || "string" != typeof a.attr("data-original-title")) && a.attr("data-original-title", a.attr("title") || "").attr("title", "") }, b.prototype.hasContent = function () { return this.getTitle() }, b.prototype.getPosition = function () { var b = this.$element[0]; return a.extend({}, "function" == typeof b.getBoundingClientRect ? b.getBoundingClientRect() : { width: b.offsetWidth, height: b.offsetHeight }, this.$element.offset()) }, b.prototype.getCalculatedOffset = function (a, b, c, d) { return "bottom" == a ? { top: b.top + b.height, left: b.left + b.width / 2 - c / 2 } : "top" == a ? { top: b.top - d, left: b.left + b.width / 2 - c / 2 } : "left" == a ? { top: b.top + b.height / 2 - d / 2, left: b.left - c } : { top: b.top + b.height / 2 - d / 2, left: b.left + b.width } }, b.prototype.getTitle = function () { var a, b = this.$element, c = this.options; return a = b.attr("data-original-title") || ("function" == typeof c.title ? c.title.call(b[0]) : c.title) }, b.prototype.tip = function () { return this.$tip = this.$tip || a(this.options.template) }, b.prototype.arrow = function () { return this.$arrow = this.$arrow || this.tip().find(".tooltip-arrow") }, b.prototype.validate = function () { this.$element[0].parentNode || (this.hide(), this.$element = null, this.options = null) }, b.prototype.enable = function () { this.enabled = !0 }, b.prototype.disable = function () { this.enabled = !1 }, b.prototype.toggleEnabled = function () { this.enabled = !this.enabled }, b.prototype.toggle = function (b) { var c = b ? a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs." + this.type) : this; c.tip().hasClass("in") ? c.leave(c) : c.enter(c) }, b.prototype.destroy = function () { this.hide().$element.off("." + this.type).removeData("bs." + this.type) }; var c = a.fn.tooltip; a.fn.tooltip = function (c) { return this.each(function () { var d = a(this), e = d.data("bs.tooltip"), f = "object" == typeof c && c; e || d.data("bs.tooltip", e = new b(this, f)), "string" == typeof c && e[c]() }) }, a.fn.tooltip.Constructor = b, a.fn.tooltip.noConflict = function () { return a.fn.tooltip = c, this } }(window.jQuery), +function (a) { "use strict"; var b = function (a, b) { this.init("popover", a, b) }; if (!a.fn.tooltip) throw new Error("Popover requires tooltip.js"); b.DEFAULTS = a.extend({}, a.fn.tooltip.Constructor.DEFAULTS, { placement: "right", trigger: "click", content: "", template: '<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>' }), b.prototype = a.extend({}, a.fn.tooltip.Constructor.prototype), b.prototype.constructor = b, b.prototype.getDefaults = function () { return b.DEFAULTS }, b.prototype.setContent = function () { var a = this.tip(), b = this.getTitle(), c = this.getContent(); a.find(".popover-title")[this.options.html ? "html" : "text"](b), a.find(".popover-content")[this.options.html ? "html" : "text"](c), a.removeClass("fade top bottom left right in"), a.find(".popover-title").html() || a.find(".popover-title").hide() }, b.prototype.hasContent = function () { return this.getTitle() || this.getContent() }, b.prototype.getContent = function () { var a = this.$element, b = this.options; return a.attr("data-content") || ("function" == typeof b.content ? b.content.call(a[0]) : b.content) }, b.prototype.arrow = function () { return this.$arrow = this.$arrow || this.tip().find(".arrow") }, b.prototype.tip = function () { return this.$tip || (this.$tip = a(this.options.template)), this.$tip }; var c = a.fn.popover; a.fn.popover = function (c) { return this.each(function () { var d = a(this), e = d.data("bs.popover"), f = "object" == typeof c && c; e || d.data("bs.popover", e = new b(this, f)), "string" == typeof c && e[c]() }) }, a.fn.popover.Constructor = b, a.fn.popover.noConflict = function () { return a.fn.popover = c, this } }(window.jQuery), +function (a) { "use strict"; function b(c, d) { var e, f = a.proxy(this.process, this); this.$element = a(c).is("body") ? a(window) : a(c), this.$body = a("body"), this.$scrollElement = this.$element.on("scroll.bs.scroll-spy.data-api", f), this.options = a.extend({}, b.DEFAULTS, d), this.selector = (this.options.target || (e = a(c).attr("href")) && e.replace(/.*(?=#[^\s]+$)/, "") || "") + " .nav li > a", this.offsets = a([]), this.targets = a([]), this.activeTarget = null, this.refresh(), this.process() } b.DEFAULTS = { offset: 10 }, b.prototype.refresh = function () { var b = this.$element[0] == window ? "offset" : "position"; this.offsets = a([]), this.targets = a([]); var c = this; this.$body.find(this.selector).map(function () { var d = a(this), e = d.data("target") || d.attr("href"), f = /^#\w/.test(e) && a(e); return f && f.length && [[f[b]().top + (!a.isWindow(c.$scrollElement.get(0)) && c.$scrollElement.scrollTop()), e]] || null }).sort(function (a, b) { return a[0] - b[0] }).each(function () { c.offsets.push(this[0]), c.targets.push(this[1]) }) }, b.prototype.process = function () { var a, b = this.$scrollElement.scrollTop() + this.options.offset, c = this.$scrollElement[0].scrollHeight || this.$body[0].scrollHeight, d = c - this.$scrollElement.height(), e = this.offsets, f = this.targets, g = this.activeTarget; if (b >= d) return g != (a = f.last()[0]) && this.activate(a); for (a = e.length; a--;)g != f[a] && b >= e[a] && (!e[a + 1] || b <= e[a + 1]) && this.activate(f[a]) }, b.prototype.activate = function (b) { this.activeTarget = b, a(this.selector).parents(".active").removeClass("active"); var c = this.selector + '[data-target="' + b + '"],' + this.selector + '[href="' + b + '"]', d = a(c).parents("li").addClass("active"); d.parent(".dropdown-menu").length && (d = d.closest("li.dropdown").addClass("active")), d.trigger("activate") }; var c = a.fn.scrollspy; a.fn.scrollspy = function (c) { return this.each(function () { var d = a(this), e = d.data("bs.scrollspy"), f = "object" == typeof c && c; e || d.data("bs.scrollspy", e = new b(this, f)), "string" == typeof c && e[c]() }) }, a.fn.scrollspy.Constructor = b, a.fn.scrollspy.noConflict = function () { return a.fn.scrollspy = c, this }, a(window).on("load", function () { a('[data-spy="scroll"]').each(function () { var b = a(this); b.scrollspy(b.data()) }) }) }(window.jQuery), +function (a) { "use strict"; var b = function (b) { this.element = a(b) }; b.prototype.show = function () { var b = this.element, c = b.closest("ul:not(.dropdown-menu)"), d = b.attr("data-target"); if (d || (d = b.attr("href"), d = d && d.replace(/.*(?=#[^\s]*$)/, "")), !b.parent("li").hasClass("active")) { var e = c.find(".active:last a")[0], f = a.Event("show.bs.tab", { relatedTarget: e }); if (b.trigger(f), !f.isDefaultPrevented()) { var g = a(d); this.activate(b.parent("li"), c), this.activate(g, g.parent(), function () { b.trigger({ type: "shown.bs.tab", relatedTarget: e }) }) } } }, b.prototype.activate = function (b, c, d) { function e() { f.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"), b.addClass("active"), g ? (b[0].offsetWidth, b.addClass("in")) : b.removeClass("fade"), b.parent(".dropdown-menu") && b.closest("li.dropdown").addClass("active"), d && d() } var f = c.find("> .active"), g = d && a.support.transition && f.hasClass("fade"); g ? f.one(a.support.transition.end, e).emulateTransitionEnd(150) : e(), f.removeClass("in") }; var c = a.fn.tab; a.fn.tab = function (c) { return this.each(function () { var d = a(this), e = d.data("bs.tab"); e || d.data("bs.tab", e = new b(this)), "string" == typeof c && e[c]() }) }, a.fn.tab.Constructor = b, a.fn.tab.noConflict = function () { return a.fn.tab = c, this }, a(document).on("click.bs.tab.data-api", '[data-toggle="tab"], [data-toggle="pill"]', function (b) { b.preventDefault(), a(this).tab("show") }) }(window.jQuery), +function (a) { "use strict"; var b = function (c, d) { this.options = a.extend({}, b.DEFAULTS, d), this.$window = a(window).on("scroll.bs.affix.data-api", a.proxy(this.checkPosition, this)).on("click.bs.affix.data-api", a.proxy(this.checkPositionWithEventLoop, this)), this.$element = a(c), this.affixed = this.unpin = null, this.checkPosition() }; b.RESET = "affix affix-top affix-bottom", b.DEFAULTS = { offset: 0 }, b.prototype.checkPositionWithEventLoop = function () { setTimeout(a.proxy(this.checkPosition, this), 1) }, b.prototype.checkPosition = function () { if (this.$element.is(":visible")) { var c = a(document).height(), d = this.$window.scrollTop(), e = this.$element.offset(), f = this.options.offset, g = f.top, h = f.bottom; "object" != typeof f && (h = g = f), "function" == typeof g && (g = f.top()), "function" == typeof h && (h = f.bottom()); var i = null != this.unpin && d + this.unpin <= e.top ? !1 : null != h && e.top + this.$element.height() >= c - h ? "bottom" : null != g && g >= d ? "top" : !1; this.affixed !== i && (this.unpin && this.$element.css("top", ""), this.affixed = i, this.unpin = "bottom" == i ? e.top - d : null, this.$element.removeClass(b.RESET).addClass("affix" + (i ? "-" + i : "")), "bottom" == i && this.$element.offset({ top: document.body.offsetHeight - h - this.$element.height() })) } }; var c = a.fn.affix; a.fn.affix = function (c) { return this.each(function () { var d = a(this), e = d.data("bs.affix"), f = "object" == typeof c && c; e || d.data("bs.affix", e = new b(this, f)), "string" == typeof c && e[c]() }) }, a.fn.affix.Constructor = b, a.fn.affix.noConflict = function () { return a.fn.affix = c, this }, a(window).on("load", function () { a('[data-spy="affix"]').each(function () { var b = a(this), c = b.data(); c.offset = c.offset || {}, c.offsetBottom && (c.offset.bottom = c.offsetBottom), c.offsetTop && (c.offset.top = c.offsetTop), b.affix(c) }) }) }(window.jQuery);
/**
 * bootbox.js v4.4.0
 *
 * http://bootboxjs.com/license.txt
 */
!function (a, b) { "use strict"; "function" == typeof define && define.amd ? define(["jquery"], b) : "object" == typeof exports ? module.exports = b(require("jquery")) : a.bootbox = b(a.jQuery) }(this, function a(b, c) { "use strict"; function d(a) { var b = q[o.locale]; return b ? b[a] : q.en[a] } function e(a, c, d) { a.stopPropagation(), a.preventDefault(); var e = b.isFunction(d) && d.call(c, a) === !1; e || c.modal("hide") } function f(a) { var b, c = 0; for (b in a) c++; return c } function g(a, c) { var d = 0; b.each(a, function (a, b) { c(a, b, d++) }) } function h(a) { var c, d; if ("object" != typeof a) throw new Error("Please supply an object of options"); if (!a.message) throw new Error("Please specify a message"); return a = b.extend({}, o, a), a.buttons || (a.buttons = {}), c = a.buttons, d = f(c), g(c, function (a, e, f) { if (b.isFunction(e) && (e = c[a] = { callback: e }), "object" !== b.type(e)) throw new Error("button with key " + a + " must be an object"); e.label || (e.label = a), e.className || (e.className = 2 >= d && f === d - 1 ? "btn-primary" : "btn-default") }), a } function i(a, b) { var c = a.length, d = {}; if (1 > c || c > 2) throw new Error("Invalid argument length"); return 2 === c || "string" == typeof a[0] ? (d[b[0]] = a[0], d[b[1]] = a[1]) : d = a[0], d } function j(a, c, d) { return b.extend(!0, {}, a, i(c, d)) } function k(a, b, c, d) { var e = { className: "bootbox-" + a, buttons: l.apply(null, b) }; return m(j(e, d, c), b) } function l() { for (var a = {}, b = 0, c = arguments.length; c > b; b++) { var e = arguments[b], f = e.toLowerCase(), g = e.toUpperCase(); a[f] = { label: d(g) } } return a } function m(a, b) { var d = {}; return g(b, function (a, b) { d[b] = !0 }), g(a.buttons, function (a) { if (d[a] === c) throw new Error("button key " + a + " is not allowed (options are " + b.join("\n") + ")") }), a } var n = { dialog: "<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>", header: "<div class='modal-header'><h4 class='modal-title'></h4></div>", footer: "<div class='modal-footer'></div>", closeButton: "<button type='button' class='bootbox-close-button close' data-dismiss='modal' aria-hidden='true'>&times;</button>", form: "<form class='bootbox-form'></form>", inputs: { text: "<input class='bootbox-input bootbox-input-text form-control' autocomplete=off type=text />", textarea: "<textarea class='bootbox-input bootbox-input-textarea form-control'></textarea>", email: "<input class='bootbox-input bootbox-input-email form-control' autocomplete='off' type='email' />", select: "<select class='bootbox-input bootbox-input-select form-control'></select>", checkbox: "<div class='checkbox'><label><input class='bootbox-input bootbox-input-checkbox' type='checkbox' /></label></div>", date: "<input class='bootbox-input bootbox-input-date form-control' autocomplete=off type='date' />", time: "<input class='bootbox-input bootbox-input-time form-control' autocomplete=off type='time' />", number: "<input class='bootbox-input bootbox-input-number form-control' autocomplete=off type='number' />", password: "<input class='bootbox-input bootbox-input-password form-control' autocomplete='off' type='password' />" } }, o = { locale: "en", backdrop: "static", animate: !0, className: null, closeButton: !0, show: !0, container: "body" }, p = {}; p.alert = function () { var a; if (a = k("alert", ["ok"], ["message", "callback"], arguments), a.callback && !b.isFunction(a.callback)) throw new Error("alert requires callback property to be a function when provided"); return a.buttons.ok.callback = a.onEscape = function () { return b.isFunction(a.callback) ? a.callback.call(this) : !0 }, p.dialog(a) }, p.confirm = function () { var a; if (a = k("confirm", ["cancel", "confirm"], ["message", "callback"], arguments), a.buttons.cancel.callback = a.onEscape = function () { return a.callback.call(this, !1) }, a.buttons.confirm.callback = function () { return a.callback.call(this, !0) }, !b.isFunction(a.callback)) throw new Error("confirm requires a callback"); return p.dialog(a) }, p.prompt = function () { var a, d, e, f, h, i, k; if (f = b(n.form), d = { className: "bootbox-prompt", buttons: l("cancel", "confirm"), value: "", inputType: "text" }, a = m(j(d, arguments, ["title", "callback"]), ["cancel", "confirm"]), i = a.show === c ? !0 : a.show, a.message = f, a.buttons.cancel.callback = a.onEscape = function () { return a.callback.call(this, null) }, a.buttons.confirm.callback = function () { var c; switch (a.inputType) { case "text": case "textarea": case "email": case "select": case "date": case "time": case "number": case "password": c = h.val(); break; case "checkbox": var d = h.find("input:checked"); c = [], g(d, function (a, d) { c.push(b(d).val()) }) }return a.callback.call(this, c) }, a.show = !1, !a.title) throw new Error("prompt requires a title"); if (!b.isFunction(a.callback)) throw new Error("prompt requires a callback"); if (!n.inputs[a.inputType]) throw new Error("invalid prompt type"); switch (h = b(n.inputs[a.inputType]), a.inputType) { case "text": case "textarea": case "email": case "date": case "time": case "number": case "password": h.val(a.value); break; case "select": var o = {}; if (k = a.inputOptions || [], !b.isArray(k)) throw new Error("Please pass an array of input options"); if (!k.length) throw new Error("prompt with select requires options"); g(k, function (a, d) { var e = h; if (d.value === c || d.text === c) throw new Error("given options in wrong format"); d.group && (o[d.group] || (o[d.group] = b("<optgroup/>").attr("label", d.group)), e = o[d.group]), e.append("<option value='" + d.value + "'>" + d.text + "</option>") }), g(o, function (a, b) { h.append(b) }), h.val(a.value); break; case "checkbox": var q = b.isArray(a.value) ? a.value : [a.value]; if (k = a.inputOptions || [], !k.length) throw new Error("prompt with checkbox requires options"); if (!k[0].value || !k[0].text) throw new Error("given options in wrong format"); h = b("<div/>"), g(k, function (c, d) { var e = b(n.inputs[a.inputType]); e.find("input").attr("value", d.value), e.find("label").append(d.text), g(q, function (a, b) { b === d.value && e.find("input").prop("checked", !0) }), h.append(e) }) }return a.placeholder && h.attr("placeholder", a.placeholder), a.pattern && h.attr("pattern", a.pattern), a.maxlength && h.attr("maxlength", a.maxlength), f.append(h), f.on("submit", function (a) { a.preventDefault(), a.stopPropagation(), e.find(".btn-primary").click() }), e = p.dialog(a), e.off("shown.bs.modal"), e.on("shown.bs.modal", function () { h.focus() }), i === !0 && e.modal("show"), e }, p.dialog = function (a) { a = h(a); var d = b(n.dialog), f = d.find(".modal-dialog"), i = d.find(".modal-body"), j = a.buttons, k = "", l = { onEscape: a.onEscape }; if (b.fn.modal === c) throw new Error("$.fn.modal is not defined; please double check you have included the Bootstrap JavaScript library. See http://getbootstrap.com/javascript/ for more details."); if (g(j, function (a, b) { k += "<button data-bb-handler='" + a + "' type='button' class='btn " + b.className + "'>" + b.label + "</button>", l[a] = b.callback }), i.find(".bootbox-body").html(a.message), a.animate === !0 && d.addClass("fade"), a.className && d.addClass(a.className), "large" === a.size ? f.addClass("modal-lg") : "small" === a.size && f.addClass("modal-sm"), a.title && i.before(n.header), a.closeButton) { var m = b(n.closeButton); a.title ? d.find(".modal-header").prepend(m) : m.css("margin-top", "-10px").prependTo(i) } return a.title && d.find(".modal-title").html(a.title), k.length && (i.after(n.footer), d.find(".modal-footer").html(k)), d.on("hidden.bs.modal", function (a) { a.target === this && d.remove() }), d.on("shown.bs.modal", function () { d.find(".btn-primary:first").focus() }), "static" !== a.backdrop && d.on("click.dismiss.bs.modal", function (a) { d.children(".modal-backdrop").length && (a.currentTarget = d.children(".modal-backdrop").get(0)), a.target === a.currentTarget && d.trigger("escape.close.bb") }), d.on("escape.close.bb", function (a) { l.onEscape && e(a, d, l.onEscape) }), d.on("click", ".modal-footer button", function (a) { var c = b(this).data("bb-handler"); e(a, d, l[c]) }), d.on("click", ".bootbox-close-button", function (a) { e(a, d, l.onEscape) }), d.on("keyup", function (a) { 27 === a.which && d.trigger("escape.close.bb") }), b(a.container).append(d), d.modal({ backdrop: a.backdrop ? "static" : !1, keyboard: !1, show: !1 }), a.show && d.modal("show"), d }, p.setDefaults = function () { var a = {}; 2 === arguments.length ? a[arguments[0]] = arguments[1] : a = arguments[0], b.extend(o, a) }, p.hideAll = function () { return b(".bootbox").modal("hide"), p }; var q = { bg_BG: { OK: "ÐžÐº", CANCEL: "ÐžÑ‚ÐºÐ°Ð·", CONFIRM: "ÐŸÐ¾Ñ‚Ð²ÑŠÑ€Ð¶Ð´Ð°Ð²Ð°Ð¼" }, br: { OK: "OK", CANCEL: "Cancelar", CONFIRM: "Sim" }, cs: { OK: "OK", CANCEL: "ZruÅ¡it", CONFIRM: "Potvrdit" }, da: { OK: "OK", CANCEL: "Annuller", CONFIRM: "Accepter" }, de: { OK: "OK", CANCEL: "Abbrechen", CONFIRM: "Akzeptieren" }, el: { OK: "Î•Î½Ï„Î¬Î¾ÎµÎ¹", CANCEL: "Î‘ÎºÏÏÏ‰ÏƒÎ·", CONFIRM: "Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·" }, en: { OK: "OK", CANCEL: "Cancel", CONFIRM: "OK" }, es: { OK: "OK", CANCEL: "Cancelar", CONFIRM: "Aceptar" }, et: { OK: "OK", CANCEL: "Katkesta", CONFIRM: "OK" }, fa: { OK: "Ù‚Ø¨ÙˆÙ„", CANCEL: "Ù„ØºÙˆ", CONFIRM: "ØªØ§ÛŒÛŒØ¯" }, fi: { OK: "OK", CANCEL: "Peruuta", CONFIRM: "OK" }, fr: { OK: "OK", CANCEL: "Annuler", CONFIRM: "D'accord" }, he: { OK: "××™×©×•×¨", CANCEL: "×‘×™×˜×•×œ", CONFIRM: "××™×©×•×¨" }, hu: { OK: "OK", CANCEL: "MÃ©gsem", CONFIRM: "MegerÅ‘sÃ­t" }, hr: { OK: "OK", CANCEL: "Odustani", CONFIRM: "Potvrdi" }, id: { OK: "OK", CANCEL: "Batal", CONFIRM: "OK" }, it: { OK: "OK", CANCEL: "Annulla", CONFIRM: "Conferma" }, ja: { OK: "OK", CANCEL: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«", CONFIRM: "ç¢ºèª" }, lt: { OK: "Gerai", CANCEL: "AtÅ¡aukti", CONFIRM: "Patvirtinti" }, lv: { OK: "Labi", CANCEL: "Atcelt", CONFIRM: "ApstiprinÄt" }, nl: { OK: "OK", CANCEL: "Annuleren", CONFIRM: "Accepteren" }, no: { OK: "OK", CANCEL: "Avbryt", CONFIRM: "OK" }, pl: { OK: "OK", CANCEL: "Anuluj", CONFIRM: "PotwierdÅº" }, pt: { OK: "OK", CANCEL: "Cancelar", CONFIRM: "Confirmar" }, ru: { OK: "OK", CANCEL: "ÐžÑ‚Ð¼ÐµÐ½Ð°", CONFIRM: "ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ" }, sq: { OK: "OK", CANCEL: "Anulo", CONFIRM: "Prano" }, sv: { OK: "OK", CANCEL: "Avbryt", CONFIRM: "OK" }, th: { OK: "à¸•à¸à¸¥à¸‡", CANCEL: "à¸¢à¸à¹€à¸¥à¸´à¸", CONFIRM: "à¸¢à¸·à¸™à¸¢à¸±à¸™" }, tr: { OK: "Tamam", CANCEL: "Ä°ptal", CONFIRM: "Onayla" }, zh_CN: { OK: "OK", CANCEL: "å–æ¶ˆ", CONFIRM: "ç¡®è®¤" }, zh_TW: { OK: "OK", CANCEL: "å–æ¶ˆ", CONFIRM: "ç¢ºèª" } }; return p.addLocale = function (a, c) { return b.each(["OK", "CANCEL", "CONFIRM"], function (a, b) { if (!c[b]) throw new Error("Please supply a translation for '" + b + "'") }), q[a] = { OK: c.OK, CANCEL: c.CANCEL, CONFIRM: c.CONFIRM }, p }, p.removeLocale = function (a) { return delete q[a], p }, p.setLocale = function (a) { return p.setDefaults("locale", a) }, p.init = function (c) { return a(c || b) }, p });
// jQuery Mask Plugin v1.7.7
// github.com/igorescobar/jQuery-Mask-Plugin
(function (f) { "function" === typeof define && define.amd ? define(["jquery"], f) : f(window.jQuery || window.Zepto) })(function (f) {
    var A = function (a, d, b) {
        var h = this, m, p; a = f(a); d = "function" === typeof d ? d(a.val(), void 0, a, b) : d; var c = {
            getCaret: function () { try { var e, l = 0, c = a.get(0), g = document.selection, d = c.selectionStart; if (g && !~navigator.appVersion.indexOf("MSIE 10")) e = g.createRange(), e.moveStart("character", a.is("input") ? -a.val().length : -a.text().length), l = e.text.length; else if (d || "0" === d) l = d; return l } catch (b) { } }, setCaret: function (e) {
                try {
                    if (a.is(":focus")) {
                        var l,
                        c = a.get(0); c.setSelectionRange ? c.setSelectionRange(e, e) : c.createTextRange && (l = c.createTextRange(), l.collapse(!0), l.moveEnd("character", e), l.moveStart("character", e), l.select())
                    }
                } catch (g) { }
            }, events: function () {
                a.on("keydown.mask", function () { m = c.val() }).on("keyup.mask", c.behaviour).on("paste.mask drop.mask", function () { setTimeout(function () { a.keydown().keyup() }, 100) }).on("change.mask", function () { a.data("changed", !0) }).on("blur.mask", function () {
                m === a.val() || a.data("changed") || a.trigger("change"); a.data("changed",
                    !1)
                }).on("focusout.mask", function () { b.clearIfNotMatch && !p.test(c.val()) && c.val("") })
            }, getRegexMask: function () { for (var e = [], a, c, g, b, k = 0; k < d.length; k++)(a = h.translation[d[k]]) ? (c = a.pattern.toString().replace(/.{1}$|^.{1}/g, ""), g = a.optional, (a = a.recursive) ? (e.push(d[k]), b = { digit: d[k], pattern: c }) : e.push(g || a ? c + "?" : c)) : e.push(d[k].replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&")); e = e.join(""); b && (e = e.replace(new RegExp("(" + b.digit + "(.*" + b.digit + ")?)"), "($1)?").replace(new RegExp(b.digit, "g"), b.pattern)); return new RegExp(e) },
            destroyEvents: function () { a.off("keydown keyup paste drop change blur focusout DOMNodeInserted ".split(" ").join(".mask ")).removeData("changeCalled") }, val: function (e) { var c = a.is("input"); return 0 < arguments.length ? c ? a.val(e) : a.text(e) : c ? a.val() : a.text() }, getMCharsBeforeCount: function (e, a) { for (var c = 0, b = 0, f = d.length; b < f && b < e; b++)h.translation[d.charAt(b)] || (e = a ? e + 1 : e, c++); return c }, caretPos: function (e, a, b, g) {
                return h.translation[d.charAt(Math.min(e - 1, d.length - 1))] ? Math.min(e + b - a - g, b) : c.caretPos(e + 1,
                    a, b, g)
            }, behaviour: function (a) { a = a || window.event; var b = a.keyCode || a.which; if (-1 === f.inArray(b, h.byPassKeys)) { var d = c.getCaret(), g = c.val(), t = g.length, k = d < t, m = c.getMasked(), n = m.length, p = c.getMCharsBeforeCount(n - 1) - c.getMCharsBeforeCount(t - 1); m !== g && c.val(m); !k || 65 === b && a.ctrlKey || (8 !== b && 46 !== b && (d = c.caretPos(d, t, n, p)), c.setCaret(d)); return c.callbacks(a) } }, getMasked: function (a) {
                var l = [], f = c.val(), g = 0, m = d.length, k = 0, p = f.length, n = 1, u = "push", r = -1, q, v; b.reverse ? (u = "unshift", n = -1, q = 0, g = m - 1, k = p - 1, v = function () {
                    return -1 <
                        g && -1 < k
                }) : (q = m - 1, v = function () { return g < m && k < p }); for (; v();) { var w = d.charAt(g), x = f.charAt(k), s = h.translation[w]; if (s) x.match(s.pattern) ? (l[u](x), s.recursive && (-1 === r ? r = g : g === q && (g = r - n), q === r && (g -= n)), g += n) : s.optional && (g += n, k -= n), k += n; else { if (!a) l[u](w); x === w && (k += n); g += n } } a = d.charAt(q); m !== p + 1 || h.translation[a] || l.push(a); return l.join("")
            }, callbacks: function (e) {
                var f = c.val(), h = f !== m; if (!0 === h && "function" === typeof b.onChange) b.onChange(f, e, a, b); if (!0 === h && "function" === typeof b.onKeyPress) b.onKeyPress(f,
                    e, a, b); if ("function" === typeof b.onComplete && f.length === d.length) b.onComplete(f, e, a, b)
            }
        }; h.mask = d; h.options = b; h.remove = function () { var b; c.destroyEvents(); c.val(h.getCleanVal()).removeAttr("maxlength"); b = c.getCaret(); c.setCaret(b - c.getMCharsBeforeCount(b)); return a }; h.getCleanVal = function () { return c.getMasked(!0) }; h.init = function () {
            b = b || {}; h.byPassKeys = [9, 16, 17, 18, 36, 37, 38, 39, 40, 91]; h.translation = {
                0: { pattern: /\d/ }, 9: { pattern: /\d/, optional: !0 }, "#": { pattern: /\d/, recursive: !0 }, A: { pattern: /[a-zA-Z0-9]/ },
                S: { pattern: /[a-zA-Z]/ }
            }; h.translation = f.extend({}, h.translation, b.translation); h = f.extend(!0, {}, h, b); p = c.getRegexMask(); !1 !== b.maxlength && a.attr("maxlength", d.length); b.placeholder && a.attr("placeholder", b.placeholder); a.attr("autocomplete", "off"); c.destroyEvents(); c.events(); var e = c.getCaret(); c.val(c.getMasked()); c.setCaret(e + c.getMCharsBeforeCount(e, !0))
        }()
    }, y = {}, z = function () {
        var a = f(this), d = {}; a.attr("data-mask-reverse") && (d.reverse = !0); "false" === a.attr("data-mask-maxlength") && (d.maxlength = !1);
        a.attr("data-mask-clearifnotmatch") && (d.clearIfNotMatch = !0); a.mask(a.attr("data-mask"), d)
    }; f.fn.mask = function (a, d) { var b = this.selector, h = function () { var b = f(this).data("mask"), h = JSON.stringify; if ("object" !== typeof b || h(b.options) !== h(d) || b.mask !== a) return f(this).data("mask", new A(this, a, d)) }; this.each(h); b && !y[b] && (y[b] = !0, setTimeout(function () { f(document).on("DOMNodeInserted.mask", b, h) }, 500)) }; f.fn.unmask = function () { try { return this.each(function () { f(this).data("mask").remove().removeData("mask") }) } catch (a) { } };
    f.fn.cleanVal = function () { return this.data("mask").getCleanVal() }; f("*[data-mask]").each(z); f(document).on("DOMNodeInserted.mask", "*[data-mask]", z)
});

/*!
 * Author: Silvestre Pinheiro de Freitas Jr.
 * Date: 4 Jan 2014
 * Description:
 *      This file should be included in all pages
 !**/

/*
 * Global variables. If you change any of these vars, don't forget 
 * to change the values in the less files!
 */

(function ($) {
    var config;
    var obj;
    var methods = {
        init: function (settings) {
            _init(settings, $(this));
            return this;
        },
        phone: function (options) {
            _init(options, $(this));
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");

                if (v.length <= 10) {
                    $(this).val(telefone(v));
                }
                else {
                    $(this).val(telefone1(v));
                }

                if ($(this).val().length > 15) $(this).val($(this).val().substring(0, 15));
            });
        },
        mobile: function () {
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");

                $(this).val(telefone1(v));

                if ($(this).val().length > 15) $(this).val($(this).val().substring(0, 15));
            });
        },
        cpf: function () {
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");

                if (v.length > 11) v = v.substring(0, 11);

                $(this).val(cpf(v));
            });
        },
        cnpj: function () {
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");

                if (v.length > 14) v = v.substring(0, 14);

                $(this).val(cnpj(v));
            });
        },
        cpfcnpj: function () {
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");

                if (v.length <= 11) {
                    $(this).val(cpf(v));
                }
                else {
                    $(this).val(cnpj(v));
                }

                if ($(this).val().length > 18) $(this).val($(this).val().substring(0, 18));
            });
        },
        cep: function () {
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");

                $(this).val(cep(v));

                if ($(this).val().length > 9) $(this).val($(this).val().substring(0, 9));
            });
        },
        date: function () {
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");

                $(this).val(data(v));

                if ($(this).val().length > 10) $(this).val($(this).val().substring(0, 10));
            });
        },
        datetime: function () {
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");
                v = v.substring(0, 12);

                $(this).val(datahorasegundo(v));
            });
        },
        datetimefull: function () {
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");
                v = v.substring(0, 14);

                $(this).val(datahorasegundo(v));
            });
        },
        integer: function () {
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");

                $(this).val(soNumeros(v));
            })
        },
        decimal: function () {
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");

                $(this).autoNumeric({ mNum: 10, mDec: 2, aSep: '', aDec: ',', aPad: true });
            })
        },
        currency: function () {
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");
                $(this).autoNumeric({ mNum: 10, mDec: 2, aSep: '.', aDec: ',', aPad: true });
            })
        },
        qtd: function () {
            $(this).bind("keyup", function () {
                var v = $(this).val().toString();
                var v = v.replace(/\D/g, "");
                $(this).autoNumeric({ mNum: 10, mDec: 4, aSep: '.', aDec: ',', aPad: true });
            })
        }
    };

    function _init(settings, _obj) {
        obj = _obj;
        config = {
            'ClassMaskphone': 'telefone',
            'ClassMaskCelular': 'celular',
            'ClassMaskCPF': 'cpf',
            'ClassMaskCNPJ': 'cnpj',
            'ClassMaskCPFCNPJ': 'cpfcnjp',
            'ClassMaskCEP': 'cep',
            'ClassMaskDate': 'data',
            'ClassMaskDateTime': 'datahora',
            'ClassMaskDateTimeFull': 'datafull',
            'ClassMaskNumber': 'numerico',
        };

        if (settings) { $.extend(config, settings); }
    }
    function telefone(v) {
        v = v.replace(/\D/g, "")                 //Remove tudo o que nÃ£o Ã© dÃ­gito
        v = v.replace(/^(\d\d)(\d)/g, "($1) $2") //Coloca parÃªnteses em volta dos dois primeiros dÃ­gitos
        v = v.replace(/(\d{4})(\d)/, "$1-$2")    //Coloca hÃ­fen entre o quarto e o quinto dÃ­gitos
        return v
    }

    function telefone1(v) {
        v = v.replace(/\D/g, "")                 //Remove tudo o que nÃ£o Ã© dÃ­gito
        v = v.replace(/^(\d\d)(\d)/g, "($1) $2") //Coloca parÃªnteses em volta dos dois primeiros dÃ­gitos
        v = v.replace(/(\d{5})(\d)/, "$1-$2")    //Coloca hÃ­fen entre o quarto e o quinto dÃ­gitos
        return v
    }

    function data(v) {
        v = v.replace(/\D/g, "")
        v = v.replace(/^(\d{2})(\d)/, "$1/$2")
        v = v.replace(/(\d{2})(\d)/, "$1/$2")
        return v
    }

    function datahorasegundo(v) {
        v = v.replace(/\D/g, "")
        if (v.length == 2) v = v.replace(/^(\d{2})/, "$1/")
        //Mes
        if (v.length == 3) v = v.replace(/^(\d{2})(\d{1})/, "$1/$2")
        if (v.length == 4) v = v.replace(/^(\d{2})(\d{2})/, "$1/$2/")

        //Ano
        if (v.length == 5) v = v.replace(/^(\d{2})(\d{2})(\d{1})/, "$1/$2/$3")
        if (v.length == 6) v = v.replace(/^(\d{2})(\d{2})(\d{2})/, "$1/$2/$3")
        if (v.length == 7) v = v.replace(/^(\d{2})(\d{2})(\d{3})/, "$1/$2/$3")
        if (v.length == 8) v = v.replace(/^(\d{2})(\d{2})(\d{4})/, "$1/$2/$3 ")

        //Hora
        if (v.length == 9) v = v.replace(/^(\d{2})(\d{2})(\d{4})(\d{1})/, "$1/$2/$3 $4")
        if (v.length == 10) v = v.replace(/^(\d{2})(\d{2})(\d{4})(\d{2})/, "$1/$2/$3 $4:")

        if (v.length == 11) v = v.replace(/^(\d{2})(\d{2})(\d{4})(\d{2})(\d{1})/, "$1/$2/$3 $4:$5")
        if (v.length == 12) v = v.replace(/^(\d{2})(\d{2})(\d{4})(\d{2})(\d{2})/, "$1/$2/$3 $4:$5")

        if (v.length == 13) v = v.replace(/^(\d{2})(\d{2})(\d{4})(\d{2})(\d{2})(\d{1})/, "$1/$2/$3 $4:$5:$6")
        if (v.length == 14) v = v.replace(/^(\d{2})(\d{2})(\d{4})(\d{2})(\d{2})(\d{2})/, "$1/$2/$3 $4:$5:$6")

        return v
    }

    function soNumeros(v) {
        return v.replace(/\D/g, "")
    }

    function cnpj(v) {
        v = v.replace(/\D/g, "")                           //Remove tudo o que nÃ£o Ã© dÃ­gito
        v = v.replace(/^(\d{2})(\d)/, "$1.$2")             //Coloca ponto entre o segundo e o terceiro dÃ­gitos
        v = v.replace(/^(\d{2})\.(\d{3})(\d)/, "$1.$2.$3") //Coloca ponto entre o quinto e o sexto dÃ­gitos
        v = v.replace(/\.(\d{3})(\d)/, ".$1/$2")           //Coloca uma barra entre o oitavo e o nono dÃ­gitos
        v = v.replace(/(\d{4})(\d)/, "$1-$2")              //Coloca um hÃ­fen depois do bloco de quatro dÃ­gitos
        return v
    }

    function cpf(v) {
        v = v.replace(/\D/g, "")                    //Remove tudo o que nÃ£o Ã© dÃ­gito
        v = v.replace(/(\d{3})(\d)/, "$1.$2")       //Coloca um ponto entre o terceiro e o quarto dÃ­gitos
        v = v.replace(/(\d{3})(\d)/, "$1.$2")       //Coloca um ponto entre o terceiro e o quarto dÃ­gitos
        //de novo (para o segundo bloco de nÃºmeros)
        v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2") //Coloca um hÃ­fen entre o terceiro e o quarto dÃ­gitos
        return v
    }

    function cep(v) {
        v = v.replace(/D/g, "")                //Remove tudo o que nÃ£o Ã© dÃ­gito
        v = v.replace(/^(\d{5})(\d)/, "$1-$2") //Esse Ã© tÃ£o fÃ¡cil que nÃ£o merece explicaÃ§Ãµes
        return v
    }

    $.fn.g2itMasks = function (method) {
        // MetÃ³do de chamada
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.g2itMasks');
        }

        return this;
    };
})(jQuery);
/**
 * jQuery Timepicker - v1.3.5 - 2016-07-10
 * http://timepicker.co
 *
 * Enhances standard form input fields helping users to select (or type) times.
 *
 * Copyright (c) 2016 Willington Vega; Licensed MIT, GPL
 */

!function (a) { "object" == typeof module && "object" == typeof module.exports ? a(require("jquery"), window, document) : "undefined" != typeof jQuery && a(jQuery, window, document) }(function (a, b, c, d) { !function () { function b(a, b, c) { return new Array(c + 1 - a.length).join(b) + a } function d() { if (1 === arguments.length) { var b = arguments[0]; return "string" == typeof b && (b = a.fn.timepicker.parseTime(b)), new Date(0, 0, 0, b.getHours(), b.getMinutes(), b.getSeconds()) } return 3 === arguments.length ? new Date(0, 0, 0, arguments[0], arguments[1], arguments[2]) : 2 === arguments.length ? new Date(0, 0, 0, arguments[0], arguments[1], 0) : new Date(0, 0, 0) } a.TimePicker = function () { var b = this; b.container = a(".ui-timepicker-container"), b.ui = b.container.find(".ui-timepicker"), 0 === b.container.length && (b.container = a("<div></div>").addClass("ui-timepicker-container").addClass("ui-timepicker-hidden ui-helper-hidden").appendTo("body").hide(), b.ui = a("<div></div>").addClass("ui-timepicker").addClass("ui-widget ui-widget-content ui-menu").addClass("ui-corner-all").appendTo(b.container), b.viewport = a("<ul></ul>").addClass("ui-timepicker-viewport").appendTo(b.ui), a.fn.jquery >= "1.4.2" && b.ui.delegate("a", "mouseenter.timepicker", function () { b.activate(!1, a(this).parent()) }).delegate("a", "mouseleave.timepicker", function () { b.deactivate(!1) }).delegate("a", "click.timepicker", function (c) { c.preventDefault(), b.select(!1, a(this).parent()) })) }, a.TimePicker.count = 0, a.TimePicker.instance = function () { return a.TimePicker._instance || (a.TimePicker._instance = new a.TimePicker), a.TimePicker._instance }, a.TimePicker.prototype = { keyCode: { ALT: 18, BLOQ_MAYUS: 20, CTRL: 17, DOWN: 40, END: 35, ENTER: 13, HOME: 36, LEFT: 37, NUMPAD_ENTER: 108, PAGE_DOWN: 34, PAGE_UP: 33, RIGHT: 39, SHIFT: 16, TAB: 9, UP: 38 }, _items: function (b, c) { var e, f, g = this, h = a("<ul></ul>"), i = null; for (-1 === b.options.timeFormat.indexOf("m") && b.options.interval % 60 !== 0 && (b.options.interval = 60 * Math.max(Math.round(b.options.interval / 60), 1)), e = c ? d(c) : b.options.startTime ? d(b.options.startTime) : d(b.options.startHour, b.options.startMinutes), f = new Date(e.getTime() + 864e5); f > e;)g._isValidTime(b, e) && (i = a("<li>").addClass("ui-menu-item").appendTo(h), a("<a>").addClass("ui-corner-all").text(a.fn.timepicker.formatTime(b.options.timeFormat, e)).appendTo(i), i.data("time-value", e)), e = new Date(e.getTime() + 60 * b.options.interval * 1e3); return h.children() }, _isValidTime: function (a, b) { var c = null, e = null; return b = d(b), null !== a.options.minTime ? c = d(a.options.minTime) : (null !== a.options.minHour || null !== a.options.minMinutes) && (c = d(a.options.minHour, a.options.minMinutes)), null !== a.options.maxTime ? e = d(a.options.maxTime) : (null !== a.options.maxHour || null !== a.options.maxMinutes) && (e = d(a.options.maxHour, a.options.maxMinutes)), null !== c && null !== e ? b >= c && e >= b : null !== c ? b >= c : null !== e ? e >= b : !0 }, _hasScroll: function () { var a = "undefined" != typeof this.ui.prop ? "prop" : "attr"; return this.ui.height() < this.ui[a]("scrollHeight") }, _move: function (a, b, c) { var d = this; if (d.closed() && d.open(a), !d.active) return void d.activate(a, d.viewport.children(c)); var e = d.active[b + "All"](".ui-menu-item").eq(0); e.length ? d.activate(a, e) : d.activate(a, d.viewport.children(c)) }, register: function (b, c) { var d = this, e = {}; e.element = a(b), e.element.data("TimePicker") || (e.options = a.metadata ? a.extend({}, c, e.element.metadata()) : a.extend({}, c), e.widget = d, a.extend(e, { next: function () { return d.next(e) }, previous: function () { return d.previous(e) }, first: function () { return d.first(e) }, last: function () { return d.last(e) }, selected: function () { return d.selected(e) }, open: function () { return d.open(e) }, close: function () { return d.close(e) }, closed: function () { return d.closed(e) }, destroy: function () { return d.destroy(e) }, parse: function (a) { return d.parse(e, a) }, format: function (a, b) { return d.format(e, a, b) }, getTime: function () { return d.getTime(e) }, setTime: function (a, b) { return d.setTime(e, a, b) }, option: function (a, b) { return d.option(e, a, b) } }), d._setDefaultTime(e), d._addInputEventsHandlers(e), e.element.data("TimePicker", e)) }, _setDefaultTime: function (b) { "now" === b.options.defaultTime ? b.setTime(d(new Date)) : b.options.defaultTime && b.options.defaultTime.getFullYear ? b.setTime(d(b.options.defaultTime)) : b.options.defaultTime && b.setTime(a.fn.timepicker.parseTime(b.options.defaultTime)) }, _addInputEventsHandlers: function (b) { var c = this; b.element.bind("keydown.timepicker", function (a) { switch (a.which || a.keyCode) { case c.keyCode.ENTER: case c.keyCode.NUMPAD_ENTER: a.preventDefault(), c.closed() ? b.element.trigger("change.timepicker") : c.select(b, c.active); break; case c.keyCode.UP: b.previous(); break; case c.keyCode.DOWN: b.next(); break; default: c.closed() || b.close(!0) } }).bind("focus.timepicker", function () { b.open() }).bind("blur.timepicker", function () { setTimeout(function () { b.element.data("timepicker-user-clicked-outside") && b.close() }) }).bind("change.timepicker", function () { b.closed() && b.setTime(a.fn.timepicker.parseTime(b.element.val())) }) }, select: function (b, c) { var d = this, e = b === !1 ? d.instance : b; d.setTime(e, a.fn.timepicker.parseTime(c.children("a").text())), d.close(e, !0) }, activate: function (a, b) { var c = this, d = a === !1 ? c.instance : a; if (d === c.instance) { if (c.deactivate(), c._hasScroll()) { var e = b.offset().top - c.ui.offset().top, f = c.ui.scrollTop(), g = c.ui.height(); 0 > e ? c.ui.scrollTop(f + e) : e >= g && c.ui.scrollTop(f + e - g + b.height()) } c.active = b.eq(0).children("a").addClass("ui-state-hover").attr("id", "ui-active-item").end() } }, deactivate: function () { var a = this; a.active && (a.active.children("a").removeClass("ui-state-hover").removeAttr("id"), a.active = null) }, next: function (a) { return (this.closed() || this.instance === a) && this._move(a, "next", ".ui-menu-item:first"), a.element }, previous: function (a) { return (this.closed() || this.instance === a) && this._move(a, "prev", ".ui-menu-item:last"), a.element }, first: function (a) { return this.instance === a ? this.active && 0 === this.active.prevAll(".ui-menu-item").length : !1 }, last: function (a) { return this.instance === a ? this.active && 0 === this.active.nextAll(".ui-menu-item").length : !1 }, selected: function (a) { return this.instance === a && this.active ? this.active : null }, open: function (b) { var d = this, e = b.getTime(), f = b.options.dynamic && e; if (!b.options.dropdown) return b.element; switch (b.element.data("timepicker-event-namespace", Math.random()), a(c).bind("click.timepicker-" + b.element.data("timepicker-event-namespace"), function (a) { b.element.get(0) === a.target ? b.element.data("timepicker-user-clicked-outside", !1) : b.element.data("timepicker-user-clicked-outside", !0).blur() }), (b.rebuild || !b.items || f) && (b.items = d._items(b, f ? e : null)), (b.rebuild || d.instance !== b || f) && (a.fn.jquery < "1.4.2" ? (d.viewport.children().remove(), d.viewport.append(b.items), d.viewport.find("a").bind("mouseover.timepicker", function () { d.activate(b, a(this).parent()) }).bind("mouseout.timepicker", function () { d.deactivate(b) }).bind("click.timepicker", function (c) { c.preventDefault(), d.select(b, a(this).parent()) })) : (d.viewport.children().detach(), d.viewport.append(b.items))), b.rebuild = !1, d.container.removeClass("ui-helper-hidden ui-timepicker-hidden ui-timepicker-standard ui-timepicker-corners").show(), b.options.theme) { case "standard": d.container.addClass("ui-timepicker-standard"); break; case "standard-rounded-corners": d.container.addClass("ui-timepicker-standard ui-timepicker-corners") }d.container.hasClass("ui-timepicker-no-scrollbar") || b.options.scrollbar || (d.container.addClass("ui-timepicker-no-scrollbar"), d.viewport.css({ paddingRight: 40 })); var g = d.container.outerHeight() - d.container.height(), h = b.options.zindex ? b.options.zindex : b.element.offsetParent().css("z-index"), i = b.element.offset(); d.container.css({ top: i.top + b.element.outerHeight(), left: i.left }), d.container.show(), d.container.css({ left: b.element.offset().left, height: d.ui.outerHeight() + g, width: b.element.outerWidth(), zIndex: h, cursor: "default" }); var j = d.container.width() - (d.ui.outerWidth() - d.ui.width()); return d.ui.css({ width: j }), d.viewport.css({ width: j }), b.items.css({ width: j }), d.instance = b, e ? b.items.each(function () { var c, f = a(this); return c = a.fn.jquery < "1.4.2" ? a.fn.timepicker.parseTime(f.find("a").text()) : f.data("time-value"), c.getTime() === e.getTime() ? (d.activate(b, f), !1) : !0 }) : d.deactivate(b), b.element }, close: function (b) { var d = this; return d.instance === b && (d.container.addClass("ui-helper-hidden ui-timepicker-hidden").hide(), d.ui.scrollTop(0), d.ui.children().removeClass("ui-state-hover")), a(c).unbind("click.timepicker-" + b.element.data("timepicker-event-namespace")), b.element }, closed: function () { return this.ui.is(":hidden") }, destroy: function (a) { var b = this; return b.close(a, !0), a.element.unbind(".timepicker").data("TimePicker", null) }, parse: function (b, c) { return a.fn.timepicker.parseTime(c) }, format: function (b, c, d) { return d = d || b.options.timeFormat, a.fn.timepicker.formatTime(d, c) }, getTime: function (b) { var c = this, d = a.fn.timepicker.parseTime(b.element.val()); return d instanceof Date && !c._isValidTime(b, d) ? null : d instanceof Date && b.selectedTime ? b.format(d) === b.format(b.selectedTime) ? b.selectedTime : d : d instanceof Date ? d : null }, setTime: function (b, c, e) { var f = this, g = b.selectedTime; if ("string" == typeof c && (c = b.parse(c)), c && c.getMinutes && f._isValidTime(b, c)) { if (c = d(c), b.selectedTime = c, b.element.val(b.format(c, b.options.timeFormat)), e) return b } else b.selectedTime = null; return (null !== g || null !== b.selectedTime) && (b.element.trigger("time-change", [c]), a.isFunction(b.options.change) && b.options.change.apply(b.element, [c])), b.element }, option: function (b, c, d) { if ("undefined" == typeof d) return b.options[c]; var e, f, g = b.getTime(); "string" == typeof c ? (e = {}, e[c] = d) : e = c, f = ["minHour", "minMinutes", "minTime", "maxHour", "maxMinutes", "maxTime", "startHour", "startMinutes", "startTime", "timeFormat", "interval", "dropdown"], a.each(e, function (c) { b.options[c] = e[c], b.rebuild = b.rebuild || a.inArray(c, f) > -1 }), b.rebuild && b.setTime(g) } }, a.TimePicker.defaults = { timeFormat: "hh:mm p", minHour: null, minMinutes: null, minTime: null, maxHour: null, maxMinutes: null, maxTime: null, startHour: null, startMinutes: null, startTime: null, interval: 30, dynamic: !0, theme: "standard", zindex: null, dropdown: !0, scrollbar: !1, change: function () { } }, a.TimePicker.methods = { chainable: ["next", "previous", "open", "close", "destroy", "setTime"] }, a.fn.timepicker = function (b) { if ("string" == typeof b) { var c, d, e = Array.prototype.slice.call(arguments, 1); return c = "option" === b && arguments.length > 2 ? "each" : -1 !== a.inArray(b, a.TimePicker.methods.chainable) ? "each" : "map", d = this[c](function () { var c = a(this), d = c.data("TimePicker"); return "object" == typeof d ? d[b].apply(d, e) : void 0 }), "map" === c && 1 === this.length ? a.makeArray(d).shift() : "map" === c ? a.makeArray(d) : d } if (1 === this.length && this.data("TimePicker")) return this.data("TimePicker"); var f = a.extend({}, a.TimePicker.defaults, b); return this.each(function () { a.TimePicker.instance().register(this, f) }) }, a.fn.timepicker.formatTime = function (a, c) { var d = c.getHours(), e = d % 12, f = c.getMinutes(), g = c.getSeconds(), h = { hh: b((0 === e ? 12 : e).toString(), "0", 2), HH: b(d.toString(), "0", 2), mm: b(f.toString(), "0", 2), ss: b(g.toString(), "0", 2), h: 0 === e ? 12 : e, H: d, m: f, s: g, p: d > 11 ? "PM" : "AM" }, i = a, j = ""; for (j in h) h.hasOwnProperty(j) && (i = i.replace(new RegExp(j, "g"), h[j])); return i = i.replace(new RegExp("a", "g"), d > 11 ? "pm" : "am") }, a.fn.timepicker.parseTime = function () { var b = [[/^(\d+)$/, "$1"], [/^:(\d)$/, "$10"], [/^:(\d+)/, "$1"], [/^(\d):([7-9])$/, "0$10$2"], [/^(\d):(\d\d)$/, "$1$2"], [/^(\d):(\d{1,})$/, "0$1$20"], [/^(\d\d):([7-9])$/, "$10$2"], [/^(\d\d):(\d)$/, "$1$20"], [/^(\d\d):(\d*)$/, "$1$2"], [/^(\d{3,}):(\d)$/, "$10$2"], [/^(\d{3,}):(\d{2,})/, "$1$2"], [/^(\d):(\d):(\d)$/, "0$10$20$3"], [/^(\d{1,2}):(\d):(\d\d)/, "$10$2$3"]], c = b.length; return function (e) { var f = d(new Date), g = !1, h = !1, i = !1, j = !1, k = !1; if ("undefined" == typeof e || !e.toLowerCase) return null; e = e.toLowerCase(), g = /a/.test(e), h = g ? !1 : /p/.test(e), e = e.replace(/[^0-9:]/g, "").replace(/:+/g, ":"); for (var l = 0; c > l; l += 1)if (b[l][0].test(e)) { e = e.replace(b[l][0], b[l][1]); break } return e = e.replace(/:/g, ""), 1 === e.length ? i = e : 2 === e.length ? i = e : 3 === e.length || 5 === e.length ? (i = e.substr(0, 1), j = e.substr(1, 2), k = e.substr(3, 2)) : (4 === e.length || e.length > 5) && (i = e.substr(0, 2), j = e.substr(2, 2), k = e.substr(4, 2)), e.length > 0 && e.length < 5 && (e.length < 3 && (j = 0), k = 0), i === !1 || j === !1 || k === !1 ? !1 : (i = parseInt(i, 10), j = parseInt(j, 10), k = parseInt(k, 10), g && 12 === i ? i = 0 : h && 12 > i && (i += 12), i > 24 ? e.length >= 6 ? a.fn.timepicker.parseTime(e.substr(0, 5)) : a.fn.timepicker.parseTime(e + "0" + (g ? "a" : "") + (h ? "p" : "")) : (f.setHours(i, j, k), f)) } }() }() });
!function (t) { "function" == typeof define && define.amd ? define(["jquery"], t) : "object" == typeof module && module.exports ? module.exports = t(require("jquery")) : t(jQuery) }(function (t) { var e = function () { function e() { var e = this, n = function () { var n = ["br-wrapper"]; "" !== e.options.theme && n.push("br-theme-" + e.options.theme), e.$elem.wrap(t("<div />", { "class": n.join(" ") })) }, i = function () { e.$elem.unwrap() }, a = function (n) { return t.isNumeric(n) && (n = Math.floor(n)), t('option[value="' + n + '"]', e.$elem) }, r = function () { var n = e.options.initialRating; return n ? a(n) : t("option:selected", e.$elem) }, o = function () { var n = e.$elem.find('option[value="' + e.options.emptyValue + '"]'); return !n.length && e.options.allowEmpty ? (n = t("<option />", { value: e.options.emptyValue }), n.prependTo(e.$elem)) : n }, l = function (t) { var n = e.$elem.data("barrating"); return "undefined" != typeof t ? n[t] : n }, s = function (t, n) { null !== n && "object" == typeof n ? e.$elem.data("barrating", n) : e.$elem.data("barrating")[t] = n }, u = function () { var t = r(), n = o(), i = t.val(), a = t.data("html") ? t.data("html") : t.text(), l = null !== e.options.allowEmpty ? e.options.allowEmpty : !!n.length, u = n.length ? n.val() : null, d = n.length ? n.text() : null; s(null, { userOptions: e.options, ratingValue: i, ratingText: a, originalRatingValue: i, originalRatingText: a, allowEmpty: l, emptyRatingValue: u, emptyRatingText: d, readOnly: e.options.readonly, ratingMade: !1 }) }, d = function () { e.$elem.removeData("barrating") }, c = function () { return l("ratingText") }, f = function () { return l("ratingValue") }, g = function () { var n = t("<div />", { "class": "br-widget" }); return e.$elem.find("option").each(function () { var i, a, r, o; i = t(this).val(), i !== l("emptyRatingValue") && (a = t(this).text(), r = t(this).data("html"), r && (a = r), o = t("<a />", { href: "#", "data-rating-value": i, "data-rating-text": a, html: e.options.showValues ? a : "" }), n.append(o)) }), e.options.showSelectedRating && n.append(t("<div />", { text: "", "class": "br-current-rating br-theme-bars-1to10-box" })), e.options.reverse && n.addClass("br-reverse"), e.options.readonly && n.addClass("br-readonly"), n }, p = function () { return l("userOptions").reverse ? "nextAll" : "prevAll" }, h = function (t) { a(t).prop("selected", !0), l("userOptions").triggerChange && e.$elem.change() }, m = function () { t("option", e.$elem).prop("selected", function () { return this.defaultSelected }), l("userOptions").triggerChange && e.$elem.change() }, v = function (t) { t = t ? t : c(), t == l("emptyRatingText") && (t = ""), e.options.showSelectedRating && e.$elem.parent().find(".br-current-rating").text(t) }, y = function (t) { return Math.round(Math.floor(10 * t) / 10 % 1 * 100) }, b = function () { e.$widget.find("a").removeClass(function (t, e) { return (e.match(/(^|\s)br-\S+/g) || []).join(" ") }) }, w = function () { var n, i, a = e.$widget.find('a[data-rating-value="' + f() + '"]'), r = l("userOptions").initialRating, o = t.isNumeric(f()) ? f() : 0, s = y(r); if (b(), a.addClass("br-selected br-current")[p()]().addClass("br-selected"), !l("ratingMade") && t.isNumeric(r)) { if (o >= r || !s) return; n = e.$widget.find("a"), i = a.length ? a[l("userOptions").reverse ? "prev" : "next"]() : n[l("userOptions").reverse ? "last" : "first"](), i.addClass("br-fractional"), i.addClass("br-fractional-" + s) } }, $ = function (t) { return l("allowEmpty") && l("userOptions").deselectable ? f() == t.attr("data-rating-value") : !1 }, x = function (n) { n.on("click.barrating", function (n) { var i, a, r = t(this), o = l("userOptions"); return n.preventDefault(), i = r.attr("data-rating-value"), a = r.attr("data-rating-text"), $(r) && (i = l("emptyRatingValue"), a = l("emptyRatingText")), s("ratingValue", i), s("ratingText", a), s("ratingMade", !0), h(i), v(a), w(), o.onSelect.call(e, f(), c(), n), !1 }) }, C = function (e) { e.on("mouseenter.barrating", function () { var e = t(this); b(), e.addClass("br-active")[p()]().addClass("br-active"), v(e.attr("data-rating-text")) }) }, O = function (t) { e.$widget.on("mouseleave.barrating blur.barrating", function () { v(), w() }) }, R = function (e) { e.on("touchstart.barrating", function (e) { e.preventDefault(), e.stopPropagation(), t(this).click() }) }, V = function (t) { t.on("click.barrating", function (t) { t.preventDefault() }) }, S = function (t) { x(t), e.options.hoverState && (C(t), O(t)) }, T = function (t) { t.off(".barrating") }, j = function (t) { var n = e.$widget.find("a"); l("userOptions").fastClicks && R(n), t ? (T(n), V(n)) : S(n) }; this.show = function () { l() || (n(), u(), e.$widget = g(), e.$widget.insertAfter(e.$elem), w(), v(), j(e.options.readonly), e.$elem.hide()) }, this.readonly = function (t) { "boolean" == typeof t && l("readOnly") != t && (j(t), s("readOnly", t), e.$widget.toggleClass("br-readonly")) }, this.set = function (t) { var n = l("userOptions"); 0 !== e.$elem.find('option[value="' + t + '"]').length && (s("ratingValue", t), s("ratingText", e.$elem.find('option[value="' + t + '"]').text()), s("ratingMade", !0), h(f()), v(c()), w(), n.silent || n.onSelect.call(this, f(), c())) }, this.clear = function () { var t = l("userOptions"); s("ratingValue", l("originalRatingValue")), s("ratingText", l("originalRatingText")), s("ratingMade", !1), m(), v(c()), w(), t.onClear.call(this, f(), c()) }, this.destroy = function () { var t = f(), n = c(), a = l("userOptions"); T(e.$widget.find("a")), e.$widget.remove(), d(), i(), e.$elem.show(), a.onDestroy.call(this, t, n) } } return e.prototype.init = function (e, n) { return this.$elem = t(n), this.options = t.extend({}, t.fn.barrating.defaults, e), this.options }, e }(); t.fn.barrating = function (n, i) { return this.each(function () { var a = new e; if (t(this).is("select") || t.error("Sorry, this plugin only works with select fields."), a.hasOwnProperty(n)) { if (a.init(i, this), "show" === n) return a.show(i); if (a.$elem.data("barrating")) return a.$widget = t(this).next(".br-widget"), a[n](i) } else { if ("object" == typeof n || !n) return i = n, a.init(i, this), a.show(); t.error("Method " + n + " does not exist on jQuery.barrating") } }) }, t.fn.barrating.defaults = { theme: "", initialRating: null, allowEmpty: null, emptyValue: "", showValues: !1, showSelectedRating: !0, deselectable: !0, reverse: !1, readonly: !1, fastClicks: !0, hoverState: !0, silent: !1, triggerChange: !0, onSelect: function (t, e, n) { }, onClear: function (t, e) { }, onDestroy: function (t, e) { } }, t.fn.barrating.BarRating = e });
//# sourceMappingURL=jquery.barrating.min.js.map
var _token = "";

//var _options = {
//    labelButtonYes: "Sim",
//    labelButtonNo: "NÃ£o",
//    labelButtonCancel: "Cancelar",
//    TitleDelete: "ConfirmaÃ§Ã£o",
//    TitleErro: "Aviso",
//    TitleSuccess: "Aviso",
//    TitleErroFormulario: "O formulÃ¡rio possui os seguintes erros:",
//    messageDelete: "Confirma a exclusÃ£o do projeto <strong>{{0}}}</strong>?",
//    MessageErro: "O seguinte erro ocorreu ao tentar atualizar os dados.<br>{{0}}",
//    RegistroExlcuido: "Registro excluÃ­do com sucesso",
//    verificationToken: "[name=__RequestVerificationToken]",
//    tabelaLengthMenu: "_MENU_ registros por página",
//    tabelaZeroRecords: "Nenhum registro encontrado",
//    tabelaInfo: "Mostrando página _PAGE_ de _PAGES_",
//    tabelaInfoEmpty: "Sem registros",
//    tabelaInfoFiltered: "(filtrando de _MAX_ registros)",
//    tabelaSearch: "",
//    tabelaSearchPlaceholder: "Busca",
//    tabelaPaginateNext: "Próximo",
//    tabelaPaginatePrevious: "Anterior"

//};

$(function () {
    _token = $(_options.verificationToken).val();
    $("body").bind("resize", function () {
        SplashResize();
    })
    TitleFromPlaceholder();
    SplashResize();
    //$('a[href*="#"]:not([href="#"])').click(function () {
    //    if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
    //        var target = $(this.hash);
    //        target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
    //        if (target.length) {
    //            $('html,body').animate({
    //                scrollTop: target.offset().top
    //            }, 1000);
    //            return false;
    //        }
    //    }
    //});

});

function AtivaDataPicker() {
    jQuery.datetimepicker.setLocale(jsIdioma);
    $('.data:not([readonly])').datetimepicker({
        format: 'd/m/Y',
        lang: jsIdioma,
        timepicker: false,
        scrollInput: false
    });
    $(".data").attr("autocomplete", "off");
    $(".data").g2itMasks("date");
}

function DefineMaxlengthTextArea() {
    $(function () {
        $('textarea[maxlength]').keyup(function () {
            var limit = parseInt($(this).attr('maxlength'));
            var text = $(this).val();
            var chars = text.length;
            if (chars > limit) {
                var new_text = text.substr(0, limit);
                $(this).val(new_text);
            }
        });
    });
}

function IsValidFrom(frm, CustomValidate) {
    LimpaErros(frm);
    var EhValido = $("#" + frm).valid();
    if (EhValido && CustomValidate != undefined && CustomValidate != "") {
        eval("EhValido = " + CustomValidate);
    }
    if (!EhValido) {
        if (TemErro(frm)) {
            var erros = $("#" + frm).find("#containerError").html();
            bootbox.alert({ message: erros, title: _options.TitleErroFormulario, });
        }
        return false;
    }
    return true;
}

function TemErro(frm) {
    var containerErro = $("#" + frm).find(".validation-summary-errors");
    var list = containerErro.find("ul");
    var erro = containerErro.find("ul").find("li:first").html();
    return list && list.length > 0 && erro != "";
}

function AddValidationDynamic() {
    $.validator.unobtrusive.parseDynamicContent('form');
}

function ResetUnobtrusiveValidator(bForce) {
    if (bForce != undefined && bForce) {
        $("form").removeData("validator");
        $("form").removeData("unobtrusiveValidation");
    }
    $.validator.unobtrusive.parse("form");
}

function MostraAlerta(titulo, msg, functionCallback) {
    var fnCallback = functionCallback;
    if (fnCallback == undefined) {
        fnCallback = function () { };
    }
    bootbox.alert({ title: "<span class='tituloBootbox'>" + titulo + "</span>", message: msg, callback: fnCallback });
}

function MostraDialog(titulo, msg, optionCallbackCancel, optionCallbackOK) {
    var fnCallbackCancel = optionCallbackCancel;
    var fnCallbackOK = optionCallbackOK;

    if (fnCallbackCancel == undefined) {
        fnCallbackCancel = { label: _options.labelButtonCancel, className: "btn-default", callback: function () { } };
    }
    if (fnCallbackOK == undefined) {
        fnCallbackOK = { label: _options.labelButtonYes, className: "btn btn-primary", callback: function () { } };
    }
    bootbox.dialog({
        message: msg,
        title: "<span class='tituloBootbox'>" + titulo + "</span>",
        buttons: { cancel: fnCallbackCancel, ok: fnCallbackOK }
    });
}

function AjaxFormSuccess(result, frm, titleSucesso, titleError, optionCallbackOK, optionCallbackCancel) {
    var fnCallbackOK = optionCallbackOK;
    var fnCallbackCancel = optionCallbackCancel;

    if (fnCallbackOK == undefined) {
        fnCallbackOK = { label: "OK", className: "btn btn-primary", callback: function () { } };
    } else {
        fnCallbackOK = { label: "OK", className: "btn btn-primary", callback: optionCallbackOK };
    }
    if (fnCallbackCancel == undefined) {
        fnCallbackCancel = { label: "OK", className: "btn btn-primary", callback: function () { } };
    } else {
        fnCallbackCancel = { label: "OK", className: "btn btn-primary", callback: optionCallbackCancel };
    }
    if (TemErro(frm)) {
        var erros = $("#" + frm).find("#containerError").html();
        bootbox.dialog({
            message: erros,
            title: titleError,
            buttons: { ok: fnCallbackCancel }
        });
    }
    else {
        var msg = "<span style='color:#698e9f'>" + $("#" + frm).find("#containerSucesso").html() + "</span>";
        bootbox.dialog({
            message: msg,
            title: titleSucesso,
            buttons: { ok: fnCallbackOK }
        });
    }
    ResetUnobtrusiveValidator();
}

function callBackError(result) {
    hideSplash();
    MostraAlerta(_options.TitleErro, _options.MessageErro.replace("{{0}}", (result.responseJSON == undefined ? result.responseText : result.responseJSON.Message)), function () { });
}

function AjaxFormError(result) {
    callBackError(result);
    ResetUnobtrusiveValidator();
}

function AjaxUpdateContent(vurl, UpdateTargetId, funcao) {
    $.ajax({
        url: vurl,
        type: 'POST',
        data: {
            __RequestVerificationToken: _token
        },
        beforeSend: function () { $("#screen").show(); },
        success: function (result) {
            $("#" + UpdateTargetId).html(result);
            if (funcao) funcao();
            ResetUnobtrusiveValidator();
            $("#screen").hide();
        },
        complete: function () { $("#screen").hide(); },
        error: callBackError
    });
    return false;
}

function AjaxDelete(vurl, UpdateTargetId, UpdateTargetEditId, funcao) {
    bootbox.dialog({
        message: _options.messageDelete,
        title: "<span class='tituloBootbox'>" + _options.TitleDelete + "</span>",
        buttons: {
            cancel: { label: _options.labelButtonCancel, className: "btn-primary", callback: function () { } },
            ok: {
                label: "OK", className: "btn btn-primary", callback: function () {
                    $.ajax({
                        url: vurl,
                        type: 'POST',
                        data: {
                            __RequestVerificationToken: _token
                        },
                        beforeSend: function () { $("#screen").show().focus(); },
                        success: function (result) {
                            $(UpdateTargetId).html(result);
                            $(UpdateTargetEditId).html("");
                            if (funcao) funcao();
                            bootbox.alert({
                                message: _options.RegistroExlcuido,
                                title: "<span class='tituloBootbox'>" + _options.TitleDelete + "</span>",
                                buttons: { ok: { className: 'btn-primary' } }
                            });
                            //message: _options.RegistroExlcuido, title: "AÃ§Ãµes", buttons: { ok { className: 'btn-success' }}});
                        },
                        complete: function () { hideSplash(); },
                        error: callBackError
                    });
                }
            }
        }
    });

    return false;
}

function showPainel(id) {
    $(id).show().removeClass("hide");
}
function hidePainel(id) {
    $(id).hide().addClass("hide");
}

function chkValue(boolValue) {
    $("input[name='" + boolValue.name + "']").val(boolValue.checked ? "True" : "False");
}

function TitleFromPlaceholder() {
    $("input[placeholder], textarea[placeholder]").each(function () {
        $(this).attr("title", $(this).attr("placeholder"));
    });
}

function SplashResize() {
    $("#splash").css("height", $(window).height());
    $("#splash").css("width", $(window).width());
}

function hideSplash() {
    $("#screen").hide();
}

function ItensChecked(frm, name) {
    return $("#" + frm).find("input[name=" + name + "]:checked").length;
}

function AdicionaMensagemErro(frm, msg) {
    var containerErro = $("#" + frm).find("[data-valmsg-summary=true]");
    var list = containerErro.find("ul");
    if (TemErro("formAcao"))
        list.append("<li>" + msg + "</li>");
    else
        list.html("<li>" + msg + "</li>");
}

function LimpaErros(frm) {
    var containerErro = $("#" + frm).find("[data-valmsg-summary=true]");
    containerErro.attr("class", "validation-summary-errors");
    var list = containerErro.find("ul").html("<li style='display:none'></li>");
}

function ConfigTabelaComCriterioDeColuna(_selector, _positionConlumn, _ascOrDesc, searchPlaceholder) {
    table = $(_selector).DataTable({
        "destroy": true,
        "responsive": true,
        "lengthMenu": [[10, 50, 100, -1], [10, 50, 100, _options.tabelaTodosRegistros]],
        "iDisplayLength": 10,
        "order": [[_positionConlumn, _ascOrDesc]],
        "language": {
            "lengthMenu": _options.tabelaLengthMenu,
            "zeroRecords": _options.tabelaZeroRecords,
            "info": _options.tabelaInfo,
            "infoEmpty": _options.tabelaInfoEmpty,
            "infoFiltered": _options.tabelaInfoFiltered,
            "search": _options.tabelaSearch,
            "searchPlaceholder": searchPlaceholder,
            "paginate": {
                "next": _options.tabelaPaginateNext,
                "previous": _options.tabelaPaginatePrevious
            }
        },
        "createdRow": function (row, data, dataIndex) {
            $(row).children().addClass("details-control");
            $(row).attr("id", dataIndex);
        },

    });
    resizeTable(table);
}

function resizeTable(table) {
    //$(table.column(0).header()).addClass('never');
    table.responsive.rebuild();
    table.responsive.recalc();

    //$(table.column(0).header()).removeClass('never');
    table.responsive.rebuild();
    table.responsive.recalc();
}

var table;
function ConfigTabela(_selector) {

    table = $(_selector).DataTable({
        "destroy": true,
        "responsive": true,
        "lengthMenu": [[10, 50, 100, -1], [10, 50, 100, _options.tabelaTodosRegistros]],
        "iDisplayLength": 10,
        "language": {
            "lengthMenu": _options.tabelaLengthMenu,
            "zeroRecords": _options.tabelaZeroRecords,
            "info": _options.tabelaInfo,
            "infoEmpty": _options.tabelaInfoEmpty,
            "infoFiltered": _options.tabelaInfoFiltered,
            "search": _options.tabelaSearch,
            "searchPlaceholder": _options.tabelaSearchPlaceholder,
            "paginate": {
                "next": _options.tabelaPaginateNext,
                "previous": _options.tabelaPaginatePrevious
            }
        }
    });

    // Apply the search
    $("table thead th input[type=text]").on('keyup change', function () {
        table
            .column($(this).closest('th').index() + ':visible')
            .search(this.value)
            .draw();
    });
    // Apply the search
    $("table thead th select").on('change', function () {
        var val = $.fn.dataTable.util.escapeRegex(
            $(this).val()
        );
        table
            .column($(this).closest('th').index() + ':visible')
            .search(val ? '^' + val + '$' : '', true, false)
            .draw();
    });

    table.on('responsive-resize', function (e, datatable, columns) {
        var i = 0;
        $("#hr1 > th").each(function () {
            if (columns[i]) {
                $(this).removeClass("hide");
            } else {
                $(this).addClass("hide");
            }
            i++;
        });
    });

    $(table.column(0).header()).addClass('never');
    table.responsive.rebuild();
    table.responsive.recalc();

    $(table.column(0).header()).removeClass('never');
    table.responsive.rebuild();
    table.responsive.recalc();
}

function formatFileSize(bytes) {
    if (typeof bytes !== 'number') {
        return '';
    }

    if (bytes >= 1000000000) {
        return (bytes / 1000000000).toFixed(2) + ' GB';
    }

    if (bytes >= 1000000) {
        return (bytes / 1000000).toFixed(2) + ' MB';
    }

    return (bytes / 1000).toFixed(2) + ' KB';
}

function UploadArquivoUnico(urlToUpload, IdCtrlUpload, IdCtrlDrop, nomeCampo, maxSize, formJson) {
    $('#' + IdCtrlDrop + ' .actionUp').click(function () {
        $('#' + IdCtrlDrop).find('input[type=file]').click();
    });
    $('#' + IdCtrlUpload).fileupload({
        url: urlToUpload,
        sequentialUploads: true,
        singleFileUploads: true,
        limitMultiFileUploads: 1,
        formData: formJson,
        dropZone: $('#' + IdCtrlDrop),
        add: function (e, data) {
            if (data.files[0].size > maxSize) {
                bootbox.alert(_options.MsgValidaUploadArquivoUnico + formatFileSize(maxSize));
            }
            else {
                var tpl = $("#" + IdCtrlUpload);
                tpl.find(".prog").show();
                tpl.find('.stop').click(function () {
                    jqXHR.abort();
                });

                // Automatically upload the file once it is added to the queue
                var jqXHR = data.submit();
            }
        },
        done: function (e, data) {
            if (data.textStatus == "success") {
                var tpl = $("#" + IdCtrlDrop).find('.img-responsive').attr("src", data.result);
                var aArquivo = data.result.split("/");
                var _arquivo = aArquivo[aArquivo.length - 1];
                _arquivo = _arquivo.split("?")[0];
                $("#" + nomeCampo).val(_arquivo);
            }
        },

        progress: function (e, data) {
            // Calculate the completion percentage of the upload
            var progress = parseInt(data.loaded / data.total * 100, 10);

            var tpl = $("#" + IdCtrlUpload);
            tpl.find('.prog').find("span").html(progress + " %" + "  - " + data.files[0].name);

            if (progress == 100) {
                tpl.find('.prog').find("span").html("0 %");
                tpl.find('.prog').hide();
            }
        },

        fail: function (e, data) {
            // Something has gone wrong!
            var tpl = $("#" + IdCtrlDrop).find('span');
            tpl.removeClass('working').addClass('error');
            tpl.html(_options.MsgValidaArquivoNaoCarregado + data.errorThrown);
        }
    });
}

//TODO: AJUSTAR
function UploadMultiplosArquivos(urlToUpload, IdCtrlDrop, IdCtrlUpload, nomeCampo, maxSize, formJson, idForm, idRegistro, urlDelete) {
    $('#' + IdCtrlDrop + ' a').click(function () {
        // Simulate a click on the file input button
        // to show the file browser dialog
        $(this).parent().find('input').click();
    });

    // Initialize the jQuery File Upload plugin
    $('#' + IdCtrlUpload).fileupload({
        url: urlToUpload,
        sequentialUploads: true,
        limitMultiFileUploads: 1,
        formData: formJson,
        // This element will accept file drag/drop uploading
        dropZone: $('#' + IdCtrlDrop),

        // This function is called when a file is added to the queue;
        // either via the browse button, or via drag/drop:
        add: function (e, data) {
            if (data.files[0].size > maxSize) {
                bootbox.alert(_options.MsgValidaUploadArquivoUnico + formatFileSize(maxSize));
            }
            else {
                var tpl = $('<li class="working"><p></p><span></span></li>');

                // Append the file name and file size
                tpl.find('p').text(data.files[0].name);

                // Add the HTML to the UL element
                var ul = $('#' + IdCtrlUpload + ' ul');
                data.context = tpl.appendTo(ul);

                // Listen for clicks on the cancel icon
                tpl.find('span').click(function () {

                    if (!tpl.hasClass('working')) {
                        jqXHR.abort();
                    }

                    tpl.fadeOut(function () {
                        tpl.remove();
                    });
                });

                // Automatically upload the file once it is added to the queue
                var jqXHR = data.submit();
            }
        },

        progress: function (e, data) {
            // Calculate the completion percentage of the upload
            var progress = parseInt(data.loaded / data.total * 100, 10);

            // Update the hidden input field and trigger a change
            // so that the jQuery knob plugin knows to update the dial
            data.context.find('p').html(progress + " %" + "  - " + data.files[0].name);;

            if (progress == 100) {
                data.context.find('p').html(data.files[0].name);
            }
        },
        done: function (e, data) {
            if (data.textStatus == "success") {
                var tipo = formJson.tipo;
                var _a = "<a class='arquivo' href='" + data.result + "' target='_blank'>" + data.files[0].name + "</a>";
                _a += "<a href=\"javascript:;\" class=\"deletefile\" target=\"_blank\" data-tipo=\"" + tipo + "\" data-arquivo=\"" + data.files[0].name + "\" data-campo=\"" + nomeCampo + "\" data-id=\"" + idRegistro + "\"><i class=\"fa fa-trash-o\" aria-hidden=\"true\" title='" + _options.labelButtonExcluir + "' data-original-title='" + _options.labelButtonExcluir + "'></i></a>";

                data.context.find('p').html(_a);
                $("#" + IdCtrlUpload).find(".working").removeClass("working");
                $("#" + idForm).find("#" + nomeCampo).val(data.files[0].name + "|" + $("#" + nomeCampo).val());

                var validator = $("#" + idForm).validate();
                validator.element("#" + nomeCampo);

                UploadDeleteFiles(urlDelete);
            }
        },
        fail: function (e, data) {
            // Something has gone wrong!
            bootbox.alert(data.errorThrown);
        }
    });
}

//TODO: AJUSTAR 28.117.644/0001-83
function UploadDeleteFiles(urlDelete) {
    $(".deletefile").bind("click", function (event) {
        event.preventDefault();
        var _arquivo = $(this).data("arquivo");
        var _tipo = $(this).data("tipo");
        var _id = $(this).data("id");
        var nomeCampo = $(this).data("campo");
        var obj = $(this);

        bootbox.confirm(_options.DesejaRealmenteExcluirEsseRegistro + _arquivo, function (result) {
            if (result == true) {

                var _oldCampo = $("#" + nomeCampo).val();
                $.ajax({
                    type: "POST",
                    url: urlDelete,
                    data: {
                        "__RequestVerificationToken": $("[name=__RequestVerificationToken]").val(),
                        "arquivo": _arquivo,
                        "id": _id,
                        "tipo": _tipo,
                        "campo": nomeCampo
                    },
                    beforeSend: function () { ShowSplash(); },
                    error: function (xhr) {
                        bootbox.alert(xhr.Message);
                    },
                    success: function (result) {
                        obj.prev().remove();
                        obj.remove();
                        $("#" + nomeCampo).val(result);
                    },
                    complete: function () { HideSplash(); }
                });
            }
        });
    });
}
function AtualizaPerfil(idPerfil, idUsuario) {
    var idCliente = $("#IdCliente").val();

    if (idPerfil == 3) {
        $('#FlCompartilhado').prop('checked', false)
        $("#FlCompartilhado").attr('disabled', true);
    }
    else {
        $("#FlCompartilhado").removeAttr('disabled');
    }

    $.ajax({
        type: "POST",
        url: "/Usuario/ListaSiteCargo?idPerfil=" + idPerfil + "&idUsuario=" + idUsuario + "&idCliente=" + idCliente,
        error: function (xhr) {
            bootbox.alert(xhr.responseText);
        },
        success: function (data) {
            $('#tipoUsuario').html(data);
            ResetUnobtrusiveValidator(true);
            EventsCtrls();
        },
        beforeSend: function () { ShowSplash(); },
        complete: function () { HideSplash(); }
    });
    return false;
}

function processoIndex() {
    $("#btnAddRotina").bind("click", function () {
        var obj = $("#editRotina");
        if (obj.hasClass("hide")) {
            obj.removeClass("hide");
        }
    });
    $("#btnCancelRotina").bind("click", function () {
        $("#rotinaRow").val("");
        $("#rotinaItem").val("");
        $("#rotinaOque").val("");
        $("#rotinaQuem").val("");
        $("#rotinaRegistro").val("");
        $("#editRotina").addClass("hide");
    });
    $(".btnEditRotina").bind("click", function () {
        var row = $(this).data("row");
        $("#rotinaRow").val(row);
        $("#rotinaItem").val($("#row" + row).find("#col1").val());
        $("#rotinaOque").val($("#row" + row).find("#col2").val());
        $("#rotinaQuem").val($("#row" + row).find("#col3").val());
        $("#rotinaRegistro").val($("#row" + row).find("#col4").val());
        $("#editRotina").removeClass("hide");
    });
    $("#btnSaveRotina").bind("click", function () {
        var row = $("#rotinaRow").val();;

        var item = $("#rotinaItem").val();
        var oque = $("#rotinaOque").val();
        var quem = $("#rotinaQuem").val();
        var registro = $("#rotinaRegistro").val();

        $("#row" + row).find("#col1").val(item);
        $("#row" + row).find("#scol1").text(item)

        $("#row" + row).find("#col2").val(oque);
        $("#row" + row).find("#scol2").text(oque)

        $("#row" + row).find("#col3").val(quem);
        $("#row" + row).find("#scol3").text(quem)

        $("#row" + row).find("#col4").val(registro);
        $("#row" + row).find("#scol4").text(registro)

        $("#editRotina").addClass("hide");
    });
}
function TodasColunasComMesmaAltura(tallest, seletor) {
    $(seletor).each(function () {
        tallest = $(this).height() > tallest ? $(this).height() : tallest;
    }).css("min-height", tallest);
}
/*
|--------------------------------------------------------------------------
| App
|--------------------------------------------------------------------------
*/

var APP = {
    core: {},
    model: {},
    component: {},
    controller: {}
};

/*
|--------------------------------------------------------------------------
| Core
|--------------------------------------------------------------------------
*/

APP.core.Main = {

    init: function () {
        this.loadPageController();
        APP.controller.General.init();
    },

    loadPageController: function () {
        var ctrl = APP.component.Util.getController();

        if (ctrl) {
            APP.controller[ctrl].init();
        }

    }
};

/*
|--------------------------------------------------------------------------
| Chamada
|--------------------------------------------------------------------------
*/


$(document).ready(function () {

    APP.core.Main.init();

});
/*
|--------------------------------------------------------------------------
| Model Anexo
|--------------------------------------------------------------------------
*/

APP.model.Anexo = {

    model: {

        IdAnexo: "",
        Extensao: "",
        ArquivoB64: "",

    },

    constructor: function (_IdAnexo, _Extensao, _ArquivoB64) {

        var anexo = {
            IdAnexo: _IdAnexo,
            Extensao: _Extensao,
            ArquivoB64: _ArquivoB64,
        };

        return anexo;

    },

};

/*
|--------------------------------------------------------------------------
| Model Cliente
|--------------------------------------------------------------------------
*/

APP.model.Cliente = {

    model: {
        ClienteLogoAux: {},
        NmFantasia: "",
        NmUrlAcesso: "",
        DtValidadeContrato: "",
        NuDiasTrocaSenha: "",
        NuTentativaBloqueioLogin: "",
        NuArmazenaSenha: "",
        ContratosAux: [],
        FlAtivo: "",
        FlTemCaptcha: "",
        FlExigeSenhaForte: "",
        Usuario: {},
        IdCliente: "",
    },

    constructor: function (_ClienteLogoAux, _NmFantasia, _NmUrlAcesso, _DtValidadeContrato, _NuDiasTrocaSenha, _NuTentativaBloqueioLogin,
        _NuArmazenaSenha, _Contratos, _FlAtivo, _FlTemCaptcha, _FlExigeSenhaForte, _Usuario, _IdCliente) {

        var cliente = {
            ClienteLogoAux: _ClienteLogoAux,
            NmFantasia: _NmFantasia,
            NmUrlAcesso: _NmUrlAcesso,
            DtValidadeContrato: _DtValidadeContrato,
            NuDiasTrocaSenha: _NuDiasTrocaSenha,
            NuTentativaBloqueioLogin: _NuTentativaBloqueioLogin,
            NuArmazenaSenha: _NuArmazenaSenha,
            ContratosAux: _Contratos,
            FlAtivo: _FlAtivo,
            FlTemCaptcha: _FlTemCaptcha,
            FlExigeSenhaForte: _FlExigeSenhaForte,
            Usuario: _Usuario,
            IdCliente: _IdCliente,
        };

        return cliente;

    },

};

/*
|--------------------------------------------------------------------------
| Model Modulo
|--------------------------------------------------------------------------
*/

APP.model.Modulo = {

    model: {
        IdSiteFuncionalidade: "",
        IdSite: "",
        IdFuncionalidade: "",
    },

    constructor: function (_IdSiteFuncionalidade, _IdSite, _IdFuncionalidade) {

        var modulo = {
            IdSiteFuncionalidade: _IdSiteFuncionalidade,
            IdSite: _IdSite,
            IdFuncionalidade: _IdFuncionalidade,
        };

        return modulo;

    },

};

/*
|--------------------------------------------------------------------------
| Model Perfil Usuario
|--------------------------------------------------------------------------
*/

APP.model.PerfilUsuario = {

    Administrador: 1,
    Suporte: 2,
    Coordenador: 3,
    Colaborador: 4,

};

/*
|--------------------------------------------------------------------------
| Model Processo
|--------------------------------------------------------------------------
*/

APP.model.Processo = {

    model: {

        IdProcesso: "",
        Nome: "",
        IdSite: "",
        FlAtivo: "",

    },

    constructor: function (_IdProcesso, _Nome, _IdSite, _FlAtivo) {

        var processo = {
            IdProcesso: _IdProcesso,
            Nome: _Nome,
            IdSite: _IdSite,
            FlAtivo: _FlAtivo,
        };

        return processo;

    },

};

/*
|--------------------------------------------------------------------------
| Model Site
|--------------------------------------------------------------------------
*/

APP.model.Site = {

    SiteLogoAux: {},
    IdSite: "",
    NmFantasia: "",
    NmRazaoSocial: "",
    NuCNPJ: "",
    DsFrase: "",
    DsObservacoes: "",
    FlAtivo: "",
    SiteFuncionalidades: [],
    Processos: [],
    IdCliente: "",

    constructor: function (_SiteLogoAux, _IdSite, _NmFantasia, _NmRazaoSocial, _NuCNPJ,
        _DsFrase, _DsObservacoes, _FlAtivo, _SiteFuncionalidades, _Processos, _IdCliente) {

        var site = {
            SiteLogoAux: _SiteLogoAux,
            IdSite: _IdSite,
            NmFantasia: _NmFantasia,
            NmRazaoSocial: _NmRazaoSocial,
            NuCNPJ: _NuCNPJ,
            DsFrase: _DsFrase,
            DsObservacoes: _DsObservacoes,
            FlAtivo: _FlAtivo,
            SiteFuncionalidades: _SiteFuncionalidades,
            Processos: _Processos,
            IdCliente: _IdCliente,
        };

        return site;

    },

};

/*
|--------------------------------------------------------------------------
| Model Usuario
|--------------------------------------------------------------------------
*/

APP.model.Usuario = {

    FotoPerfilAux: {},
    NmCompleto: "",
    //FlSexo : "",
    CdIdentificacao: "",
    NuCPF: "",
    DtExpiracao: "",
    IdPerfil: "",
    FlRecebeEmail: "",
    FlCompartilhado: "",
    FlAtivo: "",
    FlBloqueado: "",
    UsuarioClienteSites: {},
    IdUsuario: "",
    UsuarioCargoes: {},

    constructor: function (_FotoPerfilAux, _NmCompleto, _CdIdentificacao, _NuCPF, _DtExpiracao, _IdPerfil, _FlRecebeEmail,
        _FlCompartilhado, _FlAtivo, _FlBloqueado, _UsuarioClienteSites, _IdUsuario, _UsuarioCargoes) {
        var usuario = {
            FotoPerfilAux: _FotoPerfilAux,
            NmCompleto: _NmCompleto,
            //FlSexo : _FlSexo,
            CdIdentificacao: _CdIdentificacao,
            NuCPF: _NuCPF,
            DtExpiracao: _DtExpiracao,
            IdPerfil: _IdPerfil,
            FlRecebeEmail: _FlRecebeEmail,
            FlCompartilhado: _FlCompartilhado,
            FlAtivo: _FlAtivo,
            FlBloqueado: _FlBloqueado,
            UsuarioClienteSites: _UsuarioClienteSites,
            IdUsuario: _IdUsuario,
            UsuarioCargoes: _UsuarioCargoes,
        };
        return usuario;
    }

};

/*
|--------------------------------------------------------------------------
| Model UsuarioCargo
|--------------------------------------------------------------------------
*/

APP.model.UsuarioCargo = {

    model: {
        IdCargo: "",
    },


    constructor: function (_IdCargo) {
        var usuarioCargo = {
            IdCargo: _IdCargo
        };

        return usuarioCargo;
    }

};

/*
|--------------------------------------------------------------------------
| Model UsuarioClienteSite
|--------------------------------------------------------------------------
*/

APP.model.UsuarioClienteSite = {

    model: {
        IdSite: "",
        IdCliente: "",
    },


    constructor: function (_IdSite, _IdCliente) {
        var usuarioClienteSite = {
            IdSite: _IdSite,
            IdCliente: _IdCliente
        };

        return usuarioClienteSite;
    }

};

/*
|--------------------------------------------------------------------------
| Highcharts
|--------------------------------------------------------------------------
*/

APP.component.Highcharts = {

    colunas: function (_highchartsObj) {

        return this.setHighchartsRelatorioColunas(_highchartsObj);

    },

    barraEColuna: function (_highchartsObj) {

        return this.setHighchartsRelatorioColuna(_highchartsObj);
    },

    pizza: function (_highchartsObj) {

        return this.setHighchartsPizza(_highchartsObj);
    },

    barra: function (_highchartsObj) {

        return this.setHighchartsBarra(_highchartsObj);
    },

    rosquinha: function (_highchartsObj) {

        return this.setHighchartsRosquinha(_highchartsObj);
    },

    empilhado: function (_highchartsObj) {

        return this.setHighchartsEmpilhado(_highchartsObj);
    },

    spline: function (_highchartsObj) {

        return this.setHighchartsSpline(_highchartsObj);
    },

    range: function (_highchartsObj) {

        return this.setHighchartsRange(_highchartsObj);
    },

    setHighchartsRelatorioColunas: function (filtro) {

        Highcharts.chart(filtro.Container, {
            chart: {
                zoomType: 'xy'
            },
            title: {
                text: filtro.Titulo
            },
            subtitle: {
                text: filtro.SubTitulo
            },
            xAxis: [{
                categories: filtro.Categorias,
                crosshair: true
            }],
            yAxis: [{ // Primary yAxis
                labels: {
                    format: '{value} ' + filtro.UnidadeIndicador + '',
                    style: {
                        color: Highcharts.getOptions().colors[1]
                    }
                },
                title: {
                    text: '',
                    style: {
                        color: Highcharts.getOptions().colors[1]
                    }
                }
            }, { // Secondary yAxis
                title: {
                    text: '',
                },
            }],
            tooltip: {
                shared: true
            },
            legend: filtro.Legenda,
            series: [{
                name: filtro.SeriesTotais[0].name,
                type: 'column',
                data: filtro.SeriesTotais[0].data,
                tooltip: {
                    valueSuffix: filtro.UnidadeIndicador
                }

            }, {
                name: filtro.SeriesTotais[1].name,
                type: 'spline',
                data: filtro.SeriesTotais[1].data,
                tooltip: {
                    valueSuffix: filtro.UnidadeIndicador
                }
            }]
        });

    },


};
/*
|--------------------------------------------------------------------------
| Bar Rating
|--------------------------------------------------------------------------
*/

APP.component.BarRating = {

    init: function (_selector, _theme) {

        this.setup();
        this.setBarRating(_selector, _theme);

    },

    setup: function () {

        //

    },

    setBarRating: function (_selector, _theme) {

        $(_selector).barrating('show', {
            theme: _theme,
            initialRating: '0',
            showValues: false,
            onSelect: function (value, text) {
                //console.log(value, text);
            }
        });

    },

    setBarRatingGestaoDeRisco: function (_divGestaoDeRisco, _theme) {

        $(_divGestaoDeRisco).barrating('show', {
            theme: _theme,
            initialRating: '0',
            showValues: false,
            onSelect: function (value, text) {
                APP.component.GestaoDeRiscoPartial.setCriticidade(_divGestaoDeRisco, value, text);
            }
        });

    },

};
/*
|--------------------------------------------------------------------------
| BootBox
|--------------------------------------------------------------------------
*/

APP.component.BootBox = {

    init: function () {

        this.chamaBootBox(_actionPartialViewBackend, _controllerBackend, idPainelHtml, _controllerIntJS, TituloPartial, funcaoListaAtivos, _btnClick);

    },

    chamaBootBox: function (_actionPartialViewBackend, _controllerBackend, idPainelHtml, _controllerIntJS, TituloPartial, funcaoListaAtivos, _btnClick) {

        var _tipo = $(_btnClick).data("tipo");
        var _site = $(_btnClick).data("site");
        $.ajax({
            url: "/ControladorCategorias/" + _actionPartialViewBackend + "?tipo=" + _tipo + "&site=" + _site,
            type: 'POST',
            data: {
                __RequestVerificationToken: $("[name=__RequestVerificationToken]").val()
            },
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                bootbox.confirm({
                    message: "<div id='" + idPainelHtml + "'>" + result + "</div>", title: TituloPartial,
                    "className": "modal-form",
                    callback: function (result) {
                        funcaoListaAtivos();
                    }
                });
                _controllerIntJS(_tipo, _site);
            },
            complete: function () {
                APP.component.Loading.hideLoading();
            },
            error: callBackError
        });

    }

};
/*
|--------------------------------------------------------------------------
| CKEditor
|--------------------------------------------------------------------------
*/

APP.component.CkEditor = {

    init: function (_nameID) {

        this.setup();
        this.setCkEditor(_nameID);

    },

    setup: function () {

        //

    },

    setCkEditor: function (_nameID) {

        CKEDITOR.replace(_nameID);

    },

};
/*
|--------------------------------------------------------------------------
| Data Picker
|--------------------------------------------------------------------------
*/

APP.component.Datapicker = {

    init: function () {

        this.setup();
        this.ativaDataPicker();
        this.ativaTimePicker();
        this.setIconDataPicker();
        this.setIconTimePicker();

    },

    setup: function () {

        //

    },

    ativaDataPicker: function () {

        // jQuery.datetimepicker.setLocale(jsIdioma);
        // $('.data:not([readonly])').datetimepicker({
        // 	format: 'd/m/Y',
        // 	lang: jsIdioma,
        // 	timepicker: false,
        // 	scrollInput: false
        // });
        // $(".data").attr("autocomplete", "off");
        // $(".data").g2itMasks("date");

        $('.data').datepicker({
            dateFormat: "dd/mm/yy",
            minDate: new Date()
        });

    },

    setDataPicker: function (_this, _seletor) {

        var arr = [];
        var dataSelected = $(_this).val();
        var strNewFormat = dataSelected.split('/');
        arr.push(strNewFormat[1]);
        arr.push(strNewFormat[0]);
        arr.push(strNewFormat[2]);

        var data = new Date(arr.join('/'));

        $(_seletor).datepicker("option", "minDate", data);

    },

    ativaTimePicker: function () {

        $('.time').timepicker({});

    },

    setIconDataPicker: function () {

        $('.fa-calendar').on('click', function () {

            if ($(this).closest('div').find('.data').attr("disabled") == undefined)
            {
                $(this).closest('div').find('.data').trigger("focusin");
            }          

        });

    },

    setIconTimePicker: function () {

        $('.fa-clock-o').on('click', function () {

            $(this).closest('div').find('.time').trigger("focus");

        });

    },

};
/*
|--------------------------------------------------------------------------
| DataTable
|--------------------------------------------------------------------------
*/

APP.component.DataTable = {

    init: function (_nomeTable) {

        this.setup();
        return this.setDataTable(_nomeTable);

    },

    setup: function () {

        //

    },

    setDataTable: function (_nomeTable) {
        table = $(_nomeTable).DataTable({
            "destroy": true,
            "responsive": true,
            "lengthMenu": [[10, 50, 100, -1], [10, 50, 100, _options.tabelaTodosRegistros]],
            "iDisplayLength": 10,
            "language": {
                "lengthMenu": _options.tabelaLengthMenu,
                "zeroRecords": _options.tabelaZeroRecords,
                "info": _options.tabelaInfo,
                "infoEmpty": _options.tabelaInfoEmpty,
                "infoFiltered": _options.tabelaInfoFiltered,
                "search": _options.tabelaSearch,
                "searchPlaceholder": _options.tabelaSearchPlaceholder,
                "paginate": {
                    "next": _options.tabelaPaginateNext,
                    "previous": _options.tabelaPaginatePrevious
                }
            },
            "createdRow": function (row, data, dataIndex) {
                $(row).children().addClass("details-control");
                $(row).attr("id", dataIndex);
            },

        });

        // Apply the search
        $("table thead th input[type=text]").on('keyup change', function () {
            table
                .column($(this).closest('th').index() + ':visible')
                .search(this.value)
                .draw();
        });
        // Apply the search
        $("table thead th select").on('change', function () {
            var val = $.fn.dataTable.util.escapeRegex(
                $(this).val()
            );
            table
                .column($(this).closest('th').index() + ':visible')
                .search(val ? '^' + val + '$' : '', true, false)
                .draw();
        });

        table.on('responsive-resize', function (e, datatable, columns) {
            var i = 0;
            $("#hr1 > th").each(function () {
                if (columns[i]) {
                    $(this).removeClass("hide");
                } else {
                    $(this).addClass("hide");
                }
                i++;
            });
        });

        $(table.column(0).header()).addClass('never');
        table.responsive.rebuild();
        table.responsive.recalc();

        $(table.column(0).header()).removeClass('never');
        table.responsive.rebuild();
        table.responsive.recalc();
    },

    setDataTableParam: function (_nomeTable, _positionConlumn, _ascOrDesc, searchPlaceholder) {

        table = $(_nomeTable).DataTable({
            "destroy": true,
            "responsive": true,
            "lengthMenu": [[10, 50, 100, -1], [10, 50, 100, _options.tabelaTodosRegistros]],
            "iDisplayLength": 10,
            "order": [[_positionConlumn, _ascOrDesc]],
            "language": {
                "lengthMenu": _options.tabelaLengthMenu,
                "zeroRecords": _options.tabelaZeroRecords,
                "info": _options.tabelaInfo,
                "infoEmpty": _options.tabelaInfoEmpty,
                "infoFiltered": _options.tabelaInfoFiltered,
                "search": _options.tabelaSearch,
                "searchPlaceholder": searchPlaceholder,
                "paginate": {
                    "next": _options.tabelaPaginateNext,
                    "previous": _options.tabelaPaginatePrevious
                }
            },
            "createdRow": function (row, data, dataIndex) {
                $(row).children().addClass("details-control");
                $(row).attr("id", dataIndex);
            },

        });

        // Apply the search
        $("table thead th input[type=text]").on('keyup change', function () {
            table
                .column($(this).closest('th').index() + ':visible')
                .search(this.value)
                .draw();
        });
        // Apply the search
        $("table thead th select").on('change', function () {
            var val = $.fn.dataTable.util.escapeRegex(
                $(this).val()
            );
            table
                .column($(this).closest('th').index() + ':visible')
                .search(val ? '^' + val + '$' : '', true, false)
                .draw();
        });

        table.on('responsive-resize', function (e, datatable, columns) {
            var i = 0;
            $("#hr1 > th").each(function () {
                if (columns[i]) {
                    $(this).removeClass("hide");
                } else {
                    $(this).addClass("hide");
                }
                i++;
            });
        });

        $(table.column(0).header()).addClass('never');
        table.responsive.rebuild();
        table.responsive.recalc();

        $(table.column(0).header()).removeClass('never');
        table.responsive.rebuild();
        table.responsive.recalc();

        resizeTable(table);

    },

};
/*
|--------------------------------------------------------------------------
| Data Today
|--------------------------------------------------------------------------
*/

APP.component.Datatoday = {

    init: function () {

        return this.getDataToday();

    },

    getDataToday: function () {

        var today = new Date(),
            DD = today.getDate(),
            MM = today.getMonth() + 1, //January is 0!
            YYYY = today.getFullYear();

        if (DD < 10) {
            DD = '0' + DD;
        }
        if (MM < 10) {
            MM = '0' + MM;
        }

        return today = DD + "/" + MM + "/" + YYYY;

    },

    getHoraNow: function () {

        new Date($.now());
        var dt = new Date();
        var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();

        return time;

    },

    getDateUsFormat: function (_data) {

        // O formato da data contida na variÃ¡vel "data" Ã© dd/mm/yyyy
        var split = _data.split('/');
        var novadata = split[1] + "/" + split[0] + "/" + split[2];
        var data_americana = new Date(novadata);

        return data_americana;

    },

    getCompareDate: function (_dateNow, _dateLast) {

        var dataNow = APP.component.Datatoday.getDateUsFormat(_dateNow);
        var dataLast = APP.component.Datatoday.getDateUsFormat(_dateLast);
        if (new Date(dataNow).getTime() > new Date(dataLast).getTime()) {
            return true;
        } else {
            return false;
        }

    },

};
/*
|--------------------------------------------------------------------------
| Drag And Drop
|--------------------------------------------------------------------------
*/

APP.component.DragAndDrop = {

    dragSrcEl: {},

    bindDraggables: function () {
        var cols = document.querySelectorAll('.pai-calendario-processo, .calendar ul li');

        [].forEach.call(cols, function (col) {
            col.addEventListener('dragstart', APP.component.DragAndDrop.drag, false);
            col.addEventListener('dragenter', APP.component.DragAndDrop.handleDragEnter, false);
            col.addEventListener('dragover', APP.component.DragAndDrop.handleDragOver, false);
            col.addEventListener('dragleave', APP.component.DragAndDrop.handleDragLeave, false);
            col.addEventListener('drop', APP.component.DragAndDrop.drop, false);
            col.addEventListener('dragend', APP.component.DragAndDrop.handleDragEnd, false);
        });
    },

    createDraggables: function () {

    },

    allowDrop: function (ev) {
        ev.preventDefault();
    },

    drag: function (ev) {
        ev.dataTransfer.setData("text", ev.target.id);
    },

    drop: function (ev) {

        //ev.preventDefault();
        //var data = ev.dataTransfer.getData("text");
        //ev.target.appendChild();


        ev.preventDefault();
        var data = ev.dataTransfer.getData("text");        
        var nodeCopy = document.getElementById(data).cloneNode(true);
        //nodeCopy.id = nodeCopy.id + "newId"; 
        
        var temNovoNode = false;
        
        $(ev.target).find("li").each(function () {
            if($(this).find("span").html() == $(nodeCopy).find("span").html())
            {
                temNovoNode = true;
            }            
        });
        
        if(!temNovoNode)
        {
            $(nodeCopy).find("span").html($(nodeCopy).find("span").html() + "<a href='#' onclick='ExcluirProcessoAuditoria(this);' style='float: right; margin-right: 10px; color: white'><i class='fa fa-trash'></i></a>")
            ev.target.appendChild(nodeCopy);
        }
    },





    handleDrop: function (e) {
        if (e.stopPropagation) {
            e.stopPropagation();
        }

        if (APP.component.DragAndDrop.dragSrcEl != this) {
            APP.component.DragAndDrop.dragSrcEl.innerHTML = this.innerHTML;
            this.innerHTML = e.dataTransfer.getData('text/html');
        }
        return false;
    },

    handleDragEnd: function (e) {
        var cols = document.querySelectorAll('.pai-calendario-processo, .calendar ul li');
        this.style.opacity = 1;

        [].forEach.call(cols, function (col) {
            col.classList.remove('over');
        });
    },

    handleDragEnter: function (e) {
        this.classList.add('over');
    },

    handleDragLeave: function (e) {
        this.classList.remove('over');
    },

    handleDragOver: function (e) {
        if (e.preventDefault) {
            e.preventDefault();
        }

        e.dataTransfer.dropEffect = 'copy';
        return false;
    },

    handleDragStart: function (e) {
        this.style.opacity = 0.4;
        APP.component.DragAndDrop.dragSrcEl = this;
        e.dataTransfer.effectAllowed = 'copy';
        e.dataTransfer.setData('text/html', this.innerHTML);
    },

    init: function () {
        var readyStateCheckInterval = setInterval(function () {
            if (document.readyState === "complete") {
                clearInterval(readyStateCheckInterval);
                //APP.component.DragAndDrop.createDraggables();
                //APP.component.DragAndDrop.bindDraggables();
            }
        }, 10);
    }

};
/*
|--------------------------------------------------------------------------
| File Upload
|--------------------------------------------------------------------------
*/

APP.component.FileUpload = {

    init: function () {

        this.setup();
        this.fileUpload();
        this.delItemFileUpload();
        this.fileUploadMultiple();
        this.fileUploadArquivo();

        this.fileUploadRai();
        this.delItemFileUploadRai();

    },

    setup: function () {

        //Botoes
        this.buttonUploadImg = $("[class^=btn-upload]");
        this.buttonUploadImgMultiple = $("[class^=btn-upload-multiple]");
        this.buttonUploadArquivo = $("[class^=btn-upload-file]");
        this.buttonDelFileUpload = $("[class^=btn-delete]");

        this.buttonUploadRai = $("[class^=btn-upload-rai]");
        this.buttonDelFileUploadRai = $("[class^=btn-delete-rai]");

    },

    fileUpload: function () {

        this.buttonUploadImg.unbind('click');
        this.buttonUploadImg.on('click', function () {
            $(this).closest('div').find('input').trigger("click");

            //Variaveis de auxilio
            var idInput = $(this).closest('div').find('input').attr('id');
            var srcImg = $(this).children();
            var base64 = "";

            $('#' + idInput + '').unbind('change');
            $('#' + idInput + '').on('change', function () {

                var _files = this.files;

                if (_files && _files[0]) {

                    var reader = new FileReader();
                    var name = "";

                    reader.onload = function (e) {

                        srcImg.attr('src', e.target.result);

                        //Pega somente a String Base64 e coloca da tag data-b64
                        base64 = e.target.result.split(',');
                        $('#' + idInput + '').data('b64', '' + base64[1] + '');

                        //Pega o nome do arquivo e inputa na UL de descricao de arquivos
                        name = $('#' + idInput + '').prop('files')[0].name;

                    };

                    reader.readAsDataURL(_files[0]);
                }

            });

        });

    },

    fileUploadMultiple: function () {

        var names = [];

        this.buttonUploadImgMultiple.unbind('click');
        this.buttonUploadImgMultiple.on('click', function () {
            $(this).closest('div').find('input[type=file]').trigger("click");

            //Variaveis de auxilio
            var idInput = $(this).closest('div').find('input[type=file]').attr('id');
            var srcImg = $(this).children();
            var base64 = "";
            var idUl = $(this).closest('div').find('ul');

            //Variaveis para verificacao de extensao e setar img default
            //var nameInput = $(this).next('input').attr('name');
            //var urlSrcImg = $('[name='+nameInput+']').closest('.form-group').find('[name='+nameInput+'Default]').val();
            //var typeImg = "";
            $('#' + idInput + '').unbind('change');
            $('#' + idInput + '').on('change', function () {

                for (var i = 0; i < $(this).get(0).files.length; ++i) {
                    names.push($(this).get(0).files[i].name);
                }

                var _files = this.files;

                if (_files && _files[0]) {

                    var reader = new FileReader();
                    var name = "";

                    reader.onload = function (e) {

                        var tamLi = idUl.find('li').size();
                        if (tamLi == 0) {

                            srcImg.attr('src', e.target.result);

                            //Pega somente a String Base64 e coloca da tag data-b64
                            base64 = e.target.result.split(',');
                            $('#' + idInput + '').data('b64', '' + base64[1] + '');

                            //Pega o nome do arquivo e inputa na UL de descricao de arquivos
                            name = $('#' + idInput + '').prop('files')[0].name;

                        }
                        //Add List to UL
                        if (idUl.size() != 0) {

                            //Add Class na div UL
                            $(idUl).addClass('dashed');
                            $(idUl).closest('div').addClass('box-upload-arq');
                            //Pega somente a String Base64 e coloca da tag data-b64
                            base64 = e.target.result.split(',');

                            var html = '';
                            html += '';
                            html += '<li>';
                            html += '<a href="#" data-b64="' + base64[1] + '">' + names[names.length - 1] + '</a>';
                            html += '<input type="hidden" name="formCriaClienteContratoNome" value="0">';
                            html += '<input type="hidden" name="formCriaClienteContratoIdAnexo" value="0">';
                            html += '<input type="hidden" name="formCriaClienteContratoDefault" value="0" />';
                            html += '<a href="#" class="btn-delete">';
                            html += '<i class="fa fa-trash fa-1" aria-hidden="true" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '">';
                            html += '</i>';
                            html += '</a>';
                            html += '</li>';

                            idUl.append(html);

                        } else {
                            $(idUl).removeClass('dashed');
                        }

                        APP.component.FileUpload.bind();

                    };

                    reader.readAsDataURL(_files[0]);
                }

            });


        });

    },

    fileUploadArquivo: function () {

        this.buttonUploadArquivo.unbind('click');
        this.buttonUploadArquivo.on('click', function () {
            $(this).closest('div').find('input[type=file]').trigger("click");

            //Variaveis de auxilio
            var idInput = $(this).closest('div').find('input[type=file]').attr('id');
            var srcImg = $(this);
            var base64 = "";

            $('#' + idInput + '').unbind('change');
            $('#' + idInput + '').on('change', function () {

                var _files = this.files;

                if (_files && _files[0]) {

                    var reader = new FileReader();
                    var name = "";

                    reader.onload = function (e) {

                        name = $('#' + idInput + '').prop('files')[0].name;
                        base64 = e.target.result.split(',');

                        var extencao = name.split('.')[1];

                        srcImg.children().text(name.substring(0, 8) + "..." + extencao);
                        
                        var html = '<div class="DivExcluirAnexoEvidencia" style="float: left; margin-top: -50px">';
                        html += '<a href="#" class="btn-delete" onclick="DeleteAnexoAcaoImediata(this)">';
                        html += '<i class="fa fa-trash fa-1" aria-hidden="true" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '">';
                        html += '</i>';
                        html += '</div>';

                        srcImg.parent().append(html);

                        //Pega somente a String Base64 e coloca da tag data-b64
                        $('#' + idInput + '').data('b64', '' + base64[1] + '');


                    };

                    reader.readAsDataURL(_files[0]);
                }

            });

        });

    },

    delItemFileUpload: function () {

        this.buttonDelFileUpload.unbind('click');
        this.buttonDelFileUpload.on('click', function (event) {

            event.preventDefault();
            $(this).closest('li').remove();

        });

    },

    saveFileUpload: function (_idName, _url) {

        var xhr = new XMLHttpRequest();
        var fd = new FormData();
        fd.append("file", document.getElementById('form-cria-cliente-logo').files[0]);
        xhr.open("POST", "/Cliente/UploadArquivoLogo/", true);
        xhr.send(fd);
        xhr.addEventListener("load", function (result) {

        }, false);

    },

    fileUploadRai: function () {

        this.buttonUploadRai.unbind('click');
        this.buttonUploadRai.on('click', function () {
            $(this).closest('div').find('input[type=file]').trigger("click");

            //Variaveis de auxilio
            var idInput = $(this).closest('div').find('input[type=file]').attr('id');
            var NomeAnexo = $(this).closest('div').find('.NomeAnexo');
            var srcImg = $(this);
            var base64 = "";

            $('#' + idInput + '').unbind('change');
            $('#' + idInput + '').on('change', function () {

                var _files = this.files;

                if (_files && _files[0]) {

                    var reader = new FileReader();
                    var name = "";

                    reader.onload = function (e) {

                        name = $('#' + idInput + '').prop('files')[0].name;
                        base64 = e.target.result.split(',');
                        
                        NomeAnexo.val(name);
                        srcImg.text('R.A.I');
                        
                        var html = '';
                        html += '<a href="#" class="btn-delete-rai">';
                        html += '<i class="fa fa-trash fa-1" aria-hidden="true" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '">';
                        html += '</i>';
                        html += '</a>';

                        srcImg.parent().append(html);

                        //Pega somente a String Base64 e coloca da tag data-b64
                        $('#' + idInput + '').data('b64', '' + base64[1] + '');

                        APP.component.FileUpload.bind();

                    };

                    reader.readAsDataURL(_files[0]);

                }

            });


        });

    },

    delItemFileUploadRai: function () {

        this.buttonDelFileUploadRai.unbind('click');
        this.buttonDelFileUploadRai.on('click', function (event) {
            
            var id = $(this).parent().find(".download-rai-form-auditoria-mes").attr("id");

            event.preventDefault();
            $("#" + id).parent().find('[class^=btn-upload]').text('');
            $(this).parent().find('input[type=file]').data('b64', '');
            $(this).parent().find('input[type=file]').attr('data-b64', '');
            
            $(this).parent().find('.IdAnexo').val('');
            $(this).parent().find('.NomeAnexo').val('');  

            $("#" + id).attr("class", id);
            $("#" + id).removeAttr("href");
            $("#" + id).removeAttr("target");
            $("#" + id).removeAttr("download");
            $("#" + id).attr("onclick", "UploadArquivoRai(this);");
            
            
            $(this).closest('div').find('[class^=btn-upload]').html('<i class="fa fa-paperclip fa-1x" aria-hidden="true"></i> Anexar');
            $(this).remove();

        });

    },

    bind: function () {

        APP.component.FileUpload.setup();
        APP.component.FileUpload.delItemFileUpload();
        APP.component.FileUpload.delItemFileUploadRai();

    },

};
/*
|--------------------------------------------------------------------------
| GestaoDeRiscoPartial
|--------------------------------------------------------------------------
*/

APP.component.GestaoDeRiscoPartial = {

    init: function (_divGestaoDeRisco, _temaSelected) {

        var page = APP.component.Util.getPage();

        this.setup();

        if (page == "CriarAnaliseCritica") {
            this.gestaoDeRiscoCriarAnaliseCritica(_divGestaoDeRisco, _temaSelected);
            //this.gestaoDeRisco(_selector);
          
            }
        if (page == "EditarAnaliseCritica") {
            this.gestaoDeRiscoEditAnaliseCritica();
        }

    },

    setup: function () {

        //this.buttonNome = $('');

    },

    gestaoDeRiscoCriarAnaliseCritica: function (_divGestaoDeRisco, _temaSelected) {

       
        this.getPartialGestaoDeRisco(_divGestaoDeRisco, _temaSelected);
        this.setCkeditorGestaoDeRisco(_divGestaoDeRisco, _temaSelected);
        this.setBarRating(_divGestaoDeRisco);

        this.setCriticidade();
        this.setERisco();
        this.getERisco();

   

        var numeroRisco = $('[name=numeroAC]').val();
        var busca = ".gestaoDeRiscoPartial-"+_temaSelected;      
        $(busca).find($('[name=formGestaoDeRiscoNumero]')).val(numeroRisco); 
        $('[name=numeroAC]').val(parseInt(numeroRisco) + parseInt('1'));



    },

    //GestÃ£o de Risco - Criar Analise Critica
    getPartialGestaoDeRisco: function (_divGestaoDeRisco, _temaSelected) {

        $.ajax({
            type: "POST",
            async: false,
            url: '/GestaoDeRisco/ObterPartialGestaoDeRisco',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                _divGestaoDeRisco.html(result);
                _divGestaoDeRisco.find('[name=formGestaoDeRiscoRisco]').attr('name', 'formGestaoDeRiscoRisco-' + _temaSelected);
                APP.component.GestaoDeRiscoPartial.setHideAndShowGestaodeRisco(_divGestaoDeRisco);
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    setCkeditorGestaoDeRisco: function (_divGestaoDeRisco, _temaSelected) {

        $(_divGestaoDeRisco).find('textarea').first().attr('id', _temaSelected);
        var ckeditorID = $(_divGestaoDeRisco).find('textarea').first().attr('id');
        APP.component.CkEditor.init(ckeditorID);

    },

    setBarRating: function (_divGestaoDeRisco) {

        var divBarRating = $(_divGestaoDeRisco).find('.barraRating');
        APP.component.BarRating.setBarRatingGestaoDeRisco(divBarRating, 'bars-1to10');

    },

    setHideAndShowGestaodeRisco: function (_divGestaoDeRisco) {

        //_divGestaoDeRisco.find('[name^=formGestaoDeRiscoRisco]').closest('[class^=col]').hide();
        //_divGestaoDeRisco.find('[name=formGestaoDeRiscoResponsavelDefinicao]').closest('[class^=col]').hide();
        //_divGestaoDeRisco.find('[name=formGestaoDeRiscoNumero]').closest('[class^=col]').hide();
        $('.responsavel-gestao-de-risco').hide();
        $('.numeroGestaoRisco').hide();   
        $('.JustificativaGestaoDeRisco').hide(); 
        
       _divGestaoDeRisco.find('[name=formGestaoDeRiscoCausa]').closest('[class^=col]').hide();
        $('.numeroGestaoRisco').hide();
        //_divGestaoDeRisco.find('[name=formGestaoDeRiscoIdentificacao]').closest('[class^=col]').hide();

    },

    //Changes
    setCriticidade: function (value, text) {

    $('[name^=formGestaoDeRiscoCriticidade]').on('change', function () {

            //var barRatingSelect = $(this).val();
            //if (barRatingSelect == 2 || barRatingSelect == 3) {
            //$(this).closest('#gestaoDeRisco').find('[name^=formGestaoDeRiscoRisco]').closest('[class^=col]').show();
            APP.controller.AnaliseCriticaController.getTodosResponsaveisPorAcaoImediata(this);
            //}
            // else {
            //$(this).closest('#gestaoDeRisco').find('[name^=formGestaoDeRiscoRisco]').attr('checked',false);
            //$(this).closest('#gestaoDeRisco').find('[name^=formGestaoDeRiscoRisco]').closest('[class^=col]').hide();
            //$(this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoResponsavelDefinicao]').closest('[class^=col]').hide();
            //$(this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoNumero]').closest('[class^=col]').hide();
            //$(this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoIdentificacao]').closest('[class^=col]').hide();
            // }

        });

    },

    setERisco: function () {

        $('[name^=formGestaoDeRiscoRisco]').unbind('change');
        $('[name^=formGestaoDeRiscoRisco]').on('change', function () {

            var ERisco = APP.component.GestaoDeRiscoPartial.getERisco(this);
            APP.component.GestaoDeRiscoPartial.setRulesERisco(ERisco, this);

        });

    },



    //Auxiliares
    getERisco: function (_this) {

        var ERisco = $(_this).val();
        return ERisco;

    },

    //Rules
    setRulesERisco: function (_ERisco, _this) {

        if (_ERisco == "true") {
            $(_this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoResponsavelDefinicao]').closest('[class^=col]').show();
            $(_this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoNumero]').closest('[class^=col]').show();
            $(_this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoNumero]').prop('disabled', true);
            $(_this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoIdentificacao]').closest('[class^=col]').show();
            $(_this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoCausa]').closest('[class^=col]').show();
            $('.numeroGestaoRisco').show();
            $('.JustificativaGestaoDeRisco').hide();            
            APP.controller.AnaliseCriticaController.getTodosResponsaveisPorAcaoImediata(_this);
        } else {
            $(_this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoResponsavelDefinicao]').closest('[class^=col]').hide();
            $(_this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoNumero]').closest('[class^=col]').hide();
            //$(_this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoIdentificacao]').closest('[class^=col]').hide();
            $(_this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoCausa]').closest('[class^=col]').hide();
            $('.JustificativaGestaoDeRisco').show();
        }

    },

    setRulesCriticidade: function (_barRatingSelect) {

        if (barRatingSelect == 2 || barRatingSelect == 3) {
            $('[name=formGestaoDeRiscoResponsavelDefinicao]').closest('[class^=col]').show();
            $('[name=formGestaoDeRiscoCausa]').closest('[class^=col]').show();
            $('[name=formGestaoDeRiscoNumero]').closest('[class^=col]').show();
            $('[name=formGestaoDeRiscoIdentificacao]').closest('[class^=col]').show();
            APP.controller.AnaliseCriticaController.getTodosResponsaveisPorAcaoImediata(this);
        } else {
            $('[name=formGestaoDeRiscoResponsavelDefinicao]').closest('[class^=col]').hide();
            $('[name=formGestaoDeRiscoCausa]').closest('[class^=col]').hide();
            $('[name=formGestaoDeRiscoNumero]').closest('[class^=col]').hide();
            $('[name=formGestaoDeRiscoIdentificacao]').closest('[class^=col]').hide();
        }

    },

    getRadioPossuiGestaoDeRisco: function () {

        $('[name^=formGestaoDeRiscoRisco]').unbind('change');
        $('[name^=formGestaoDeRiscoRisco]').bind('change', function () {
            var radioPossuiGestaoDeRisco = APP.component.Radio.init('formGestaoDeRiscoRisco');
            if (radioPossuiGestaoDeRisco == "true") {
                $(this).closest('#gestaoDeRisco').find('[name=InformacoesGestaoDeRisco]').show();
                $(this).closest('#gestaoDeRisco').find('.responsavel-gestao-de-risco').show();
                $(this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoCausa]').show();
                APP.controller.AnaliseCriticaController.getTodosResponsaveisPorAcaoImediata(this);

            } else {
                $(this).closest('#gestaoDeRisco').find('[name=InformacoesGestaoDeRisco]').hide();
                $(this).closest('#gestaoDeRisco').find('.responsavel-gestao-de-risco').hide();
                $(this).closest('#gestaoDeRisco').find('[name=formGestaoDeRiscoCausa]').hide();
            }

        });

    },



    //GestÃ£o de Risco - Editar Analise Critica
    gestaoDeRiscoEditAnaliseCritica: function () {

        APP.component.BarRating.init('.barraRating', 'bars-1to10');

        $(('[id^=DsTexto]')).each(function (key, value) {

            var idDsTexto = $(this).attr('id');
            APP.component.CkEditor.init('#' + idDsTexto);
        });

        this.setDisableForm();

    },

    setDisableForm: function () {

        $('[name=options2]').prop("disabled", true);

    },

    setInfosEditGestaoDeRisco: function () {
        var selectRisco = $('.tema-cor-risco').val();
        //$('.rating').closest('div').next();data('');

    },

};


/*
|--------------------------------------------------------------------------
| Loading
|--------------------------------------------------------------------------
*/

APP.component.Calendar = {

    init: function () {

        this.setup();
    },

    setup: function () {

        $(".fa-calendar").click(function () {

            if ($(this).parent().parent().find("input").attr("disabled") == undefined) {
                $(this).parent().parent().find("input").datepicker("show");
            }

            
        });

        

    },
};

/*
|--------------------------------------------------------------------------
| Loading
|--------------------------------------------------------------------------
*/

APP.component.Loading = {

    init: function () {

        this.setup();
        this.hideLoading();

    },

    setup: function () {

        //

    },

    showLoading: function () {

        $(".loading").show().focus();

    },

    hideLoading: function () {

        $(".loading").hide();

    },

};
/*
|--------------------------------------------------------------------------
| Lobi Panel
|--------------------------------------------------------------------------
*/

APP.component.AtivaLobiPanel = {

    init: function () {

        this.ativaLobiPanel();

    },

    ativaLobiPanel: function () {

        $('.panel').lobiPanel({
            editTitle: false,
            unpin: false,
            reload: false,
            close: false,
            minimize: {
                icon: 'fa fa-minus',
                icon2: 'fa fa-plus',
                tooltip: _options.Minimiza
            },
            expand: {
                icon: 'fa fa-expand',
                icon2: 'fa fa-compress',
                tooltip: _options.TelaCheia
            },
            close: false,
            toggleIcon: "caret"
        });

    },

};

/*
|--------------------------------------------------------------------------
| Máscaras
|--------------------------------------------------------------------------
*/

APP.component.Mascaras = {

    init: function () {

        this.mascara();
        this.mascaraCelular();

    },

    mascara: function () {

        $('.input-cpf').mask('000.000.000-00', { reverse: true });
        $('.input-telefone').mask('(00) 0000-0000');
        $('.input-cep').mask('00000-000');
        $('.input-data').mask('00/00/0000');
        $('.input-cnpj').mask('00.000.000/0000-00');
        $('.input-metrica').mask('000.000.000.000,000');
    },

    mascaraCelular: function () {

        $('.input-celular').focusout(function () {

            var elemento, elementoThis; elementoThis = $(this);
            elementoThis.unmask(); elemento = elementoThis.val().replace(/\D/g, "");

            if (elemento.length > 10) {
                elementoThis.mask("(00) 90000-0000", {
                    placeholder: "(__) _____-____",
                });
            }
            else {
                elementoThis.mask("(00) 0000-0000", {
                    placeholder: "(__) ____-____",
                });
            }

        }).trigger("focusout");

    },

    mascaraDinheiro: function () {

        $(".input-money").maskMoney({
            prefix: 'R$ ', allowNegative: true,
            thousands: '.',
            decimal: ',',
            affixesStay: false
        });

    }


};

/*
|--------------------------------------------------------------------------
| Menu
|--------------------------------------------------------------------------
*/

APP.component.Menu = {

    init: function () {
        this.setup();
        this.abrirMenu();
        this.fecharMenu();
    },

    setup: function () {

        this.OpenMenu = $('.menu-lateral');
        this.CloseMenu = $('.close-menu-lateral');

    },

    abrirMenu: function () {

        this.OpenMenu.on('click', function () {
            $("#mySidenav").css("width", "250px");
            $("#main").css("marginLeft", "250px");
        });

        

    },

    fecharMenu: function () {

        this.CloseMenu.on('click', function () {
            $("#mySidenav").css("width", "0px");
            $("#main").css("marginLeft", "0px");

        });

        

    },

};
/*
|--------------------------------------------------------------------------
| Menu Side Bar
|--------------------------------------------------------------------------
*/

APP.component.MenuSideBar = {

    init: function () {

        this.setup();
        this.menuSideBar();

    },

    setup: function () {

        //Botao de trocar a imagem
        //this.buttonUploadImg = $("[class^=btn-upload-img]");

    },

    menuSideBar: function () {

        var trigger = $('.hamburger'),
            overlay = $('.overlay'),
            isClosed = false;

        trigger.click(function () {
            hamburger_cross();
        });

        function hamburger_cross() {

            if (isClosed == true) {
                overlay.hide();
                trigger.removeClass('is-open');
                trigger.addClass('is-closed');
                isClosed = false;
                $('.wrapper-toggle').removeClass('toggled');
            } else {
                overlay.show();
                trigger.removeClass('is-closed');
                trigger.addClass('is-open');
                isClosed = true;
                $('.wrapper-toggle').addClass('toggled');
            }
        }

    },


};
/*
|--------------------------------------------------------------------------
| User Menu
|--------------------------------------------------------------------------
*/

APP.component.UserMenu = {

    init: function () {

        var page = APP.component.Util.getPage();

        if (page != "Login") {

            this.setup();
            this.user();
            //this.sitesPorCliente();
            this.clientes();
            //this.sitesPorCoordenador();
            this.setBoxClientes();
            this.setSitesCoordenador();
        }
    },

    setup: function () {

        this.openCliente = $('#nav-user-clientes');
        this.closeCliente = $('#close-user-clientes');
        this.openSites = $('.box-clientes');
        this.closeSites = $('#close-user-sites');
        this.openSitesCoordenador = $('#nav-user-site');

    },

    user: function () {

        //Menu - Clientes
        this.openCliente.on('click', function () {
            $('#clientes').slideDown();
        });

        this.closeCliente.on('click', function () {
            $('#clientes').slideUp();
        });

        this.openSites.on('click', function () {
            $('#clientes').slideUp();
            $('#sites').slideDown();
        });

        this.closeSites.on('click', function () {
            $('#sites').slideUp();
        });

        this.openSitesCoordenador.on('click', function () {
            $('#sites').slideDown();
        });

    },

    sitesPorCliente: function (cliente) {
        $.ajax({
            type: "GET",
            async: false,
            dataType: 'json',
            url: "/Site/ObterSitesPorCliente",
            data: { idCliente: cliente },
            success: function (result) {

                var $siteBox = $("#sites .row-box");

                $siteBox.html("");

                $.each(result, function (key, val) {

                    var htmlSites = '';
                    var img = "";

                    if (val.SiteLogoAux.Extensao != null) {
                        img = "data:image/" + val.SiteLogoAux.Extensao + ";base64," + val.SiteLogoAux.ArquivoB64;
                    } else {
                        img = val.SiteLogoAux.ArquivoB64;
                    }

                    htmlSites += '<!-- Site - ' + val.NmFantasia + ' -->';
                    htmlSites += '<div class="col-md-2">';
                    htmlSites += '<div class="box-clientes">';
                    htmlSites += '<a href="/Site/EscolheSite/?idSite=' + val.IdSite + '">';
                    htmlSites += '<img src="' + img + '" class="img-responsive">';
                    htmlSites += '<span>' + val.NmFantasia + '</span></a>';
                    htmlSites += '</a>';
                    htmlSites += '</div>';
                    htmlSites += '</div>';
                    $siteBox.append(htmlSites);
                });
            },
        });
        $('#clientes').slideUp();
        $('#sites').slideDown();
    },

    clientes: function () {

        this.openCliente.on('click', function () {
            var tamanho = $("#clientes .box-clientes").size();
            var url = window.location.href;
            var $siteBox = $("#sites .row-box");

            $siteBox.html("");
            if (tamanho == 0) {

                $.ajax({
                    type: "GET",
                    async: false,
                    dataType: 'json',
                    url: "/Cliente/ObterClientesUsuario",
                    success: function (result) {

                        var $clienteBox = $("#clientes .row-box");
                        
                        var index = 1;

                        $.each(result, function (key, val) {

                            var htmlCliente = '';
                            var img = "";

                            if (val.ClienteLogoAux.Extensao != null) {
                                img = "data:image/" + val.ClienteLogoAux.Extensao + ";base64," + val.ClienteLogoAux.ArquivoB64;
                            } else {
                                img = val.ClienteLogoAux.ArquivoB64;
                            }

                            htmlCliente += '<!-- Cliente - ' + val.IdCliente + ' -->';
                            htmlCliente += '<div class="col-md-2">';
                            htmlCliente += '<div class="box-clientes">';
                            htmlCliente += '<a href="#" class="get-site-cliente">';
                            htmlCliente += '<img src="' + img + '" class="img-responsive">';
                            htmlCliente += '<span><input type="hidden" class="idCliente"' + 'value="' + val.IdCliente + '">' + val.NmFantasia + '</span></a>';
                            htmlCliente += '</div>';
                            htmlCliente += '</div>';
                            

                            if (result.length == index) {
                                htmlCliente += '<!-- Sair -->';
                                htmlCliente += '<div class="col-md-2">';
                                htmlCliente += '<div class="box-clientes">';
                                htmlCliente += '<a href="/Site/EscolheSite/?idSite=0" class="get-site-cliente">';
                                htmlCliente += '<img src="../../../img/sair.png" class="img-responsive">';
                                htmlCliente += '<span><input type="hidden" class="idCliente" value="0">'+_options.Sair+'</span></a>';
                                htmlCliente += '</div>';
                                htmlCliente += '</div>';

                            }

                            $clienteBox.append(htmlCliente);

                            index++;

                        });

                        APP.component.UserMenu.setBoxClientes();

                    },
                });

            }
        });

    },

    setBoxClientes: function () {
        $('.get-site-cliente').unbind('click');
        $('.get-site-cliente').bind('click', function (e) {

            var id = $(this).find(".idCliente").val();

            APP.component.UserMenu.getEscolheCliente(id);

        });
    },

    getEscolheCliente: function (_id) {

        $.ajax({
            type: "GET",
            async: false,
            dataType: 'json',
            data: { "idCliente": _id },
            url: "/Cliente/EscolheCliente/",
            success: function (result) {

            },
        });
        APP.component.UserMenu.sitesPorCliente(_id);
        //APP.component.UserMenu.setImagemCliente(_id);

    },

    setSitesCoordenador: function () {
        this.openSitesCoordenador.unbind("click");
        this.openSitesCoordenador.bind("click", function () {
            $("#modal-panel-clientes-sites .modal-title").html("Sites");
            APP.component.UserMenu.sitesPorCliente();
        });
    },

};

/*
|--------------------------------------------------------------------------
| Modal
|--------------------------------------------------------------------------
*/

APP.component.Modal = {

    init: function () {

        this.fecharModal();
        this.abrirModal();

    },

    fecharModal: function () {

        $('.modal-close').on('click', function () {
            $('.modal-box').hide();
            $('.modal').hide();
        });

    },

    abrirModal: function (titulo, texto) {

        $('.modal').fadeIn();
        $('.modal-box').fadeIn();
        $('.modal-title').text(titulo);
        $('.modal-text').text(texto);

    },

    alert: function (_title, _text) {

        $('#modal-alert .modal-title').text(_title);
        $('#modal-alert .modal-body').text(_text);
        $("#modal-alert").modal('show');

    }

};


/*
|--------------------------------------------------------------------------
| Radio Sim Não
|--------------------------------------------------------------------------
*/

APP.component.Radio = {

    init: function (_nomeRadio) {

        this.setup();
        return this.getRadio(_nomeRadio);

    },

    setup: function () {

        //

    },

    getRadio: function (_nomeRadio) {
        var radio_val = $("input[name='" + _nomeRadio + "']:checked").val();
        return radio_val;
    },

};
/*
|--------------------------------------------------------------------------
| Radio Sim Não
|--------------------------------------------------------------------------
*/

APP.component.RadioSimNao = {

    init: function (_nomeRadio) {

        this.setup();
        return this.getRadio(_nomeRadio);

    },

    setup: function () {

        //

    },

    getRadio: function (_nomeRadio) {
        var radio_val = $("input[name='" + _nomeRadio + "']:checked").val();
        return radio_val;
    },

};
/*
|--------------------------------------------------------------------------
| Notas / Avaliação
|--------------------------------------------------------------------------
*/

APP.component.Rating = {

    init: function () {

        this.nota();

    },

    enviarNota: function () {

        $("#rateYo").rateYo({
            starWidth: "20px",
            fullStar: true,
            rating: $('#nota-usuario').text(),
            onSet: function (rating) {

                obj = {
                    idConteudo: $('#conteudoID').text(),
                    nota: rating
                };

                $.ajax({
                    type: "POST",
                    async: false,
                    dataType: 'json',
                    url: tratarUrl("/Avaliacao/Avaliar"),
                    data: obj,
                });
            }
        });

    },

};
/*
|--------------------------------------------------------------------------
| Remove Acentos
|--------------------------------------------------------------------------
*/

APP.component.RemoveAcentos = {

    init: function (_word) {

        this.setup();
        return this.setRemoveAcentos(_word);

    },

    setup: function (_buton) {

        //

    },

    setRemoveAcentos: function (_word) {

        var string = _word;
        var mapaAcentosHex = {
            a: /[\xE0-\xE6]/g,
            e: /[\xE8-\xEB]/g,
            i: /[\xEC-\xEF]/g,
            o: /[\xF2-\xF6]/g,
            u: /[\xF9-\xFC]/g,
            c: /\xE7/g,
            n: /\xF1/g,
            '-': /\s/g
        };

        for (var letra in mapaAcentosHex) {
            var expressaoRegular = mapaAcentosHex[letra];
            string = string.replace(expressaoRegular, letra);
        }

        return string;

    },

};
/*
|--------------------------------------------------------------------------
| Result Erros - Alert HTML
|--------------------------------------------------------------------------
*/

APP.component.ResultErros = {

    init: function (_listErros) {

        this.setup();
        return this.setResultErros(_listErros);

    },

    setup: function () {

        //

    },

    setResultErros: function (_listErros) {

        var html = "";
        html += "<div class='erros-result'>";
        html += "<ul>";

        if (Array.isArray(_listErros)) {
            $.each(_listErros, function (index, value) {
                html += "<li>";
                html += "- " + value;
                html += "</li>";
            });
        }
        else
        {
            html += "<li>";
            html += "- " + _listErros;
            html += "</li>";
        }

        html += "</ul>";
        html += "</div>";

        return html;

    },

};
/*
|--------------------------------------------------------------------------
| SelectAll
|--------------------------------------------------------------------------
*/

APP.component.SelectAll = {

    init: function (_selector) {

        this.setup();
        this.setSelectAll(_selector);

    },

    setup: function () {

        //

    },

    setSelectAll: function (_selector) {

        $("[name^='" + _selector + "']").click(function () {
            $(this).closest('.tabela-check').find('input:checkbox').not(this).prop('checked', this.checked);
        });

    },

};
/*
|--------------------------------------------------------------------------
| Compare Select List
|--------------------------------------------------------------------------
*/

APP.component.SelectListCompare = {

    init: function (_listResult, _listPage, _idSelect, _paramCompare, _paramTexto) {

        this.setup();
        this.selectList(_listResult, _listPage, _idSelect, _paramCompare, _paramTexto);

    },

    setup: function () {

        //

    },

    selectList: function (_listResult, _listPage, _idSelect, _paramCompare, _paramTexto) {
        var array = _listResult;
        var anotherOne = [];
        var obj = {};

        if (_listPage.val() == undefined)
            _listPage = [0];

        $(_listPage).each(function (key, value) {
            

            obj = { [_paramCompare.valueOf()]: parseInt($(value).val()) };
            anotherOne.push(obj);
            
        });

        var filteredArray = array.filter(myCallBack);

        function myCallBack(el) {
            return anotherOne.findIndex(x => x['' + _paramCompare + ''] == el['$' + _paramCompare +'}']) < 0;
        }

        this.addSelectOnPage(filteredArray, _idSelect, obj, _paramTexto);

    },

    myCallBack: function (el) {

        return anotherOne.indexOf(el) < 0;

    },

    addSelectOnPage: function (filteredArray, _idSelect, obj, _paramTexto) {


        $(filteredArray).each(function (key, value) {

            var keyName = Object.keys(obj)[0];
            var $option = $('<option>');
            $(_idSelect.selector).append($option.val(value[keyName]).text(value[_paramTexto.valueOf()]));
            $(_idSelect).append($option.val(value[keyName]).text(value[_paramTexto.valueOf()]));

        });

    },

};

/*
|--------------------------------------------------------------------------
| Slider
|--------------------------------------------------------------------------
*/

APP.component.Slider = {

    init: function () {

        this.sliderPrincipal();


    },

    sliderPrincipal: function () {

        $('.bx-slider').bxSlider({
            auto: true,
            speed: 1000,
            onSliderLoad: function () {
                $(".slider").css("visibility", "visible");
            }
        });

    },

};

/*
|--------------------------------------------------------------------------
| Strong Password
|--------------------------------------------------------------------------
*/

APP.component.StrongPassword = {

    init: function (_button) {

        this.setup(_button);
        this.setStrongPassword(_button);
        this.setRuleStrongPassword();

    },

    setup: function (_button) {

        this.buttonChange = $("[name='" + _button + "']");

    },

    setStrongPassword: function (_button) {
        this.buttonChange.on('input', function () {

            var pwd = $("[name='" + _button + "']").val();

            var array = [];
            //Zero or more uppercase characters
            array[0] = pwd.match(/[A-Z]/);
            //Zero or more lowercase characters
            array[1] = pwd.match(/[a-z]/);
            //Zero or more decimal digits
            array[2] = pwd.match(/\d/);
            //Zero or more non-word characters (!, Â£, $, %, etc.)
            array[3] = pwd.match(/[!_.-]/);

            var sum = 0;
            for (var i = 0; i < array.length; i++) {
                sum += array[i] ? 1 : 0;
            }

            var label = APP.component.StrongPassword.getLabelStrongPassword();

            switch (sum) {
                case 0:
                    APP.component.StrongPassword.setHtmlStrongPassword(this, label[0]);
                    break;
                case 1:
                    APP.component.StrongPassword.setHtmlStrongPassword(this, label[1]);
                    break;
                case 2:
                    APP.component.StrongPassword.setHtmlStrongPassword(this, label[2]);
                    break;
                case 3:
                    APP.component.StrongPassword.setHtmlStrongPassword(this, label[3]);
                    break;
                case 4:
                    APP.component.StrongPassword.setHtmlStrongPassword(this, label[4]);
                    break;
                default:
                    APP.component.StrongPassword.setHtmlStrongPassword(this, label[0]);
                    break;
            }

        });

    },

    getLabelStrongPassword: function () {

        var arrayLabelStrongPassword = [];
        var strongPassword = $('input[name^=lblStrongPassword]');

        strongPassword.each(function (i) {

            arrayLabelStrongPassword[i] = $(this).val();

        });

        return arrayLabelStrongPassword;

    },

    setHtmlStrongPassword: function (e, _info) {

        var classe = APP.component.RemoveAcentos.init(_info).toLowerCase();

        var html = "";
        $('.pwd-validate').remove();
        html += '<div class="pwd-validate">';
        html += '<div class="pwd-validate-info">';
        html += '<span class="pwd-validate-info-' + classe + '">' + _info + '</span>';
        html += '</div>';
        html += '<div class="pwd-validate-bar pwd-validate-bar-' + classe + '">';
        html += '</div>';
        html += '</div>';

        $(e).closest('.form-group').append(html);

    },

    setRuleStrongPassword: function () {

        $.validator.addMethod("strongPassword", function () {
            var statusForce = APP.component.StrongPassword.getStrongPasswordValue();
            return ($('[name=formAlterarSenhaUtilizaSenhaForte]').val() == statusForce);
        });

    },

    getStrongPasswordValue: function () {

        var force = $('span[class^=pwd-validate-info-]').attr('class');
        force = force.split('info-');
        var statusForce = force[1];

        if (statusForce == "forte" || statusForce == "muito-forte") {
            return "true";
        } else {
            return "false";
        }

    },

};
/*
|--------------------------------------------------------------------------
| TINYMCE EDITOR
|--------------------------------------------------------------------------
*/

APP.component.TinyMCE = {

    init: function (_selector) {
        this.start(_selector);
    },

    start: function (_selector) {
        tinymce.init({
            selector: _selector,
            height: 200,
            width: 500,

            menubar: false,
            //plugins: [
            //  'advlist autolink lists link image charmap print preview anchor',
            //  'searchreplace visualblocks code fullscreen',
            //  'insertdatetime media table contextmenu paste code'
            //],
            toolbar: 'undo redo | insert | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image',
            content_css: [
                '//fonts.googleapis.com/css?family=Lato:300,300i,400,400i',
                '//www.tinymce.com/css/codepen.min.css']
        });
    },



};

/*
|--------------------------------------------------------------------------
| Tracking
|--------------------------------------------------------------------------
*/

APP.component.Tracking = {

    init: function () {

        this.trackUrl();
        this.trackEventos();
        this.trackAudio();

    },

    // Envia URL para trackear

    trackUrl: function () {

        obj = {
            descricaoNavegacao: window.location.href
        };


        $.ajax({
            type: "POST",
            async: false,
            dataType: 'json',
            url: tratarUrl("/Registro/Navegacao"),
            data: obj
        });

    },

    // Envia o track de cada evento

    trackEventos: function () {

        var tipoEvento = $('[data-tipoevento]');

        tipoEvento.on('click', function (event) {

            obj = {
                idConteudo: $('#conteudoID').text(),
                idTipoEvento: $(this).data("tipoevento")
            };

            $.ajax({
                type: "POST",
                async: false,
                dataType: 'json',
                url: tratarUrl("/Registro/Evento"),
                data: obj
            });


        });

    },

    // Envia o track de play de audio

    trackAudio: function () {
        var player = $("#player");

        player.on("play", function () {
            obj = {
                idConteudo: $('#conteudoID').text(),
                idTipoEvento: $(this).data("tipoevento")
            };

            $.ajax({
                type: "POST",
                async: false,
                dataType: 'json',
                url: tratarUrl("/Registro/Evento"),
                data: obj
            });

        });
    },





};

/*
|--------------------------------------------------------------------------
| Upload Files
|--------------------------------------------------------------------------
*/

APP.component.UploadFiles = {

    init: function () {

        this.setup();

    },

    setup: function () {

        //

    },

    setUploadFiles: function (urlToUpload, IdCtrlDrop, IdCtrlUpload, nomeCampo, maxSize, formJson, idForm, idRegistro, urlDelete) {

        $('#' + IdCtrlDrop + ' a').click(function () {
            // Simulate a click on the file input button
            // to show the file browser dialog
            $(this).parent().find('input').click();
        });

        // Initialize the jQuery File Upload plugin
        $('#' + IdCtrlUpload).fileupload({
            url: urlToUpload,
            sequentialUploads: true,
            limitMultiFileUploads: 1,
            formData: formJson,
            // This element will accept file drag/drop uploading
            dropZone: $('#' + IdCtrlDrop),

            // This function is called when a file is added to the queue;
            // either via the browse button, or via drag/drop:
            add: function (e, data) {
                if (data.files[0].size > maxSize) {
                    bootbox.alert(_options.MsgValidaUploadArquivoUnico + formatFileSize(maxSize));
                }
                else {
                    var tpl = $('<li class="working"><p></p><span></span></li>');

                    // Append the file name and file size
                    tpl.find('p').text(data.files[0].name);

                    // Add the HTML to the UL element
                    var ul = $('#' + IdCtrlUpload + ' ul');
                    data.context = tpl.appendTo(ul);

                    // Listen for clicks on the cancel icon
                    tpl.find('span').click(function () {

                        if (!tpl.hasClass('working')) {
                            jqXHR.abort();
                        }

                        tpl.fadeOut(function () {
                            tpl.remove();
                        });
                    });

                    // Automatically upload the file once it is added to the queue
                    var jqXHR = data.submit();
                }
            },

            progress: function (e, data) {
                // Calculate the completion percentage of the upload
                var progress = parseInt(data.loaded / data.total * 100, 10);

                // Update the hidden input field and trigger a change
                // so that the jQuery knob plugin knows to update the dial
                data.context.find('p').html(progress + " %" + "  - " + data.files[0].name);;

                if (progress == 100) {
                    data.context.find('p').html(data.files[0].name);
                }
            },
            done: function (e, data) {
                if (data.textStatus == "success") {
                    var tipo = formJson.tipo;
                    var _a = "<a class='arquivo' href='" + data.result + "' target='_blank'>" + data.files[0].name + "</a>";
                    _a += "<a href=\"javascript:;\" class=\"deletefile\" target=\"_blank\" data-tipo=\"" + tipo + "\" data-arquivo=\"" + data.files[0].name + "\" data-campo=\"" + nomeCampo + "\" data-id=\"" + idRegistro + "\"><i class=\"fa fa-trash-o\" aria-hidden=\"true\" title='" + _options.labelButtonExcluir + "' data-original-title='" + _options.labelButtonExcluir + "'></i></a>";

                    data.context.find('p').html(_a);
                    $("#" + IdCtrlUpload).find(".working").removeClass("working");
                    $("#" + idForm).find("#" + nomeCampo).val(data.files[0].name + "|" + $("#" + nomeCampo).val());

                    var validator = $("#" + idForm).validate();
                    validator.element("#" + nomeCampo);

                    UploadDeleteFiles(urlDelete);
                }
            },
            fail: function (e, data) {
                // Something has gone wrong!
                bootbox.alert(data.errorThrown);
            }
        });

    },

    ativaFileUpload: function () {

        //// Prevent the default action when a file is dropped on the window
        $(document).on('drop dragover', function (e) {
            e.preventDefault();
        });
        $(document).on('drop dragenter', function (e) {
            e.preventDefault();
            if (event.target.className == "drop") {
                event.target.style.background = "#dcdcdc";
            }
        });
        $(document).on('drop dragleave', function (e) {
            e.preventDefault();
            if (event.target.className == "drop") {
                event.target.style.background = "";
            }
        });

    },

};
/*
|--------------------------------------------------------------------------
| Utils
|--------------------------------------------------------------------------
*/

APP.component.Util = {

    init: function () {

    },

    setup: function () {




    },

    tratarUrl: function (url) {

        var ambiente = urlBase.substring(0, urlBase.length - 1);

        var ret = ambiente + url;
        return ret;
    },

    getUrlAmbiente: function () {

        var url = (window.location.href);
        var protocol = window.location.protocol;
        var host = window.location.host;
        var pathname = window.location.pathname;
        var newURL = protocol + "//" + host;
        return newURL;

    },

    getController: function () {

        var controller = $('meta[name=controller]').attr('content');
        return controller ? controller : false;

    },

    getPage: function () {

        var page = $('meta[name=page]').attr('content');
        return page ? page : false;

    }
};
/*
|--------------------------------------------------------------------------
| Validate Form
|--------------------------------------------------------------------------
*/

APP.component.ValidateForm = {

    init: function (_objFormValidade, _formName) {

        this.setup();
        this.validateForm(_objFormValidade, _formName);

    },

    setup: function () {

        this.cpfIsValid();
        this.cnpjIsValid();
        this.verifyTableAcaoImediata();

    },

    validateForm: function (_objFormValidade, _formName) {

        var page = APP.component.Util.getPage();

        $(_formName).validate({
            ignore: ".ignore",
            rules: _objFormValidade,
            messages: {

            },
            errorElement: "em",
            errorPlacement: function (error, element) {

                //Verifica se tem grupo de checkbox
                var hasTableCheck = $(element).closest('.form-group').find('.tabela-check').size();


                // Add the 'help-block' class to the error element
                error.addClass("help-block");
                //error.addClass( "arrow_box " );
                //console.log(error);

                // Add 'has-feedback' class to the parent div.form-group
                // in order to add icons to inputs
                element.closest(".form-group").addClass("has-feedback");
                //console.log(element);


                if (element.prop("type") === "checkbox") {
                    if (hasTableCheck != 0) {
                        element.closest(".form-group").find('.tabela-check').addClass("has-feedback");
                        error.insertAfter(element.closest('.form-group').children().last());
                    } else {
                        error.insertAfter(element.closest('.form-group').children());
                    }

                } else if (element.prop("type") === "radio") {
                    //console.log('radio');
                    error.insertAfter(element.closest('.form-group').children().last());
                } else {
                    //console.log('normal');
                    if (page == "Login" || page == "RecuperarSenha" || page == "AlterarSenhaLogin") {
                        error.insertAfter(element.closest('.form-group').children().first());
                    } else if (element.hasClass('data')) {
                        error.insertAfter(element.closest('.form-group').children().last());
                    } else {
                        error.insertAfter(element);
                    }
                }


                // Add the span element, if doesn't exists, and apply the icon classes to it.
                if (!element.next("span")[0]) {

                    if (hasTableCheck != 0) {
                        $("<span class='glyphicon glyphicon-remove form-control-feedback'></span>").insertAfter(element.closest('.tabela-check'));
                    } else {
                        $("<span class='glyphicon glyphicon-remove form-control-feedback'></span>").insertAfter(element);
                    }
                }
            },
            success: function (label, element) {
                // Add the span element, if doesn't exists, and apply the icon classes to it.
                if (!$(element).next("span")[0]) {
                    $("<span class='glyphicon glyphicon-ok form-control-feedback'></span>").insertAfter($(element));
                } else if (!$(element).next("span")[0]) {
                    $("<span class='glyphicon glyphicon-ok form-control-feedback'></span>").insertAfter($(element));
                }
            },
            highlight: function (element, errorClass, validClass) {
                $(element).closest('.form-group').addClass("has-error").removeClass("has-success");
                $(element).next("span").addClass("glyphicon-remove").removeClass("glyphicon-ok");
                //$( element ).closest(".form-group").find( "em" ).addClass( "arrow_box" );
            },
            unhighlight: function (element, errorClass, validClass) {
                $(element).closest(".form-group").addClass("has-success").removeClass("has-error");
                $(element).next("span").addClass("glyphicon-ok").removeClass("glyphicon-remove");
                //$( element ).closest(".form-group").find( "em" ).removeClass( "arrow_box" );
            }

        });

    },

    verifyGroupValidateChecked: function (_nameGroup) {

        $.validator.addMethod("groupValidateChecked ", function () {
            return ($('[name=' + _nameGroup + ']:checked').size() != 0);
        });

    },

    cpfIsValid: function () {

        $.validator.addMethod("cpf", function (value, element) {
            value = jQuery.trim(value);

            value = value.replace('.', '');
            value = value.replace('.', '');
            cpf = value.replace('-', '');
            while (cpf.length < 11) cpf = "0" + cpf;
            var expReg = /^0+$|^1+$|^2+$|^3+$|^4+$|^5+$|^6+$|^7+$|^8+$|^9+$/;
            var a = [];
            var b = new Number();
            var c = 11;
            for (i = 0; i < 11; i++) {
                a[i] = cpf.charAt(i);
                if (i < 9) b += (a[i] * --c);
            }
            if ((x = b % 11) < 2) { a[9] = 0 } else { a[9] = 11 - x }
            b = 0;
            c = 11;
            for (y = 0; y < 10; y++) b += (a[y] * c--);
            if ((x = b % 11) < 2) { a[10] = 0; } else { a[10] = 11 - x; }

            var retorno = true;
            if ((cpf.charAt(9) != a[9]) || (cpf.charAt(10) != a[10]) || cpf.match(expReg)) retorno = false;

            return this.optional(element) || retorno;

        });

    },

    cnpjIsValid: function () {

        $.validator.addMethod("cnpj", function (value, element) {
            cnpj = value.replace(/[^\d]+/g, '');
            if (cnpj == '') return false;
            if (cnpj.length != 14)
                return false;
            // Elimina CNPJs invalidos conhecidos
            if (cnpj == "00000000000000" ||
                cnpj == "11111111111111" ||
                cnpj == "22222222222222" ||
                cnpj == "33333333333333" ||
                cnpj == "44444444444444" ||
                cnpj == "55555555555555" ||
                cnpj == "66666666666666" ||
                cnpj == "77777777777777" ||
                cnpj == "88888888888888" ||
                cnpj == "99999999999999")
                return false;

            // Valida DVs
            tamanho = cnpj.length - 2;
            numeros = cnpj.substring(0, tamanho);
            digitos = cnpj.substring(tamanho);
            soma = 0;
            pos = tamanho - 7;
            for (i = tamanho; i >= 1; i--) {
                soma += numeros.charAt(tamanho - i) * pos--;
                if (pos < 2)
                    pos = 9;
            }
            resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
            if (resultado != digitos.charAt(0))
                return false;

            tamanho = tamanho + 1;
            numeros = cnpj.substring(0, tamanho);
            soma = 0;
            pos = tamanho - 7;
            for (i = tamanho; i >= 1; i--) {
                soma += numeros.charAt(tamanho - i) * pos--;
                if (pos < 2)
                    pos = 9;
            }
            resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
            if (resultado != digitos.charAt(1))
                return false;

            return true;

        });

    },


    //Nao Conformidade
    //Tabela de AÃ§Ã£o imediata

    verifyTableAcaoImediata: function () {

        $.validator.addMethod("verifyTableAcaoImediata ", function () {
            console.log('opa')
            return $('[name=formAcaoImadiataJustificativa]').val() != "" ? true : false;
        });

    },

    modelMsgErro: function () {

        //

    },

};
/*
|--------------------------------------------------------------------------
| Controlador AÃ§Ã£o Corretiva
|--------------------------------------------------------------------------
*/

APP.controller.AcaoCorretivaController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "IndexAcaoCorretiva") {
            this.indexAcaoCorretiva();
        }
        if (page == "CriarAcaoCorretiva") {
            this.acoesAcaoCorretiva();
        }

    },

    setup: function () {
        //Index Acao Corretiva
        this.buttonDelAcaoCorretiva = $(".del-acao-corretiva");

        //Criar Acao Corretiva
        this.buttonSalvar = $(".btn-salvar");

        //Editar Acao Corretiva
        this.buttonAddAcaoImediata = $('.add-acao-imediata');

        this.buttonDestravar = $(".btn-destravar");

    },

    //Models
    models: {
        AnexoModel: APP.model.Anexo,
    },

    //Index Acao Corretiva
    indexAcaoCorretiva: function () {

        APP.component.DataTable.setDataTableParam('#tb-index-acao-corretiva', 0, "desc", "Tags");
        this.delAcaoCorretiva();

    },

    delAcaoCorretiva: function () {
        this.buttonDelAcaoCorretiva.on('click', function () {

            var msgIconeDeleteAC = $('[name=msgIconeDeleteAC]').val();

            bootbox.confirm(msgIconeDeleteAC, function (result) {
                if (result == true) {
                    APP.controller.AcaoCorretivaController.setDelAcaoCorretiva();
                }
            });

        });

    },

    setDelAcaoCorretiva: function () {

        var idAcaoCorretiva = $('.del-acao-corretiva').data("id-acao-corretiva");
        var data = {
            "idAcaoCorretiva": idAcaoCorretiva,
            "__RequestVerificationToken": $("[name=__RequestVerificationToken]").val()
        };

        var erro = "";

        $.ajax({
            type: "POST",
            dataType: 'json',
            data: data,
            url: "/AcaoCorretiva/RemoverComAcaoConformidade",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {

                if (result.StatusCode == 200) {
                    window.location.href = "/AcaoCorretiva/Index";
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    //Acoes Nao Conformidade
    acoesAcaoCorretiva: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        APP.component.FileUpload.init();
        APP.component.Mascaras.init();
        this.setAndHide();
        this.setValidateForms();

        this.sendFormCriarNaoConformidade();


        this.setDestravarCamposAcaoCorretiva();

        if (habilitaLoad == 'sim') {

            this.HabilitaCamposAcaoCorretiva(perfil);
        }

    },

    setAndHide: function () {

        //Verifica Status Etapa
        var statusEtapa = parseInt($('[name=StatusEtapa]').val());
        switch (statusEtapa) {

            case 1:
                this.setShowAndHideStatusEtapa1();
                this.formAcaoImediata();
                break;
            case 2:
                this.setShowAndHideStatusEtapa2();
                this.formAcaoImediata();
                break;
            case 3:
                this.setShowAndHideStatusEtapa3();
                this.formAcaoImediata();
                break;
            case 4:
                this.setShowAndHideStatusEtapa4();
                break;
        }

    },

    setValidateForms: function () {

        var ObjFormCriarNaoConformidadeValidate = APP.controller.AcaoCorretivaController.getObjObjFormCriarNaoConformidadeValidate();
        APP.component.ValidateForm.init(ObjFormCriarNaoConformidadeValidate, '#form-criar-naoconformidade');
        APP.component.ValidateForm.init(ObjFormCriarNaoConformidadeValidate, '#form-acaoimediata');

    },

    //Interacao de Tela - StatusEtapa 1
    setShowAndHideStatusEtapa1: function () {

        this.setDisabledStatusEtapa1(true);
        this.setHideStatusEtapa1();

    },

    setDisabledStatusEtapa1: function (_disabled) {
        //Formulario Nao Conformidade
        $('[name=formCriarNaoConformidadeDsRegistro]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDsJustificativa]').prop('disabled', _disabled);
        
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDtEmissao]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeProcesso]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEmissor]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeResponsavel]').prop('disabled', _disabled);

    },

    setHideStatusEtapa1: function () {

        //Formulario Acao Imediata
        $('[name=formAcaoImadiataFoiEficaz]').closest('[class^=col]').hide();
        APP.controller.AcaoCorretivaController.checkSizeTableAcaoImediata();
        APP.controller.AcaoCorretivaController.setHideRowAcaoImediata();

    },

    setHideRowAcaoImediata: function () {

        $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').closest('div').hide();
        $('[name=formAcaoImadiataTbEvidencia]').closest('div').hide();

    },

    checkSizeTableAcaoImediata: function () {

        var sizeTable = $('#tb-acao-imediata tbody tr').size();

        if (sizeTable > 0) {
            $('[name=formAcaoImadiataResponsavelReverificacao]').closest('[class^=col]').show();
        } else {
            $('[name=formAcaoImadiataResponsavelReverificacao]').closest('[class^=col]').hide();
        }

    },

    //Interacao de Tela - StatusEtapa 2
    setShowAndHideStatusEtapa2: function () {

        this.setHideStatusEtapa2();
        this.setDisabledStatusEtapa2(true);
        this.setShowInputsEtapa2();

    },

    setHideStatusEtapa2: function () {

        //Botoes Acoes
        $('#tb-acao-imediata tbody tr').each(function () {
            $(this).find('td').last().hide();
        });
        $('[name=formAcaoImadiataFoiEficaz]').closest('[class^=col]').hide();
        $('.add-acao-imediata').hide();

    },

    setDisabledStatusEtapa2: function (_disabled) {

        //Formulario Nao Conformidade
        $('[name=formCriarNaoConformidadeDsRegistro]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDsJustificativa]').prop('disabled', _disabled);
        
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDtEmissao]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeProcesso]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEmissor]').prop('disabled', _disabled);
        $('#add-tipo-nao-conformidade').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeResponsavel]').prop('disabled', _disabled);

        //Formulario Acao Imediata
        $('[name=formAcaoImadiataDtDescricaoAcao]').prop('disabled', _disabled);
        //Table Acao Imediata
        $('[name=formAcaoImadiataTbDescricao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtPrazoImplementacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbResponsavelImplementar]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').prop('disabled', _disabled);
        $('.upload-arq form-control').prop('disabled', _disabled);
        //Upload Changes
        $('[class^=btn-upload-form-acaoimediata-tb-evidencia]').closest('div').css('background-color', '#eee');
        $('[name=formAcaoImadiataTbEvidencia]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelReverificacao]').prop('disabled', _disabled);

    },


    setShowInputsEtapa2: function () {

        var idUsuarioLogado = $('[name=UsuarioLogado]').val();
        var idPerfil = $('[name=IdPerfil]').val();
        $('#tb-acao-imediata tbody tr').each(function () {
            var idResponsavelImplementar = $(this).find('[name=formAcaoImadiataTbResponsavelImplementar]').val();
            if ((idResponsavelImplementar == idUsuarioLogado) || idPerfil != 4) {
                $(this).find('[name=formAcaoImadiataTbDtEfetivaImplementacao]').prop('disabled', false);
                $(this).find('[name=formAcaoImadiataTbEvidencia]').prop('disabled', false);
                $(this).find('[class^=btn-upload-form-acaoimediata-tb-evidencia]').closest('div').css('background-color', '#fff');
            }
        });

    },

    //Interacao de Tela - StatusEtapa 3
    setShowAndHideStatusEtapa3: function () {

        this.setHideStatusEtapa3();
        this.setDisabledStatusEtapa3(true);
        this.setShowInputsEtapa3();
        this.setCheckAcaoImediataOk();
        this.setCheckAcaoImediataNotOk();
        this.setBackChecksOnPage();

    },

    setHideStatusEtapa3: function () {

        //Botoes Acoes
        $('#tb-acao-imediata tbody tr').each(function () {
            $(this).find('td').last().hide();
        });
        $('[name=formAcaoImadiataFoiEficaz]').closest('[class^=col]').hide();
        $('.add-acao-imediata').hide();

    },

    setDisabledStatusEtapa3: function (_disabled) {

        //Formulario Nao Conformidade
        $('[name=formCriarNaoConformidadeDsRegistro]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDsJustificativa]').prop('disabled', _disabled);
        
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDtEmissao]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeProcesso]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEmissor]').prop('disabled', _disabled);
        $('#add-tipo-nao-conformidade').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeResponsavel]').prop('disabled', _disabled);

        //Formulario Acao Imediata
        $('[name=formAcaoImadiataDtDescricaoAcao]').prop('disabled', _disabled);
        //Table Acao Imediata
        $('[name=formAcaoImadiataTbDescricao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtPrazoImplementacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbResponsavelImplementar]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').prop('disabled', _disabled);
        $('.upload-arq form-control').prop('disabled', _disabled);
        //Upload Changes
        $('[name^=formCriarNaoConformidadeEvidencia]').closest('div').css('background-color', '#eee');
        $('[name=formAcaoImadiataTbEvidencia]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelReverificacao]').prop('disabled', _disabled);

    },

    setShowInputsEtapa3: function () {

        var idUsuarioLogado = $('[name=UsuarioLogado]').val();
        var idPerfil = $('[name=IdPerfil]').val();

        var idResponsavelReverificacao = $('[name=formAcaoImadiataResponsavelReverificacao]').val();
        if ((idResponsavelReverificacao == idUsuarioLogado) || idPerfil != 4) {
            $('#tb-acao-imediata tbody tr').each(function () {
                $(this).find('td').last().show();
                $(this).find('.btn-delete-acao-imediata').hide();
            });

            $('[name=formAcaoImadiataFoiEficaz]').closest('[class^=col]').show();

        }

    },

    setCheckAcaoImediataOk: function () {

        $('.btn-confirm-acao-imediata').on('click', function () {
            $(this).closest('td').find('.btn-confirm-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-denied-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-ok-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('[name=formAcaoImadiataTbAprovado]').val(true);
            APP.controller.AcaoCorretivaController.getChecksAcaoImediata();
        });

    },

    setCheckAcaoImediataNotOk: function () {

        $('.btn-denied-acao-imediata').on('click', function () {
            $(this).closest('td').find('.btn-confirm-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-denied-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-notok-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('[name=formAcaoImadiataTbAprovado]').val(false);
            APP.controller.AcaoCorretivaController.getChecksAcaoImediata();
        });

    },

    getChecksAcaoImediata: function () {
        var checkSize = 0;
        var checkAcaoImediata = $('#tb-acao-imediata tbody tr').find('[name=formAcaoImadiataTbAprovado]');
        for (i = 0; i < checkAcaoImediata.size(); i++) {
            var valueAprovador = $(checkAcaoImediata[i]).val();
            if (valueAprovador == "true") {
                checkSize++;
            }
        }
        if (checkSize == checkAcaoImediata.size()) {
            $('[name=formAcaoImadiataFoiEficaz').filter('[value=true]').prop('checked', true);
        } else {
            $('[name=formAcaoImadiataFoiEficaz').filter('[value=false]').prop('checked', true);
        }

    },

    setBackChecksOnPage: function () {
        $('.fa-check-circle, .fa-times-circle').unbind('click');
        $('.fa-check-circle, .fa-times-circle').on('click', function () {
            $(this).closest('td').find('.btn-ok-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-notok-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-confirm-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('.btn-denied-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('[name=formAcaoImadiataTbAprovado]').val('');
            APP.controller.AcaoCorretivaController.getChecksAcaoImediata();

        });
    },

    //Interacao de Tela - StatusEtapa 4
    setShowAndHideStatusEtapa4: function () {

        this.setHideStatusEtapa4();
        this.setTriggerRadioButtonsEtapa4('change');
        this.setDisabledStatusEtapa4(true);
        this.setShowInputsEtapa4();

    },

    setHideStatusEtapa4: function () {

        //Botoes Acoes
        $('#tb-acao-imediata tbody tr').each(function () {
            $(this).find('.btn-delete-acao-imediata').hide();
            $(this).find('.btn-confirm-acao-imediata').hide();
            $(this).find('.btn-denied-acao-imediata').hide();
        });
        $('.add-acao-imediata').hide();

    },

    setTriggerRadioButtonsEtapa4: function (_change) {

        $('[name=formAcaoImadiataEProcedente]').trigger(_change);
        $('[name=formAcaoImadiataECorrecao]').trigger(_change);
        $('[name=formAcaoImadiataNecessitaAC]').trigger(_change);

    },

    setDisabledStatusEtapa4: function (_disabled) {

        //Formulario Nao Conformidade
        $('[name=formCriarNaoConformidadeDsRegistro]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDsJustificativa]').prop('disabled', _disabled);
        
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDtEmissao]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeProcesso]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEmissor]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEAuditoria]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTipo]').prop('disabled', _disabled);
        $('#add-tipo-nao-conformidade').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeResponsavel]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTags]').prop('disabled', _disabled);

        //Formulario Acao Imediata
        $('[name=formAcaoImadiataEProcedente]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataDtDescricaoAcao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataJustificativa]').prop('disabled', _disabled);
        //Table Acao Imediata
        $('[name=formAcaoImadiataTbDescricao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtPrazoImplementacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbResponsavelImplementar]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').prop('disabled', _disabled);
        $('.upload-arq form-control').prop('disabled', _disabled);
        //Upload Changes
        $('[name^=formCriarNaoConformidadeEvidencia]').closest('div').css('background-color', '#eee');
        $('[name=formAcaoImadiataTbEvidencia]').prop('disabled', _disabled);
        $('.btn-delete-acao-imediata').prop('disabled', _disabled);
        $('.btn-confirm-acao-imediata').prop('disabled', _disabled);
        $('.btn-denied-acao-imediata').prop('disabled', _disabled);
        $('.btn-ok-acao-imediata').prop('disabled', _disabled);
        $('.btn-notok-acao-imediata').prop('disabled', _disabled);
        $('[name=formAcaoImadiataECorrecao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataNecessitaAC]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelReverificacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataFoiEficaz]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelTratativa]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataAnaliseCausa]').prop('disabled', _disabled);

    },

    setShowInputsEtapa4: function () {


        $('#tb-acao-imediata tbody tr').each(function () {
            var aprovado = $(this).find('[name=formAcaoImadiataTbAprovado]');
            if (aprovado == "true") {
                $(this).find('.btn-ok-acao-imediata').show();
            } else {
                $(this).find('.btn-notok-acao-imediata').show();
            }

        });

    },

    //Auxiliares
    getFoiEficaz: function () {

        var FoiEficaz = APP.component.Radio.init('formAcaoImadiataFoiEficaz');
        return FoiEficaz;

    },

    getObjObjFormCriarNaoConformidadeValidate: function () {

        var acoesNaoConformidadeoFormCriarNaoConformidadeObj = {

            //Form Acao Imediata
            // formAcaoImadiataEProcedente: {'required': true},
            // formAcaoImadiataDtDescricaoAcao: {'required': true},
            // formAcaoImadiataJustificativa: {'required': true},
            // //formAcaoImadiataTbDescricao: {'required': true},
            // //formAcaoImadiataTbDtPrazoImplementacao: {'required': true},
            // //formAcaoImadiataTbResponsavelImplementar: {'required': true},
            // //formAcaoImadiataTbDtEfetivaImplementacao: {'required': true},
            // //formAcaoImadiataTbEvidencia: {'required': true},
            // formAcaoImadiataECorrecao: {'required': true},
            // formAcaoImadiataNecessitaAC: {'required': true},
            // formAcaoImadiataResponsavelReverificacao: {'required': true},
            // formAcaoImadiataFoiEficaz: {'required': true},
            // formAcaoImadiataResponsavelTratativa: {'required': true},
            // //formAcaoImadiataNumeroAC: {'required': true},
            // formAcaoImadiataAnaliseCausa: {'required': true},
        };

        return acoesNaoConformidadeoFormCriarNaoConformidadeObj;

    },
    //OLd
    //getObjFormCriarNaoConformidade: function (_fluxo) {

    //    var acoesNaoConformidadeFormCriarNaoConformidadeObj = {};

    //    switch (_fluxo) {
    //        case "fluxo-02":
    //            //Obj enviado no fluxo 02 de edicao
    //            acoesNaoConformidadeFormCriarNaoConformidadeObj = {
    //                StatusEtapa: 2,
    //                IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
    //                DtDescricaoAcao: $('[name=formAcaoImadiataDtDescricaoAcao]').val(),
    //                DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
    //                AcoesImediatas: APP.controller.AcaoCorretivaController.getObjFormAcaoImediata(),
    //                IdProcesso: $('[name=formCriarNaoConformidadeProcesso]').val(),
    //                ECorrecao: APP.component.Radio.init('formAcaoImadiataECorrecao'),
    //                NecessitaAcaoCorretiva: APP.component.Radio.init('formAcaoImadiataNecessitaAC'),
    //                IdResponsavelReverificador: $('[name=formAcaoImadiataResponsavelReverificacao]').val(),
    //                IdResponsavelPorIniciarTratativaAcaoCorretiva: $('[name=formAcaoImadiataResponsavelTratativa]').val(),
    //                IdResponsavelImplementar: $('[name=formCriarNaoConformidadeResponsavel]').val(),
    //                DescricaoAnaliseCausa: $('[name=formAcaoImadiataAnaliseCausa]').val(),
    //                IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel]').val(),
    //                DtPrazoImplementacao: $('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
    //            };

    //            break;
    //        case "fluxo-03":
    //            //Obj enviado no fluxo 03 de edicao
    //            acoesNaoConformidadeFormCriarNaoConformidadeObj = {
    //                StatusEtapa: 2,
    //                IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
    //                AcoesImediatas: APP.controller.AcaoCorretivaController.getObjFormAcaoImediata(),
    //            };
    //            break;
    //        case "fluxo-04":
    //            //Obj enviado no fluxo 04 de edicao
    //            acoesNaoConformidadeFormCriarNaoConformidadeObj = {
    //                StatusEtapa: $('[name=StatusEtapa]').val(),
    //                IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
    //                AcoesImediatas: APP.controller.AcaoCorretivaController.getObjFormAcaoImediata(),
    //                FlEficaz: APP.controller.AcaoCorretivaController.getFoiEficaz(),
    //            };
    //        case "fluxo-05":
    //            //Obj enviado no fluxo 04 de edicao
    //            acoesNaoConformidadeFormCriarNaoConformidadeObj = {
    //                StatusEtapa: $('[name=StatusEtapa]').val(),
    //                IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
    //                AcoesImediatas: APP.controller.AcaoCorretivaController.getObjFormAcaoImediata(),
    //                FlEficaz: APP.controller.AcaoCorretivaController.getFoiEficaz(),
    //            };
    //            break;
    //    }

    //    return acoesNaoConformidadeFormCriarNaoConformidadeObj;

    //},


    getObjFormCriarNaoConformidade: function (_fluxo) {

        var acoesNaoConformidadeFormCriarNaoConformidadeObj = {};

        switch (_fluxo) {
                case "fluxo-02":
                //Obj enviado no fluxo 02 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: 2,
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    DtDescricaoAcao: $('[name=formAcaoImadiataDtDescricaoAcao]').val(),
                    AcoesImediatas: APP.controller.GestaoDeRiscoController.getObjFormAcaoImediata(),
                    ECorrecao: APP.component.Radio.init('formAcaoImadiataECorrecao'),
                    NecessitaAcaoCorretiva: APP.component.Radio.init('formAcaoImadiataNecessitaAC'),
                    IdResponsavelPorIniciarTratativaAcaoCorretiva: $('[name=formAcaoImadiataResponsavelTratativa]').val(),
                    DescricaoAnaliseCausa: $('[name=formAcaoImadiataAnaliseCausa]').val(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    DtEmissao: $('[name=formCriarNaoConformidadeDtEmissao]').val(),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    CriticidadeGestaoDeRisco: $('[name=formCriarNaoConformidadeCriticidade] :selected').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdResponsavelReverificador: $('[name=formAcaoImadiataResponsavelReverificacao]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    DtPrazoImplementacao: $('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    DsAcao: $('[name=formAcaoImadiataTbDescricao]').val(),
                    EProcedente: $('[name=formAcaoImadiataEProcedente]:checked').val(),
                    ArquivosDeEvidenciaAux: APP.controller.GestaoDeRiscoController.getAnexosEvidencias(),
                    Causa: $('[name=formCausa]').val(),
                };

                break;
            case "fluxo-03":
                //Obj enviado no fluxo 03 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: 2,
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    AcoesImediatas: APP.controller.GestaoDeRiscoController.getObjFormAcaoImediata(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    DtEmissao: $('[name=formCriarNaoConformidadeDtEmissao]').val(),
                    NecessitaAcaoCorretiva: APP.component.Radio.init('formAcaoImadiataNecessitaAC'),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    CriticidadeGestaoDeRisco: $('[name=formCriarNaoConformidadeCriticidade] :selected').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdResponsavelReverificador: $('[name=formAcaoImadiataResponsavelReverificacao]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    DtPrazoImplementacao: $('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    DsAcao: $('[name=formAcaoImadiataTbDescricao]').val(),
                    EProcedente: $('[name=formAcaoImadiataEProcedente]:checked').val(),
                    ArquivosDeEvidenciaAux: APP.controller.GestaoDeRiscoController.getAnexosEvidencias(),
                    Causa: $('[name=formCausa]').val(),
                };
                break;
            case "fluxo-04":
                //Obj enviado no fluxo 04 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: $('[name=StatusEtapa]').val(),
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    AcoesImediatas: APP.controller.GestaoDeRiscoController.getObjFormAcaoImediata(),
                    FlEficaz: APP.controller.GestaoDeRiscoController.getFoiEficaz(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    DtEmissao: $('[name=formCriarNaoConformidadeDtEmissao]').val(),
                    NecessitaAcaoCorretiva: APP.component.Radio.init('formAcaoImadiataNecessitaAC'),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    CriticidadeGestaoDeRisco: $('[name=formCriarNaoConformidadeCriticidade] :selected').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdResponsavelReverificador: $('[name=formAcaoImadiataResponsavelReverificacao]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    DtPrazoImplementacao: $('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    DsAcao: $('[name=formAcaoImadiataTbDescricao]').val(),
                    EProcedente: $('[name=formAcaoImadiataEProcedente]:checked').val(),
                    ArquivosDeEvidenciaAux: APP.controller.GestaoDeRiscoController.getAnexosEvidencias(),
                    Causa: $('[name=formCausa]').val(),
                };
                break;
            case "fluxo-05":
                //Obj enviado no fluxo 04 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: $('[name=StatusEtapa]').val(),
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    AcoesImediatas: APP.controller.GestaoDeRiscoController.getObjFormAcaoImediata(),
                    FlEficaz: APP.controller.GestaoDeRiscoController.getFoiEficaz(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    DtEmissao: $('[name=formCriarNaoConformidadeDtEmissao]').val(),
                    NecessitaAcaoCorretiva: APP.component.Radio.init('formAcaoImadiataNecessitaAC'),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    CriticidadeGestaoDeRisco: $('[name=formCriarNaoConformidadeCriticidade] :selected').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdResponsavelReverificador: $('[name=formAcaoImadiataResponsavelReverificacao]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    DtPrazoImplementacao: $('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    DsAcao: $('[name=formAcaoImadiataTbDescricao]').val(),
                    EProcedente: $('[name=formAcaoImadiataEProcedente]:checked').val(),
                    ArquivosDeEvidenciaAux: APP.controller.GestaoDeRiscoController.getAnexosEvidencias(),
                    Causa: $('[name=formCausa]').val(),
                };
                break;
        }

        return acoesNaoConformidadeFormCriarNaoConformidadeObj;

    },


    //Formulario Acao Imediata
    formAcaoImediata: function () {

        this.setAndHideAcaoImediata();
        this.getformCriarNaoConformidadeDtDescricaoAcao();
        this.setAcaoImediata();
        this.delAcaoImediata();
        this.getResponsavelReverificarAcaoImediata();

    },

    setAndHideAcaoImediata: function () {

        //

    },

    getformCriarNaoConformidadeDtDescricaoAcao: function () {

        $('[name=formAcaoImadiataDtDescricaoAcao]').val(APP.component.Datatoday.init());

    },

    setAcaoImediata: function () {

        this.buttonAddAcaoImediata.unbind('click');
        this.buttonAddAcaoImediata.bind('click', function () {

            var TraducaoDropNameSelect = 'Selecione';
            var index = $('#tb-acao-imediata tbody tr').size();

            var html = '';
            html += '<tr role="row" class="odd">';
            html += '<td>';
            html += '<textarea type="text" id="form-acaoimediata-tb-descricao' + _options.NumeroAcaoImediataGrid + '" name="formAcaoImadiataTbDescricao" class="form-control" ';
            html += 'placeholder="Descrição" ';
            html += 'data-msg-required="" ';
            html += 'value=""';
            html += 'rows="3"></textarea>';
            html += '<input type="hidden" name="formAcaoImadiataTbIdAcaoImediata" class="form-control input-data" value="0"/>';
            html += '<input type="hidden" name="formAcaoImadiataTbEstado" value="4"/>';
            html += '</td>';
            html += '<td>';
            html += '<div class="input-group">';
            html += '<input type="text" name="formAcaoImadiataTbDtPrazoImplementacao" id="form-acaoimediata-tb-dt-prazo-implementacao' + _options.NumeroAcaoImediataGrid + '" class="form-control data datepicker largura-calendario " ';
            html += 'data-msg-required="" ';
            html += 'value="" />';
            html += '<span class="input-group-addon">';
            html += '<i class="fa fa-calendar" onclick="AbreCalendario(this)"  aria-hidden="true"></i>';
            html += '</span>';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<select id="form-acaoimediata-tb-responsavel-implementar" name="formAcaoImadiataTbResponsavelImplementar" class="form-control" ';
            html += 'data-msg-required="">';
            html += '<option value="">' + TraducaoDropNameSelect + '</option>';
            html += '</select>';
            html += '</td>';
            html += '<td>';
            html += '<div class="input-group">';
            html += '<input type="text" name="formAcaoImadiataTbDtEfetivaImplementacao" id="form-acaoimediata-tb-dt-efetiva-implementacao' + _options.NumeroAcaoImediataGrid + '" class="form-control data datepicker" ';
            html += 'data-msg-required="" ';
            html += 'value="" />';
            html += '<span class="input-group-addon">';
            html += '<i class="fa fa-calendar" aria-hidden="true"></i>';
            html += '</span>';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<div class="upload-arq form-control">';
            html += '<a class="btn-upload-form-acaoimediata-tb-evidencia-' + index + '">';
            html += '<i class="fa fa-paperclip fa-1x" aria-hidden="true"></i><br>Anexar';
            html += '</a>';
            html += '<input type="file" name="formAcaoImadiataTbEvidencia" id="form-acaoimediata-tb-evidencia-' + index + '" class="" data-msg-required="" data-b64="">';
            html += '</div>';
            html += '<ul></ul>';
            html += '</td>';
            html += '<td>';
            html += '<a href="#" class="btn-delete-acao-imediata icon-cliente trash-color">';
            html += '<i class="fa fa-trash" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</a>';
            html += '</td>';
            html += '</tr>';

            $('#tb-acao-imediata tbody').append(html);
            $('.add-acao-imediata').removeClass('show').addClass('hide');
            APP.controller.GestaoDeRiscoController.bind();

            _options.NumeroAcaoImediataGrid++;

        });

    },
    delAcaoImediata: function () {

        $('.btn-delete-acao-imediata').unbind('click');
        $('.btn-delete-acao-imediata').on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });

    },

    getResponsavelImplementarAcaoImediata: function () {
        var idSite = $('#nao-conformidade-site').val();
        var idFuncao = 23; // Funcionalidade(Implementar aÃ§Ã£o) que permite usuario Implementar aÃ§Ã£o NC
        var idProcesso = $('[name=IdProcesso]').val();
        $.ajax({
            type: "GET",
            dataType: 'json',
            url: '/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso=' + idProcesso +'&idSite=' + idSite + '&idFuncao=' + idFuncao +'',
            beforeSend: function () {
                $('.add-acao-imediata').removeClass('show').addClass('hide');
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    APP.component.SelectListCompare.selectList(result.Lista, $('#tb-acao-imediata tbody tr:last-child [name="formAcaoImadiataTbResponsavelImplementar"] option'), $('#tb-acao-imediata tbody tr:last-child [name="formAcaoImadiataTbResponsavelImplementar"]'), 'IdUsuario', 'NmCompleto');
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {
                $('.add-acao-imediata').removeClass('hide').addClass('show');
            }
        });

    },

    getResponsavelReverificarAcaoImediata: function () {
        var idSite = $('#nao-conformidade-site').val();
        var idProcesso = $('[name=IdProcesso]').val();
        var idFuncao = 24; // Funcionalidade(ReverificaÃ§Ã£o) que permite usuario Reverifique NC
        $.get('/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso=' + idProcesso + '&idSite=' + idSite + '&idFuncao=' + idFuncao +'', function (result) {
            if (result.StatusCode == 200) {

                $(result.Lista).each(function (key, value) {
                    var $option = $('<option>');
                    $('[name=formAcaoImadiataResponsavelReverificacao]').append(
                        $option.val(value.IdUsuario).text(value.NmCompleto)
                    );
                });
            }
        });

    },

    bind: function () {

        APP.component.Datapicker.init();
        APP.controller.AcaoCorretivaController.setup();
        APP.controller.AcaoCorretivaController.setAcaoImediata();
        APP.controller.AcaoCorretivaController.getResponsavelImplementarAcaoImediata();
        APP.component.FileUpload.init();
        APP.controller.AcaoCorretivaController.delAcaoImediata();
        APP.controller.AcaoCorretivaController.setHideStatusEtapa1();

    },

    getObjObjFormAcaoImediataValidate: function () {

        var acoesNaoConformidadeoFormAcaoImediataObj = {

            formCriarNaoConformidadeTags: 'required',
        };

        return acoesNaoConformidadeoFormAcaoImediataObj;

    },

    getObjFormAcaoImediata: function () {

        var idUsuarioLogado = $('[name=UsuarioLogado]').val();
        var statusEtapa = parseInt($('[name=StatusEtapa]').val());

        var getObjFormAcaoImediataArray = [];
        var acoesNaoConformidadeFormAcaoImediataObj = {};

        var anexoEvidenciaModel = APP.controller.AcaoCorretivaController.models.AnexoModel;

        $('#tb-acao-imediata tbody tr').each(function (index, tr) {
            if (statusEtapa == 2) {
                acoesNaoConformidadeFormAcaoImediataObj = {
                    Descricao: $(tr).find('[name=formAcaoImadiataTbDescricao]').val(),
                    DtPrazoImplementacao: $(tr).find('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    IdResponsavelImplementar: $(tr).find('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $(tr).find('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    ArquivoEvidenciaAux: anexoEvidenciaModel.constructor(
                        $(tr).find('[name^=formCriarNaoConformidadeEvidencia]').closest('td').find('[name^=formCriarNaoConformidadeEvidenciaIdAnexo]').val(),
                        $(tr).find('[name^=formCriarNaoConformidadeEvidencia]').closest('td').find('i').text(),
                        $(tr).find('[id^=form-acaoimediata-tb-evidencia-]').data('b64')
                    ),
                    Estado: $(tr).find('[name=formAcaoImadiataTbEstado]').val() != 0 ? 16 : 0,
                    IdAcaoImediata: $(tr).find('[name=formAcaoImadiataTbIdAcaoImediata]').val(),
                };
            } else if (statusEtapa == 3) {
                acoesNaoConformidadeFormAcaoImediataObj = {
                    Aprovado: $(tr).find('[name=formAcaoImadiataTbAprovado]').val(),
                    IdAcaoImediata: $(tr).find('[name=formAcaoImadiataTbIdAcaoImediata]').val(),
                    Estado: $(tr).find('[name=formAcaoImadiataTbEstado]').val() != 0 ? 16 : 0,
                };
            } else {
                acoesNaoConformidadeFormAcaoImediataObj = {
                    Descricao: $(tr).find('[name=formAcaoImadiataTbDescricao]').val(),
                    DtPrazoImplementacao: $(tr).find('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    IdResponsavelImplementar: $(tr).find('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $(tr).find('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    Estado: $(tr).find('[name=formAcaoImadiataTbEstado]').val(),
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    ArquivoEvidenciaAux: anexoEvidenciaModel.constructor(
                        $(tr).find('[name^=formCriarNaoConformidadeEvidencia]').closest('td').find('[name^=formCriarNaoConformidadeEvidenciaIdAnexo]').val(),
                        $(tr).find('[name^=formCriarNaoConformidadeEvidencia]').closest('td').find('i').text(),
                        $(tr).find('[id^=form-acaoimediata-tb-evidencia-]').data('b64')
                    ),                    
                    IdAcaoImediata: $(tr).find('[name=formAcaoImadiataTbIdAcaoImediata]').val(),
                };
            }

            getObjFormAcaoImediataArray.push(acoesNaoConformidadeFormAcaoImediataObj);
        });

        return getObjFormAcaoImediataArray;

    },

    //Todos
    sendFormCriarNaoConformidade: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            //var validate = APP.controller.AcaoCorretivaController.validateForms();
            var validate = true

            //validate = true;
            if (validate == true) {

                var statusEtapa = parseInt($('[name=StatusEtapa]').val());
                var IdRegistroConformidade = $('[name=IdRegistroConformidade]').val();
                var eProcedente = $('[name=formAcaoImadiataEProcedente]:checked').val();

                var naoConformidade = {};

                var fluxos = {
                    //Status 1 - AÃ§Ã£o Corretiva
                    _002: ['fluxo-02'],
                    //Status 2 - ImplementaÃ§Ã£o
                    _003: ['fluxo-03'],
                    //Status 3 - ReverificaÃ§Ã£o
                    _004: ['fluxo-04'],
                    //Status 4 - Salvar
                    _005: ['fluxo-05']
                };

                switch (statusEtapa) {
                    case 1:
                        naoConformidade = APP.controller.AcaoCorretivaController.getCriarNaoConformidadeObj("fluxo-02");
                        APP.controller.AcaoCorretivaController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-02");
                        break;
                    case 2:
                        naoConformidade = APP.controller.AcaoCorretivaController.getCriarNaoConformidadeObj("fluxo-03");
                        APP.controller.AcaoCorretivaController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-03");

                        break;
                    case 3:
                        naoConformidade = APP.controller.AcaoCorretivaController.getCriarNaoConformidadeObj("fluxo-04");
                        APP.controller.AcaoCorretivaController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-04");
                        break;
                    case 4:
                        naoConformidade = APP.controller.AcaoCorretivaController.getCriarNaoConformidadeObj("fluxo-05");
                        APP.controller.AcaoCorretivaController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-05");
                        break;
                }
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    getCriarNaoConformidadeObj: function (_fluxo) {

        var naoConformidadeObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                switch (form) {
                    case "naoconformidade":
                        naoConformidadeObj = APP.controller.AcaoCorretivaController.getObjFormCriarNaoConformidade(_fluxo);
                        break;
                    //case "acaoimediata":
                    //acaoimediataObj = APP.controller.AcaoCorretivaController.getObjFormAcaoImediata();
                    //break;
                }
            }

        });

        return naoConformidadeObj;

    },

    saveFormCriarNaoConformidade: function (naoConformidadeObj, _fluxo) {
        var url = "";

        switch (_fluxo) {
            case "fluxo-02":
                url = "/AcaoCorretiva/SalvarSegundaEtapa";
                break;
            case "fluxo-03":
                url = "/AcaoCorretiva/SalvarSegundaEtapa";
                break;
            case "fluxo-04":
                url = "/AcaoCorretiva/SalvarSegundaEtapa";
                break;
        }

        $.ajax({
            type: "POST",
            data: naoConformidadeObj,
            dataType: 'json',
            url: url,
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/AcaoCorretiva/Index";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },


    HabilitaCamposAcaoCorretiva: function (perfil) {
        if (perfil == '4') {

            $('#main').find('input, textarea, button, select').removeAttr('disabled');
            $("#form-criar-nao-conformidade-nm-registro").attr("disabled", true);
            $("#form-criar-nao-conformidade-processo").attr("disabled", true);
            $("#form-criar-nao-conformidade-emissor").attr("disabled", true);
            $('.br-widget').removeClass('barRating-disabled');

        }
        else {
            $('#main').find('input, textarea, button, select').removeAttr('disabled');
            $("#form-criar-nao-conformidade-nm-registro").attr("disabled", true);
            $("#form-criar-nao-conformidade-dt-emissao").attr("disabled", true);
            $('.br-widget').removeClass('barRating-disabled');
        }
    },


    DestravaDocumento: function () {

        var idAcaoCorretiva = $("input[name='IdRegistroConformidade']").val();  
        var data = { "idAcaoCorretiva": idAcaoCorretiva };

        $.ajax({
            type: "POST",
            dataType: 'json',
            data: data,
            url: "/AcaoCorretiva/DestravarDocumento",
            success: function (result) {
                //alert('foi');
                //if (result.StatusCode == 200) {
                //    window.location.reload([true]);
                //} else if (result.StatusCode == 505) {
                //    erro = APP.component.ResultErros.init(result.Erro);
                //    bootbox.alert(erro);
                //} else if (result.StatusCode == 500) {
                //    erro = APP.component.ResultErros.init(result.Erro);
                //    bootbox.alert(erro);
                //}

            },
            error: function (result) {
                //erro = APP.component.ResultErros.init(result.Erro);
                //bootbox.alert(erro);
            },
            //complete: function (result) {
            //    APP.component.Loading.hideLoading();
        });
    },


    setDestravarCamposAcaoCorretiva: function () {

        this.buttonDestravar.on('click', function () {


            if (perfil == '4') {
                $('#main').find('input, textarea, button, select').removeAttr('disabled');
                $("#form-criar-nao-conformidade-nm-registro").attr("disabled", true);
                $("#form-criar-nao-conformidade-processo").attr("disabled", true);
                $("#form-criar-nao-conformidade-emissor").attr("disabled", true);
                $('.br-widget').removeClass('barRating-disabled');


            }
            else {
                $('#main').find('input, textarea, button, select').removeAttr('disabled');
                $("#form-criar-nao-conformidade-nm-registro").attr("disabled", true);
                $("#form-criar-nao-conformidade-dt-emissao").attr("disabled", true); 
                $('.br-widget').removeClass('barRating-disabled');
            }


            var idAcaoCorretiva = $('[name=IdRegistroConformidade]').val();  // $('#form-criar-nao-conformidade-nm-registro').val();
            var data = { "idAcaoCorretiva": idAcaoCorretiva };

            $.ajax({
                type: "POST",
                dataType: 'json',
                data: data,
                url: "/AcaoCorretiva/DestravarDocumento",
                success: function (result) {
                    //alert('foi');
                    //if (result.StatusCode == 200) {
                    //    window.location.reload([true]);
                    //} else if (result.StatusCode == 505) {
                    //    erro = APP.component.ResultErros.init(result.Erro);
                    //    bootbox.alert(erro);
                    //} else if (result.StatusCode == 500) {
                    //    erro = APP.component.ResultErros.init(result.Erro);
                    //    bootbox.alert(erro);
                    //}

                },
                error: function (result) {
                    //erro = APP.component.ResultErros.init(result.Erro);
                    //bootbox.alert(erro);
                },
                //complete: function (result) {
                //    APP.component.Loading.hideLoading();
            });




            //this.HabilitaCamposGestaoRisco(perfil);

            //this.DestravaDocumento();

        });
    },


};
/*
|--------------------------------------------------------------------------
| Acao Corretiva Controller
|--------------------------------------------------------------------------
*/

APP.controller.AcaoCorretivaController_old = {

    init: function () {

        //var page = APP.component.Util.getPage();

        //this.setup();

        //if (page == "ListaAcaoCorretiva") {
        //    this.IndexAcaoCorretiva();
        //}
        //else if (page == "EditarAcaoCorretiva") {
        //    this.EditarAcaoCorretiva();
        //}

    },

    setup: function () {

        //Acao Corretiva Index
        this.buttonDelAcaoCorreita = $(".del-acao-corretiva");

        //Acao Corretiva Criar

        //Acao Corretiva Editar
        this.buttonRadioEProcedente = $("input:radio[name='EProcedente']");
        this.buttonAddAcaoImediata = $('.add-acao-imediata');
        this.selectButtonResponsavelImplementar = $('[name=IdResponsavelImplementar]');
        this.buttonDtEfetivaImplementacao = $("input[name='DtEfetivaImplementacao']");

    },

    //Chamadas
    IndexAcaoCorretiva: function () {

        this.delAcaoCorretiva();
        APP.component.DataTable.setDataTableParam('#tb-lista-acao-corretiva', 0, "desc", "Tags");

    },

    EditarAcaoCorretiva: function () {

        this.setAcaoImediata();
        this.showFileUploadAcaoImediata();
        this.setNewResponsavelImplementar();
        this.setupUploadArquivoAcaoImediata();
        this.getSelectResponsavelReverificar();
        APP.component.AtivaLobiPanel.init();
        APP.component.FileUpload.init();
        APP.component.Datapicker.init();
        APP.component.UploadFiles.init();
        $('[name=DtDescricaoAcao]').val(APP.component.Datatoday.init());
        this.sendFormSegundaEtapa();

        this.setHideAndShow();
        this.setChecksOnPage();
        this.setCheckAcaoImediataOk();
        this.setCheckAcaoImediataNotOk();
        this.setBackChecksOnPage();

    },

    //FunÃ§Ãµes Index NÃ£o Conformidade
    delAcaoCorretiva: function () {
        this.buttonDelAcaoCorreita.on('click', function (event) {

            var $idAcaoCorretiva = $($(event)[0].target).parent().data("id-nao-conformidade");
            var data = {
                "idAcaoCorretiva": $idAcaoCorretiva,
                "__RequestVerificationToken": $("[name=__RequestVerificationToken]").val()
            };

            var perguntaSeDesejaExcluir = $('[name=labelDesejaExcluirNC]').val();
            bootbox.confirm(perguntaSeDesejaExcluir, function (result) {
                if (result) {
                    $.post('/AcaoCorretiva/RemoverComAcaoConformidade', data, function (data) {
                    }).done(function (result) {
                        if (result.StatusCode == 200) {
                            window.location.href = "/AcaoCorretiva/Index";
                        }
                    })
                        .fail(function (result) {
                        });
                }
            });
        });

    },

    setAcaoImediata: function () {

        this.buttonAddAcaoImediata.unbind('click');
        this.buttonAddAcaoImediata.bind('click', function () {

            var TraducaoDropNameSelect = 'Selecione';
            var index = $('#tb-acao-imediata tbody tr').size();

            var html = '';
            html += '<tr role="row" class="odd">';
            html += '<td>';
            html += '<textarea type="text" id="form-acaoimediata-tb-descricao' + _options.NumeroAcaoImediataGrid + '" name="formAcaoImadiataTbDescricao" class="form-control" ';
            html += 'placeholder="Descrição" ';
            html += 'data-msg-required="" ';
            html += 'value=""';
            html += 'rows="3"></textarea>';
            html += '<input type="hidden" name="formAcaoImadiataTbIdAcaoImediata" class="form-control input-data" value="0"/>';
            html += '<input type="hidden" name="formAcaoImadiataTbEstado" value="4"/>';
            html += '</td>';
            html += '<td>';
            html += '<div class="input-group">';
            html += '<input type="text" name="formAcaoImadiataTbDtPrazoImplementacao" id="form-acaoimediata-tb-dt-prazo-implementacao' + _options.NumeroAcaoImediataGrid + '" class="form-control data datepicker largura-calendario" ';
            html += 'data-msg-required="" ';
            html += 'value="" />';
            html += '<span class="input-group-addon">';
            html += '<i class="fa fa-calendar" onclick="AbreCalendario(this)"  aria-hidden="true"></i>';
            html += '</span>';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<select id="form-acaoimediata-tb-responsavel-implementar" name="formAcaoImadiataTbResponsavelImplementar" class="form-control" ';
            html += 'data-msg-required="">';
            html += '<option value="">' + TraducaoDropNameSelect + '</option>';
            html += '</select>';
            html += '</td>';
            html += '<td>';
            html += '<div class="input-group">';
            html += '<input type="text" name="formAcaoImadiataTbDtEfetivaImplementacao" id="form-acaoimediata-tb-dt-efetiva-implementacao' + _options.NumeroAcaoImediataGrid + '" class="form-control data datepicker" ';
            html += 'data-msg-required="" ';
            html += 'value="" />';
            html += '<span class="input-group-addon">';
            html += '<i class="fa fa-calendar" aria-hidden="true"></i>';
            html += '</span>';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<div class="upload-arq form-control">';
            html += '<a class="btn-upload-form-acaoimediata-tb-evidencia-' + index + '">';
            html += '<i class="fa fa-paperclip fa-1x" aria-hidden="true"></i><br>Anexar';
            html += '</a>';
            html += '<input type="file" name="formAcaoImadiataTbEvidencia" id="form-acaoimediata-tb-evidencia-' + index + '" class="" data-msg-required="" data-b64="">';
            html += '</div>';
            html += '<ul></ul>';
            html += '</td>';
            html += '<td>';
            html += '<a href="#" class="btn-delete-acao-imediata icon-cliente trash-color">';
            html += '<i class="fa fa-trash" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</a>';
            html += '</td>';
            html += '</tr>';

            $('#tb-acao-imediata tbody').append(html);
            $('.add-acao-imediata').removeClass('show').addClass('hide');
            APP.controller.GestaoDeRiscoController.bind();

            _options.NumeroAcaoImediataGrid++;

        });

    },
    getPrimeiraEtapaAcaoCorretiva: function () {

        $.get('/AcaoCorretiva/PrimeiraEtapa', function (_partial) {
            $('#primeira-etapa').html(_partial);
            APP.controller.AcaoCorretivaController.formularioPrimeiraEtapa();
        });

    },

    //FunÃ§Ãµes Editar NÃ£o Conformidade
    getRadioAcaoCorretivaEtapa1: function () {
        var radioAcaoCorretiva = APP.component.Radio.init('EAcaoCorretivaAuditoria');
        if (radioAcaoCorretiva == "false") {
            $('.radio-eprocedente-nao').prop("checked", true);
            $('.painel-acao-corretiva-sim').removeClass('show').addClass('hide');
            $('.painel-acao-corretiva-nao').removeClass('hide').addClass('show');
        } else {
            $(".radio-eprocedente-sim").prop("checked", true);
            $(".radio-eprocedente-sim").prop("disabled", true);
            $('.painel-acao-corretiva-nao').removeClass('show').addClass('hide');
            $('.painel-acao-corretiva-sim').removeClass('hide').addClass('show');
        }
    },

    showAcaoCorretivaProcedente: function () {
        this.buttonRadioEProcedente.on('click', function () {
            var radioEProcedente = APP.component.Radio.init('EProcedente');
            if (radioEProcedente == "false") {
                $('.painel-acao-corretiva-sim').removeClass('show').addClass('hide');
                $('.painel-acao-corretiva-nao').removeClass('hide').addClass('show');
            } else {
                $('.painel-acao-corretiva-nao').removeClass('show').addClass('hide');
                $('.painel-acao-corretiva-sim').removeClass('hide').addClass('show');
            }
        });
    },

    getOptionResponsavelImplementar: function () {
        var idSite = $('#acao-corretiva-site').val();
        var idProcesso = $('[name=IdProcesso]').val();
        var idFuncao = 23; // Funcionalidade(Implementar aÃ§Ã£o imediata) que permite usuario criar GR

        $.ajax({
            type: "GET",
            dataType: 'json',
            url: '/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso=' + idProcesso + '&idSite=' + idSite + '&idFuncao=' + idFuncao'',
            beforeSend: function () {
                $('.add-acao-imediata').removeClass('show').addClass('hide');
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    $(result.Lista).each(function (key, value) {
                        var $option = $('<option>');
                        $('.tb-acao-imediata tbody tr:last-child [name="IdResponsavelImplementar"]').append($option.val(value.IdUsuario).text(value.NmCompleto));
                    });
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {
                $('.add-acao-imediata').removeClass('hide').addClass('show');
            }
        });

    },

    showDataEfetivaImplementacao: function (_select) {

        var idResponsavelImplementar = _select;
        var idUsuarioLogado = $('[name=IdUsuarioLogado]').val();
        if (idResponsavelImplementar == idUsuarioLogado) {
            $('.dp-dt-efetiva-implementacao').show();
        } else {
            $('.dp-dt-efetiva-implementacao').hide();
        }

    },

    setNewResponsavelImplementar: function () {

        $('[name=IdResponsavelImplementar]').change(function () {
            var select = $(this).find(':selected').val();
            APP.controller.GestaoDeRiscoController.showDataEfetivaImplementacao(select, this);
        });

    },

    showFileUploadAcaoImediata: function () {

        $('[name="DtEfetivaImplementacao"]').on('change', function () {
            var buttonDtEfetivaImplementacao = $(this).val();
            if (buttonDtEfetivaImplementacao != null && buttonDtEfetivaImplementacao != "") {
                $(this).closest('tr').find('.acao-imediata-upload').show();
            } else {
                $(this).closest('tr').find('.acao-imediata-upload').hide();
            }
        });

    },

    setupUploadArquivoAcaoImediata: function () {

        $("div[id^=uplPE] a").unbind('click');
        $('div[id^=uplPE] a').click(function () {
            var dropPE = $(this).closest('td').find('div[id^=uplPE]').attr('id');
            var uplPE = $(this).closest('td').find('div[id^=dropPE]').attr('id');
            var arquivoEvidencia = $(this).closest('td').find('input[id^=arquivoEvidencia]').attr('id');

            var formJson = { "id": 0, "tipo": "ac", "acaoImediata": "acaoImediata" };
            APP.component.UploadFiles.setUploadFiles("/AcaoCorretiva/UploadArquivo",
                dropPE,
                uplPE,
                arquivoEvidencia,
                30000000000,
                formJson,
                "form-acao-corretiva-etapa-2",
                0,
                "/AcaoCorretiva/RemoverArquivo");

            UploadDeleteFiles("/AcaoCorretiva/RemoverArquivo");
        });
    },

    editAcaoImediata: function () {

        $('.btn-edit-acao-imediata').on('click', function () {
            $(this).closest('tr').find('.descricao-acao-imediata textarea').attr("disabled", false);
            $(this).closest('tr').find('.prazo-para-implementar input').attr("disabled", false);
            $(this).closest('tr').find('.responsavel-para-implementar select').attr("disabled", false);
            $(this).closest('tr').find('.data-para-efetiva-implementacao input').attr("disabled", false);
            $(this).closest('tr').find('.upload-file input').attr("disabled", false);
            $('.add-acao-imediata').hide();
            $('.e-correcao-acao-imediata').removeClass('hide').addClass('show');
        });

    },

    setConfirmAcaoImediata: function () {

        $('.btn-confirm-acao-imediata').on('click', function () {
            $(this).closest('tr').find('.descricao-acao-imediata textarea').attr("disabled", true);
            $(this).closest('tr').find('.prazo-para-implementar input').attr("disabled", true);
            $(this).closest('tr').find('.responsavel-para-implementar select').attr("disabled", true);
            $(this).closest('tr').find('.data-para-efetiva-implementacao input').attr("disabled", true);
            $(this).closest('tr').find('.upload-file input').attr("disabled", true);
            $('.add-acao-imediata').show();
            $('.e-correcao-acao-imediata').removeClass('hide').addClass('show');
        });

    },

    delAcaoImediata: function () {

        $('.btn-delete-acao-imediata').on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
            $('.add-acao-imediata').show();
            $('.e-correcao-acao-imediata').removeClass('show').addClass('hide');
        });

    },

    getRadioECorrecao: function () {
        $("input[name='ECorrecao']").unbind('click');
        $("input[name='ECorrecao']").on('click', function (event) {
            var radioECorrecao = APP.component.Radio.init('ECorrecao');
            if (radioECorrecao == "false") {
                $('.responsavel-reverificacao').removeClass('hide').addClass('show');
                APP.controller.AcaoCorretivaController.getSelectResponsavelReverificar();
            } else {
                $('.responsavel-reverificacao').removeClass('show').addClass('hide');
            }
        });
    },

    getSelectResponsavelReverificar: function () {
        var idSite = $('#acao-corretiva-site').val();
        var idProcesso = $('[name=IdProcesso]').val();
        var idFuncao = 24; // Funcionalidade(ReverificaÃ§Ã£o) que permite usuario Reverifique AC
        $.get('/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso=' + idProcesso + '&idSite=' + idSite + '&idFuncao=' + idFuncao +'', function (result) {
            if (result.StatusCode == 200) {
                $(result.Lista).each((key, value) => {
                    var $option = $('<option>');
                    $('[name=IdResponsavelReverificador]').append(
                        $option.val(value.IdUsuario).text(value.NmCompleto)
                    );
                });
            }
        });

    },

    showDataEfetivaImplementacaoStatus: function () {
        var usuariosSelect = $('#AcoesImediatas tbody tr').find('[name=IdResponsavelImplementar]');
        var idUsuarioLogado = $('[name=IdUsuarioLogado]').val();

        for (i = 0; i < usuariosSelect.size(); i++) {
            var valueSelect = $(usuariosSelect[i]).val();
            if (valueSelect != idUsuarioLogado) {
                $(usuariosSelect[i]).closest('tr').find('[name=DtEfetivaImplementacao]').prop("disabled", true);
            }
        }

    },

    setHideAndShow: function () {

        var statusEtapa = parseInt($('[name=StatusEtapa]').val());

        if (statusEtapa == 2) {
            APP.controller.AcaoCorretivaController.showDataEfetivaImplementacaoStatus();
        } else if (statusEtapa == 3) {
            $('div[id^=dropPE]').addClass('input-disable');
            $('div[id^=dropPE] a').addClass('input-disable');
            $('[name=upl]').prop("disabled", true);
        } else if (statusEtapa == 4) {
            $('.dp-dt-efetiva-implementacao').show();
            $('.acao-imediata-upload').show();
            $('[name=DtEfetivaImplementacao]').prop("disabled", true);
            $('.foi-eficaz').removeClass('hide').addClass('show');
            $('[name=FlEficaz]').prop("disabled", true);
            $('div[id^=dropPE]').addClass('input-disable');
            $('div[id^=dropPE] a').addClass('input-disable');
            $('[name=upl]').prop("disabled", true);

            var aprovadoAcaoImediata = $('[name=Aprovado]').val();
            if (aprovadoAcaoImediata == "true") {
                $('.btn-ok-acao-imediata').show();
            } else if (aprovadoAcaoImediata == "false") {
                $('.btn-notok-acao-imediata').show();
            }
            $('.btn-ok-acao-imediata, .btn-notok-acao-imediata').prop("disabled", true);
        }
    },

    //FunÃ§Ãµes Editar AÃ§Ã£o Imediata NÃ£o Conformidade
    setChecksOnPage: function () {

        var statusEtapa = parseInt($('[name=StatusEtapa]').val());
        var idUsuarioLogado = $('[name=IdUsuarioLogado]').val();
        var IdResponsavelImplementar = $('[name=IdResponsavelImplementar]').val();
        var IdResponsavelReverificador = $('[name=IdResponsavelReverificador]').val();

        if (statusEtapa == 2 && idUsuarioLogado == IdResponsavelImplementar) {
            //$('.dp-dt-efetiva-implementacao').show();
        } else if (statusEtapa == 3) {
            $('.dp-dt-efetiva-implementacao').show();
            $('.acao-imediata-upload').show();
            $('[name=DtEfetivaImplementacao]').prop("disabled", true);
        }
        if (statusEtapa == 3 && IdResponsavelReverificador == idUsuarioLogado) {
            $('.btn-confirm-acao-imediata').show();
            $('.btn-denied-acao-imediata').show();
            $('.foi-eficaz').removeClass('hide').addClass('show');
        }

    },

    setBackChecksOnPage: function () {
        $('.fa-check-circle, .fa-times-circle').unbind('click');
        $('.fa-check-circle, .fa-times-circle').on('click', function () {
            $(this).closest('td').find('.btn-ok-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-notok-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-confirm-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('.btn-denied-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('[name=Aprovado]').val('');
            APP.controller.AcaoCorretivaController.getChecksAcaoImediata();

        });
    },

    setCheckAcaoImediataOk: function () {

        $('.btn-confirm-acao-imediata').on('click', function () {
            $(this).closest('td').find('.btn-confirm-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-denied-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-ok-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('[name=Aprovado]').val(true);
            $(this).closest('td').find('[name=Aprovado]').val(true);
            APP.controller.AcaoCorretivaController.getChecksAcaoImediata();
        });

    },

    setCheckAcaoImediataNotOk: function () {

        $('.btn-denied-acao-imediata').on('click', function () {
            $(this).closest('td').find('.btn-confirm-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-denied-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-notok-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('[name=Aprovado]').val(false);
            APP.controller.AcaoCorretivaController.getChecksAcaoImediata();
        });

    },

    getChecksAcaoImediata: function () {
        var checkSize = 0;
        var checkAcaoImediata = $('#AcoesImediatas table tbody tr').find('[name=Aprovado]');
        for (i = 0; i < checkAcaoImediata.size(); i++) {
            var valueAprovador = $(checkAcaoImediata[i]).val();
            if (valueAprovador == "true") {
                checkSize++;
            }
        }
        if (checkSize == checkAcaoImediata.size()) {
            $('[name=FlEficaz').filter('[value=true]').prop('checked', true);
        } else {
            $('[name=FlEficaz').filter('[value=false]').prop('checked', true);
        }

    },

    sendFormSegundaEtapa: function () {
        $('.btn-salvar-notificar').unbind('click');
        $('.btn-salvar-notificar').on('click', function () {

            var statusEtapa = parseInt($('[name=StatusEtapa]').val());
            var IdRegistroConformidade = $('[name=IdRegistroConformidade]').val();

            var $form = $('#form-acao-corretiva-etapa-2');
            $form.append({ "__RequestVerificationToken": $("[name=__RequestVerificationToken]").val() });

            var acaoCorretiva = {};

            var fluxos = {
                //Status 2 - ImplementaÃ§Ã£o
                _001: 'fluxo-01',
                //Status 3 - ReverificaÃ§Ã£o
                _002: 'fluxo-02',
                _003: 'fluxo-03'
            };
            var dtEfetivaImplementacaoFoiPreenchida = $('[name=DtEfetivaImplementacao]').filter(x => x == this.defaultValue).val();
            var idResponsavelPorImplementar = $('[name=IdResponsavelImplementar]').is(':disabled');
            switch (statusEtapa) {
                case 1:
                    acaoCorretiva = APP.controller.AcaoCorretivaController.getAcaoCorretiva(fluxos._001);
                    APP.controller.AcaoCorretivaController.saveFormSegundaEtapa(acaoCorretiva);
                    break;

                case 2:
                    acaoCorretiva = (dtEfetivaImplementacaoFoiPreenchida == undefined && idResponsavelPorImplementar == true) ? gestaoDeRisco = APP.controller.AcaoCorretivaController.getAcaoCorretiva(fluxos._002) : APP.controller.AcaoCorretivaController.getAcaoCorretiva(fluxos._001);
                    APP.controller.AcaoCorretivaController.saveFormSegundaEtapa(acaoCorretiva);

                    break;
                case 3:
                    acaoCorretiva = APP.controller.AcaoCorretivaController.getAcaoCorretiva(fluxos._003);
                    APP.controller.AcaoCorretivaController.saveFormSegundaEtapa(acaoCorretiva);
                    break;
                case 4:

                    break;
                default:
                    APP.controller.AcaoCorretivaController.saveFormSegundaEtapa(acaoCorretiva);
            }

        });
    },

    getAcaoCorretiva: function (fluxos) {

        var acaoCorretivaObj = {};

        acaoCorretivaObj.IdRegistroConformidade = $('[name=IdRegistroConformidade]').val();
        switch (fluxos) {
            case "fluxo-01":

                acaoCorretivaObj.StatusEtapa = 2;
                acaoCorretivaObj.DtDescricaoAcao = $('[name=DtDescricaoAcao]').val();
                acaoCorretivaObj.AcoesImediatas = APP.controller.AcaoCorretivaController.getAcaoImediataObj();
                acaoCorretivaObj.IdResponsavelReverificador = $('[name=IdResponsavelReverificador]').val();
                break;
            case "fluxo-02":

                acaoCorretivaObj.StatusEtapa = 2;
                acaoCorretivaObj.AcoesImediatas = APP.controller.AcaoCorretivaController.getAcaoImediataObj();
                break;
            case "fluxo-03":

                acaoCorretivaObj.AcoesImediatas = APP.controller.AcaoCorretivaController.getAcaoImediataObj();
                acaoCorretivaObj.FlEficaz = $('[name=FlEficaz]:checked').val();
                acaoCorretivaObj.StatusEtapa = $('[name=StatusEtapa]').val();
                break;
            default:
        }

        return acaoCorretivaObj;
    },

    getAcaoImediataObj: function () {

        var arrayAcoesImediatasObj = [];
        var $trAcoesImediatas = $('#AcoesImediatas table tbody tr');
        var $idUsuarioLogado = $('[name=IdUsuarioLogado]').val();
        var statusEtapa = parseInt($('[name=StatusEtapa]').val());
        var acaoImediata = {};
        $trAcoesImediatas.each(function (index, tr) {
            if (statusEtapa == 2) {
                acaoImediata = {
                    Descricao: $(tr).find('[name=Descricao]').val(),
                    IdResponsavelImplementar: $(tr).find('[name=IdResponsavelImplementar]').val(),
                    DtPrazoImplementacao: $(tr).find('[name=DtPrazoImplementacao]').val(),
                    DtEfetivaImplementacao: $(tr).find('[name=DtEfetivaImplementacao]').val(),
                    ArquivoEvidencia: $(tr).find('[name=ArquivoEvidencia]').val(),
                    Estado: $(tr).find('[name=DtEfetivaImplementacao]').val() != 0 ? 16 : 0,
                    IdAcaoImediata: $(tr).find('[name=IdAcaoImediata]').val(),
                    IdUsuarioLogado: $idUsuarioLogado
                };
            } else if (statusEtapa == 3) {
                acaoImediata = {
                    Aprovado: $(tr).find('[name=Aprovado]').val(),
                    IdAcaoImediata: $(tr).find('[name=IdAcaoImediata]').val(),
                    Estado: $(tr).find('[name=DtEfetivaImplementacao]').val() != 0 ? 16 : 0,
                    IdUsuarioLogado: $idUsuarioLogado
                };
            } else {
                acaoImediata = {
                    Descricao: $(tr).find('[name=Descricao]').val(),
                    DtPrazoImplementacao: $(tr).find('[name=DtPrazoImplementacao]').val(),
                    DtEfetivaImplementacao: $(tr).find('[name=DtEfetivaImplementacao]').val(),
                    IdResponsavelImplementar: $(tr).find('[name=IdResponsavelImplementar]').val(),
                    Estado: $(tr).find('[name=Estado]').val(),
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    IdUsuarioLogado: $idUsuarioLogado
                };
            }

            arrayAcoesImediatasObj.push(acaoImediata);
        });

        return arrayAcoesImediatasObj;

    },

    saveFormSegundaEtapa: function (formAcaoCorretiva) {

        $.ajax({
            type: "POST",
            data: formAcaoCorretiva,
            dataType: 'json',
            url: "/AcaoCorretiva/SalvarSegundaEtapa",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(_options.MsgSaveSuccess);
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
                window.location.href = "/AcaoCorretiva/Index";
            }
        });

    },

    bind: function () {

        APP.component.Datapicker.init();
        APP.controller.AcaoCorretivaController.setAcaoImediata();
        APP.controller.AcaoCorretivaController.getOptionResponsavelImplementar();
        APP.controller.AcaoCorretivaController.setNewResponsavelImplementar();
        APP.controller.AcaoCorretivaController.showFileUploadAcaoImediata();
        APP.controller.AcaoCorretivaController.editAcaoImediata();
        APP.controller.AcaoCorretivaController.setConfirmAcaoImediata();
        APP.controller.AcaoCorretivaController.delAcaoImediata();

    },


    destravaFormEtapa: function () {
        //destravar etapa
        $('.btn-destravar-etapa').on('click', function (e) {

            var detectPartial = $('form').val() == "partial";
            var $forms = $('form');

            $.each($forms, (index, element) => {
                var visible = $(element).visible(detectPartial);
                if (visible) {
                    var data = {
                        "idAcaoCorretiva": $('[name=IdAcaoCorretiva]').val(),
                        "etapa": index + 1,
                        "__RequestVerificationToken": $("[name=__RequestVerificationToken]").val()
                    };
                    $.post('/AcaoCorretiva/DestravarEtapa', data, (result) => { })
                        .done((result) => {
                            if (result.StatusCode == 200) {
                                console.log(result);
                            } else if (result.StatusCode != 200) {

                            }
                        });
                }
            });

        });
    },

};

/*
|--------------------------------------------------------------------------
| Controlador Analise Critica
|--------------------------------------------------------------------------
*/

APP.controller.AnaliseCriticaController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "IndexAnaliseCritica") {
            this.indexAnaliseCritica();
        }
        if (page == "CriarAnaliseCritica") {
            this.acoesAnaliseCritica();
        }

    },

    setup: function () {

        //Criar Analise Critica
        this.buttonAddPessoaFuncao = $(".add-pessoa-funcao");

        this.buttonSalvar = $(".btn-salvar");
        this.buttonExcluirAnaliseCritica = $(".excluir-analise-critica");


    },

    //Models
    models: {

        //PerfilUsuarioModel: APP.model.PerfilUsuario,

    },

    //Index Analise Critica
    indexAnaliseCritica: function () {

        APP.component.DataTable.init('#tb-index-analise-critica');
        this.setExcluirAnaliseCritica();
    },

    //Acoes Analise Critica
    acoesAnaliseCritica: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        APP.component.FileUpload.init();
        APP.component.Mascaras.init();
        this.setAndHide();
        this.setValidateForms();
        this.formCriarAnaliseCritica();

        if ($('[name=IdAnaliseCritica]').val() > 0) {
            APP.controller.AnaliseCriticaController.getTemasDescricao();
            APP.controller.AnaliseCriticaController.getTemasCores();
            APP.controller.AnaliseCriticaController.getTemasPossuiGestaoDeRisco();
            APP.controller.AnaliseCriticaController.setPossuiGestaoDeRisco();
            APP.controller.AnaliseCriticaController.setHidePossuiGestaoDeRisco();
            APP.controller.AnaliseCriticaController.bindTemas();
        }

        this.sendFormCriarAnaliseCritica();

    },

    setAndHide: function () {

        //

    },

    setValidateForms: function () {

        var ObjFormCriarAnaliseCriticaValidate = APP.controller.AnaliseCriticaController.getObjObjFormCriarAnaliseCriticaValidate();
        APP.component.ValidateForm.init(ObjFormCriarAnaliseCriticaValidate, '#form-criar-analisecritica');
        APP.component.ValidateForm.init(ObjFormCriarAnaliseCriticaValidate, '#form-analisecriticatema');

    },

    //Formulario Analise Critica
    formCriarAnaliseCritica: function () {

        this.setAndHideCriarAnaliseCritica();
        this.getResponsavel();
        this.addPessoaFuncao();
        this.delPessoaFuncao();
        //this.getParticipantes();
        this.setFuncaoPessoa();

        this.setTemas();
        this.editTemas();
        this.setTemaBox();
        this.delTemaCombobox();
        this.getTodosResponsaveisPorAcaoImediata();

    },

    setAndHideCriarAnaliseCritica: function () {

        //

    },

    getResponsavel: function () {

        var idProcesso = $('[name=IdProcesso]').val();
        var idSite = $('[name=IdSite]').val();
        var idFuncao = 48; // Funcionalidade(Registro da ata) que permite Criar Analise Critica;
        $.get('/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso=' + idProcesso + '&idSite=' + idSite + '&idFuncao=' + idFuncao +'', (result) => {
            if (result.StatusCode == 200) {
                APP.component.SelectListCompare.selectList(result.Lista, $('[name="formCriarAnaliseCriticaResponsavel"] option'), $('[name="formCriarAnaliseCriticaResponsavel"]'), 'IdUsuario', 'NmCompleto');
            }
        });
    },

    addPessoaFuncao: function () {

        this.buttonAddPessoaFuncao.unbind('click');
        this.buttonAddPessoaFuncao.on('click', function () {

            if ($("#tb-passoa-funcao").find('[name=formCriarAnaliseCriticaCargo]').last().val() != "") {

                var msgRequiredParticipante = $('[name=placeholderDropdownNameSelect]').val();
                var placeholderDropdownNameSelect = $('[name=placeholderDropdownNameSelect]').val();

                var index = $("#tb-passoa-funcao tbody tr").size();

                var html = '';
                html += '<tr>';
                html += '<!-- Participante -->';
                html += '<td align="center">';
                html += '<div class="form-group">';
                html += '<select id="form-criar-analise-critica-participante" name="formCriarAnaliseCriticaParticipante" class="form-control"';
                html += 'data-msg-required="' + msgRequiredParticipante + '">';
                html += '<option value="">' + placeholderDropdownNameSelect + '</option>';
                html += '</select>';
                html += '</div>';
                html += '</td>';
                html += '<!-- FunÃ§Ã£o -->';
                html += '<td>';
                html += '';
                html += '<div class="form-group">';
                html += '<input id="form-criar-analise-critica-cargo" name="formCriarAnaliseCriticaCargo" class="form-control" placeholder="" data-msg-required="" value="" disabled />';
                html += '</div>';
                html += '</td>';
                html += '<!-- Icon Del -->';
                html += '<td align="center">';
                html += '<a href="#" class="excluir-funcionario icon-cliente">';
                html += '<i class="fa fa-trash" aria-hidden="true" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
                html += '</a>';
                html += '</td>';
                html += '</tr>';

                $("#tb-passoa-funcao tbody:last-child").append(html);

                APP.controller.AnaliseCriticaController.bind();
            }
        });
    },

    delPessoaFuncao: function () {

        $('.excluir-funcionario').on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });

    },

    getParticipantes: function () {

        var idAnaliseCritica = $('[name=IdAnaliseCritica]').val();
        $.get('/AnaliseCritica/ObterUsuariosPorAnaliseCritica?idAnaliseCritica=' + idAnaliseCritica, function (result) {
            $.each(result.Lista, function (key, value) {
                if (result.StatusCode == 200) {
                    APP.component.SelectListCompare.selectList(result.Lista, $('#tb-passoa-funcao tbody tr:last-child [name="formCriarAnaliseCriticaParticipante"] option'), $('#tb-passoa-funcao tbody tr:last-child [name="formCriarAnaliseCriticaParticipante"]'), 'IdUsuario', 'NmCompleto');
                }
            });
        });

    },

    setParticipante: function () {

        $('[name=formCriarAnaliseCriticaParticipante]').each(function (key, value) {
            var idParticipanteSelected = $(this).closest('tr').find('.id-funcionario').val();
            $(value).val(idParticipanteSelected);
        });
    },

    setFuncaoPessoa: function () {

        $("[name^=formCriarAnaliseCriticaParticipante]").change(function () {
            var select = $(this).find(':selected');
            var idUsuario = $(this).val();
            $.get('/Usuario/ObterFuncao?idUsuario=' + idUsuario, function (result) {
                if (result.StatusCode == 200) {
                    $(select.closest("tr").find('[name=formCriarAnaliseCriticaCargo]').val(result.Funcoes));
                }
            });
        });

    },

    bind: function () {

        //APP.controller.AnaliseCriticaController.getResponsavel();
        APP.controller.AnaliseCriticaController.setup();
        APP.controller.AnaliseCriticaController.addPessoaFuncao();
        APP.controller.AnaliseCriticaController.getParticipantes();
        APP.controller.AnaliseCriticaController.setFuncaoPessoa();
        APP.controller.AnaliseCriticaController.delPessoaFuncao();
        APP.controller.AnaliseCriticaController.setValidateForms();

    },

    setTemas: function () {

        var idSite = $('[name=IdSite]').val();

        $.get('/ControladorCategorias/ListaAtivos?tipo=tema&site=' + idSite, function (result) {
            $.each(result.Lista, function (key, value) {
                if (result.StatusCode == 202) {
                    APP.component.SelectListCompare.selectList(result.Lista, $('#tb-passoa-funcao tbody tr:last-child [name="formCriarAnaliseCriticaParticipante"] option'), $('#tb-passoa-funcao tbody tr:last-child [name="formCriarAnaliseCriticaParticipante"]'), 'IdUsuario', 'NmCompleto');
                }
            });
        });

    },

    editTemas: function () {

        $('.add-tema-analise-critica').unbind('click');
        $('.add-tema-analise-critica').on('click', function () {

            var idSite = $('#site-analise-critica').val();
            APP.controller.ControladorCategoriasController.init(idSite, 'tema', APP.controller.AnaliseCriticaController.setTemas, '.add-tema-analise-critica');

        });

    },

    setTemaBox: function () {
        
    $('[name=formCriarAnaliseCriticaTema]').change(function () {
            //Valor zero representa o selecione no combobox
            var temaSelected = $("[name=formCriarAnaliseCriticaTema] option:selected").val();
            var textoTemaSelected = $("[name=formCriarAnaliseCriticaTema] option:selected").text();
            var numeroAC = $("[name=numeroAC]").val(); 
            
            if (temaSelected != 0) {
            
                var id = temaSelected;
                var tema = '';
                tema += '<li class="row li-tema-AC">';
                tema += '<div class="barra-busca">';
                tema += '<!-- Titulo -->';
                tema += '<div class="col-lg-10 col-md-10 col-sm-10 col-xs-10">';
                tema += '<h2>' + textoTemaSelected + '</h2>';
                tema += '</div>';
                tema += '<!-- Acoes -->';
                tema += '<div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">';
                tema += '<a href="#" class="btn icon-analise editar-tema" data-toggle="collapse">';
                tema += '<i class="fa fa-pencil fa-1" aria-hidden="true"></i>';
                tema += '</a>';
                tema += '<a href="#" class="btn icon-analise excluir-tema" data-toggle="collapse">';
                tema += '<i class="fa fa-trash fa-1" aria-hidden="true" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
                tema += '</a>';
                tema += '</div>';
                tema += '<!-- Gestao de Risco -->';
                tema += '<input type="hidden" name="idControladorCategoria" value="' + temaSelected + '">';
                tema += '<div name="GestaoDeRisco" class="gestaoDeRiscoPartial-' + temaSelected + '" id="gestaoDeRiscoPartial-' + temaSelected + '" data-name="' + temaSelected + '">';
                tema += '</div>';
                tema += '</div>';
                tema += '</li>';


                $("#panel-lista-temas").append(tema);
                $("[name=formCriarAnaliseCriticaTema] option:selected").remove();

                var divGestaoDeRisco = $('.gestaoDeRiscoPartial-' + temaSelected);
                APP.component.GestaoDeRiscoPartial.init(divGestaoDeRisco, temaSelected);

                APP.controller.AnaliseCriticaController.delTemaCombobox();
                APP.controller.AnaliseCriticaController.bindTemas();

            }
        });

    },

    delTemaCombobox: function () {
        $(".excluir-tema").unbind("click");
        $(".excluir-tema").bind('click', function () {

            var idControladorCategoria = $(this).closest('.li-tema-AC').find('[name=idControladorCategoria]').val();
            var tituloTema = $(this).closest('.li-tema-AC').find('h2').text();
            APP.controller.AnaliseCriticaController.setTemaCombobox(idControladorCategoria, tituloTema);
            CKEDITOR.instances[idControladorCategoria].destroy(true);

            $(this).closest('.li-tema-AC').remove();

        });
    },

    editTemaExistenteBox: function () {

        $('.editar-tema').unbind('click');
        $('.editar-tema').on('click', function () {

            $(this).closest('.li-tema-AC').find('[id^=gestaoDeRiscoPartial]').slideToggle();

        });

    },

    setTemaCombobox: function (idTema, descricaoTema) {


        $('[name=formCriarAnaliseCriticaTema]').append($('<option />').val(idTema).text(descricaoTema));
    },

    getTodosResponsaveisPorAcaoImediata: function (_this) {

        var idSite = $('[name=IdSite]').val();
        var idFuncao = 91; // Funcionalidade(Implementar aÃ§Ã£o) que permite Criar aÃ§Ãµes Corretivas
        var idProcesso = $('[name=IdProcesso]').val();
        $.get('/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso=' + idProcesso + '&idSite=' + idSite + '&idFuncao=' + idFuncao +'', (result) => {
            if (result.StatusCode == 200) {
                
                if($(_this).closest('#gestaoDeRisco').find('[name="formGestaoDeRiscoResponsavelDefinicao"]').find("option").length <= 1)
                {
                    var comboResponsavel = $(_this).closest('#gestaoDeRisco').find('[name="formGestaoDeRiscoResponsavelDefinicao"] option');
                    var idComboResponsavel = $(_this).closest('#gestaoDeRisco').find('[name="formGestaoDeRiscoResponsavelDefinicao"]');
                    APP.component.SelectListCompare.selectList(result.Lista, comboResponsavel, idComboResponsavel, 'IdUsuario', 'NmCompleto');
                }
                
            }
        });

    },

    setPopulaGestaoRisco: function (result, idTema) {

        $('#' + idTema).find('.DsTexto').val(result.GestaoDeRisco.DescricaoRegistro);

        APP.component.GestaoDeRiscoPartial.showBarRating(('#' + idTema), result.CorRisco);

        if (result.CorRisco === "Amarelo" || result.CorRisco === "Vermelho") {
            $('#' + idTema).find("[name=divGestaoRisco]").show();
        }

        if (result.PossuiGestaoRisco) {
            $('#' + idTema).find('#list-option-1').prop('checked', true);
        }
        else {
            $('#' + idTema).find('#list-option-2').prop('checked', true);
        }

        $('#' + idTema).find('.indentificacaoDeRisco').val(result.DsEvidenciaEficaciaAcao);

    },

    delParticipanteCombobox: function () {
        $('.participante-drop').children().remove();
    },

    setTemaGestaoDeRisco: function () {

        $('.editar-tema').unbind('click');
        $('.editar-tema').on('click', function () {

            var gestaoRiscoSelecionada = $(this).closest(".li-tema-AC").find(".gestaoDeRiscoPartial");
            var idTema = $(this).closest(".li-tema-AC").find('[name=idControladorCategoria]').val();
            var idDiv = gestaoRiscoSelecionada.data("name");
            var idGestao = $(this).closest('.barra-busca').find('[name=GestaoDeRisco]');

            APP.component.GestaoDeRiscoPartial.init(gestaoRiscoSelecionada, true, idTema);
            APP.controller.AnaliseCriticaController.bind();

            var temas = JSON.parse($("#temas-analisecritica").val());

            for (var index in temas) {
                if (temas[index].IdTema == idTema) {
                    APP.controller.AnaliseCriticaController.setPopulaGestaoRisco(temas[index], idTema);
                }
            }

        });

    },

    bindTemas: function () {

        APP.controller.AnaliseCriticaController.editTemas();
        APP.controller.AnaliseCriticaController.setTemaBox();
        APP.controller.AnaliseCriticaController.delTemaCombobox();
        APP.controller.AnaliseCriticaController.editTemaExistenteBox();
        APP.controller.AnaliseCriticaController.setValidateForms();

    },

    getObjObjFormCriarAnaliseCriticaValidate: function () {

        var acoesPadraoFormCriarPadraoObj = {
            //formCriaClienteLogo: {required: true, minFiles: 1},
            //Analise Critica
            formCriarAnaliseCriticaResponsavel: { required: true },
            formCriarAnaliseCriticaAta: { required: true },
            formCriarAnaliseCriticaDtCriacao: { required: true },
            formCriarAnaliseCriticaDtProximaAnalise: { required: true },
            //Analise Critica - Pessoa Funcao
            formCriarAnaliseCriticaParticipante: { required: true },
            formCriarAnaliseCriticaCargo: { required: true },
            //Analise Critica - Gestao de Risco
            //formCriarAnaliseCriticaTema : {required: true},
            //formGestaoDeRiscoDescricao : {required: true},
            formGestaoDeRiscoCriticidade: { required: true },
            //formGestaoDeRiscoRisco : {required: true},
            //formGestaoDeRiscoResponsavelDefinicao : {required: true},
            //formGestaoDeRiscoNumero : {required: true},
            //formGestaoDeRiscoIdentificacao : {required: true},

        };

        return acoesPadraoFormCriarPadraoObj;

    },

    getObjFormCriarAnaliseCritica: function () {

       

        var acoesPadraoFormCriarPadraoObj = {

            IdAnaliseCritica: $('[name=IdAnaliseCritica]').val(),
            IdSite: $('[name=IdSite]').val(),
            IdResponsavel: $('[name=formCriarAnaliseCriticaResponsavel] :selected').val(),
            Ata: $('[name=formCriarAnaliseCriticaAta]').val(),
            DataCriacao: $('[name=formCriarAnaliseCriticaDtCriacao]').val(),
            DataProximaAnalise: $('[name=formCriarAnaliseCriticaDtProximaAnalise]').val(),
            Ativo: true,
            Temas: APP.controller.AnaliseCriticaController.getObjFormTemasAnaliseCriticaArray(),
            Funcionarios: APP.controller.AnaliseCriticaController.getObjFormPessoaFuncaoAnaliseCriticaArray(),
        };

        
        return acoesPadraoFormCriarPadraoObj;

    },

    getObjFormPessoaFuncaoAnaliseCriticaArray: function () {

        var arrayFormAnaliseCriticaObj = [];

        $('#tb-passoa-funcao tbody tr').each(function () {

            var formCriarAnaliseCriticaObj = {
                IdAnaliseCriticaFuncionario: $(this).find('[name=formCriarAnaliseCriticaFuncionarioId]').val(),
                IdUsuario: $(this).find('[name=formCriarAnaliseCriticaParticipante] :selected').val(),
                Funcao: $(this).find('[name=formCriarAnaliseCriticaCargo]').val(),
            };

            arrayFormAnaliseCriticaObj.push(formCriarAnaliseCriticaObj);

        });

        return arrayFormAnaliseCriticaObj;

    },

    getObjFormTemasAnaliseCriticaArray: function () {

        var arrayFormTemasAnaliseCriticaObj = [];

        $('#panel-lista-temas .li-tema-AC').each(function () {

            var idCkEditor = $(this).find('[name=formGestaoDeRiscoDescricao]').attr('id');

            var formCriarTemasAnaliseCriticaObj = {
                IdTema: $(this).find('[name=IdTema]').val(),
                Descricao: CKEDITOR.instances[idCkEditor].getData(),
                CorRisco: $(this).find("[name^=formGestaoDeRiscoCriticidade] :selected").val(),
                PossuiGestaoRisco: $(this).find('[name^=formGestaoDeRiscoRisco]:checked').val(),
                IdControladorCategoria: $(this).find('[name=idControladorCategoria]').val(),
                IdGestaoDeRisco: $(this).find('[name=IdGestaoDeRisco]').val(),
                GestaoDeRisco:
                    {
                        CriticidadeGestaoDeRisco: $('.br-current').data('rating-value') == undefined ? 0 : $(this).find("[name^=formGestaoDeRiscoCriticidade] :selected").val(),
                        //TipoRegistro: 'gr',
                        IdResponsavelInicarAcaoImediata: $(this).find('[name=formGestaoDeRiscoResponsavelDefinicao]').val(),
                        DescricaoRegistro: $(this).find('[name=formGestaoDeRiscoIdentificacao]').val(),
                        Causa: $(this).find('[name=formGestaoDeRiscoCausa]').val(),                        
                        DsJustificativa: $(this).find('[name=formGestaoDeRiscojustificativa]').val()
                    }
            };
            
            arrayFormTemasAnaliseCriticaObj.push(formCriarTemasAnaliseCriticaObj);

        });

        return arrayFormTemasAnaliseCriticaObj;

    },

    //Funcoes Edit Analise Critica
    getTemasDescricao: function () {

        $('[name=formGestaoDeRiscoDescricao]').each(function (index, element) {

            var idDescricao = $(element).attr('id');
            CKEDITOR.replace(idDescricao);
        });

    },

    getTemasCores: function () {

        var divBarRating = $('.barraRating');
        APP.component.BarRating.setBarRatingGestaoDeRisco(divBarRating, 'bars-1to10');

        $('[name=formGestaoDeRiscoDescricao]').each(function (index, element) {

            var divContext = $(element).closest('[name=GestaoDeRisco]');

            var corRisco = divContext.find('[name=formGestaoDeRiscoCriticidadeCor]').val();
            var lastCores = divContext.find("[data-rating-value='" + corRisco + "']").last().index();
            for (i = 0; i <= lastCores; i++) {
                $(divContext.find('.br-theme-bars-1to10').find('.br-widget a')[i]).addClass('br-selected');
            }
            $(divContext.find('.br-theme-bars-1to10').find('.br-widget a')[lastCores]).trigger("click");
            divContext.find('.br-theme-bars-1to10').find("[data-rating-value='" + corRisco + "']").addClass('br-current');
            $('.br-widget').addClass('barRating-disabled');
        });
    },

    getTemasPossuiGestaoDeRisco: function () {
        $('[name=formGestaoDeRiscoDescricao]').each(function (index, element) {
            var divContext = $(element).closest('[name=GestaoDeRisco]');
            var temGestaoDeRisco = divContext.find('[name=formGestaoDeRiscoRisco]').val();
            divContext.find('[name=formGestaoDeRiscoResponsavelDefinicao][value='+ temGestaoDeRisco +']').prop('checked', temGestaoDeRisco);
        });
    },


    setPossuiGestaoDeRisco: function () {

        $('[name^=formGestaoDeRiscoRisco]').unbind('change');
        $('[name^=formGestaoDeRiscoRisco]').on('change', function () {

            var possuiGestaoDeRisco = APP.controller.AnaliseCriticaController.getPossuiGestaoDeRisco();
            APP.controller.AnaliseCriticaController.setRulesPossuiGestaoDeRisco(possuiGestaoDeRisco);

        });

    },

    getPossuiGestaoDeRisco: function () {

        var possuiGestaoDeRisco = APP.component.Radio.init('formGestaoDeRiscoRisco');
        return possuiGestaoDeRisco;

    },

    setRulesPossuiGestaoDeRisco: function (_possuiGestaoDeRisco) {

        if (_possuiGestaoDeRisco == "true") {
            $('[name=formGestaoDeRiscoResponsavelDefinicao]').closest("[class^=col]").show();
            $('[name=formGestaoDeRiscoNumero]').closest("[class^=col]").show();
            $('[name=formGestaoDeRiscoIdentificacao]').closest("[class^=col]").show();
            $('.JustificativaGestaoDeRisco').hide();
            
        } else {
            $('[name=formGestaoDeRiscoResponsavelDefinicao]').closest("[class^=col]").hide();
            $('[name=formGestaoDeRiscoNumero]').closest("[class^=col]").hide();
            $('.JustificativaGestaoDeRisco').show();
            $('[name=formGestaoDeRiscoIdentificacao]').closest("[class^=col]").hide();
        }

    },

    setHidePossuiGestaoDeRisco: function () {

        $('[name^=formGestaoDeRiscoRisco]').trigger('change');

    },

    //Todos
    sendFormCriarAnaliseCritica: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = APP.controller.AnaliseCriticaController.validateForms();

            //var validate = true;
            if (validate == true) {
                var padraoObj = APP.controller.AnaliseCriticaController.getCriarAnaliseCriticaObj();
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    getCriarAnaliseCriticaObj: function () {

        var analiseCriticaObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                switch (form) {
                    case "analisecritica":
                        analiseCriticaObj = APP.controller.AnaliseCriticaController.getObjFormCriarAnaliseCritica();
                        
                        var valida = true;

                        if (analiseCriticaObj.Funcionarios.length == 0) {

                            bootbox.alert(_options.labelParticipantesObrigatorio);
                            valida = false;
                        }
                        else if (analiseCriticaObj.Temas.length == 0)
                        {
                            
                            bootbox.alert(_options.labelTemaObrigatorio);
                            valida = false;
                        }
                        else if (analiseCriticaObj.Temas.length > 0) {

                            if (analiseCriticaObj.Temas[0].Descricao == "" || analiseCriticaObj.Temas[0].Descricao == null)
                            {
                                bootbox.alert(_options.labelDescricaoObrigatorio);
                                valida = false;
                            }
                            else if (analiseCriticaObj.Temas[0].GestaoDeRisco.DescricaoRegistro == "" || analiseCriticaObj.Temas[0].GestaoDeRisco.DescricaoRegistro == null) {
                                bootbox.alert(_options.labelIdentificacaoRiscoObrigatorio);
                                valida = false;
                            }
                            else if (analiseCriticaObj.Temas[0].GestaoDeRisco.CriticidadeGestaoDeRisco == "" || analiseCriticaObj.Temas[0].GestaoDeRisco.CriticidadeGestaoDeRisco == null || analiseCriticaObj.Temas[0].GestaoDeRisco.CriticidadeGestaoDeRisco == 0) {
                                bootbox.alert(_options.labelCriticidadeGestaoDeRisco);
                                valida = false;
                            }
                            else if (analiseCriticaObj.Temas[0].PossuiGestaoRisco == null || analiseCriticaObj.Temas[0].PossuiGestaoRisco == "") 
                            {
                                bootbox.alert(_options.labelPossuiGestaoRisco);
                                valida = false;
                            }
                            
                            else if (analiseCriticaObj.Temas[0].GestaoDeRisco.IdResponsavelInicarAcaoImediata == null || analiseCriticaObj.Temas[0].GestaoDeRisco.IdResponsavelInicarAcaoImediata  == "") {
                                bootbox.alert(_options.labelResponsavelDefinicaoObrigatorio);
                                valida = false;
                            }
                        }
                                                

                        if (valida == true)
                        {
                            APP.controller.AnaliseCriticaController.saveFormCriarAnaliseCritica(analiseCriticaObj, '/AnaliseCritica/Salvar');
                        }
                        
                        break;
                }
            }

        });


    },

    saveFormCriarAnaliseCritica: function (analiseCriticaObj, url) {

        var erro = "";
        $.ajax({
            type: "POST",
            data: analiseCriticaObj,
            dataType: 'json',
            url: url,
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/AnaliseCritica/Index";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    setExcluirAnaliseCritica: function () {

        this.buttonExcluirAnaliseCritica.unbind('click');
        this.buttonExcluirAnaliseCritica.bind('click', function () {
            
            event.preventDefault();

            var idDocumento = $(this).attr("idAnaliseCritica");

            bootbox.confirm(_options.DesejaRealmenteExcluirEsseRegistro, function (result) {
                if (result) {
                    $.post('/AnaliseCritica/Excluir/' + idDocumento, function (data, status) { }).done(function (data) {
                        if (data.StatusCode == "200") {
                            
                            bootbox.alert(data.Success, function (result) {
                                window.location.href = "/AnaliseCritica/Index";
                            });

                        }
                        if (data.StatusCode == "500") {
                            bootbox.alert(_options.MsgErroExclusaoRegistro);
                        }
                    });
                }
            });
        });

    },



};
/*
|--------------------------------------------------------------------------
| Controlador Auditoria
|--------------------------------------------------------------------------
*/

APP.controller.AuditoriaController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "IndexAuditoria") {
            this.indexAuditoria();
        }

    },

    setup: function () {

        //Criar Cliente
        this.buttonSalvar = $(".btn-salvar");

    },

    models: {        
        AnexoModel: APP.model.Anexo,        
    },

    indexAuditoria: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.FileUpload.init();
        APP.component.DragAndDrop.init();
        //$('.carousel').carousel();
        this.setAndHide();
        this.getGestorPorSite();
        this.setValidateForms();
        this.sendFormAuditoria();       

    },

    setAndHide: function () {

        //

    },

    getArquivo: function (_this) {

        var anexoContratoModel = APP.controller.FornecedoresController.models.AnexoModel;
        var anexoAuditoria = {};
        
        var nameImg = $(_this).parent().find('.NomeAnexo').val();
        var id = $(_this).parent().find('.IdAnexo').val() != undefined && $(_this).parent().find('.IdAnexo').val() != null && $(_this).parent().find('.IdAnexo').val() != "" ? $(_this).parent().find('.IdAnexo').val() : "0";
        
        var anexoAuditoria = anexoContratoModel.constructor(
            id,
            nameImg,
            $(_this).parent().find('.anexo-plai').data('b64'),
        );

        return anexoAuditoria;

    },
   
    getGestorPorSite: function () {

        var idSite = $('[name=IdSite]').val();
        var idFuncao = 12; // Funcionalidade(Cadastrar) que permite usuario criar nc
        $.get('/Usuario/ObterUsuariosPorFuncao?idSite=' + idSite + '&idFuncao=' + idFuncao +'', (result) => {
            if (result.StatusCode == 200) {
                APP.component.SelectListCompare.selectList(result.Lista, $('[name=formAuditoriaGestor] option'), $('[name=formAuditoriaGestor]'), 'IdUsuario', 'NmCompleto');
            }
        });

    },

    setValidateForms: function () {

        var ObjFormPaiValidate = APP.controller.AuditoriaController.getObjObjFormPaiValidate();
        APP.component.ValidateForm.init(ObjFormPaiValidate, '#form-auditoria');

    },

    getObjObjFormPaiValidate: function () {

        var acoesCalendarioFormPaiObj = {
            formAuditoriaGestor: 'required',
        };

        return acoesCalendarioFormPaiObj;

    },

    getObjFormAuditoria: function (_this) {

        var formCriarAuditoriaObj = {
            IdPai: $(_this).find(".formAuditoriaIdPai").val(),
            IdGestor: $('[name=formAuditoriaGestor] :selected').val(),
            Ano: $(_this).find(".pai-ano").find("span").html(),
            Plais: APP.controller.AuditoriaController.getObjFormAuditoriaPlais(_this)
        };

        return formCriarAuditoriaObj;

    },

    getObjFormAuditoriaAno: function () {

        var arrayFormAuditoriaAnoObj = [];

        $('#myCarousel .item').each(function () {
            var hasItem = APP.controller.AuditoriaController.getProcessoMesAno(this);

            if (hasItem) {

                var formAuditoriaAnoObj = {
                    formAuditoriaAno: $(this).find('.pai-ano span').text(),
                    formAuditoriaMeses: APP.controller.AuditoriaController.getObjFormAuditoriaMeses(this),
                };

                arrayFormAuditoriaAnoObj.push(formAuditoriaAnoObj);
            }
        });

        return arrayFormAuditoriaAnoObj;

    },

    getObjFormAuditoriaPlais: function (_this) {

        var arrayFormAuditoriaMesesObj = [];
        $(_this).find('.calendar ul').each(function () {
            var formAuditoriaMesesObj = {
                Mes: $(this).find('[name^=formAuditoriaMes]').val(),
                Arquivo: APP.controller.AuditoriaController.getArquivo(this),
                PlaiProcessoNorma: APP.controller.AuditoriaController.getObjFormAuditoriaMesesProcessos(this),
            };

            arrayFormAuditoriaMesesObj.push(formAuditoriaMesesObj);
        });

        return arrayFormAuditoriaMesesObj;

    },

    getObjFormAuditoriaMesesProcessos: function (e) {

        var arrayFormAuditoriaMesesProcessosObj = [];
        $(e).find('li').each(function () {
            var formAuditoriaMesesProcessosObj = {
                NomeProcesso: $(this).find('span').text(),
            };
            arrayFormAuditoriaMesesProcessosObj.push(formAuditoriaMesesProcessosObj);
        });

        return arrayFormAuditoriaMesesProcessosObj;

    },

    getIdProcessoPorNome: function (_Nome) {
     
        $.ajax({
            type: "GET",
            dataType: 'JSON',
            data: { Nome: _Nome },
            async: false,
            url: '/Auditoria/RetornaProcessoPorNome',
            success: function (result) {
                if (result.StatusCode == 202) {
                    return result.IdProcesso;
                }
                else
                {
                    return 0;
                }
            },
            error: function (result) {
                return 0;
            },
        });
    },

    getProcessoMesAno: function (_this) {

        var itens = $(_this).find('.calendar ul li').size();
        if (itens > 0) {
            return true;
        } else {
            return false;
        }
    },

    //Todos
    sendFormAuditoria: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = APP.controller.AuditoriaController.validateForms();

            //var validate = true;
            if (validate == true) {
                var auditoriaObj = APP.controller.AuditoriaController.getAuditoriaObj();
                APP.controller.AuditoriaController.saveFormAuditoria(auditoriaObj);
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    getAuditoriaObj: function () {

        var ArrayAuditoriaObj = [];

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                
                if (form == "auditoria")
                {
                    $('.carousel-inner .item').each(function () {
                        var auditoriaObj = APP.controller.AuditoriaController.getObjFormAuditoria(this);                    
                        ArrayAuditoriaObj.push(auditoriaObj);
                    });
                }                
            }

        });

        return ArrayAuditoriaObj;

    },

    saveFormAuditoria: function (auditoriaObj) {

        var erro = "";

        $.ajax({
            type: "POST",
            data: { pais: auditoriaObj },
            dataType: 'json',
            url: "/Auditoria/Salvar",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/Auditoria/Index";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

};
/*
|--------------------------------------------------------------------------
| Controlador Cargo
|--------------------------------------------------------------------------
*/
APP.controller.CargoController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "IndexCargo") {
            this.indexCargo();
        }
        if (page == "CriarCargo") {
            this.acoesCargo();
        }

    },

    setup: function () {

        //Criar Pagina
        this.buttonSalvar = $(".btn-salvar");

    },

    //Index Cargo
    indexCargo: function () {

        APP.component.DataTable.init('#tb-index-cargo');
        APP.controller.CargoController.setMsgIconeAtivo();
        APP.controller.CargoController.setMsgIconeExcluir();

    },

    setMsgIconeAtivo: function () {
        

    },

    getMsgIconeAtivo: function (_idCargo) {

        var erro = "";
        var idSite = $('[name=IdSite]').val();
        $.ajax({
            type: "POST",
            dataType: 'json',
            url: '/Cargo/AtivaInativa?idCargo=' + idcargo'',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {

                if (result.StatusCode == 200) {
                    window.location.href = "/Cargo/Index/" + idSite;
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    setMsgIconeExcluir: function () {
        

    },

    getMsgIconeExcluir: function (_idCargo) {

        var erro = "";
        var idSite = $('[name=IdSite]').val();
        $.ajax({
            type: "POST",
            dataType: 'json',
            url: '/Cargo/Excluir?id=' + icargo'',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    window.location.href = "/Cargo/Index/" + idSite;
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    //Acoes Cargo
    acoesCargo: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        APP.component.FileUpload.init();
        APP.component.Mascaras.init();
        APP.component.SelectAll.init('formCargoModuloFuncionalidadeAll');
        this.setAndHide();
        this.setValidateForms();
        this.formCriarCargo();

        this.sendFormCriarCargo();

    },

    setAndHide: function () {

        //

    },

    setValidateForms: function () {

        var ObjFormCriarCargoValidate = APP.controller.CargoController.getObjFormCriarCargoValidate();
        APP.component.ValidateForm.init(ObjFormCriarCargoValidate, '#form-criar-cargo');

    },

    //Formulario Criar Cargo
    formCriarCargo: function () {

        this.setAndHideCriarCargo();

    },

    setAndHideCriarCargo: function () {

        //

    },

    getObjFormCriarCargoValidate: function () {

        var acoesCargoFormCriarCargoObj = {
            formCargoNome: 'required',
        };

        return acoesCargoFormCriarCargoObj;

    },

    getObjFormCriarCargo: function () {

        var acoesCargoFormCriarCargoObj = {
            IdCargo: $('[name=idCargo]').val(),
            IdSite: $('[name=IdSite]').val(),
            NmNome: $('[name=formCargoNome]').val(),
            CargoProcessos: APP.controller.CargoController.getObjFormCargoProcessosArray(),
        };

        return acoesCargoFormCriarCargoObj;

    },

    getObjFormCargoProcessosArray: function () {

        var arrayAcoesCargoFormCriarCargoProcessosObj = [];
        $('[id^=form-cargo-processo-]').each(function () {
            $(this).find('input[id^=form-cargo-modulo-funcionalidade]:checked:not(:first-child)').each(function () {

                var acoesCargoFormCriarCargoProcessosbj = {
                    IdCargoProcesso: $(this).closest('div').find('[name=IdCargoProcesso]').val(),
                    IdCargo: $('[name=idCargo]').val(),
                    IdProcesso: $(this).closest('form').find('[name=formCargoProcessoIdProcesso]').val(),
                    IdFuncao: $(this).val()
                };

                arrayAcoesCargoFormCriarCargoProcessosObj.push(acoesCargoFormCriarCargoProcessosbj);
            });
        });

        return arrayAcoesCargoFormCriarCargoProcessosObj;

    },

    //Todos
    sendFormCriarCargo: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = APP.controller.CargoController.validateForms();

            //var validate = true;
            if (validate == true) {
                var cargoObj = APP.controller.CargoController.getCriarCargoObj();
                APP.controller.CargoController.saveFormCriarCargo(cargoObj);
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    getCriarCargoObj: function () {

        var cargoObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                switch (form) {
                    case "cargo":
                        cargoObj = APP.controller.CargoController.getObjFormCriarCargo();
                        break;
                }
            }

        });

        return cargoObj;

    },

    saveFormCriarCargo: function (cargo) {

        var idSite = $('[name=IdSite]').val();
        $.ajax({
            type: "POST",
            data: cargo,
            dataType: 'json',
            url: "/Cargo/Salvar",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = '/Cargo/Index/' + idSite';
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

};
/*
|--------------------------------------------------------------------------
| Controlador Cliente
|--------------------------------------------------------------------------
*/

APP.controller.ClienteController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "IndexCliente") {
            this.indexCliente();
        }
        if (page == "CriarCliente") {
            this.criarCliente();
        }

    },

    setup: function () {

        //Criar Cliente
        this.buttonSalvar = $(".btn-salvar");

    },

    //Models
    models: {
        ClienteModel: APP.model.Cliente,
        SiteModel: APP.model.Site,
        AnexoModel: APP.model.Anexo,
        ModuloModel: APP.model.Modulo,
        ProcessoModel: APP.model.Processo,
    },

    indexCliente: function () {

        APP.component.DataTable.init('#tb-index-cliente');
        APP.controller.ClienteController.setMsgIconeAtivo();
        APP.controller.ClienteController.setMsgIconeExcluirCliente();

    },

    setMsgIconeAtivo: function () {
        

    },

    getMsgIconeAtivo: function (_idCliente) {

        var erro = "";
        $.ajax({
            type: "POST",
            dataType: 'json',
            url: '/Cliente/AtivaInativa?id=' + _idCliente'',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    window.location.href = "/Cliente/Index";
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    setMsgIconeExcluirCliente: function () {
        

    },

    getMsgIconeExcluirCliente: function (_idCliente) {

        var erro = "";
        $.ajax({
            type: "POST",
            dataType: 'json',
            url: '/Cliente/Excluir?id=' + _idCliente',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    window.location.href = "/Cliente/Index";
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },


    criarCliente: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        APP.component.FileUpload.init();
        APP.component.Mascaras.init();
        this.setValidateForms();
        this.formCriarCliente();
        this.formCriarSite();
        this.formModulos();
        this.formProcessos();
        this.formCriarUsuario();

        this.sendFormCriarUsuario();

    },

    setValidateForms: function () {

        var ObjFormCriarClienteValidate = APP.controller.ClienteController.getObjFormCriarClienteValidate();
        APP.component.ValidateForm.init(ObjFormCriarClienteValidate, '#form-cria-cliente');

        var ObjFormCriarSiteValidate = APP.controller.ClienteController.getObjFormCriarSiteValidate();
        APP.component.ValidateForm.init(ObjFormCriarSiteValidate, '#form-cria-site');

        var ObjFormModulosValidate = APP.controller.ClienteController.getObjFormModulosValidate();
        APP.component.ValidateForm.init(ObjFormModulosValidate, '#form-modulos-acesso');

        var ObjFormProcessosValidate = APP.controller.ClienteController.getObjFormProcessosValidate();
        APP.component.ValidateForm.init(ObjFormProcessosValidate, '#form-processos');

        var ObjFormCriarUsuarioValidate = APP.controller.ClienteController.getObjFormCriarUsuarioValidate();
        APP.component.ValidateForm.init(ObjFormCriarUsuarioValidate, '#form-cria-usuario');

    },

    //Formulario Criar Cliente
    formCriarCliente: function () {

        this.setAndHideCriarCliente();

    },

    setAndHideCriarCliente: function () {

        //

    },

    getObjFormCriarClienteValidate: function () {
        var IdCliente = $('[name=IdCliente]').val();
        var criarClienteFormCriarClienteObj = {
            formCriaClienteLogo: $('[name=formCriaClienteLogo]').data('b64') != "" ? { required: false } : { required: true },
            formCriaClienteNome: { required: true, maxlength: 60 },
            formCriaClienteUrl: { required: true, maxlength: 60 },
            formCriaClienteDtValidade: 'required',
            //formCriaClienteTrocaSenha: 'required',
            //formCriaClienteBloquear: 'required',
            //formCriaClienteArmazenar: 'required',
            //formCriarClienteContrato: 'required',
        };

        return criarClienteFormCriarClienteObj;

    },


    getObjFormCriarCliente: function () {

        var clienteModel = this.models.ClienteModel;
        var anexoClienteModel = APP.controller.ClienteController.models.AnexoModel;


        var idCliente = $('[name=IdCliente]').val();
        var imgB64 = $('[name=formCriaClienteLogo]').prop('files').length != 0 ? $('[name=formCriaClienteLogo]').prop('files')[0].name : $('[name=formCriaClienteLogoNome]').val();

        var anexoLogoCliente = anexoClienteModel.constructor(
            $('[name=formCriaClienteLogoIdAnexo]').val(),
            imgB64,
            $('[name=formCriaClienteLogo]').data('b64')
        );

        var cliente = clienteModel.constructor(
            anexoLogoCliente,
            $('[name=formCriaClienteNome]').val(),
            $('[name=formCriaClienteUrl]').val(),
            $('[name=formCriaClienteDtValidade]').val(),
            $('[name=formCriaClienteTrocaSenha] :selected').val(),
            $('[name=formCriaClienteBloquear] :selected').val(),
            $('[name=formCriaClienteArmazenar] :selected').val(),
            APP.controller.ClienteController.getAnexosContratos(),
            $('[name=formCriaClienteAtivo]:checked').val(),
            $('[name=formCriaClienteCaptcha]:checked').val(),
            $('[name=formCriaClienteSenha]:checked').val(),
            idCliente == 0 ? APP.controller.ClienteController.getObjFormCriarUsuario() : null,
            idCliente
        );

        return cliente;

    },

    getAnexosContratos: function () {

        var anexoContratoModel = APP.controller.ClienteController.models.AnexoModel;
        var arrayAnexoContrato = [];

        $('.dashed li a:first-child').each(function () {

            var nameImg = $(this).text();
            var anexoContratoCliente = anexoContratoModel.constructor(
                $(this).closest('li').find('[name=formCriaClienteContratoIdAnexo]').val(),
                nameImg,
                $(this).data('b64')
            );

            arrayAnexoContrato.push(anexoContratoCliente);
        });

        return arrayAnexoContrato;

    },

    //Formulario Criar Site
    formCriarSite: function () {

        this.setAndHideCriarSite();

    },

    setAndHideCriarSite: function () {

        //

    },

    getObjFormCriarSiteValidate: function () {

        var criarClienteFormCriarSiteObj = {
            formCriaSiteLogo: $('[name=formCriaSiteLogo]').data('b64') != "" ? { required: false } : { required: true },
            formCriaSiteNome: { required: true, maxlength: 60 },
            formCriaSiteRazaoSocial: { required: true, maxlength: 60 },
            formCriaSiteCnpj: { required: true, cnpj: true },
            //formCriaSiteFrase: 'required',
            //formCriaSiteObservacoes: 'required',
        };

        return criarClienteFormCriarSiteObj;

    },

    getObjFormCriarSite: function () {

        return APP.controller.SiteController.getObjFormCriarSite();

    },

    //Formulario Modulos
    formModulos: function () {

        this.setAndHideModulos();
        //APP.component.ValidateForm.verifyGroupValidateChecked('formModulosAcessoEscolha');

    },

    setAndHideModulos: function () {

        //

    },

    getObjFormModulosValidate: function () {

        var criarClienteFormModulosObj = {
            //formModulosAcessoEscolha: {required: true, groupValidateChecked: true},
        };

        return criarClienteFormModulosObj;

    },

    getObjFormModulos: function () {

        var arrayCriarClienteFormModulosObj = [];
        $('[name=formModulosAcessoEscolha]:checked').each(function (i) {
            var criarClienteFormModulosObj = {
                IdFuncionalidade: $(this).val(),
            };
            arrayCriarClienteFormModulosObj.push(criarClienteFormModulosObj);
        });
        return arrayCriarClienteFormModulosObj;

    },

    //Formulario Processos
    formProcessos: function () {

        this.setAndHideProcessos();
        this.setProcesso();
        this.delProcesso();

    },

    setAndHideProcessos: function () {

        //

    },

    setProcesso: function () {

        $('.btn-add-processo').unbind('click');
        $('.btn-add-processo').on('click', function () {

            var msgProcessosNomeLabel = $('[name=msgProcessosNomeLabel]').val();
            var msgProcessosNomePlaceholder = $('[name=msgProcessosNomePlaceholder]').val();
            var msgProcessosNomeRequired = $('[name=msgProcessosNomeRequired]').val();
            var msgProcessosNomeRequiredMaxlength = $('[name=msgProcessosNomeRequiredMaxlength]').val();
            var msgProcessosAtivo = $('[name=msgProcessosAtivo]').val();
            var msgIconeExcluir = $('[name=msgIconeExcluir]').val();

            var index = $('#tb-processos tbody tr').size();

            var html = '';
            html += '<tr role="row" class="odd">';
            html += '<td>';
            html += '<div class="form-group">';
            html += '<input type="text" name="formProcessosNome" id="form-processos-nome-' + index + '" class="form-control"';
            html += 'placeholder="' + msgProcessosNomePlaceholder + '"';
            html += 'data-msg-required="' + msgProcessosNomeRequired + '"';
            html += 'data-msg-maxlength="' + msgProcessosNomeRequiredMaxlength + '"';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<div class="form-group checkbox">';
            html += '<input type="checkbox" name="formProcessosAtivo-' + index + '" id="form-processos-ativo-' + index + '" class="form-control" value="true">';
            html += '<label for="form-processos-ativo-' + index + '">' + msgProcessosAtivo + '</label>';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<a href="#" class="btn-delete-processo icon-cliente trash-color">';
            html += '<i class="fa fa-trash" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</a>';
            html += '</td>';
            html += '</tr>';

            $('#tb-processos tbody').append(html);
            APP.controller.ClienteController.bindProcesso();

        });

    },

    delProcesso: function () {

        $('.btn-delete-processo').on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });

    },

    getObjFormProcessosValidate: function () {

        var criarClienteFormProcessosObj = {
            formProcessosNome: { required: true, maxlength: 60 }
        };

        return criarClienteFormProcessosObj;

    },

    getObjFormProcessos: function () {

        var arrayCriarClienteFormProcessosObj = [];
        var table = $('#tb-processos tbody tr');
        table.each(function () {

            var criarClienteFormProcessosObj = {
                Nome: $(this).find('[name=formProcessosNome]').val(),
                FlAtivo: $(this).find('[name^=formProcessosAtivo]').is(':checked'),
            };

            arrayCriarClienteFormProcessosObj.push(criarClienteFormProcessosObj);

        });

        return arrayCriarClienteFormProcessosObj;

    },

    bindProcesso: function () {

        APP.controller.ClienteController.delProcesso();
        APP.controller.ClienteController.setValidateForms();

    },

    //Formulario Criar Usuario
    formCriarUsuario: function () {

        this.setAndHideCriarUsuario();

    },

    setAndHideCriarUsuario: function () {

        //

    },

    getObjFormCriarUsuarioValidate: function () {

        var criarClienteFormCriarUsuarioObj = {
            //formCriaUsuarioLogo: {required: true, extension: "jpg|jpeg|png|gif"},
            formCriaUsuarioResponsavel: { required: true, maxlength: 30 },
            //formCriaUsuarioSexo: 'required',
            formCriaUsuarioEmail: { required: true, maxlength: 60, email: true },
            formCriaUsuarioCpf: { cpf: true },
            formCriaUsuarioDtExpiracao: 'required',
            //formCriaUsuarioEscolhaEmail: 'required',
            //formCriaUsuarioEscolhaCompartilhado: 'required',
            //formCriaUsuarioEscolhaAtivo: 'required',
            //formCriaUsuarioEscolhaBloqueado: 'required',
        };

        return criarClienteFormCriarUsuarioObj;

    },

    getObjFormCriarUsuario: function () {

        return APP.controller.UsuarioController.getObjFormCriarUsuario();

    },

    //Todos
    sendFormCriarUsuario: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = APP.controller.ClienteController.validateForms();
            var typeSave = $('[name=IdCliente]').val() > 0 ? 'edit' : 'create';

            //validate = true;
            if (validate == true) {

                var clienteObj = APP.controller.ClienteController.getCriarClienteObj();
                if (typeSave == 'create') {
                    APP.controller.ClienteController.saveFormCriarCliente(clienteObj);
                } else {
                    APP.controller.ClienteController.saveFormEditarCliente(clienteObj);
                }
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    getCriarClienteObj: function () {

        var clienteObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];

                switch (form) {
                    case "cliente":
                        clienteObj = APP.controller.ClienteController.getObjFormCriarCliente();
                        break;
                    case "site":
                        clienteObj.Site = APP.controller.ClienteController.getObjFormCriarSite();
                        break;
                }
            }

        });

        return clienteObj;

    },

    saveFormCriarCliente: function (clientes) {

        var erro = "";
        $.ajax({
            type: "POST",
            data: clientes,
            dataType: 'json',
            url: "/Cliente/Criar",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/Cliente/Index";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    saveFormEditarCliente: function (clientes) {

        var erro = "";
        $.ajax({
            type: "POST",
            data: clientes,
            dataType: 'json',
            url: "/Cliente/Editar",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/Cliente/Index";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

};
/*
|--------------------------------------------------------------------------
| Control Doc
|--------------------------------------------------------------------------
*/

APP.controller.ControlDocController = {

    init: function () {
        var page = APP.component.Util.getPage();

        this.setup();
        APP.component.MenuSideBar.init();

        if (page == "ListDocumentos") {
            this.listDocumentos();
        }
        if (page == "EmissaoDocumento") {

            if (this.IdDocumento.val() != 0) {
                this.emissaoDocumentoEdicao();
            } else {
                this.emissaoDocumento();
            }
        }

        if (page == "ConteudoDocumento") {
            this.setEditorFormFluxo();
            this.setImprimirDocumento();
            this.imprimir();
        }

        $(document).on("change", "#ddlCopiaControlada", function () {
            
            var copiaControlada = this.value;

            if (copiaControlada == "true")
            {
                $(".usuarioDestinoCopiaControlada").show();
            }
            else
            {
                $(".usuarioDestinoCopiaControlada").hide();
            }

            APP.controller.ControlDocController.models.iscontrolada = copiaControlada;

        });

        $(document).on("change", "#ddlUsuarioDestino", function () {
            
            APP.controller.ControlDocController.models.idusuariodestino = this.value;
        });
    },

    setup: function () {


        //Control Doc - EmissaoDocumento
        this.buttonTabs = $(".menu-one li");
        this.buttonSalvar = $('.btn-salvar');
        this.buttonEnviarVerificacao = $('.btn-enviar-verificacao');
        this.buttonEnviarAprovacao = $('.btn-enviar-aprovacao');
        this.buttonVoltarElaboracao = $('.btn-voltar-elaboracao');
        this.buttonAprovar = $('.btn-aprovar');

        //Control Doc - ListDocumentos
        this.buttonExcluirDocumento = $(".excluir-documento");

        //Control Doc - Impressao Documentos
        this.buttonImprimirDocumento = $(".imprimir-documento");

        //Control Doc - REGISTROS
        this.buttonAddNovoRegistroFormRegistro = $('.form-registros-add-registro');
        this.buttonSaveNovoRegistroFormRegistro = $('.salvar-form-registros');
        this.buttonEditNovoRegistroFormRegistro = $('.editar-form-registros');
        this.buttonDelNovoRegistroFormRegistro = $('.excluir-form-registros');

        //Control Doc - ROTINAS
        this.buttonAddNovaRotinaFormRotina = $('.form-rotina-add-rotina');
        this.buttonSaveNovaRotinaFormRotina = $('.salvar-form-rotina');
        this.buttonEditNovaRotinaFormRotina = $('.editar-form-rotina');
        this.buttonDelNovaRotinaFormRotina = $('.excluir-form-rotina');

        //Control Doc - INDICADORES
        this.buttonAddNovaIndicadoresFormIndicadores = $('.form-rotina-add-indicadores');
        this.buttonDelNovaIndicadoresFormIndicadores = $('.excluir-form-indicadores');
        this.buttonSaveNovaIndicadoresFormIndicadores = $('.salvar-form-indicadores');
        this.buttonEditNovaIndicadoresFormIndicadores = $('.editar-form-indicadores');


        //Control Doc - UPLOAD
        this.buttonAddUploadFormUpload = $('.form-upload-add-upload');
        this.buttonDelUploadFormUpload = $('.excluir-form-upload');

        //Control Doc - ASSUNTOS
        this.buttonAddNovoAssuntoFormAssuntos = $('.form-assuntos-add-assunto');
        this.buttonSaveNovoAssuntoFormAssuntos = $('.salvar-form-assuntos');
        this.buttonEditNovoAssuntoFormAssuntos = $('.editar-form-assuntos');
        this.buttonDelAssuntoFormAssuntos = $('.excluir-form-assuntos');

        //Control Doc - COMENTARIOS
        this.buttonAddNovaMensagemFormComentarios = $('.btn-form-comentario-enviar');

        //IdDocumento
        this.IdDocumento = $("#emissao-documento-IdDocumento");

    },

    models: {
        AnexoModel: APP.model.Anexo,
        iscontrolada: null,
        idusuariodestino: null,
        idDocumento: null
    },

    //Chamadas
    listDocumentos: function () {

        APP.component.DataTable.init("#tb-list-documentos");
        this.setRevisarDocumento();
        this.setExcluirDocumento();
        this.setImprimirDocumento();
        this.imprimir();
    },

    changeCadastroSigla: function () {

        $('[name=formCadastroSigla]').change(function () {

            var sigla = $(this).val();

            $.post('/ControlDoc/RetornaNumeroPorSigla/' + sigla, function (data, status) { }).done(function (data) {
                if (data.StatusCode == "200") {
                 
                    $('[name=formCadastroNmDocumento]').val(data.Retorno);
                 
                }                
            });

        });

    },

    setImprimirDocumento: function () {
       
        var tabela = $("#tb-list-documentos").DataTable();

        this.buttonImprimirDocumento.unbind('click');
        this.buttonImprimirDocumento.bind('click', function () {
            $(".usuarioDestinoCopiaControlada").show();
            event.preventDefault();
            APP.controller.ControlDocController.models.idDocumento = $(this).data("iddocumento");
            var perfil = $(this).data("perfil");
            var $rowAtual = $(this).parents("tr");

            if (perfil == "1" || perfil == "3") {

                var modal = bootbox.dialog({
                    title: "Impressão de Documentos",
                    message: $(".modal-impressao").html(),
                    buttons: [
                        {
                            label: _options.BtnImprimir,
                            className: "btn btn-primary pull-right",
                            callback: function () {
                                APP.controller.ControlDocController.imprimir(APP.controller.ControlDocController.models.idDocumento, true);
                            }
                        },
                        {
                            label: _options.botao_cancelar,
                            className: "btn btn-default pull-right",
                            callback: function () {
                                modal.modal("hide");
                            }
                        }
                    ],
                    show: false,
                    onEscape: function () {
                        modal.modal("hide");
                    }
                });
                modal.modal("show");
            }
            else {
                APP.controller.ControlDocController.models.iscontrolada = null;
                APP.controller.ControlDocController.models.idusuariodestino = null;
                APP.controller.ControlDocController.imprimir(APP.controller.ControlDocController.models.idDocumento, false);
            }
            });
    },

    imprimir: function (idDocumento, possuiPerfilControle) {

        

        if (idDocumento != null) {

            APP.component.Loading.showLoading();

            var isControlada = null;
            idUsuarioDestino = null;

            if (possuiPerfilControle) {
                isControlada = APP.controller.ControlDocController.models.iscontrolada == null ? $("#ddlCopiaControlada").val() : APP.controller.ControlDocController.models.iscontrolada;
                idUsuarioDestino = APP.controller.ControlDocController.models.idusuariodestino == null ? $("#ddlUsuarioDestino").val() : APP.controller.ControlDocController.models.idusuariodestino;
            } else {
                isControlada = false;
                idUsuarioDestino = "";
            }

            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/ControlDoc/DownloadPdf?id=' + idDocumento + '&controlada=' + isControlada + '&usuarioDest=' + idUsuarioDestino, true);
            xhr.responseType = 'arraybuffer';
            xhr.onload = function (e) {
                if (this.status == 200) {
                    var blob = new Blob([this.response], { type: "application/pdf" });
                    var pdfUrl = URL.createObjectURL(blob);
                    printJS(pdfUrl);
                }
                APP.controller.ControlDocController.models.iscontrolada = null;
                APP.controller.ControlDocController.models.idusuariodestino = null;
                
                APP.component.Loading.hideLoading();
            
            };

            xhr.send();

            
            
        }
    },

    setExcluirDocumento: function () {

        var tabela = $('#tb-list-documentos').DataTable();

        this.buttonExcluirDocumento.unbind('click');
        this.buttonExcluirDocumento.bind('click', function () {
            event.preventDefault();

            var idDocumento = $(this).data("iddocumento");

            var $rowAtual = $(this).parents('tr');

            bootbox.confirm(_options.MsgDesejaExcluirRegistro, function (result) {
                if (result) {
                    $.post('/ControlDoc/Excluir/' + idDocumento, function (data, status) { }).done(function (data) {
                        if (data.StatusCode == "200") {
                            tabela.row($rowAtual).remove().draw();
                            bootbox.alert(_options.MsgRegistroExcluidoSucesso);
                        }
                        if (data.StatusCode == "500") {
                            bootbox.alert(_options.MsgErroExclusaoRegistro);
                        }
                    });
                }
            });
        });

    },

    setRevisarDocumento: function () {
        $('.controldoc-revisar').on('click', function () {
            var erro = "";


            var idDoc = $(this).data('id-doc');

            $.ajax({
                type: "POST",
                dataType: 'json',
                url: '/ControlDoc/Revisar?Id=' + idDoc'',
                beforeSend: function () {
                    APP.component.Loading.showLoading();
                },
                success: function (result) {
                    if (result.StatusCode == 200) {
                        window.location.href = "/ControlDoc/DocumentosElaboracao";
                    }
                    else if (result.StatusCode == 505) {
                        erro = APP.component.ResultErros.init(result.Erro);
                        bootbox.alert(erro);
                    } else if (result.StatusCode == 500) {
                        erro = APP.component.ResultErros.init(result.Erro);
                        bootbox.alert(erro);
                    }

                },
                error: function (result) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                },
                complete: function (result) {
                    APP.component.Loading.hideLoading();
                }
            });

        });

    },

    //Criar
    emissaoDocumento: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        APP.component.FileUpload.init();
        this.setValidateForms();
        this.setHideAndShow();
        this.getTabs();
        this.getEscolhaPanel();
        this.formCadastro();
        this.formTexto();
        this.formFluxo();
        this.formRegistro();
        this.formIndicadores();
        this.formRotina();
        this.formRecursos();
        this.formUpload();
        this.formRiscos();
        this.formLicenca();
        this.formDocsExternos();
        this.formAssuntos();
        this.formComentarios();
        this.formCargos();
        this.setCargosEmissaoDocumentos();

        this.sendFormEmissaoDocumento();
        this.sendFormEmissaoDocumentoVerificacao();
        this.sendFormEmissaoDocumentoAprovacao();
        this.sendFormEmissaoDocumentoElaboracao();
        this.changeCadastroSigla();
        //this.setValidateFormEmissaoDocumentoCadastro();

    },

    emissaoDocumentoEdicao: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        this.formCadastro();
        this.setHideAndShowEdit();
        this.getTabs();
        this.getEscolhaPanel();
        this.formTexto();
        this.formFluxo();
        this.formRegistro();
        this.formRotina();
        this.formRecursos();
        this.formUpload();
        this.formRiscos();
        this.formLicenca();
        this.formDocsExternos();
        this.formAssuntos();
        this.formComentarios();
        this.formCargos();
        this.setCargosEmissaoDocumentos();
        this.setWorkFlow();
        APP.controller.ControlDocController.getTemasCores();

        this.sendFormEmissaoDocumento();
        this.sendFormEmissaoDocumentoVerificacao();
        this.sendFormEmissaoDocumentoAprovacao();
        this.sendFormEmissaoDocumentoElaboracao();
        this.sendFormEmissaoDocumentoAprovado();
        this.changeCadastroSigla();
        //HIde and show Templates
        this.setShowTemplatesEmissaoDocumento();

        //$("#form-emissao-documento-texto").show();
        $('[name=formRiscosNecessitaAcao]').trigger('change');
        $('[name=formCadastroWorkflow]').trigger('change');

        this.setImprimirDocumento();
        this.imprimir();
    },

    //Funcoes Emissao Documento
    setValidateForms: function () {

        var ObjFormCadastroValidate = APP.controller.ControlDocController.getObjFormCadastroValidate();
        APP.component.ValidateForm.init(ObjFormCadastroValidate, '#form-emissao-documento-cadastro');

    },

    setHideAndShow: function () {

        var statusEtapa = parseInt($('[name=StatusEtapa]').val());

        //Hide All
        $('[id^=panel-form-]').hide();
        $('[id^=panel-tab-]').hide();
        $('#panel-form-cadastro').show();
        $('.btn-enviar-verificacao').hide();
        $('.btn-enviar-aprovacao').hide();
        $('.btn-voltar-elaboracao').hide();
        $('.btn-aprovar').hide();

        var getWorkFlow = $('[name=formCadastroWorkflow]').val();

        if (getWorkFlow == 'true') {

            if(statusEtapa != 0)
            {
                
                $('[name=StatusEtapa]').prop('disabled', true);

            }
            
            switch (statusEtapa) {
                case 0:
                    $('.um').hide();
                    $('.dois').hide();
                    $('.tres').hide();
                    break;
                case 1:
                    this.setDisableVerificacao();
                    $('.btn-enviar-verificacao').hide();
                    $('.btn-voltar-elaboracao').show();
                    break;
                case 2:
                    $('.btn-enviar-aprovacao').show();
                    $('.btn-voltar-elaboracao').show();
                    break;
            }
        }



    },

    getTabs: function () {
        $('a[data-toggle="tab"]').on('click', function (e) {
            var target = $(e.target).attr("href");
        });
    },

    getEscolhaPanel: function () {

        $('[id^=form-cadastro-escolha]').unbind('click');
        $('[id^=form-cadastro-escolha]').on('click', function () {

            var panel = $(this).attr('id').split('-');
            $('#panel-tab-' + panel[3]).slideToggle();
            $('#panel-form-' + panel[3]).slideToggle();

            var tam = 0;
            setTimeout(function () {
                tam = $('[id^=panel-tab-]:visible').size();
                setTimeout(function () {
                    APP.controller.ControlDocController.setTabs(tam);

                }, 1);
            }, 500);

        });

    },

    setTabs: function (_tam) {

        switch (_tam) {
            case 0:
                $('#panel-tab-cadastro').slideToggle();
                break;
            case 1:
                $('#panel-tab-cadastro').slideToggle();
                $('[id^=panel-tab-]:visible').css('width', '50%');
                break;
            case 2:
                $('[id^=panel-tab-]:visible').css('width', '50%');
                break;
            case 3:
                $('[id^=panel-tab-]:visible').css('width', '33.3%');
                break;
            case 4:
                $('[id^=panel-tab-]:visible').css('width', '25%');
                break;
            case 5:
                $('[id^=panel-tab-]:visible').css('width', '20%');
                break;
            case 6:
                $('[id^=panel-tab-]:visible').css('width', '16.6%');
                break;
            case 7:
                $('[id^=panel-tab-]:visible').css('width', '14.2%');
                break;
            case 8:
                $('[id^=panel-tab-]:visible').css('width', '12.5%');
                break;
            case 9:
                $('[id^=panel-tab-]:visible').css('width', '11.1%');
                break;
            case 10:
                $('[id^=panel-tab-]:visible').css('width', '10%');
                break;
            default:

        }

    },

    validateForms: function () {

        var arrayFormValidate = [];
        var validate = {};
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                validate = {

                    valid: $(this).closest('form').valid(),
                };
                arrayFormValidate.push(validate);
            }
        });

        return arrayFormValidate;

    },

    sendFormEmissaoDocumento: function () {
        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = [];
            var ValidateOK = true;

            validate = APP.controller.ControlDocController.validateForms();

            for (i = 0; i < validate.length; i++) {
                if (validate[i].valid != true) {
                    ValidateOK = false;
                }
            }

            //ValidateOK = true;
            if (ValidateOK == true) {

                var emissaoDocumento = APP.controller.ControlDocController.getEmissaoDocumentoObj();

                if ($("#emissao-documento-IdDocumento").val() != 0) {

                    emissaoDocumento.Assuntos = APP.controller.ControlDocController.getObjFormAssuntos();
                    emissaoDocumento.Comentarios = APP.controller.ControlDocController.getObjFormComentarios();
                }

                var statusEtapa = parseInt($('[name=StatusEtapa]').val());
                var workFlow = $("[name=formCadastroWorkflow]").val();
                
                if (workFlow == "sim")
                {
                    statusEtapa = 3;
                }

                APP.controller.ControlDocController.saveFormEmissaoDocumento(emissaoDocumento, statusEtapa);
            }

        });

    },

    getEmissaoDocumentoObj: function (_statusEmissaoDocumento) {

        var formEmissaoDocumentoCadastro = $('#form-emissao-documento-cadastro');
        var formEmissaoDocumentoTexto = $('#form-emissao-documento-texto');
        var formEmissaoDocumentoFluxo = $('#form-emissao-documento-fluxo');
        var formEmissaoDocumentoRegistros = $('#form-emissao-documento-registros');
        var formEmissaoDocumentoRotina = $('#form-emissao-documento-rotina');
        var formEmissaoDocumentoRecursos = $('#form-emissao-documento-recursos');
        var formEmissaoDocumentoUpload = $('#form-emissao-documento-upload');
        var formEmissaoDocumentoRiscos = $('#form-emissao-documento-riscos');
        var formEmissaoDocumentoLicenca = $('#form-emissao-documento-licenca');
        var formEmissaoDocumentoDocsExternos = $('#form-emissao-documento-docsexternos');
        var formEmissaoDocumentoAssuntos = $('#form-emissao-documento-assuntos');
        var formEmissaoDocumentoComentarios = $('#form-emissao-documento-comentarios');
        var formEmissaoDocumentoCargos = $('#form-emissao-documento-cargos');

        var formEmissaoDocumentoIndicadores = $('#form-emissao-documento-indicadores');

        var emissaoDocumentoObj = {};

        var ConteudoDocumento = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                switch (form) {
                    case "cadastro":
                        emissaoDocumentoObj = APP.controller.ControlDocController.getObjFormCadastro(_statusEmissaoDocumento);
                        break;
                    case "texto":
                        emissaoDocumentoObj.TextoDoc = APP.controller.ControlDocController.getObjFormTexto();
                        break;
                    case "fluxo":
                        emissaoDocumentoObj.FluxoDoc = APP.controller.ControlDocController.getObjFormFluxo();
                        break;
                    case "registros":
                        emissaoDocumentoObj.Registros = APP.controller.ControlDocController.getObjFormRegistro();
                        break;
                    case "rotina":
                        emissaoDocumentoObj.Rotinas = APP.controller.ControlDocController.getObjFormRotina();
                        break;
                    case "recursos":
                        emissaoDocumentoObj.RecursoDoc = APP.controller.ControlDocController.getObjFormRecursos();
                        break;
                    case "riscos":
                        emissaoDocumentoObj.GestaoDeRisco = APP.controller.ControlDocController.getObjFormRiscos();
                        emissaoDocumentoObj.CorRisco = $('[name=formRiscosCorDoRisco]:checked').val();
                        emissaoDocumentoObj.PossuiGestaoRisco = $('[name=formRiscosNecessitaAcao]:checked').val();
                        break;
                    case "licenca":
                        emissaoDocumentoObj.Licenca = APP.controller.ControlDocController.getObjFormLicenca();
                        break;
                    case "docsexternos":
                        emissaoDocumentoObj.DocExterno = APP.controller.ControlDocController.getObjFormDocsExternos();
                        break;
                    case "indicadores":
                        emissaoDocumentoObj.Indicadores = APP.controller.ControlDocController.getObjFormIndicadores();
                        break;
                }
            }
        });

        emissaoDocumentoObj.ConteudoDocumento = ConteudoDocumento;
        emissaoDocumentoObj.DocCargo = APP.controller.ControlDocController.getObjFormCargos();

        return emissaoDocumentoObj;
    },

    aux: { IdDocumento: '' },

    saveFormEmissaoDocumento: function (emissaoDocumento, _statusEtapa) {
        var url = "/ControlDoc/Salvar/";
        var eEdicao = false;

        if (this.IdDocumento.val() != 0) {
            eEdicao = true;
        }

        $.ajax({
            type: "POST",
            data: { "doc": emissaoDocumento, "status": _statusEtapa },
            dataType: 'json',
            url: url,
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {


                APP.controller.ControlDocController.aux.IdDocumento = result.IdDocumento;
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        if (!emissaoDocumento.FlWorkFlow) {
                            window.location.href = "/ControlDoc/DocumentosAprovados";
                            return;
                        }
                        if (eEdicao) {
                            //window.location.href = "/ControlDoc/ListDocumentosVerificacao";
                            return;
                        }
                        window.location.href = "/ControlDoc/Editar/" + APP.controller.ControlDocController.aux.IdDocumento;
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });
        //}

    },

    sendFormEmissaoDocumentoVerificacao: function (emissaoDocumento) {

        this.buttonEnviarVerificacao.unbind('click');
        this.buttonEnviarVerificacao.on('click', function () {

            var emissaoDocumento = APP.controller.ControlDocController.getEmissaoDocumentoObj(1);
            emissaoDocumento.Assuntos = APP.controller.ControlDocController.getObjFormAssuntos();
            emissaoDocumento.Comentarios = APP.controller.ControlDocController.getObjFormComentarios();

            APP.controller.ControlDocController.saveFormEmissaoDocumentoEtapaVerificacao(emissaoDocumento);
        });

    },

    saveFormEmissaoDocumentoEtapaVerificacao: function (emissaoDocumento) {

        var erro = "";

        $.ajax({
            type: "POST",
            data: emissaoDocumento,
            dataType: 'json',
            url: '/ControlDoc/EnviarDocumentoParaVerificacao',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/ControlDoc/DocumentosVerificacao";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    sendFormEmissaoDocumentoAprovacao: function (emissaoDocumento) {
        this.buttonEnviarAprovacao.unbind('click');
        this.buttonEnviarAprovacao.on('click', function () {

            var emissaoDocumento = APP.controller.ControlDocController.getEmissaoDocumentoObj(2);
            emissaoDocumento.Assuntos = APP.controller.ControlDocController.getObjFormAssuntos();
            emissaoDocumento.Comentarios = APP.controller.ControlDocController.getObjFormComentarios();

            APP.controller.ControlDocController.saveFormEmissaoDocumentoEtapaAprovacao(emissaoDocumento);
        });
    },

    saveFormEmissaoDocumentoEtapaAprovacao: function (emissaoDocumento) {

        $.ajax({
            type: "POST",
            data: emissaoDocumento,
            dataType: 'json',
            url: '/ControlDoc/EnviarParaAprovacao',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/ControlDoc/DocumentosAprovacao";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });
    },

    saveFormEmissaoDocumentoEtapaAprovar: function (documento) {

        $.ajax({
            type: "POST",
            data: documento,
            dataType: 'json',
            url: '/ControlDoc/EnviarParaAprovado',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/ControlDoc/DocumentosAprovados";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });
    },

    sendFormEmissaoDocumentoElaboracao: function (emissaoDocumento) {

        this.buttonVoltarElaboracao.unbind('click');
        this.buttonVoltarElaboracao.on('click', function () {

            var emissaoDocumento = APP.controller.ControlDocController.getEmissaoDocumentoObj(0);
            emissaoDocumento.Assuntos = APP.controller.ControlDocController.getObjFormAssuntos();
            emissaoDocumento.Comentarios = APP.controller.ControlDocController.getObjFormComentarios();

            APP.controller.ControlDocController.saveFormEmissaoDocumentoEtapaVoltarElaboracao(emissaoDocumento);

        });

    },

    saveFormEmissaoDocumentoEtapaVoltarElaboracao: function (emissaoDocumento) {
        $.ajax({
            type: "POST",
            data: emissaoDocumento,
            dataType: 'json',
            url: '/ControlDoc/EnviarParaElaboracao',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {

                        window.location.href = "/ControlDoc/DocumentosElaboracao";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });
    },

    sendFormEmissaoDocumentoAprovado: function () {
        this.buttonAprovar.unbind('click');
        this.buttonAprovar.on('click', function () {
            var idDocumento = $("#emissao-documento-IdDocumento").val();

            var emissaoDocumento = APP.controller.ControlDocController.getEmissaoDocumentoObj(1);
            emissaoDocumento.Assuntos = APP.controller.ControlDocController.getObjFormAssuntos();
            emissaoDocumento.Comentarios = APP.controller.ControlDocController.getObjFormComentarios();

            APP.controller.ControlDocController.saveFormEmissaoDocumentoEtapaAprovar(emissaoDocumento);
        });
    },

    //Formulario CADASTRO
    formCadastro: function () {

        //Preenchimento dos Combos
        this.setComboSigla();
        this.setSigla();
        this.setCategoria();
        this.setComboCategoria();


        this.setComboProcesso();
        this.setElaborador();
        this.setComboVerificador();
        this.setComboAprovador();
        this.getChangeComboProcesso();
        this.getRadioFormCadastroRevisaoPeriodica();
        this.getRadioFormCadastroWorkflow();

        //ConstruÃ§Ã£o OBJ
        //this.getObjFormCadastro();

        // Hide OR Show de Campos do Formulario
        this.setHideAndShowFormCadastro();
    },

    setHideAndShowFormCadastro: function () {

        $('#form-cadastro-dt-notificacao').closest('.form-group').hide();
        $('#form-cadastro-verificador').closest('.form-group').hide();
        $('#form-cadastro-aprovador').closest('.form-group').hide();

    },

    setComboSigla: function () {

        var idSite = $('#emissao-documento-site').val();
        let idFuncao = 15;
        var dataTipo = $("#form-cadastro-sigla").closest('div').find('i').data("tipo");
        var dataSite = $("#form-cadastro-sigla").closest('div').find('i').data("site");
        var data = {
            "tipo": dataTipo,
            "site": dataSite
        };

        $.ajax({
            type: "GET",
            dataType: 'JSON',
            data: data,
            url: '/ControladorCategorias/ListaAtivos',
            success: function (result) {
                if (result.StatusCode == 202) {
                    APP.component.SelectListCompare.init(result.Lista, $('[name=formCadastroSigla] option'), '#form-cadastro-sigla', 'IdControladorCategorias', 'Descricao');
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
        });
    },

    setSigla: function () {

        $('.add-sigla').on('click', function () {

            APP.component.BootBox.chamaBootBox("Cadastro",
                "ControladorCategorias",
                "pnlCadUsu",
                APP.controller.ControladorCategoriasController.behavior,
                "Cadastro",
                APP.controller.ControlDocController.setComboSigla,
                ".add-sigla");

        });

    },

    setComboProcesso: function () {

        var idSite = $('#emissao-documento-site').val();
        var data = {
            "idSite": idSite
        };

        $.ajax({
            type: "GET",
            dataType: 'JSON',
            data: data,
            url: '/Processo/ListaProcessosPorSite',
            success: function (result) {
                if (result.StatusCode == 200) {
                    APP.component.SelectListCompare.init(result.Lista, $('[name=formCadastroProcesso] option'), '#form-cadastro-processo', 'IdProcesso', 'Nome');
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
        });

    },

    setComboCategoria: function () {

        var idSite = $('#emissao-documento-site').val();
        let idFuncao = 15;
        var dataTipo = $("#form-cadastro-categoria").closest('div').find('i').data("tipo");
        var dataSite = $("#form-cadastro-categoria").closest('div').find('i').data("site");
        var data = {
            "tipo": dataTipo,
            "site": dataSite
        };

        $.ajax({
            type: "GET",
            dataType: 'JSON',
            data: data,
            url: '/ControladorCategorias/ListaAtivos',
            success: function (result) {
                if (result.StatusCode == 202) {
                    APP.component.SelectListCompare.init(result.Lista, $('[name=formCadastroCategoria] option'), '#form-cadastro-categoria', 'IdControladorCategorias', 'Descricao');
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
        });
    },

    setCategoria: function () {

        $('.add-categoria').on('click', function () {

            APP.component.BootBox.chamaBootBox("Cadastro",
                "ControladorCategorias",
                "pnlCadUsu",
                APP.controller.ControladorCategoriasController.behavior,
                "Cadastro",
                APP.controller.ControlDocController.setComboCategoria,
                ".add-categoria");

        });

    },

    setElaborador: function () {

        var idSite = $('#emissao-documento-site').val();
        let idFuncao = 3;
        var data = {
            "idSite": idSite,
            "idFuncao": idFuncao
        };

        $.ajax({
            type: "GET",
            dataType: 'JSON',
            data: data,
            url: '/Usuario/ObterUsuariosPorFuncao',
            beforeSend: function () {

            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    APP.component.SelectListCompare.init(result.Lista, $('[name=formCadastroElaborador] option'), '#form-cadastro-elaborador', 'IdUsuario', 'NmCompleto');
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {

            }
        });

        var eColaborador = $('#emissao-documento-e-colaborador').val();
        var IdUsuarioLogado = $('#emissao-documento-id-usuario-logado').val();
        if (eColaborador == "true") {
            $('[name=formCadastroElaborador]').prop('disabled', true);
            $('[name=formCadastroElaborador]').val(IdUsuarioLogado);
        }

    },

    setComboVerificador: function (_IdProcesso) {

        var idSite = $('#emissao-documento-site').val();
        let idFuncao = 101;
        var data = "";
        var url = "";

        if (_IdProcesso != 0 && _IdProcesso != undefined) {
            url = '/Usuario/ObterUsuariosPorFuncaoSiteEProcesso';
            data = {
                "idProcesso": _IdProcesso,
                "idSite": idSite,
                "idFuncao": idFuncao
            };
        } else {
            url = '/Usuario/ObterUsuariosPorFuncao';
            data = {
                "idSite": idSite,
                "idFuncao": idFuncao
            };
        }

        $.ajax({
            type: "GET",
            dataType: 'JSON',
            data: data,
            url: url,
            beforeSend: function () {

            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    APP.component.SelectListCompare.init(result.Lista, $('[name=formCadastroVerificador] option'), '#form-cadastro-verificador', 'IdUsuario', 'NmCompleto');
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {

            }
        });

    },

    setComboAprovador: function (_IdProcesso) {

        var idSite = $('#emissao-documento-site').val();
        let idFuncao = 102;
        var data = "";
        var url = "";

        if (_IdProcesso != 0 && _IdProcesso != undefined) {
            url = '/Usuario/ObterUsuariosPorFuncaoSiteEProcesso';
            data = {
                "idProcesso": _IdProcesso,
                "idSite": idSite,
                "idFuncao": idFuncao
            };
        } else {
            url = '/Usuario/ObterUsuariosPorFuncao';
            data = {
                "idSite": idSite,
                "idFuncao": idFuncao
            };
        }

        $.ajax({
            type: "GET",
            dataType: 'JSON',
            data: data,
            url: url,
            beforeSend: function () {

            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    APP.component.SelectListCompare.init(result.Lista, $('[name=formCadastroAprovador] option'), '#form-cadastro-aprovador', 'IdUsuario', 'NmCompleto');
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {

            }
        });

    },

    getChangeComboProcesso: function () {

        $('#form-cadastro-processo').on('change', function () {
            var IdProcesso = $(this).val();
            if (IdProcesso == 0) {
                IdProcesso = null;
            }

            APP.controller.ControlDocController.setComboVerificador(IdProcesso);
            APP.controller.ControlDocController.setComboAprovador(IdProcesso);
            APP.controller.ControlDocController.getResponsavel(IdProcesso);

        });

    },

    getRadioFormCadastroRevisaoPeriodica: function () {

        $('[name=formCadastroRevisaoPeriodica]').on('change', function () {

            var RadioFormCadastroRevisaoPeriodica = APP.component.Radio.init('formCadastroRevisaoPeriodica');

            if (RadioFormCadastroRevisaoPeriodica != "sim") {
                $('#form-cadastro-dt-notificacao').closest('.form-group').hide();
            } else {
                $('#form-cadastro-dt-notificacao').closest('.form-group').show();
            }
        });
    },

    getRadioFormCadastroWorkflow: function () {
        $('[name=formCadastroWorkflow]').on('change', function () {
            APP.controller.ControlDocController.hideOrShowWorkFlow();
        });
    },

    getFormCadastroVerificadores: function () {

        var objVerificadores = [];

        // Objeto Verificadores
        $('[name=formCadastroVerificador] :selected').each(function () {
            var verificador = {
                IdUsuario: $(this).val(),
                TpEtapa: "V",
                FlVerificou: "0",
                IdDocUsuarioVerificaAprova: $(this).data("iddocusuarioverificaaprova"),
                IdDocumento: $("#emissao-documento-IdDocumento").val()
            };
            objVerificadores.push(verificador);
        });

        return objVerificadores;

    },

    getFormCadastroAprovadores: function () {

        var objAprovadores = [];

        // Objeto Aprovadores
        $('[name=formCadastroAprovador] :selected').each(function () {
            var aprovador = {
                IdUsuario: $(this).val(),
                TpEtapa: "A",
                FlAprovou: "0",
                IdDocUsuarioVerificaAprova: $(this).data("iddocusuarioverificaaprova"),
                IdDocumento: $("#emissao-documento-IdDocumento").val()
            };
            objAprovadores.push(aprovador);
        });

        return objAprovadores;

    },

    getObjFormCadastroValidate: function () {

        var emissaoDocumentoFormCadastroObj = {
            formCadastroTituloDocumento: 'required',
            formCadastroSigla: 'required',
            formCadastroNmDocumento: 'required',
            //formCadastroProcesso: 'required',
            formCadastroCategoria: 'required',
            //formCadastroEscolha: 'required',
            formCadastroRevisaoPeriodica: 'required',
            // formCadastroDtNotificacao: 'required',
            //formCadastroWorkflow: 'required',
            formCadastroElaborador: 'required',
            // formCadastroVerificador: 'required',
            kformCadastroAprovador: 'required',
        };

        return emissaoDocumentoFormCadastroObj;

    },

    getObjFormCadastro: function (_statusEmissaoDocumento) {

        var idSite = $('#emissao-documento-site').val();
        var idProcesso = $('[name=formCadastroProcesso] option:selected').val();
        var FlRevisaoPeriodica = APP.component.Radio.init('formCadastroRevisaoPeriodica') == "sim" ? true : false;
        var FlWorkFlow = APP.component.Radio.init('formCadastroWorkflow') == "sim" ? true : false;

        var docUsuarios = [];
        docUsuarios.push(APP.controller.ControlDocController.getFormCadastroAprovadores());
        docUsuarios.push(APP.controller.ControlDocController.getFormCadastroVerificadores());

        var emissaoDocumentoFormCadastroObj = {
            IdDocumento: $('#emissao-documento-IdDocumento').val(),
            IdSite: idSite,
            IdDocIdentificador: "",
            IdProcesso: idProcesso == 0 ? null : idProcesso,
            IdCategoria: $('[name=formCadastroCategoria]').val(),
            Titulo: $('[name=formCadastroTituloDocumento]').val(),
            IdSigla: $('[name=formCadastroSigla]').val(),
            NumeroDocumento: $('[name=formCadastroNmDocumento]').val(),
            IdElaborador: $('[name=formCadastroElaborador]').val(),
            FlRevisaoPeriodica: FlRevisaoPeriodica,
            DtNotificacao: FlRevisaoPeriodica == true ? $('[name=formCadastroDtNotificacao]').val() : null,
            FlWorkFlow: FlWorkFlow,
            FlStatus: _statusEmissaoDocumento,
            IdLicenca: $('[name=formLicensaAnexoIdAnexo]').val() != "" ? $('[name=formLicensaAnexoIdAnexo]').val() : null,
            Licenca: null,
            IdDocExterno: $('[name=formDocExternoAnexoIdAnexo]').val() != "" ? $('[name=formDocExternoAnexoIdAnexo]').val() : null,
            Ativo: true,
            Aprovadores: APP.controller.ControlDocController.getFormCadastroAprovadores(),
            Verificadores: APP.controller.ControlDocController.getFormCadastroVerificadores(),
            DocTemplate: APP.controller.ControlDocController.getListFormCadastroEscolha(),
            NuRevisao: $('[name=nuRevisao]').val(),
        };

        //emissaoDocumentoFormCadastroObj.DocUSuarioVerificaAprova = docUsuarios;

        return emissaoDocumentoFormCadastroObj;
    },

    getListFormCadastroEscolha: function () {

        var arrayListEscolhaObj = [];
        var cadastroEscolha = {};
        $('[name=formCadastroEscolha]:checked').each(function () {
            cadastroEscolha = {
                TpTemplate: $(this).val(),
                IdDocTemplate: $(this).data("id"),
                IdDocumento: $("#emissao-documento-IdDocumento").val(),
            };
            arrayListEscolhaObj.push(cadastroEscolha);
        });
        return arrayListEscolhaObj;

    },

    //Formulario TEXTO
    formTexto: function () {

        this.setCkeditorFormTexto();
    },

    setCkeditorFormTexto: function () {
        // APP.component.CkEditkor.init('dstexto-emissao-documento-texto');
        CKEDITOR.replace('dstexto-emissao-documento-texto');

    },

    getObjFormTexto: function () {

        var emissaoDocumentoFormTextoObj = CKEDITOR.instances['dstexto-emissao-documento-texto'].getData();

        return emissaoDocumentoFormTextoObj;

    },

    //Formulario FLUXO
    formFluxo: function () {

        this.setEditorFormFluxo();

    },

    setEditorFormFluxo: function () {

        // Carrega o arquivo de Configuracao utilizado pelo MxGraph
        var config = mxUtils.load('/Content/assets_src/js/vendor/mxGraph/javascript/src/config/diagrameditor.xml').getDocumentElement();

        // Carrega o editor
        editor = new mxEditor(config);

        // Inicializa o componente
        onInit(editor);

        $("#Copy").click(function () {
            editor.execute('copy');
        });

        $("#Paste").click(function () {
            editor.execute('paste');
        });

        $("#Delete").click(function () {
            editor.execute('delete');
        });

        $("#Undo").click(function () {
            editor.execute('undo');
        });

        $("#Redo").click(function () {
            editor.execute('redo');
        });

        $("#Cut").click(function () {
            editor.execute('cut');
        });

        $("#View").click(function () {
            var graph = editor.graph;
            mxUtils.show(graph, null, 100, 200);
        });

        $("#zoomActual").click(function () {
            var graph = editor.graph;
            graph.zoomActual();
            graph.view.rendering = true;
            graph.refresh();
        });

        $("#zoomIn").click(function () {
            var graph = editor.graph;
            graph.zoomIn();
            graph.view.rendering = true;
            graph.refresh();
        });

        $("#zoomOut").click(function () {
            var graph = editor.graph;
            graph.zoomOut();
            graph.view.rendering = true;
            graph.refresh();
        });

        $("#zoomFit").click(function () {
            var graph = editor.graph;
            graph.fit();
            graph.view.rendering = true;
            graph.refresh();
        });

        $("#unselectAll").click(function () {
            var graph = editor.graph;
            graph.clearSelection();
        });

        $("#selectAll").click(function () {
            var graph = editor.graph;
            graph.selectAll();
        });

        $('#panel').on('onFullScreen.lobiPanel', function (ev, lobiPanel) {
            $('#graphContainer').height($("#panelBody").height() - 50);
        });

        $('#panel').on('onSmallSize.lobiPanel', function (ev, lobiPanel) {
            $('#graphContainer').height(300);
        });

        LoadFlow(editor);

        function onInit(editor) {
            // Enables rotation handle
            mxVertexHandler.prototype.rotationEnabled = true;

            // Enables guides
            mxGraphHandler.prototype.guidesEnabled = true;

            // Alt disables guides
            mxGuide.prototype.isEnabledForEvent = function (evt) {
                return !mxEvent.isAltDown(evt);
            };

            // Enables snapping waypoints to terminals
            mxEdgeHandler.prototype.snapToTerminals = true;

            // Defines an icon for creating new connections in the connection handler.
            // This will automatically disable the highlighting of the source vertex.
            mxConnectionHandler.prototype.connectImage = new mxImage('/Content/assets_src/js/vendor/mxGraph/javascript/src/images/connector.gif', 16, 16);

            // Enables connections in the graph and disables
            // reset of zoom and translate on root change
            // (ie. switch between XML and graphical mode).
            editor.graph.setConnectable(true);

            // Clones the source if new connection has no target
            editor.graph.connectionHandler.setCreateTarget(true);

            // Changes the zoom on mouseWheel events
            //mxEvent.addMouseWheelListener(function (evt, up) {
            //    if (!mxEvent.isConsumed(evt)) {
            //        if (up) {
            //            editor.execute('zoomIn');
            //        } else {
            //            editor.execute('zoomOut');
            //        }

            //        mxEvent.consume(evt);
            //    }
            //});

        }

        function LoadFlow(editor) {

            var graph = editor.graph;
            var xmlString = $("#form-emissao-documento-fluxo-conteudo").val();
            if (xmlString != "") {
                var doc = mxUtils.parseXml(xmlString);
                var node = doc.documentElement;
                editor.readGraphModel(node);
            }

        }

    },

    getObjFormFluxo: function () {

        // Recupera os dados do plugin de fluxo
        var graph = editor.graph;
        var encoder = new mxCodec();
        var node = encoder.encode(graph.getModel());
        var dadosxml = mxUtils.getXml(node);
        var emissaoDocumentoFormFluxoObj = dadosxml;

        return emissaoDocumentoFormFluxoObj;

    },

    //Formulario REGISTRO
    formRegistro: function () {

        this.setNovoRegistroFormRegistro();
        this.setSaveNovoRegistroFormRegistro();
        this.setEditNovoRegistroFormRegistro();
        this.delNovoRegistroFormRegistro();

    },

    setNovoRegistroFormRegistro: function () {
        this.buttonAddNovoRegistroFormRegistro.unbind('click');
        this.buttonAddNovoRegistroFormRegistro.on('click', function () {
            event.preventDefault();

            var html = '';
            html += '<tr>';
            html += '<td>';
            html += '<textarea name="formRegistrosIdentificar" if="form-registros-identificar" maxlength="300"  class="form-control" data-val="true" title="" type="text" value=""></textarea>';
            html += '</td>';
            html += '<td>';
            html += '<textarea name="formRegistrosArmazenar" if="form-registros-armazenar" maxlength="300"  class="form-control" data-val="true" title="" type="text" value=""></textarea>';
            html += '</td>';
            html += '<td>';
            html += '<textarea name="formRegistrosProteger" if="form-registros-proteger" maxlength="300"  class="form-control" data-val="true" title="" type="text" value=""></textarea>';
            html += '</td>';
            html += '<td>';
            html += '<textarea name="formRegistrosRecuperar" if="form-registros-recuperar" maxlength="300"  class="form-control" data-val="true" title="" type="text" value=""></textarea>';
            html += '</td>';
            html += '<td>';
            html += '<textarea name="formRegistrosRetencao" if="form-registros-retencao" maxlength="300"  class="form-control" data-val="true" title="" type="text" value=""></textarea>';
            html += '</td>';
            html += '<td>';
            html += '<textarea name="formRegistrosDisposicao" if="form-registros-disposicao" maxlength="300"  class="form-control" data-val="true" title="" type="text" value=""></textarea>';
            html += '</td>';
            html += '<td class="text-nowrap">';
            html += '<a href="#" class="editar-form-registros icon-cliente editar-color">';
            html += '<i class="fa fa-pencil" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonEditar + '" data-original-title="' + _options.labelButtonEditar + '"></i>';
            html += '</a>';
            html += '<a href="#" data-valor="True" class="salvar-form-registros icon-cliente">';
            html += '<i class="fa fa-check  ativo-color" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonAtivar + '" data-original-title="' + _options.labelButtonAtivar + '"></i>';
            html += '</a>';
            html += '<a href="#" class="excluir-form-registros icon-cliente trash-color">';
            html += '<i class="fa fa-trash" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</a>';
            html += '</td>';
            html += '</tr>';

            $('#tb-form-registros tbody').append(html);

            APP.controller.ControlDocController.setup();
            APP.controller.ControlDocController.bindFormRegistro();

        });

    },

    setSaveNovoRegistroFormRegistro: function () {

        this.buttonSaveNovoRegistroFormRegistro.unbind('click');
        this.buttonSaveNovoRegistroFormRegistro.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name=formRegistrosIdentificar]').prop('disabled', true);
            $(this).closest('tr').find('[name=formRegistrosArmazenar]').prop('disabled', true);
            $(this).closest('tr').find('[name=formRegistrosProteger]').prop('disabled', true);
            $(this).closest('tr').find('[name=formRegistrosRecuperar]').prop('disabled', true);
            $(this).closest('tr').find('[name=formRegistrosRetencao]').prop('disabled', true);
            $(this).closest('tr').find('[name=formRegistrosDisposicao]').prop('disabled', true);

        });

    },

    setEditNovoRegistroFormRegistro: function () {

        this.buttonEditNovoRegistroFormRegistro.unbind('click');
        this.buttonEditNovoRegistroFormRegistro.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name=formRegistrosIdentificar]').prop('disabled', false);
            $(this).closest('tr').find('[name=formRegistrosArmazenar]').prop('disabled', false);
            $(this).closest('tr').find('[name=formRegistrosProteger]').prop('disabled', false);
            $(this).closest('tr').find('[name=formRegistrosRecuperar]').prop('disabled', false);
            $(this).closest('tr').find('[name=formRegistrosRetencao]').prop('disabled', false);
            $(this).closest('tr').find('[name=formRegistrosDisposicao]').prop('disabled', false);

        });

    },

    delNovoRegistroFormRegistro: function () {

        this.buttonDelNovoRegistroFormRegistro.unbind('click');
        this.buttonDelNovoRegistroFormRegistro.on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });

    },

    getObjFormRegistro: function () {

        var table = $('#tb-form-registros tbody');
        var arrayFormRegistrosObj = [];
        var registros = {};

        table.find('tr').each(function () {
            registros = {
                IdDocRegistro: $(this).find('[name=formRegistrosIdRegistroDoc]').val(),
                IdDocumento: $('[name=IdDocumento]').val(),
                Identificar: $(this).find('[name=formRegistrosIdentificar]').val(),
                Armazenar: $(this).find('[name=formRegistrosArmazenar]').val(),
                Proteger: $(this).find('[name=formRegistrosProteger]').val(),
                Retencao: $(this).find('[name=formRegistrosRecuperar]').val(),
                Recuperar: $(this).find('[name=formRegistrosRetencao]').val(),
                Disposicao: $(this).find('[name=formRegistrosDisposicao]').val(),
            };
            arrayFormRegistrosObj.push(registros);
        });

        return arrayFormRegistrosObj;

    },

    bindFormRegistro: function () {

        APP.controller.ControlDocController.setNovoRegistroFormRegistro();
        APP.controller.ControlDocController.setSaveNovoRegistroFormRegistro();
        APP.controller.ControlDocController.setEditNovoRegistroFormRegistro();
        APP.controller.ControlDocController.delNovoRegistroFormRegistro();

    },







    //Formulario INDICADORES
    formIndicadores: function () {

        this.setHideAndShowFormIndicadores();
        // -- nao this.setNovaRotinaFormRotina();
        this.setNovaIndicadoresFormIndicadores();
        this.setSaveNovaIndicadoresFormIndicadores();
        this.setEditNovaIndicadoresFormIndicadores();
        this.delNovaIndicadoresFormIndicadores();

    },

    setHideAndShowFormIndicadores: function () {
        //$('[name=formRotinaItem]').prop('disabled', true);
    },

    //setContNumberRotina: function () {
    //    $('[name=formRotinaItem]').each(function (i) {
    //        $(this).val(i + 1);
    //    });
    //},


    setNovaIndicadoresFormIndicadores: function () {
        this.buttonAddNovaIndicadoresFormIndicadores.unbind('click');
        this.buttonAddNovaIndicadoresFormIndicadores.on('click', function () {
            event.preventDefault();
            var html = '';
            html += '<tr>';
            //html += '<td style="width: 5%;">';
            html += '<td>';
            html += '<textarea type="text" name="formIndicadoresObjetivo" maxlength="8000" rows="5" if="form-indicadores-objetivo" class="form-control"></textarea>';
            html += '</td>';

            html += '<td>';
            html += '<textarea type="text" name="formIndicadoresResponsavel" if="form-indicadores-responsavel" class="form-control"></textarea>';
            html += '</td>';

            html += '<td>';
            html += '<input type="text" name="formIndicadoresMeta" if="form-indicadores-meta" class="form-control">';
            html += '</td>';

            html += '<td>';
            html += '<textarea type="text" name="formIndicadoresIndicadores" maxlength="8000" rows="5" if="form-indicadores-indicadores" class="form-control"></textarea>';
            html += '</td>';

            html += '<td>';
            html += '<input type="text" name="formIndicadoresUnidadeMeta" if="form-indicadores-UnidadeMeta" class="form-control">';
            html += '</td>';

            html += '<td>';
            html += '<input type="text" name="formIndicadoresMetaMaximaMinima" if="form-indicadores-MetaMaximaMinima" class="form-control">';
            html += '</td>';



            html += '<td class="text-nowrap">';
            html += '<a href="#" class="editar-form-indicadores icon-cliente editar-color">';
            html += '<i class="fa fa-pencil" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonEditar + '" data-original-title="' + _options.labelButtonEditar + '"></i>';
            html += '</a>';
            html += '<a href="#" data-valor="True" class="salvar-form-indicadores icon-cliente">';
            html += '<i class="fa fa-check  ativo-color" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonAtivar + '" data-original-title="' + _options.labelButtonAtivar + '"></i>';
            html += '</a>';
            html += '<a href="#" class="excluir-form-indicadores icon-cliente trash-color">';
            html += '<i class="fa fa-trash" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</a>';
            html += '</td>';
            html += '</tr>';

            $('#tb-form-indicadores tbody').append(html);



            APP.controller.ControlDocController.setup();
            APP.controller.ControlDocController.bindFormIndicadores();

        });
    },

    setSaveNovaIndicadoresFormIndicadores: function () {

        this.buttonSaveNovaIndicadoresFormIndicadores.unbind('click');
        this.buttonSaveNovaIndicadoresFormIndicadores.on('click', function () {
            event.preventDefault();
            $(this).closest('tr').find('[name=formIndicadoresResponsavel]').prop('disabled', true);
            $(this).closest('tr').find('[name=formIndicadoresObjetivo]').prop('disabled', true);
            $(this).closest('tr').find('[name=formIndicadoresResponsavel]').prop('disabled', true);
            $(this).closest('tr').find('[name=formIndicadoresMeta]').prop('disabled', true);
            $(this).closest('tr').find('[name=formIndicadoresIndicadores]').prop('disabled', true);
            $(this).closest('tr').find('[name=formIndicadoresUnidadeMeta]').prop('disabled', true);
            $(this).closest('tr').find('[name=formIndicadoresMetaMaximaMinima]').prop('disabled', true);
            editor.graph.setEnabled(false);


            //var itemAtual = $(this).closest('tr').find('[name=formRotinaItem]').val();
            //var total = $('#tb-form-rotina tbody tr').length;
            //var IdItemAtual = $(this).closest('tr').find('[name=formRotinaIdRotina]').val();

            //if (total > itemAtual && (IdItemAtual == null || IdItemAtual == undefined)) {

            //    var quantidadeLoop = total - itemAtual;

            //    for (var i = 0; i < quantidadeLoop; i++) {
            //        var $parent = $(this).parents('#tb-form-rotina tbody tr');
            //        $parent.insertBefore($parent.prev());
            //    }

            //    APP.controller.ControlDocController.setContNumberRotina();
            //}

        });

    },




    setEditNovaIndicadoresFormIndicadores: function () {
        this.buttonEditNovaIndicadoresFormIndicadores.unbind('click');
        this.buttonEditNovaIndicadoresFormIndicadores.on('click', function () {
            event.preventDefault();
            $(this).closest('tr').find('[name=formIndicadoresResponsavel]').prop('disabled', false);
            $(this).closest('tr').find('[name=formIndicadoresObjetivo]').prop('disabled', false);
            $(this).closest('tr').find('[name=formIndicadoresResponsavel]').prop('disabled', false);
            $(this).closest('tr').find('[name=formIndicadoresMeta]').prop('disabled', false);
            $(this).closest('tr').find('[name=formIndicadoresIndicadores]').prop('disabled', false);
            $(this).closest('tr').find('[name=formIndicadoresUnidadeMeta]').prop('disabled', false);
            $(this).closest('tr').find('[name=formIndicadoresMetaMaximaMinima]').prop('disabled', false);
            editor.graph.setEnabled(true);
        });

    },


    delNovaIndicadoresFormIndicadores: function () {

        this.buttonDelNovaIndicadoresFormIndicadores.unbind('click');
        this.buttonDelNovaIndicadoresFormIndicadores.on('click', function (event) {
            event.preventDefault();

            var itemExcluir = $(this).closest('tr');

            bootbox.confirm(_options.MsgDesejaExcluirRegistro, function (result) {
                if (result) {
                    itemExcluir.remove();
                    APP.controller.ControlDocController.setContNumberRotina();
                }
            });

        });

    },


    getObjFormIndicadores: function () {

        var table = $('#tb-form-indicadores tbody');
        var arrayFormIndicadoresObj = [];
        var indicadores = {};

        table.find('tr').each(function () {
            indicadores = {
                //IdDocRotina: $(this).find('[name=formRotinaIdRotina]').val(),
                Objetivo: $('[name=formIndicadoresObjetivo]').val(),
                IdResponsavel: $(this).find('[name=formIndicadoresResponsavel]').val(),
                IndicadoresMeta: $(this).find('[name=formIndicadoresMeta]').val(),
                Indicadores: $(this).find('[name=formIndicadoresIndicadores]').val(),
                IndicadoresUnidadeMeta: $(this).find('[name=formIndicadoresUnidadeMeta]').val(),
                IndicadoresMetaMaximaMinima: $(this).find('[name=formIndicadoresMetaMaximaMinima]').val(),
            };
            arrayFormIndicadoresObj.push(indicadores);

        });
        return arrayFormIndicadoresObj;

    },



    bindFormIndicadores: function () {

        APP.controller.ControlDocController.setNovaIndicadoresFormIndicadores();
        APP.controller.ControlDocController.setSaveNovaIndicadoresFormIndicadores();
        APP.controller.ControlDocController.setEditNovaIndicadoresFormIndicadores();
        APP.controller.ControlDocController.delNovaIndicadoresFormIndicadores();

        //APP.controller.ControlDocController.setHideAndShowFormRotina();


        //APP.controller.ControlDocController.setContNumberRotina();

    },



    //Formulario ROTINA
    formRotina: function () {

        this.setHideAndShowFormRotina();
        this.setNovaRotinaFormRotina();
        this.setSaveNovaRotinaFormRotina();
        this.setEditNovaRotinaFormRotina();
        this.delNovaRotinaFormRotina();

    },

    setHideAndShowFormRotina: function () {

        $('[name=formRotinaItem]').prop('disabled', true);

    },

    setContNumberRotina: function () {
        $('[name=formRotinaItem]').each(function (i) {
            $(this).val(i + 1);
        });
    },

    setNovaRotinaFormRotina: function () {
        this.buttonAddNovaRotinaFormRotina.unbind('click');
        this.buttonAddNovaRotinaFormRotina.on('click', function () {
            event.preventDefault();

            var html = '';
            html += '<tr>';
            html += '<td>';
            html += '<input type="text" name="formRotinaItem" if="form-rotina-item" class="form-control">';
            html += '</td>';
            html += '<td>';
            html += '<textarea type="text" name="formRotinaOQue" if="form-rotina-o-que" class="form-control"></textarea>';
            html += '</td>';
            html += '<td>';
            html += '<textarea type="text" name="formRotinaQuem" if="form-rotina-quem" class="form-control"></textarea>';
            html += '</td>';
            html += '<td>';
            html += '<textarea type="text" name="formRotinaRegistro" if="form-rotina-registro" class="form-control"></textarea>';
            html += '</td>';
            html += '<td>';
            html += '<textarea type="text" name="formRotinaComo" maxlength="500" if="form-rotina-como" class="form-control"></textarea>';
            html += '</td>';
            html += '<td class="text-nowrap">';
            html += '<a href="#" class="editar-form-rotina icon-cliente editar-color">';
            html += '<i class="fa fa-pencil" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonEditar + '" data-original-title="' + _options.labelButtonEditar + '"></i>';
            html += '</a>';
            html += '<a href="#" data-valor="True" class="salvar-form-rotina icon-cliente">';
            html += '<i class="fa fa-check  ativo-color" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonAtivar + '" data-original-title="' + _options.labelButtonAtivar + '"></i>';
            html += '</a>';
            html += '<a href="#" class="excluir-form-rotina icon-cliente trash-color">';
            html += '<i class="fa fa-trash" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</a>';
            html += '</td>';
            html += '</tr>';

            $('#tb-form-rotina tbody').append(html);

            APP.controller.ControlDocController.setup();
            APP.controller.ControlDocController.bindFormRotina();

        });
    },

    setSaveNovaRotinaFormRotina: function () {

        this.buttonSaveNovaRotinaFormRotina.unbind('click');
        this.buttonSaveNovaRotinaFormRotina.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name=formRotinaItem]').prop('disabled', true);
            $(this).closest('tr').find('[name=formRotinaOQue]').prop('disabled', true);
            $(this).closest('tr').find('[name=formRotinaQuem]').prop('disabled', true);
            $(this).closest('tr').find('[name=formRotinaRegistro]').prop('disabled', true);
            $(this).closest('tr').find('[name=formRotinaComo]').prop('disabled', true);

        });

    },

    setEditNovaRotinaFormRotina: function () {

        this.buttonEditNovaRotinaFormRotina.unbind('click');
        this.buttonEditNovaRotinaFormRotina.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name=formRotinaItem]').prop('disabled', false);
            $(this).closest('tr').find('[name=formRotinaOQue]').prop('disabled', false);
            $(this).closest('tr').find('[name=formRotinaQuem]').prop('disabled', false);
            $(this).closest('tr').find('[name=formRotinaRegistro]').prop('disabled', false);
            $(this).closest('tr').find('[name=formRotinaComo]').prop('disabled', false);

        });

    },

    delNovaRotinaFormRotina: function () {

        this.buttonDelNovaRotinaFormRotina.unbind('click');
        this.buttonDelNovaRotinaFormRotina.on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
            APP.controller.ControlDocController.setContNumberRotina();
        });

    },

    getObjFormRotina: function () {

        var table = $('#tb-form-rotina tbody');
        var arrayFormRotinasObj = [];
        var rotinas = {};

        table.find('tr').each(function () {
            rotinas = {
                IdDocRotina: $(this).find('[name=formRotinaIdRotina]').val(),
                IdDocumento: $('[name=IdDocumento]').val(),
                Item: $(this).find('[name=formRotinaItem]').val(),
                OQUE: $(this).find('[name=formRotinaOQue]').val(),
                QUEM: $(this).find('[name=formRotinaQuem]').val(),
                Registro: $(this).find('[name=formRotinaRegistro]').val(),
                Como: $(this).find('[name=formRotinaComo]').val(),
            };
            arrayFormRotinasObj.push(rotinas);

        });

        return arrayFormRotinasObj;

    },

    bindFormRotina: function () {

        APP.controller.ControlDocController.setHideAndShowFormRotina();
        APP.controller.ControlDocController.setNovaRotinaFormRotina();
        APP.controller.ControlDocController.setSaveNovaRotinaFormRotina();
        APP.controller.ControlDocController.setEditNovaRotinaFormRotina();
        APP.controller.ControlDocController.delNovaRotinaFormRotina();
        APP.controller.ControlDocController.setContNumberRotina();

    },

    //Formulario RECURSOS
    formRecursos: function () {

        this.setCkeditorFormRecursos();

    },

    setCkeditorFormRecursos: function () {

        APP.component.CkEditor.init('dstexto-emissao-documento-recursos');

    },

    getObjFormRecursos: function () {

        return CKEDITOR.instances['dstexto-emissao-documento-recursos'].getData();

    },

    //Formulario UPLOAD
    formUpload: function () {

        this.setdelUploadFormUpload();
        this.delUploadFormUpload();
        this.setupUploadArquivoFormUpload();

    },

    setdelUploadFormUpload: function () {
        this.buttonAddUploadFormUpload.unbind('click');
        this.buttonAddUploadFormUpload.on('click', function () {
            var index = $('#tb-form-upload tbody tr').size();
            event.preventDefault();

            var html = '';
            html += '<tr>';
            html += '<td>';
            html += '<input type="text" name="formUploadTitulo" id="form-upload-titulo" class="form-control"  value="" />';
            html += '</td>';
            html += '<td>';
            html += '<div id="uplPE-form-upload' + index + '" class="upload upload-file">';
            html += '<div id="dropPE-form-upload' + index + '" class="drop" style="padding:2px 3px; background-color:#fff;">';
            html += '<a href="javascript:;" class="text-center" style="color: #698e9f;">';
            html += '<i class="fa fa-paperclip fa-1x" aria-hidden="true"></i><br>Anexar</a>';
            html += '<input type="file" name="upl" multiple />';
            html += '<ul><!-- The file uploads will be shown here --></ul>';
            html += '<input type="hidden" id="arquivoEvidencia-form-upload' + index + '" value=""/></div></div>';
            html += '</td>';
            html += '<td>';
            html += '<button type="button" class="excluir-form-upload btn trash-color">';
            html += '<i class="fa fa-trash " aria-hidden="true" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</button>';
            html += '</td>';
            html += '</tr>';

            $('#tb-form-upload tbody').append(html);

            var dropPE = "dropPE-form-upload" + index;
            var uplPE = "uplPE-form-upload" + index;
            var arquivoEvidencia = "arquivoEvidencia-form-upload" + index;

            APP.controller.ControlDocController.setup();
            APP.controller.ControlDocController.bindFormUpload(dropPE, uplPE, arquivoEvidencia);

        });

    },

    delUploadFormUpload: function () {

        this.buttonDelUploadFormUpload.unbind('click');
        this.buttonDelUploadFormUpload.on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });

    },

    setupUploadArquivoFormUpload: function (dropPE, uplPE, arquivoEvidencia) {

        // var formJson = {
        //     "tipo": "Upload"
        // };
        // APP.component.UploadFiles.setUploadFiles("/CriarCliente/UploadArquivo",
        //     dropPE,
        //     uplPE,
        //     arquivoEvidencia,
        //     30000000000,
        //     formJson,
        //     "form-cria-cliente",
        //     0,
        //     "/CriarCliente/RemoverArquivo");

        // UploadDeleteFiles("/CriarCliente/RemoverArquivo");
    },

    getObjFormUpload: function () {

        var table = $('#tb-form-upload tbody');
        var arrayFormUploadObj = [];
        var uploads = {};

        table.find('tr').each(function () {
            uploads = {
                Titulo: $(this).find('[name=formUploadTitulo]').val(),
                Arquivo: $(this).find('input[id^=arquivoEvidencia]').val().split("|")[0],
            };
            arrayFormUploadObj.push(uploads);
        });

        return arrayFormUploadObj;

    },

    bindFormUpload: function (dropPE, uplPE, arquivoEvidencia) {

        APP.controller.ControlDocController.setup();
        APP.controller.ControlDocController.setupUploadArquivoFormUpload(dropPE, uplPE, arquivoEvidencia);
        APP.controller.ControlDocController.setdelUploadFormUpload();
        APP.controller.ControlDocController.delUploadFormUpload();
    },

    //Formulario RISCOS
    formRiscos: function () {

        this.setHideAndShowFormRiscos();
        this.setNecessitaAcao();
        APP.component.BarRating.init('.barraRating', 'bars-1to10');

    },

    setHideAndShowFormRiscos: function () {

        $('#form-riscos-numero').closest('.form-group').hide();
        $('[name=formRiscosResponsavel]').closest('[class^=col]').hide();
        //$('[name=formRiscosIdentificacao]').closest('[class^=col]').hide();
        //$('[name=formRiscosCriticidade]').closest('[class^=col]').hide();
        $('[name=formRiscosJustificativa]').closest('[class^=col]').hide();
    },

    getTemasCores: function () {
        
        var StatusEtapa = $('[name=StatusEtapa]').val();
        var divBarRating = $('.barraRating');
        var corRisco = $('[name=formRiscosCriticidade]').val();
        var lastCores = $("[data-rating-value='" + corRisco + "']").last().index();
        for (i = 0; i <= lastCores; i++) {
            $($('.br-theme-bars-1to10').find('.br-widget a')[i]).addClass('br-selected');
        }
        $($('.br-theme-bars-1to10').find('.br-widget a')[lastCores]).trigger("click");
        $('.br-theme-bars-1to10').find("[data-rating-value='" + corRisco + "']").addClass('br-current');
        
        if(StatusEtapa > 0)
        {
            $('.br-widget').addClass('barRating-disabled');
        }

    },

    getResponsavel: function (_idProcesso) {

        var idSite = $('[name=IdSite]').val();
        var idFuncao = 48; // Funcionalidade(Registro da ata) que permite Criar Analise Critica;
        $.get('/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso=' + _idProcesso + '&idSite=' + idSite + '&idFuncao=' + idFuncao +'', (result) => {
            if (result.StatusCode == 200) {
                APP.component.SelectListCompare.selectList(result.Lista, $('[name="formRiscosResponsavel"] option'), $('[name="formRiscosResponsavel"]'), 'IdUsuario', 'NmCompleto');
            }
        });
    },

    setNecessitaAcao: function () {

        $('[name=formRiscosNecessitaAcao]').unbind('change');
        $('[name=formRiscosNecessitaAcao]').on('change', function () {

            var necessitaAcao = APP.controller.ControlDocController.getNecessitaAcao();
            APP.controller.ControlDocController.setRulesNecessitaAcao(necessitaAcao);

        });

    },

    getNecessitaAcao: function () {

        var necessitaAcao = APP.component.Radio.init('formRiscosNecessitaAcao');
        return necessitaAcao;

    },

    setRulesNecessitaAcao: function (_necessitaAcao) {

        if (_necessitaAcao == "true") {
            $('[name=formRiscosResponsavel]').closest('[class^=col]').show();
            //$('[name=formRiscosIdentificacao]').closest('[class^=col]').show();
            //$('[name=formRiscosCriticidade]').closest('[class^=col]').show();
            $('[name=formRiscosJustificativa]').closest('[class^=col]').hide();
        } else {
            $('[name=formRiscosResponsavel]').closest('[class^=col]').hide();
            //$('[name=formRiscosIdentificacao]').closest('[class^=col]').hide();
            //$('[name=formRiscosCriticidade]').closest('[class^=col]').hide();
            $('[name=formRiscosJustificativa]').closest('[class^=col]').show();
        }

    },

    getObjFormRiscos: function () {
        var emissaoDocumentoFormRiscosObj = {

            CriticidadeGestaoDeRisco: $('.br-current').data('rating-value'),
            IdResponsavelInicarAcaoImediata: $('[name=formRiscosResponsavel] :selected').val(),
            DescricaoRegistro: $('[name=formRiscosIdentificacao]').val(),
            Causa: $('[name=formRiscosCausa]').val(),
            IdRegistroConformidade: $('#idgestaorisco').val(),
            DsJustificativa: $('[name=formRiscosJustificativa]').val()
        };

        return emissaoDocumentoFormRiscosObj;

    },

    //Formulario LICENCA
    formLicenca: function () {

        this.setUploadArquivoFormLicenca();

    },

    setUploadArquivoFormLicenca: function () {

        // var dropPE = "dropPE-novo-fluxo";
        // var uplPE = "uplPE-novo-fluxo";
        // var arquivoEvidencia = "arquivoEvidencia-novo-fluxo";

        // var formJson = {
        //     "tipo": "Licenca"
        // };
        // APP.component.UploadFiles.setUploadFiles("/ControlDoc/UploadArquivo",
        //     dropPE,
        //     uplPE,
        //     arquivoEvidencia,
        //     30000000000,
        //     formJson,
        //     "form-emissao-documento-licenca",
        //     0,
        //     "/ControlDoc/RemoverArquivo");

        // UploadDeleteFiles("/ControlDoc/RemoverArquivo");

    },

    getObjFormLicenca: function () {
        var anexoLicencaoModel = APP.controller.ControlDocController.models.AnexoModel;
        var nameImg = $('.btn-upload-file-form-licensa-anexo').find('i').text(); //Precisa pegar

        var anexo = anexoLicencaoModel.constructor(
            $('[name=formLicensaAnexoIdAnexo]').val(),
            nameImg,
            $('[name=formLicensaAnexo]').data('b64')
        );

        var emissaoDocumentoFormLicensaObj = {

            DataEmissao: $('[name=formLicencaDtEmissao]').val(),
            DataVencimento: $('[name=formLicencaDtVencimento]').val(),
            IdAnexo: 0,
            Anexo: anexo
        };

        return emissaoDocumentoFormLicensaObj;

    },

    //Formulario DOCS EXTERNOS
    formDocsExternos: function () {

        this.setupUploadArquivoFormDocsExternos();

    },

    setupUploadArquivoFormDocsExternos: function () {

        // var dropPE = "dropPE-form-docsexternos-arquivo";
        // var uplPE = "uplPE-form-docsexternos-arquivo";
        // var arquivoEvidencia = "arquivoEvidencia-form-docsexternos-arquivo";

        // var formJson = {
        //     "tipo": "DocExterno"
        // };

        // APP.component.UploadFiles.setUploadFiles("/ControlDoc/UploadArquivo",
        //     dropPE,
        //     uplPE,
        //     arquivoEvidencia,
        //     30000000000,
        //     formJson,
        //     "form-emissao-documento-docsexternos",
        //     0,
        //     "/ControlDoc/RemoverArquivo");

        // UploadDeleteFiles("/ControlDoc/RemoverArquivo");

    },

    getObjFormDocsExternos: function () {
        var anexoDocExternoModel = APP.controller.ControlDocController.models.AnexoModel;
        var nameImg = $('.btn-upload-file-form-docexterno-anexo').find('i').text(); //Precisa pegar

        var anexo = anexoDocExternoModel.constructor(
            $('[name=formDocExternoAnexoIdAnexo]').val(),
            nameImg,
            $('[name=formDocExternoAnexoAnexo]').data('b64')
        );

        var emissaoDocumentoFormDocsExternosObj = {
            LinkDocumentoExterno: $('[name=formDocsexternosLink]').val(),
            IdAnexo: $('[name=formDocExternoAnexoIdAnexo]').val(),
            Anexo: anexo,
        };

        return emissaoDocumentoFormDocsExternosObj;

    },

    //Formulario ASSUNTOS
    formAssuntos: function () {

        APP.component.DataTable.init('#tb-emissao-documento-form-assuntos');
        this.setHideAndShowAssunto();
        this.setNovoAssuntoFormAssuntos();
        this.setSaveAssuntoFormAssuntos();
        this.setEditAssuntoFormAssuntos();

    },

    setHideAndShowAssunto: function () {

        var empty = $('#tb-emissao-documento-form-assuntos tbody tr td').hasClass('dataTables_empty');
        if (empty) {
            $('.odd').remove();
        }
    },

    setNovoAssuntoFormAssuntos: function () {
        this.buttonAddNovoAssuntoFormAssuntos.unbind('click');
        this.buttonAddNovoAssuntoFormAssuntos.on('click', function () {
            event.preventDefault();

            var html = '';
            html += '<tr>';

            html += '<td>';
            html += '<input type="text" name="formAssuntoRevisao" class="form-control" disabled id="form-assunto-revisao"> ';
            html += '</td>';

            html += '<td>';
            html += '<div class="input-group date" id="datetimepicker77">';
            html += '<input type="text" name="formAssuntoDtVersao" class="form-control data datepicker" />';
            html += '<span class="input-group-addon">';
            html += '<i class="fa fa-calendar" aria-hidden="true"></i>';
            html += '</span>';
            html += '</div>';
            html += '</td>';
            
            html += '<td>';
            html += '<textarea name="formAssuntoDescricao" class="form-control" id="form-assunto-descricao" data-val="true"  rows="5"></textarea>';
            html += '</td>';
            html += '<td class="text-nowrap">';
            html += '<a href="#" class="editar-form-assuntos icon-cliente editar-color">';
            html += '<i class="fa fa-pencil" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonEditar + '" data-original-title="' + _options.labelButtonEditar + '"></i>';
            html += '</a>';
            html += '<a href="#" data-valor="True" class="salvar-form-assuntos icon-cliente">';
            html += '<i class="fa fa-check  ativo-color" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonAtivar + '" data-original-title="' + _options.labelButtonAtivar + '"></i>';
            html += '</a>';
            //html += '<a href="#" class="excluir-form-assuntos icon-cliente trash-color">';
            //html += '<i class="fa fa-trash" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            //html += '</a>';
            html += '</td>';
            html += '</tr>';



            $('#tb-emissao-documento-form-assuntos tbody').append(html);

            APP.controller.ControlDocController.setup();
            APP.controller.ControlDocController.bindFormAssuntos();

        });

    },

    setSaveAssuntoFormAssuntos: function () {

        this.buttonSaveNovoAssuntoFormAssuntos.unbind('click');
        this.buttonSaveNovoAssuntoFormAssuntos.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name=formAssuntoDtVersao]').prop('disabled', true);
            $(this).closest('tr').find('[name=formAssuntoRevisao]').prop('disabled', true);
            $(this).closest('tr').find('[name=formAssuntoDescricao]').prop('disabled', true);

        });

    },

    setEditAssuntoFormAssuntos: function () {

        this.buttonEditNovoAssuntoFormAssuntos.unbind('click');
        this.buttonEditNovoAssuntoFormAssuntos.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name=formAssuntoDtVersao]').prop('disabled', false);
            $(this).closest('tr').find('[name=formAssuntoRevisao]').prop('disabled', false);
            $(this).closest('tr').find('[name=formAssuntoDescricao]').prop('disabled', false);

        });

    },

    delAssuntoFormAssuntos: function () {

        this.buttonDelAssuntoFormAssuntos.unbind('click');
        this.buttonDelAssuntoFormAssuntos.on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });

    },

    getObjFormAssuntos: function () {

        var table = $('#tb-emissao-documento-form-assuntos tbody');
        var arrayFormAssuntosObj = [];
        var assuntos = {};

        table.find('tr').each(function () {
            assuntos = {
                Id: $(this).find('[name=formAssuntoId]').val(),
                DataAssunto: $(this).find('[name=formAssuntoDtVersao]').val(),
                Revisao: $(this).find('[name=formAssuntoRevisao]').val(),
                Descricao: $(this).find('[name=formAssuntoDescricao]').val(),
                IdDocumento: $("#emissao-documento-IdDocumento").val(),
            };
            arrayFormAssuntosObj.push(assuntos);
        });

        return arrayFormAssuntosObj;
    },

    bindFormAssuntos: function () {

        APP.controller.ControlDocController.setNovoAssuntoFormAssuntos();
        APP.controller.ControlDocController.setSaveAssuntoFormAssuntos();
        APP.controller.ControlDocController.setEditAssuntoFormAssuntos();
        APP.controller.ControlDocController.delAssuntoFormAssuntos();
        APP.controller.ControlDocController.setNumeroRevisaoAssunto();
        
        APP.component.Datapicker.init();

    },

    setNumeroRevisaoAssunto: function () {
        $('[name=formAssuntoRevisao]').each(function (i) {
            $(this).val(i + 1);
        });
    },

    //Formulario Comentarios
    formComentarios: function () {

        this.setNovaMensagemFormComentarios();

    },

    setNovaMensagemFormComentarios: function () {

        this.buttonAddNovaMensagemFormComentarios.unbind('click');
        this.buttonAddNovaMensagemFormComentarios.on('click', function () {
            event.preventDefault();

            var usuario = $('[name=IdUsuarioLogado]').val();
            var nome = $('[name=NmUsuarioLogado]').val();
            var comentario = $('[name=formComentariosMensagem]').val();
            var data = APP.component.Datatoday.init();
            var hora = APP.component.Datatoday.getHoraNow();

            var html = '';
            html += '<!-- Comentario -->';
            html += '<div class="form-comentarios-comentario-info">';
            html += '<input type="hidden" name="IdComentario" value="0" />';
            html += '<span name="formComentariosComentarioUsuario" class="form-comentarios-comentario-usuario">' + nome + ' -</span>';
            html += '<p name="formComentariosComentarioTexto" class="form-comentarios-comentario-texto">&nbsp;' + comentario + '</p>';
            html += '<span name="formComentariosComentarioData" class="form-comentarios-comentario-data">' + data + ' - ' + hora + '</span>';
            html += '</div>';

            $('#form-comentarios-comentario').append(html);
            document.getElementById("form-emissao-documento-comentarios").reset();
            APP.controller.ControlDocController.setup();

        });

    },

    getObjFormComentarios: function () {

        var table = $('#form-comentarios-comentario');
        var arrayFormComentariosObj = [];
        var comentarios = {};

        table.find('.form-comentarios-comentario-info').each(function () {
            comentarios = {
                Id: $(this).find('[name=IdComentario]').val(),
                IdUsuario: $('[name=IdUsuarioLogado]').val(),
                Descricao: $(this).find('[name=formComentariosComentarioTexto]').text(),
                DataComentario: $(this).find('[name=formComentariosComentarioData]').text(),
                IdDocumento: $("#emissao-documento-IdDocumento").val()
            };
            arrayFormComentariosObj.push(comentarios);

        });

        return arrayFormComentariosObj;
    },

    setTodosOsCamposNecessariosForamPreenchidos: function () {

        if ($('[name=formCargosEscolha]:checked').length == 0) {
            bootbox.alert(_options.MsgCargoSelect);
            return false;
        }

        if ($('[name=formCadastroEscolha]:checked').length == 0) {
            $('.tabela-check').addClass("input-validation-error");
            return false;
        }

        return true;
    },

    //Formulario CARGOS
    formCargos: function () {

        this.getSelectAllCargos();

    },

    getSelectAllCargos: function () {

        $('#form-cargos-escolha-all').unbind('click');
        $('#form-cargos-escolha-all').on('click', function () {
            $('[name=formCargosEscolha]').not(this).prop('checked', this.checked);
        });

    },

    setCargosEmissaoDocumentos: function () {

        $.ajax({
            type: "GET",
            data: {
                id: $('#emissao-documento-IdDocumento').val()
            },
            dataType: 'json',
            url: '/ControlDoc/CargosPorDocumento',
            beforeSend: function () { },
            success: function (result) {
                if (result.StatusCode == 200) {

                    $.each(result.Dados, function (index, cargo) {
                        APP.controller.ControlDocController.addCargosEmissaoDocumentos(cargo);
                    });
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) { }
        });

    },

    addCargosEmissaoDocumentos: function (cargo) {

        var $divCargos = $(".tabela-cargo-check");

        var html = '';
        html += '<div class="col-md-12 checkbox">';
        html += '<input type="checkbox" name="formCargosEscolha" id="form-cargos-escolha-cargo' + cargo.IdCargo + '" class="form-control" value="' + cargo.IdCargo + '" data-idDocCargo="' + cargo.IdDocCargo + '" ' + (cargo.IdDocCargo != 0 ? 'checked' : '') + '>';
        html += '<label for="form-cargos-escolha-cargo' + cargo.IdCargo + '">' + cargo.NmNome + '</label>';
        html += '</div>';

        $divCargos.append(html);

    },

    getObjFormCargos: function () {

        var table = $('.tabela-cargo-check');
        var arrayFormCargosObj = [];
        var cargos = {};

        table.find('[name=formCargosEscolha]:checked').each(function () {
            cargos = {
                Id: $(this).data("iddoccargo"),
                IdCargo: $(this).val(),
                IdDocumento: $("#emissao-documento-IdDocumento").val(),

            };
            arrayFormCargosObj.push(cargos);
        });

        return arrayFormCargosObj;

    },

    //Funcoes Emissao Documento Edit
    setHideAndShowEdit: function () {

        //Hide All
        $('div[id^=panel-form-]').hide();
        $('.nav-pills li').hide();
        $('#panel-form-cadastro').show();
        $('.btn-enviar-verificacao').hide();
        $('.btn-enviar-aprovacao').hide();
        $('.btn-voltar-elaboracao').hide();
        $('.btn-aprovar').hide();

        APP.controller.ControlDocController.hideOrShowWorkFlow();
        $('[name=formCadastroWorkflow]').trigger('change');

    },

    setHideButton: function () {

        $('.btn-enviar-verificacao').hide();
        $('.btn-enviar-aprovacao').hide();
        $('.btn-voltar-elaboracao').hide();
        $('.btn-aprovar').hide();

    },

    setWorkFlow: function () {

        $('[name=formCadastroWorkflow]').on('change', function () {

            var workFlow = APP.controller.ControlDocController.getWorkFlow();
            APP.controller.ControlDocController.setRulesWorkFlow(workFlow);

        });

    },

    getWorkFlow: function () {

        var workFlow = APP.component.Radio.init('formCadastroWorkflow');
        return workFlow;

    },

    setRulesWorkFlow: function (_workFlow) {

        var statusEtapa = parseInt($('[name=StatusEtapa]').val());

        if (_workFlow == 'sim') {
            switch (statusEtapa) {
                case 0:
                    $('.btn-enviar-verificacao').show();
                    break;
                case 1:
                    APP.controller.ControlDocController.setDisableVerificacao(statusEtapa);
                    $('.btn-enviar-aprovacao').show();
                    $('.btn-voltar-elaboracao').show();
                    $("input").attr("disabled", "disabled");
                    $(".quatro").hide();
                    break;
                case 2:
                    APP.controller.ControlDocController.setDisableVerificacao(statusEtapa);
                    $('.btn-aprovar').show();
                    $('.btn-voltar-elaboracao').show();
                    $("input").attr("disabled", "disabled");
                    $("#form-cargos-escolha-all").removeAttr("disabled");
                    $(".closeCargos").removeAttr("disabled");
                    
                    
                    break;
                case 3:
                    APP.controller.ControlDocController.setDisableVerificacao(statusEtapa);
                    break;
            }
        } else {
            APP.controller.ControlDocController.setHideButton();
        }

    },

    setDisableVerificacao: function (_statusEtapa) {

        $("[id^=form-emissao-documento-] :input").attr("disabled", true);
        $("[id^=tb-form-] tbody tr td:last-child").hide();

        if (_statusEtapa == 1) {
            $("#form-emissao-documento-comentarios :input").prop("disabled", false);
        } else if (_statusEtapa == 3) {
            $("#form-emissao-documento-assuntos :input").prop("disabled", false);
        }

    },

    hideOrShowWorkFlow: function () {

        var RadioFormCadastroWorkflow = APP.component.Radio.init('formCadastroWorkflow');

        if (RadioFormCadastroWorkflow != "sim") {
            $('#form-cadastro-verificador').closest('.form-group').hide();
            $('#form-cadastro-aprovador').closest('.form-group').hide();
        } else {
            $('#form-cadastro-verificador').closest('.form-group').show();
            $('#form-cadastro-aprovador').closest('.form-group').show();
        }
    },

    setShowTemplatesEmissaoDocumento: function () {
        $('[name=formCadastroEscolha]:checked').each(function () {
            var templateUtilizado = $(this).attr("id").split("-")[3];
            $("#panel-form-" + templateUtilizado).show();
        });
    },

};
/*
|--------------------------------------------------------------------------
| ControladorCategoriasController
|--------------------------------------------------------------------------
*/

APP.controller.ControladorCategoriasController = {

    init: function (_tipo, _site, funcaoListaAtivos, _btnClick) {

        APP.component.BootBox.chamaBootBox("Cadastro", "ControladorCategorias", "pnlCadUsu", this.behavior, "Cadastro", funcaoListaAtivos, _btnClick);

        this.behavior(_tipo, _site);

    },


    behavior: function (_tipo, _site) {

        var tipo = _tipo;
        var site = _site;
        limpaCamposEdicao();

        bind();

        function bind() {

            ////////////   Tabela unica da PartialView
            ConfigTabela('#tbCadastroCategoria');

            ////////////   Clean
            $('.cadastro-categoria-clean').on('click', () => {
                limpaCamposEdicao();
            });

            ////////////   Exibir Novo Registro
            $('#btn-new-tipo').on('click', function () {
                $('table tbody tr #descricao-hidden').parent().show();
            });

            ////////////   Edit
            $('tr td .edita-descricao').on('click', function (e) {

                ////Input Show
                var $idCurrentClick = $(e)[0].currentTarget.dataset.url;
                var $descricaoCategoria = $(e)[0].currentTarget.parentElement.parentElement.innerText;

                $('table tbody tr #descricao-hidden').parent().show();
                $('#id-cadastro-categoria').val($idCurrentClick);
                $('#nova-descricao-cadastro-categoria').val($descricaoCategoria);

            });

            ////////////   Save
            $('#cadastro-categoria-insert').on('click', () => {

                var controladorCategorias = {
                    'IdControladorCategorias': $('#id-cadastro-categoria').val(),
                    'IdSite': site,
                    'Descricao': $('#nova-descricao-cadastro-categoria').val(),
                    'TipoTabela': tipo,
                    'Ativo': true,
                    "__RequestVerificationToken": $("[name=__RequestVerificationToken]").val(),
                };

                ///ajax
                $.post('/ControladorCategorias/Salvar', controladorCategorias, function (callback) {
                    limpaCamposEdicao();

                }).done(function (result) {
                    refresh(tipo, site);



                }).fail(function (result) {
                    callBackError(result);
                });

            });

            ////////////   Delete
            $('tr td .exclui-descricao').on('click', function (e) {
                var $idCurrentClick = $(e)[0].currentTarget.dataset.url;
                var data = {
                    'idControladorCategorias': $idCurrentClick,
                    "__RequestVerificationToken": $("[name=__RequestVerificationToken]").val()
                };

                bootbox.confirm("Deseja realmente, excluir esse item?", function (result) {
                    if (result) {
                        // 
                        $.post('/ControladorCategorias/Excluir', data, function (data) {
                        }).done(function () {
                            refresh(tipo, site);
                        })
                            .fail(function (result) {
                                callBackError(result);
                            })
                            .always(function () {
                                refresh(tipo, site);
                            });
                    }
                });

            });

            ////////////   Ativa Desativa
            $('tr td .ativa-desativa').on('click', function (e) {
                var $idCurrentClick = $(e)[0].currentTarget.dataset.url;
                var data = {
                    'idControladorCategorias': $idCurrentClick,
                    "__RequestVerificationToken": $("[name=__RequestVerificationToken]").val()

                };
                $.post('/ControladorCategorias/AtivarDesativa', data, function (callback) {
                    limpaCamposEdicao();
                }).done(function () {
                    refresh(tipo, site);
                })
                    .fail(function (result) {
                        callBackError(result);
                    });

            });


        }

        function hideDescricao() {
            $('#descricao-hidden').parent().hide();
        }

        function limpaCamposEdicao() {
            $('#id-cadastro').val("");
            $('#nova-descricao-cadastro-categoria').val("");
            hideDescricao();
        }

        function refresh(tipo, site) {
            $.get("/ControladorCategorias/AtualizaTabela?tipo=" + tipo + "&site=" + site, function (result) {
                $("#pnlCadUsu").html(result);
                limpaCamposEdicao();
                bind();
            });
        }

    },

};

APP.controller.NotificacaoController = {

    init: function () {
        this.setNotificacao();
        this.atualiza();
    },

    atualiza: function () {
        $.ajax({
            url: "/Notificacao/Index",
            type: 'POST',
            data: {
                __RequestVerificationToken: _token
            },
            beforeSend: function () {

            },
            success: function (result) {

                $("#pnlNotificacoesUsuario").html(result);
                $('.badge').text($("[name=TotalNotificacoes]").val());
            },
            complete: function () {
                setTimeout(this.atualiza, 60000);
            },
            error: callBackError
        });
    },


    setNotificacao: function () {
        var html = "";
        html += '<li class="dropdown">';
        html += '<a class="dropdown-toggle" data-toggle="modal" data-target="#mdPendencia" href="#">';
        html += '<i class="fa fa-bell fa-2x" aria-hidden="true">  <span class="badge">0</span> </i>';
        html += '<span>'+ _options.TituloNotificacoes +'</span> </i>';
        html += '</a>';
        html += '</li>';

        $('#ulLayout').append(html);
    }



};


APP.controller.FuncionarioController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "AcoesFuncionario") {
            this.acoesFuncionario();
        }

    },

    setup: function () {

        //Criar Cliente
        this.buttonSalvar = $(".btn-salvar");

    },

    acoesFuncionario: function () {

        this.setValidateForms();
        this.formCriarCliente();
        this.formCriarSite();

        this.sendFormCriarUsuario();

    },

    setValidateForms: function () {

        var ObjFormCriarClienteValidate = APP.controller.ClienteController.getObjFormCriarFuncionarioValidate();
        APP.component.ValidateForm.init(ObjFormCriarClienteValidate, '#form-cria-funcionario');

    },

    //Formulario Criar Funcionario
    formCriarFuncionario: function () {

        this.setAndHideCriarFuncionario();

    },

    setAndHideCriarFuncionario: function () {

        //

    },


    getObjFormCriarFuncionarioValidate: function () {

        var funcionarioFormCriarFuncionarioObj = {
            //formCriaClienteLogo: {required: true, minFiles: 1},
            formCriaClienteNome: 'required',
            formCriaClienteUrl: 'required',
            formCriaClienteDtValidade: 'required',
            formCriaClienteTrocaSenha: 'required',
            formCriaClienteBloquear: 'required',
            formCriaClienteArmazenar: 'required',
            //formCriarClienteContrato: 'required',
        };

        return funcionarioFormCriarFuncionarioObj;

    },

    getObjFormCriarFuncionario: function () {

        var funcionarioFormCriarFuncionarioeObj = {
            formCriaClienteSenha: $('[name=formCriaClienteSenha]:checked').val(),
        };

        return funcionarioFormCriarFuncionarioeObj;

    },

    //Todos
    sendFormCriarFuncionario: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = APP.controller.ClienteController.validateForms();

            //var validate = true;
            if (validate == true) {

                var clienteObj = APP.controller.ClienteController.getCriarClienteObj();
                APP.controller.ClienteController.saveFormCriarCliente(clienteObj);
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    getCriarFuncionarioObj: function () {

        var funcionarioObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                switch (form) {
                    case "funcionario":
                        funcionarioObj = APP.controller.ClienteController.getObjFormCriarCliente();
                        break;
                }
            }

        });

        return funcionarioObj;

    },

    saveFormCriarFuncionario: function (funcionario) {

        $.ajax({
            type: "POST",
            data: funcionario,
            dataType: 'json',
            processData: false,
            contentType: false,// not json
            url: "/Cliente/SalvarCliente",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {

                if (result.StatusCode == 200) {
                    bootbox.alert("Salvo com sucesso!");
                    //window.location.reload();
                }
                else if (result.StatusCode == 500) {
                    var erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

};
/*
|--------------------------------------------------------------------------
| General
|--------------------------------------------------------------------------
*/

APP.controller.General = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.start();
        this.controllerPages(page);

    },

    start: function () {
        //APP.component.Modal.init();        
        APP.component.UserMenu.init();
        APP.component.Loading.init();
        APP.component.Calendar.init();
        APP.component.Menu.init();
    },

    controllerPages: function (page) {
        //Controle das Pages

        //Login
        if (page == "Login" || page == "RecuperarSenha" || page == "AlterarSenhaLogin") {
            this.loginController();
        }

        //Home
        if (page == "Index") {
            this.homeController();
        }

        //Cliente
        if (page == "IndexCliente" || page == "CriarCliente") {
            this.clienteController();
        }

        //MeusDados
        if (page == "IndexUsuario" || page == "MeusDados" || page == "AlterarSenha" || page == "CriarUsuario") {
            this.usuarioController();
        }

        //Site
        if (page == "IndexSite" || page == "CriarSite") {
            this.siteController();
        }

        //Cargo
        if (page == "IndexCargo" || page == "CriarCargo") {
            this.cargoController();
        }

        //Nao Conformidade
        if (page === "IndexNaoConformidade" || "CriarNaoConformidade" || "EditarNaoConformidade") {
            this.naoConformidadeController();
        }

        //Acao Corretiva
        if (page === "IndexAcaoCorretiva" || "EditarAcaoCorretiva") {
            this.acaoCorretivaController();
        }

        //Gestao de Risco
        if (page === "IndexGestaoDeRisco" || "CriarGestaoDeRisco") {
            this.gestaoDeRiscoController();
        }

        //Instrumentos
        if (page === "IndexInstrumentos" || "CriarInstrumentos") {
            this.instrumentosController();
        }

        //Analise Critica
        if (page === "IndexAnaliseCritica" || page === "CriarAnaliseCritica") {
            this.analiseCriticaController();
        }

        //Indicador
        if (page == "IndexIndicador" || page == "CriarIndicador" || page === "RelatorioBarras" || page == "RelatorioColuna" || page == "DashBoard") {
            this.indicadorController();
        }

        //Control Doc
        if (page == "EmissaoDocumento" || page == "ListDocumentos" || page == "ConteudoDocumento") {
            this.controlDocController();
        }

        //Fornecedores
        if (page == "IndexProdutos" || page == "AcoesProdutos" || page == "IndexFornecedores" || page == "AcoesFornecedores") {
            this.fornecedoresController();
        }

        //Notificacao
        if (page != "Login" && page != "Cliente" && page != "RecuperarSenha" && page != "AlterarSenhaLogin" && page != "AlterarSenha") {
            this.notificacaoController();
        }

        //Relatorio
        if (page == "DashBoard") {
            this.relatorioController();
        }

        //Auditoria
        if (page == "IndexAuditoria") {
            this.auditoriaController();
        }
        //Norma
        if (page == "IndexNorma") {
            this.normaController();
        }
        //Plai
        if (page == "AcoesPlai") {
            this.plaiController();
        }

    },

    loginController: function () {
        APP.controller.LoginController.init();
    },

    homeController: function () {
        APP.controller.HomeController.init();
    },

    clienteController: function () {

        APP.controller.ClienteController.init();

    },

    naoConformidadeController: function () {
        APP.controller.NaoConformidadeController.init();
    },

    acaoCorretivaController: function () {
        APP.controller.AcaoCorretivaController.init();
    },

    gestaoDeRiscoController: function () {
        APP.controller.GestaoDeRiscoController.init();
    },

    instrumentosController: function () {
        APP.controller.InstrumentosController.init();
    },

    analiseCriticaController: function () {
        APP.controller.AnaliseCriticaController.init();
    },

    indicadorController: function () {
        APP.controller.IndicadorController.init();
    },

    controlDocController: function () {
        APP.controller.ControlDocController.init();
    },

    fornecedoresController: function () {
        APP.controller.FornecedoresController.init();
    },

    notificacaoController: function () {
        APP.controller.NotificacaoController.init();
    },

    usuarioController: function () {
        APP.controller.UsuarioController.init();
    },

    siteController: function () {
        APP.controller.SiteController.init();
    },

    cargoController: function () {
        APP.controller.CargoController.init();
    },

    auditoriaController: function () {
        APP.controller.AuditoriaController.init();
    },

    relatorioController: function () {
        APP.controller.RelatorioController.init();
    },

    normaController: function () {
        APP.controller.NormaController.init();
    },

    plaiController: function () {
        APP.controller.PlaiController.init();
    },

    processoController: function () {
        APP.controller.ProcessoController.init();
    },

};

/*
|--------------------------------------------------------------------------
| Controlador Gestao de Risco
|--------------------------------------------------------------------------
*/

APP.controller.GestaoDeRiscoController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "IndexGestaoDeRisco") {
            this.indexGestaoDeRisco();
        }
        if (page == "CriarGestaoDeRisco") {
            this.acoesGestaoDeRisco();

        }
    },

    setup: function () {
        //Index Gestao De Risco
        this.buttonDelGestaoDeRisco = $(".del-gestao-de-risco");

        //Criar Gestao De Risco
        this.buttonSalvar = $(".btn-salvar");

        //Editar Gestao De Risco
        this.buttonAddAcaoImediata = $('.add-acao-imediata');

        //Criar Gestao De Risco
        this.buttonDestravar = $(".btn-destravar");
    },

    //Models
    models: {
        AnexoModel: APP.model.Anexo,
    },

    //Index Gestao De Risco
    indexGestaoDeRisco: function () {

        APP.component.DataTable.setDataTableParam('#tb-index-gestao-de-risco', 0, "desc", "Tags");
        this.delGestaoDeRisco();

    },

    delGestaoDeRisco: function () {
        
        var tabelaGestaoRisco = $('#tb-index-gestao-de-risco').DataTable();

        this.buttonDelGestaoDeRisco.on('click', function (event) {
            event.preventDefault();

            var IdRegistroConformidade = $(this).data('idGestaoDeRisco');
            var $AtualRow = $(this).parents('tr');
                    
            console.log("IdRegistroConformidade:= ", IdRegistroConformidade);

            bootbox.confirm(_options.MsgDesejaExcluirRegistro, function (result) {
                    if (result) {
                        $.get('/GestaoDeRisco/Excluir?idGestaoDeRisco=' + IdRegistroConformidade, function (data, status) {
                        }).done(function (data) {
                            if (data.StatusCode == "200") {
                                tabelaGestaoRisco.row($AtualRow).remove().draw();
                                bootbox.alert(data.Success, function (result) {
                                    window.location.href = "/GestaoDeRisco/Index";
                                });
                                
                            }
                        });
                    }
                });
            });

        //    var msgIconeDeleteNC = $('[name=msgIconeDeleteGR]').val();

        //    bootbox.confirm(msgIconeDeleteNC, function (result) {
        //        if (result == true) {
        //            APP.controller.GestaoDeRiscoController.setDelGestaoDeRisco();
        //        }
        //    });

        //});

    },

    setDelGestaoDeRisco: function () {

        var idGestaoDeRisco = $('.del-gestao-de-risco').data("id-gestao-de-risco");
        var data = {
            "idGestaoDeRisco": idGestaoDeRisco,
            "__RequestVerificationToken": $("[name=__RequestVerificationToken]").val()
        };

        var erro = "";

        $.ajax({
            type: "POST",
            dataType: 'json',
            data: data,
            url: "/GestaoDeRisco/RemoverComAcaoConformidade",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {

                if (result.StatusCode == 200) {
                    window.location.reload([true]);
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    //Acoes Gestao De Risco
    acoesGestaoDeRisco: function () {
        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        APP.component.FileUpload.init();
        APP.component.Mascaras.init();
        APP.component.BarRating.setBarRating('[name=formCriarNaoConformidadeCriticidade]', 'bars-1to10');
        //this.getProcessosPorSite();
        if ($('[name=IdRegistroConformidade]').val() > 0) {
            APP.controller.GestaoDeRiscoController.getTemasCores();
        }


        this.setAndHide();
        this.setValidateForms();

        this.setDestravarCamposGestaoRisco();
        this.sendFormCriarNaoConformidade();

        if (habilitaLoad == 'sim') {

            this.HabilitaCamposGestaoRisco(perfil);
        }

        APP.controller.GestaoDeRiscoController.setRulesNecessitaAcao();
    },

    getProcessosPorSite: function () {

        var idSite = $('#nao-conformidade-site').val();
        $.get('/Processo/ListaProcessosPorSite?idSite=' + idSite, function (result) {
            $.each(result.Lista, (key, val) => {
                var $option = $('<option></option>');
                $('[name=formCriarNaoConformidadeProcesso]').append(
                    $option.val(val.IdProcesso).text(val.Nome)
                );
            });
        });

    },

    setAndHide: function () {

        //Verifica Status Etapa
        var statusEtapa = parseInt($('[name=StatusEtapa]').val());
        switch (statusEtapa) {
            case 0:
                this.setShowAndHideStatusEtapa0();
                this.formCriarNaoConformidade();
                break;
            case 1:
                this.setShowAndHideStatusEtapa1();
                this.formAcaoImediata();
                break;
            case 2:
                this.setShowAndHideStatusEtapa2();
                this.formAcaoImediata();
                break;
            case 3:
                this.setShowAndHideStatusEtapa3();
                this.formAcaoImediata();
                break;
            case 4:
                this.setShowAndHideStatusEtapa4();
                break;
        }

    },

    setValidateForms: function () {

        var ObjFormCriarNaoConformidadeValidate = APP.controller.GestaoDeRiscoController.getObjObjFormCriarNaoConformidadeValidate();
        APP.component.ValidateForm.init(ObjFormCriarNaoConformidadeValidate, '#form-criar-gestaoderisco');
        APP.component.ValidateForm.init(ObjFormCriarNaoConformidadeValidate, '#form-acaoimediata');

    },

    //Interacao de Tela - StatusEtapa 0
    setShowAndHideStatusEtapa0: function () {

        $('#panel-acaoimediata').hide();
        $('[name=formCriarNaoConformidadeNmRegistro]').closest('div').hide();
        $('#lblformCriarNaoConformidadeNmRegistro').closest('div').hide();
        $('[name=formCriarNaoConformidadeResponsavel]').closest('div').hide();        
        $('[name=formCausa]').closest('div').hide();

        

    },

    //Interacao de Tela - StatusEtapa 1
    setShowAndHideStatusEtapa1: function () {

        this.setDisabledStatusEtapa1(true);
        this.setHideStatusEtapa1();

    },

    setDisabledStatusEtapa1: function (_disabled) {
        //Formulario Nao Conformidade
        $('[name=formCriarNaoConformidadeDsRegistro]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDsJustificativa]').prop('disabled', _disabled);
        
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDtEmissao]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeProcesso]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEmissor]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeResponsavel]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataEProcedente]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTags]').prop('disabled', _disabled);
        $('[name=formCausa]').prop('disabled', _disabled);

    },

    setHideStatusEtapa1: function () {

        //Formulario Acao Imediata
        $('[name=formAcaoImadiataFoiEficaz]').closest('[class^=col]').hide();
        APP.controller.GestaoDeRiscoController.checkSizeTableAcaoImediata();
        APP.controller.GestaoDeRiscoController.setHideRowAcaoImediata();

    },

    setHideRowAcaoImediata: function () {

        $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').closest('div').hide();
        $('[name=formAcaoImadiataTbEvidencia]').closest('div').hide();

    },

    checkSizeTableAcaoImediata: function () {

        var sizeTable = $('#tb-acao-imediata tbody tr').size();

        if (sizeTable > 0) {
            $('[name=formAcaoImadiataResponsavelReverificacao]').closest('[class^=col]').show();
        } else {
            $('[name=formAcaoImadiataResponsavelReverificacao]').closest('[class^=col]').hide();
        }

    },

    //Interacao de Tela - StatusEtapa 2
    setShowAndHideStatusEtapa2: function () {

        this.setHideStatusEtapa2();
        this.setDisabledStatusEtapa2(true);
        this.setShowInputsEtapa2();

    },

    setHideStatusEtapa2: function () {

        //Botoes Acoes
        $('#tb-acao-imediata tbody tr').each(function () {
            $(this).find('td').last().hide();
        });
        $('[name=formAcaoImadiataFoiEficaz]').closest('[class^=col]').hide();
        $('.add-acao-imediata').hide();

    },

    setDisabledStatusEtapa2: function (_disabled) {

        //Formulario Nao Conformidade
        $('[name=formCriarNaoConformidadeDsRegistro]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDsJustificativa]').prop('disabled', _disabled);
        
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDtEmissao]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeProcesso]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEmissor]').prop('disabled', _disabled);
        $('#add-tipo-nao-conformidade').prop('disabled', _disabled);
        $('[name=formAcaoImadiataEProcedente]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeResponsavel]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTags]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeCriticidade]').prop('disabled', _disabled);

        //Formulario Acao Imediata
        $('[name=formAcaoImadiataDtDescricaoAcao]').prop('disabled', _disabled);
        //Table Acao Imediata
        $('[name=formAcaoImadiataTbDescricao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtPrazoImplementacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbResponsavelImplementar]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').prop('disabled', _disabled);
        $('.upload-arq form-control').prop('disabled', _disabled);
        //Upload Changes
        $('[class^=btn-upload-form-acaoimediata-tb-evidencia]').closest('div').css('background-color', '#eee');
        $('[name=formAcaoImadiataTbEvidencia]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelReverificacao]').prop('disabled', _disabled);
        $('[name=formCausa]').prop('disabled', _disabled);

    },

    setShowInputsEtapa2: function () {

        var idUsuarioLogado = $('[name=UsuarioLogado]').val();
        var idPerfil = $('[name=IdPerfil]').val();
        $('#tb-acao-imediata tbody tr').each(function () {
            var idResponsavelImplementar = $(this).find('[name=formAcaoImadiataTbResponsavelImplementar]').val();
            if ((idResponsavelImplementar == idUsuarioLogado) || idPerfil != 4) {
                $(this).find('[name=formAcaoImadiataTbDtEfetivaImplementacao]').prop('disabled', false);
                $(this).find('[name=formAcaoImadiataTbEvidencia]').prop('disabled', false);
                $(this).find('[class^=btn-upload-form-acaoimediata-tb-evidencia]').closest('div').css('background-color', '#fff');
            }
        });

    },

    //Interacao de Tela - StatusEtapa 3
    setShowAndHideStatusEtapa3: function () {

        this.setHideStatusEtapa3();
        this.setDisabledStatusEtapa3(true);
        this.setShowInputsEtapa3();
        this.setCheckAcaoImediataOk();
        this.setCheckAcaoImediataNotOk();
        this.setBackChecksOnPage();

    },

    setHideStatusEtapa3: function () {

        //Botoes Acoes
        $('#tb-acao-imediata tbody tr').each(function () {
            $(this).find('td').last().hide();
        });
        $('[name=formAcaoImadiataFoiEficaz]').closest('[class^=col]').hide();
        $('.add-acao-imediata').hide();

    },

    setDisabledStatusEtapa3: function (_disabled) {

        //Formulario Nao Conformidade
        $('[name=formCriarNaoConformidadeDsRegistro]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDsJustificativa]').prop('disabled', _disabled);
        
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDtEmissao]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeProcesso]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEmissor]').prop('disabled', _disabled);
        $('#add-tipo-nao-conformidade').prop('disabled', _disabled);
        $('[name=formAcaoImadiataEProcedente]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeResponsavel]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTags]').prop('disabled', _disabled);

        //Formulario Acao Imediata
        $('[name=formAcaoImadiataDtDescricaoAcao]').prop('disabled', _disabled);
        //Table Acao Imediata
        $('[name=formAcaoImadiataTbDescricao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtPrazoImplementacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbResponsavelImplementar]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').prop('disabled', _disabled);
        $('.upload-arq form-control').prop('disabled', _disabled);
        //Upload Changes
        $('[name^=formCriarNaoConformidadeEvidencia]').closest('div').css('background-color', '#eee');
        $('[name=formAcaoImadiataTbEvidencia]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelReverificacao]').prop('disabled', _disabled);
        $('[name=formCausa]').prop('disabled', _disabled);
    },

    setShowInputsEtapa3: function () {

        var idUsuarioLogado = $('[name=UsuarioLogado]').val();
        var idPerfil = $('[name=IdPerfil]').val();

        var idResponsavelReverificacao = $('[name=formAcaoImadiataResponsavelReverificacao]').val();
        if ((idResponsavelReverificacao == idUsuarioLogado) || idPerfil != 4) {
            $('#tb-acao-imediata tbody tr').each(function () {
                $(this).find('td').last().show();
                $(this).find('.btn-delete-acao-imediata').hide();
            });

            $('[name=formAcaoImadiataFoiEficaz]').closest('[class^=col]').show();

        }

    },

    setCheckAcaoImediataOk: function () {

        $('.btn-confirm-acao-imediata').on('click', function () {
            $(this).closest('td').find('.btn-confirm-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-denied-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-ok-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('[name=formAcaoImadiataTbAprovado]').val(true);
            APP.controller.GestaoDeRiscoController.getChecksAcaoImediata();
        });

    },

    setCheckAcaoImediataNotOk: function () {

        $('.btn-denied-acao-imediata').on('click', function () {
            $(this).closest('td').find('.btn-confirm-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-denied-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-notok-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('[name=formAcaoImadiataTbAprovado]').val(false);
            APP.controller.GestaoDeRiscoController.getChecksAcaoImediata();
        });

    },

    getChecksAcaoImediata: function () {
        var checkSize = 0;
        var checkAcaoImediata = $('#tb-acao-imediata tbody tr').find('[name=formAcaoImadiataTbAprovado]');
        for (i = 0; i < checkAcaoImediata.size(); i++) {
            var valueAprovador = $(checkAcaoImediata[i]).val();
            if (valueAprovador == "true") {
                checkSize++;
            }
        }
        if (checkSize == checkAcaoImediata.size()) {
            $('[name=formAcaoImadiataFoiEficaz').filter('[value=true]').prop('checked', true);
        } else {
            $('[name=formAcaoImadiataFoiEficaz').filter('[value=false]').prop('checked', true);
        }

    },

    setBackChecksOnPage: function () {
        $('.fa-check-circle, .fa-times-circle').unbind('click');
        $('.fa-check-circle, .fa-times-circle').on('click', function () {
            $(this).closest('td').find('.btn-ok-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-notok-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-confirm-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('.btn-denied-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('[name=formAcaoImadiataTbAprovado]').val('');
            APP.controller.GestaoDeRiscoController.getChecksAcaoImediata();

        });
    },

    //Interacao de Tela - StatusEtapa 4
    setShowAndHideStatusEtapa4: function () {

        this.setHideStatusEtapa4();
        this.setTriggerRadioButtonsEtapa4('change');
        this.setDisabledStatusEtapa4(true);
        this.setShowInputsEtapa4();

    },

    setHideStatusEtapa4: function () {

        //Botoes Acoes
        $('#tb-acao-imediata tbody tr').each(function () {
            $(this).find('.btn-delete-acao-imediata').hide();
            $(this).find('.btn-confirm-acao-imediata').hide();
            $(this).find('.btn-denied-acao-imediata').hide();
        });
        $('.add-acao-imediata').hide();
        APP.controller.GestaoDeRiscoController.setNecessitaAcao();

    },

    setTriggerRadioButtonsEtapa4: function (_change) {

        $('[name=formAcaoImadiataEProcedente]').trigger(_change);
        $('[name=formAcaoImadiataECorrecao]').trigger(_change);
        $('[name=formAcaoImadiataNecessitaAC]').trigger(_change);

    },

    setDisabledStatusEtapa4: function (_disabled) {

        //Formulario Nao Conformidade
        $('[name=formCriarNaoConformidadeDsRegistro]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDsJustificativa]').prop('disabled', _disabled);
        
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDtEmissao]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeProcesso]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEmissor]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEAuditoria]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTipo]').prop('disabled', _disabled);
        $('#add-tipo-nao-conformidade').prop('disabled', _disabled);
        $('[name=formAcaoImadiataEProcedente]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeResponsavel]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTags]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTags]').prop('disabled', _disabled);

        //Formulario Acao Imediata
        $('[name=formAcaoImadiataEProcedente]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataDtDescricaoAcao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataJustificativa]').prop('disabled', _disabled);
        //Table Acao Imediata
        $('[name=formAcaoImadiataTbDescricao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtPrazoImplementacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbResponsavelImplementar]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').prop('disabled', _disabled);
        $('.upload-arq form-control').prop('disabled', _disabled);
        //Upload Changes
        $('[name^=formCriarNaoConformidadeEvidencia]').closest('div').css('background-color', '#eee');
        $('[name=formAcaoImadiataTbEvidencia]').prop('disabled', _disabled);
        $('.btn-delete-acao-imediata').prop('disabled', _disabled);
        $('.btn-confirm-acao-imediata').prop('disabled', _disabled);
        $('.btn-denied-acao-imediata').prop('disabled', _disabled);
        $('.btn-ok-acao-imediata').prop('disabled', _disabled);
        $('.btn-notok-acao-imediata').prop('disabled', _disabled);
        $('[name=formAcaoImadiataECorrecao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataNecessitaAC]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelReverificacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataFoiEficaz]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelTratativa]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataAnaliseCausa]').prop('disabled', _disabled);
        $('[name=formCausa]').prop('disabled', _disabled);

    },

    setShowInputsEtapa4: function () {


        $('#tb-acao-imediata tbody tr').each(function () {
            var aprovado = $(this).find('[name=formAcaoImadiataTbAprovado]');
            if (aprovado == "true") {
                $(this).find('.btn-ok-acao-imediata').show();
            } else {
                $(this).find('.btn-notok-acao-imediata').show();
            }

        });

    },

    //Auxiliares
    getFoiEficaz: function () {

        var FoiEficaz = APP.component.Radio.init('formAcaoImadiataFoiEficaz');
        return FoiEficaz;

    },

    getNecessitaAcao: function () {

        var NecessitaAcao = APP.component.Radio.init('formAcaoImadiataEProcedente');
        return NecessitaAcao;

    },

    //Rules
    setRulesNecessitaAcao: function () {

        var necessitaAcao = APP.controller.GestaoDeRiscoController.getNecessitaAcao();
        if (necessitaAcao == "false") {
            $('[name=formCriarNaoConformidadeResponsavel]').closest('[class^=col]').hide();
            $('[name=formCriarNaoConformidadeNmRegistro]').closest('[class^=col]').hide();
            $('#lblformCriarNaoConformidadeNmRegistro').closest('div').hide();
            
            $('[name=formCausa]').closest('div').hide();
            $('#form-acaoimediata').hide();
            $("#painel-acao-corretiva-nao").show();
            $('#painel-acao-corretiva-sim').hide();
        } else {
            $('[name=formCriarNaoConformidadeResponsavel]').closest('[class^=col]').show();
            $('[name=formCriarNaoConformidadeNmRegistro]').closest('[class^=col]').show();
            $('#lblformCriarNaoConformidadeNmRegistro').closest('div').show();
            
            $('[name=formCausa]').closest('div').show();
            $('#form-acaoimediata').show();
            $('#painel-acao-corretiva-sim').show();
            $("#painel-acao-corretiva-nao").hide();
            
        }

    },

    //Change
    setNecessitaAcao: function () {

        $('[name^=formAcaoImadiataEProcedente]').on('change', function () {

            APP.controller.GestaoDeRiscoController.setRulesNecessitaAcao();

        });

    },

    //Formulario Criar Nao Conformidade
    formCriarNaoConformidade: function () {

        this.setAndHideCriarNaoConformidade();
        this.getformCriarNaoConformidadeDtEmissao();
        this.getProcessosPorSite();
        this.getEmissorPorSite();
        this.setResponsavelAnaliseDefinicaoAC();
        this.setEProcedente();
        APP.controller.GestaoDeRiscoController.setNecessitaAcao();

    },

    setAndHideCriarNaoConformidade: function () {

        //

    },

    getformCriarNaoConformidadeDtEmissao: function () {

        $('[name=formCriarNaoConformidadeDtEmissao]').val(APP.component.Datatoday.init());

    },

    getProcessosPorSite: function () {

        var idSite = $('#nao-conformidade-site').val();
        $.get('/Processo/ListaProcessosPorSite?idSite=' + idSite, function (result) {
            $.each(result.Lista, (key, val) => {
                var $option = $('<option></option>');
                $('[name=formCriarNaoConformidadeProcesso]').append(
                    $option.val(val.IdProcesso).text(val.Nome)
                );
            });
        });

    },

    getEmissorPorSite: function () {

        var idSite = $('#nao-conformidade-site').val();
        var idFuncao = 89; // Funcionalidade(Cadastrar) que permite usuario criar nc
        $.get('/Usuario/ObterUsuariosPorFuncao?idSite=' + idSite +'&idFuncao=' + idFuncao +'', (result) => {
            if (result.StatusCode == 200) {
                APP.component.SelectListCompare.selectList(result.Lista, $('[name=formCriarNaoConformidadeEmissor] option'), $('[name=formCriarNaoConformidadeEmissor]'), 'IdUsuario', 'NmCompleto');
            }
        });

    },

    setResponsavelAnaliseDefinicaoAC: function () {

        $('[name=formCriarNaoConformidadeProcesso]').on('change', function () {
            var idSite = $('#nao-conformidade-site').val();
            processoSelecionado = $(this).find(':selected').val();
            var idFuncao = 90; // Funcionalidade(Define aÃ§Ã£o)
            $.get('/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso=' + processoSelecionado + '&idSite=' + idSite +'idFuncao=' + idFuncao +'', (result) => {
                if (result.StatusCode == 200) {
                    $('[name=formCriarNaoConformidadeResponsavel] option').not(':first-child').remove();
                    APP.component.SelectListCompare.selectList(result.Lista, $('[name="formCriarNaoConformidadeResponsavel"] option'), $('[name="formCriarNaoConformidadeResponsavel"]'), 'IdUsuario', 'NmCompleto');
                }
            });

        });

    },

    setEProcedente: function () {

        $('[name=formAcaoImadiataEProcedente]').on('change', function () {

            if ($(this).val() == "true") {
                $('[name=formCriarNaoConformidadeResponsavel]').closest('div').show();
                $('[name=formCriarNaoConformidadeNmRegistro]').closest('div').show();
                $('#lblformCriarNaoConformidadeNmRegistro').closest('div').show();

            } else {
                $('[name=formCriarNaoConformidadeResponsavel]').closest('div').hide();
                $('[name=formCriarNaoConformidadeNmRegistro]').closest('div').hide();
                $('#lblformCriarNaoConformidadeNmRegistro').closest('div').hide();
            }
        });

    },

    getUltimaDataEmissao: function (_fluxo) {

        var dtEmissao = $('[name=formCriarNaoConformidadeDtEmissao]').val();
        var idSite = $('#nao-conformidade-site').val();

        $.ajax({
            url: "/NaoConformidade/ObtemUltimaDataEmissao/",
            type: "GET",
            data: {
                "site": idSite
            },
            async: false,
            success: function (result) {
                if (result.StatusCode == 200) {
                    var dataCompare = APP.component.Datatoday.getCompareDate(dtEmissao, result.UltimaDataEmissao);
                    var labelDesejaCriarNcDtEmissaoAnteriorAUltima = $('[name=labelDesejaCriarNcDtEmissaoAnteriorAUltima]').val();
                    if (!true) {
                        bootbox.confirm(labelDesejaCriarNcDtEmissaoAnteriorAUltima, function (result) {
                            if (result) {
                                var naoConformidadeObj = APP.controller.GestaoDeRiscoController.getCriarNaoConformidadeObj(_fluxo);
                                APP.controller.GestaoDeRiscoController.saveFormCriarNaoConformidade(naoConformidadeObj, _fluxo);
                            }
                        });
                    } else {
                        var naoConformidadeObj = APP.controller.GestaoDeRiscoController.getCriarNaoConformidadeObj(_fluxo);
                        APP.controller.GestaoDeRiscoController.saveFormCriarNaoConformidade(naoConformidadeObj, _fluxo);
                    }
                }
            }
        });

    },

    getObjObjFormCriarNaoConformidadeValidate: function () {

        var acoesNaoConformidadeoFormCriarNaoConformidadeObj = {
            //formCriarNaoConformidadeNmRegistro: 'required',
            formCriarNaoConformidadeDsRegistro: {
                'required': true,
                'minlength': 4
            },
            formCriarNaoConformidadeDtEmissao: { 'required': true },
            formCriarNaoConformidadeProcesso: { 'required': true },
            formCriarNaoConformidadeEmissor: 'required',
            //formCriarNaoConformidadeResponsavel: 'required',
            //formCriarNaoConformidadeTags: 'required',

            //Form Acao Imediata
            // formAcaoImadiataEProcedente: {'required': true},
            // formAcaoImadiataDtDescricaoAcao: {'required': true},
            // formAcaoImadiataJustificativa: {'required': true},
            // formAcaoImadiataTbDescricao: {'required': true},
            // formAcaoImadiataTbDtPrazoImplementacao: {'required': true},
            // formAcaoImadiataTbResponsavelImplementar: {'required': true},
            // formAcaoImadiataTbDtEfetivaImplementacao: {'required': true},
            // formAcaoImadiataTbEvidencia: {'required': true},
            // formAcaoImadiataECorrecao: {'required': true},
            // formAcaoImadiataNecessitaAC: {'required': true},
            // formAcaoImadiataResponsavelReverificacao: {'required': true},
            // formAcaoImadiataFoiEficaz: {'required': true},
            // formAcaoImadiataResponsavelTratativa: {'required': true},
            // formAcaoImadiataNumeroAC: {'required': true},
            // formAcaoImadiataAnaliseCausa: {'required': true},
        };

        return acoesNaoConformidadeoFormCriarNaoConformidadeObj;

    },

    getObjFormCriarNaoConformidade: function (_fluxo) {

        var acoesNaoConformidadeFormCriarNaoConformidadeObj = {};

        switch (_fluxo) {
            case "fluxo-00":
                //Obj enviado no fluxo de criacao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    IdSite: $('[name=IdSite]').val(),
                    StatusEtapa: parseInt($('[name=StatusEtapa]').val()),
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    ArquivosDeEvidenciaAux: APP.controller.GestaoDeRiscoController.getAnexosEvidencias(),
                    DtEmissao: $('[name=formCriarNaoConformidadeDtEmissao]').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    CriticidadeGestaoDeRisco: $('[name=formCriarNaoConformidadeCriticidade] :selected').val(),
                    EProcedente: $('[name=formAcaoImadiataEProcedente]:checked').val(),
                    Causa: $('[name=formCausa]').val(),
                };

                break;

            case "fluxo-02":
                //Obj enviado no fluxo 02 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: 2,
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    DtDescricaoAcao: $('[name=formAcaoImadiataDtDescricaoAcao]').val(),
                    AcoesImediatas: APP.controller.GestaoDeRiscoController.getObjFormAcaoImediata(),
                    ECorrecao: APP.component.Radio.init('formAcaoImadiataECorrecao'),
                    NecessitaAcaoCorretiva: APP.component.Radio.init('formAcaoImadiataNecessitaAC'),
                    IdResponsavelPorIniciarTratativaAcaoCorretiva: $('[name=formAcaoImadiataResponsavelTratativa]').val(),
                    DescricaoAnaliseCausa: $('[name=formAcaoImadiataAnaliseCausa]').val(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    DtEmissao: $('[name=formCriarNaoConformidadeDtEmissao]').val(),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    CriticidadeGestaoDeRisco: $('[name=formCriarNaoConformidadeCriticidade] :selected').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdResponsavelReverificador: $('[name=formAcaoImadiataResponsavelReverificacao]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    DtPrazoImplementacao: $('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    DsAcao: $('[name=formAcaoImadiataTbDescricao]').val(),
                    EProcedente: $('[name=formAcaoImadiataEProcedente]:checked').val(),                  
                    ArquivosDeEvidenciaAux: APP.controller.GestaoDeRiscoController.getAnexosEvidencias(),
                    Causa: $('[name=formCausa]').val(),
                };

                break;
            case "fluxo-03":
                //Obj enviado no fluxo 03 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: 2,
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    AcoesImediatas: APP.controller.GestaoDeRiscoController.getObjFormAcaoImediata(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    DtEmissao: $('[name=formCriarNaoConformidadeDtEmissao]').val(),
                    NecessitaAcaoCorretiva: APP.component.Radio.init('formAcaoImadiataNecessitaAC'),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    CriticidadeGestaoDeRisco: $('[name=formCriarNaoConformidadeCriticidade] :selected').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdResponsavelReverificador: $('[name=formAcaoImadiataResponsavelReverificacao]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    DtPrazoImplementacao: $('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    DsAcao: $('[name=formAcaoImadiataTbDescricao]').val(),
                    EProcedente: $('[name=formAcaoImadiataEProcedente]:checked').val(),
                    ArquivosDeEvidenciaAux: APP.controller.GestaoDeRiscoController.getAnexosEvidencias(),
                    Causa: $('[name=formCausa]').val(),
                };
                break;
            case "fluxo-04":
                //Obj enviado no fluxo 04 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: $('[name=StatusEtapa]').val(),
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    AcoesImediatas: APP.controller.GestaoDeRiscoController.getObjFormAcaoImediata(),
                    FlEficaz: APP.controller.GestaoDeRiscoController.getFoiEficaz(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    DtEmissao: $('[name=formCriarNaoConformidadeDtEmissao]').val(),
                    NecessitaAcaoCorretiva: APP.component.Radio.init('formAcaoImadiataNecessitaAC'),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    CriticidadeGestaoDeRisco: $('[name=formCriarNaoConformidadeCriticidade] :selected').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdResponsavelReverificador: $('[name=formAcaoImadiataResponsavelReverificacao]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    DtPrazoImplementacao: $('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    DsAcao: $('[name=formAcaoImadiataTbDescricao]').val(),
                    EProcedente: $('[name=formAcaoImadiataEProcedente]:checked').val(),
                    ArquivosDeEvidenciaAux: APP.controller.GestaoDeRiscoController.getAnexosEvidencias(),
                    Causa: $('[name=formCausa]').val(),
                };
                break;
            case "fluxo-05":
                //Obj enviado no fluxo 04 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: $('[name=StatusEtapa]').val(),
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    AcoesImediatas: APP.controller.GestaoDeRiscoController.getObjFormAcaoImediata(),
                    FlEficaz: APP.controller.GestaoDeRiscoController.getFoiEficaz(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    DtEmissao: $('[name=formCriarNaoConformidadeDtEmissao]').val(),
                    NecessitaAcaoCorretiva: APP.component.Radio.init('formAcaoImadiataNecessitaAC'),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    CriticidadeGestaoDeRisco: $('[name=formCriarNaoConformidadeCriticidade] :selected').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdResponsavelReverificador: $('[name=formAcaoImadiataResponsavelReverificacao]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    DtPrazoImplementacao: $('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    DsAcao: $('[name=formAcaoImadiataTbDescricao]').val(),
                    EProcedente: $('[name=formAcaoImadiataEProcedente]:checked').val(),
                    ArquivosDeEvidenciaAux: APP.controller.GestaoDeRiscoController.getAnexosEvidencias(),
                    Causa: $('[name=formCausa]').val(),
                };
                break;
        }

        return acoesNaoConformidadeFormCriarNaoConformidadeObj;

    },

    getAnexosEvidencias: function () {

        var anexoEvidenciaModel = APP.controller.ClienteController.models.AnexoModel;
        var arrayAnexoEvidencia = [];

        $('.dashed li a:first-child').each(function () {

            var nameImg = $(this).text();
            var anexoEvidenciaNC = anexoEvidenciaModel.constructor(
                $(this).closest('li').find('[name=formCriarNaoConformidadeEvidenciaIdAnexo]').val(),
                nameImg,
                $(this).data('b64')
            );

            arrayAnexoEvidencia.push(anexoEvidenciaNC);
        });

        return arrayAnexoEvidencia;

    },

    //Formulario Acao Imediata
    formAcaoImediata: function () {

        this.setAndHideAcaoImediata();
        this.getformCriarNaoConformidadeDtDescricaoAcao();
        this.setAcaoImediata();
        this.delAcaoImediata();
        this.getResponsavelReverificarAcaoImediata();

    },

    setAndHideAcaoImediata: function () {

        var necessitaAcao = APP.controller.GestaoDeRiscoController.getNecessitaAcao();
        if (necessitaAcao == "false") {
            $('[name=formCriarNaoConformidadeResponsavel]').closest('[class^=col]').hide();
            $('[name=formCriarNaoConformidadeNmRegistro]').closest('[class^=col]').hide();
            $('#form-acaoimediata').hide();
        }

    },

    getformCriarNaoConformidadeDtDescricaoAcao: function () {

        $('[name=formAcaoImadiataDtDescricaoAcao]').val(APP.component.Datatoday.init());

    },

    setAcaoImediata: function () {

        this.buttonAddAcaoImediata.unbind('click');
        this.buttonAddAcaoImediata.bind('click', function () {

            var TraducaoDropNameSelect = 'Selecione';
            var index = $('#tb-acao-imediata tbody tr').size();

            var html = '';
            html += '<tr role="row" class="odd">';
            html += '<td>';
            html += '<textarea type="text" id="form-acaoimediata-tb-descricao' + _options.NumeroAcaoImediataGrid + '" name="formAcaoImadiataTbDescricao" class="form-control" ';
            html += 'placeholder="Descrição" ';
            html += 'data-msg-required="" ';
            html += 'value=""';
            html += 'rows="3"></textarea>';
            html += '<input type="hidden" name="formAcaoImadiataTbIdAcaoImediata" class="form-control input-data" value="0"/>';
            html += '<input type="hidden" name="formAcaoImadiataTbEstado" value="4"/>';
            html += '</td>';
            html += '<td>';
            html += '<div class="input-group">';
            html += '<input type="text" name="formAcaoImadiataTbDtPrazoImplementacao" id="form-acaoimediata-tb-dt-prazo-implementacao' + _options.NumeroAcaoImediataGrid + '" class="form-control data datepicker largura-calendario" ';
            html += 'data-msg-required="" ';
            html += 'value="" />';
            html += '<span class="input-group-addon">';
            html += '<i class="fa fa-calendar" onclick="AbreCalendario(this)"  aria-hidden="true"></i>';
            html += '</span>';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<select id="form-acaoimediata-tb-responsavel-implementar" name="formAcaoImadiataTbResponsavelImplementar" class="form-control" ';
            html += 'data-msg-required="">';
            html += '<option value="">' + TraducaoDropNameSelect + '</option>';
            html += '</select>';
            html += '</td>';
            html += '<td>';
            html += '<div class="input-group">';
            html += '<input type="text" name="formAcaoImadiataTbDtEfetivaImplementacao" id="form-acaoimediata-tb-dt-efetiva-implementacao' + _options.NumeroAcaoImediataGrid + '" class="form-control data datepicker" ';
            html += 'data-msg-required="" ';
            html += 'value="" />';
            html += '<span class="input-group-addon">';
            html += '<i class="fa fa-calendar" aria-hidden="true"></i>';
            html += '</span>';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<div class="upload-arq form-control">';
            html += '<a class="btn-upload-form-acaoimediata-tb-evidencia-' + index + '">';
            html += '<i class="fa fa-paperclip fa-1x" aria-hidden="true"></i><br>Anexar';
            html += '</a>';
            html += '<input type="file" name="formAcaoImadiataTbEvidencia" id="form-acaoimediata-tb-evidencia-' + index + '" class="" data-msg-required="" data-b64="">';
            html += '</div>';
            html += '<ul></ul>';
            html += '</td>';
            html += '<td>';
            html += '<a href="#" class="btn-delete-acao-imediata icon-cliente trash-color">';
            html += '<i class="fa fa-trash" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</a>';
            html += '</td>';
            html += '</tr>';

            $('#tb-acao-imediata tbody').append(html);
            $('.add-acao-imediata').removeClass('show').addClass('hide');
            APP.controller.GestaoDeRiscoController.bind();

            _options.NumeroAcaoImediataGrid++;

        });

    },

    delAcaoImediata: function () {

        $('.btn-delete-acao-imediata').unbind('click');
        $('.btn-delete-acao-imediata').on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });

    },

    getResponsavelImplementarAcaoImediata: function () {
        var idSite = $('#nao-conformidade-site').val();
        var idFuncao = 91; // Funcionalidade(Implementar aÃ§Ã£o) que permite usuario Implementar aÃ§Ã£o NC
        var idProcesso = $('[name=IdProcesso]').val();
        $.ajax({
            type: "GET",
            dataType: 'json',
            url: '/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso=' + idProcesso + '&idSite=' + idSite + '&idFuncao=' + idFuncao '',
            beforeSend: function () {
                $('.add-acao-imediata').removeClass('show').addClass('hide');
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    APP.component.SelectListCompare.selectList(result.Lista, $('#tb-acao-imediata tbody tr:last-child [name="formAcaoImadiataTbResponsavelImplementar"] option'), $('#tb-acao-imediata tbody tr:last-child [name="formAcaoImadiataTbResponsavelImplementar"]'), 'IdUsuario', 'NmCompleto');
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {
                $('.add-acao-imediata').removeClass('hide').addClass('show');
            }
        });

    },

    getResponsavelReverificarAcaoImediata: function () {
        var idSite = $('#nao-conformidade-site').val();
        var idProcesso = $('[name=IdProcesso]').val();
        var idFuncao = 92; // Funcionalidade(ReverificaÃ§Ã£o) que permite usuario Reverifique NC
        $.get('/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso=' + idProcesso + '&idSite=' + idSite + '&idFuncao=' + idFuncao +'', function (result) {
            if (result.StatusCode == 200) {

                $(result.Lista).each(function (key, value) {
                    var $option = $('<option>');
                    $('[name=formAcaoImadiataResponsavelReverificacao]').append(
                        $option.val(value.IdUsuario).text(value.NmCompleto)
                    );
                });
            }
        });

    },

    bind: function () {

        APP.component.Datapicker.init();
        APP.controller.GestaoDeRiscoController.setup();
        APP.controller.GestaoDeRiscoController.setAcaoImediata();
        APP.controller.GestaoDeRiscoController.getResponsavelImplementarAcaoImediata();
        APP.component.FileUpload.init();
        APP.controller.GestaoDeRiscoController.delAcaoImediata();
        APP.controller.GestaoDeRiscoController.setHideStatusEtapa1();

    },

    getObjObjFormAcaoImediataValidate: function () {

        var acoesNaoConformidadeoFormAcaoImediataObj = {

            formCriarNaoConformidadeTags: 'required',
        };

        return acoesNaoConformidadeoFormAcaoImediataObj;

    },

    getObjFormAcaoImediata: function () {

        var idUsuarioLogado = $('[name=UsuarioLogado]').val();
        var statusEtapa = parseInt($('[name=StatusEtapa]').val());

        var getObjFormAcaoImediataArray = [];
        var acoesNaoConformidadeFormAcaoImediataObj = {};

        var anexoEvidenciaModel = APP.controller.ClienteController.models.AnexoModel;

        $('#tb-acao-imediata tbody tr').each(function (index, tr) {
            if (statusEtapa == 2) {
                acoesNaoConformidadeFormAcaoImediataObj = {
                    Descricao: $(tr).find('[name=formAcaoImadiataTbDescricao]').val(),
                    DtPrazoImplementacao: $(tr).find('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    IdResponsavelImplementar: $(tr).find('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $(tr).find('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    ArquivoEvidenciaAux: anexoEvidenciaModel.constructor(
                        $(tr).find('[name^=formCriarNaoConformidadeEvidencia]').closest('td').find('[name^=formCriarNaoConformidadeEvidenciaIdAnexo]').val(),
                        $(tr).find('[name^=formCriarNaoConformidadeEvidencia]').closest('td').find('i').text(),
                        $(tr).find('[id^=form-acaoimediata-tb-evidencia-]').data('b64')
                    ),
                    Estado: $(tr).find('[name=formAcaoImadiataTbEstado]').val() != 0 ? 16 : 0,
                    IdAcaoImediata: $(tr).find('[name=formAcaoImadiataTbIdAcaoImediata]').val(),
                };
            } else if (statusEtapa == 3) {
                acoesNaoConformidadeFormAcaoImediataObj = {
                    Aprovado: $(tr).find('[name=formAcaoImadiataTbAprovado]').val(),
                    IdAcaoImediata: $(tr).find('[name=formAcaoImadiataTbIdAcaoImediata]').val(),
                    Estado: $(tr).find('[name=formAcaoImadiataTbEstado]').val() != 0 ? 16 : 0,
                };
            } else {
                acoesNaoConformidadeFormAcaoImediataObj = {
                    Descricao: $(tr).find('[name=formAcaoImadiataTbDescricao]').val(),
                    DtPrazoImplementacao: $(tr).find('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    IdResponsavelImplementar: $(tr).find('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $(tr).find('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    Estado: $(tr).find('[name=formAcaoImadiataTbEstado]').val(),
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                };
            }

            getObjFormAcaoImediataArray.push(acoesNaoConformidadeFormAcaoImediataObj);
        });

        return getObjFormAcaoImediataArray;

    },

    //Edit
    getTemasCores: function () {

        var divBarRating = $('.barraRating');
        var corRisco = $('[name=formGestaoDeRiscoCriticidadeCor]').val();
        var lastCores = $("[data-rating-value='" + corRisco + "']").last().index();
        for (i = 0; i <= lastCores; i++) {
            $($('.br-theme-bars-1to10').find('.br-widget a')[i]).addClass('br-selected');
        }
        $($('.br-theme-bars-1to10').find('.br-widget a')[lastCores]).trigger("click");
        $('.br-theme-bars-1to10').find("[data-rating-value='" + corRisco + "']").addClass('br-current');
        $('.br-widget').addClass('barRating-disabled');

    },

    //Todos
    sendFormCriarNaoConformidade: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = APP.controller.GestaoDeRiscoController.validateForms();

            //validate = true;
            if (validate == true) {

                var statusEtapa = parseInt($('[name=StatusEtapa]').val());
                var IdRegistroConformidade = $('[name=IdRegistroConformidade]').val();
                var eProcedente = $('[name=formAcaoImadiataEProcedente]:checked').val();

                var naoConformidade = {};

                var fluxos = {
                    //Criar Gestao de Risco
                    _000: ['fluxo-00'],
                    //Status 1 - AÃ§Ã£o Corretiva
                    _002: ['fluxo-02'],
                    //Status 2 - ImplementaÃ§Ã£o
                    _003: ['fluxo-03'],
                    //Status 3 - ReverificaÃ§Ã£o
                    _004: ['fluxo-04'],
                    //Status 3 - Desbloquear
                    _005: ['fluxo-05']
                };

                switch (statusEtapa) {
                    case 0:
                        APP.controller.GestaoDeRiscoController.getUltimaDataEmissao('fluxo-00');
                        break;
                    case 1:
                        naoConformidade = APP.controller.GestaoDeRiscoController.getCriarNaoConformidadeObj("fluxo-02");
                        APP.controller.GestaoDeRiscoController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-02");
                        break;
                    case 2:
                        naoConformidade = APP.controller.GestaoDeRiscoController.getCriarNaoConformidadeObj("fluxo-03");
                        APP.controller.GestaoDeRiscoController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-03");
                        break;
                    case 3:
                        naoConformidade = APP.controller.GestaoDeRiscoController.getCriarNaoConformidadeObj("fluxo-04");
                        APP.controller.GestaoDeRiscoController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-04");
                        break;
                    case 4:
                        naoConformidade = APP.controller.GestaoDeRiscoController.getCriarNaoConformidadeObj("fluxo-05");
                        APP.controller.GestaoDeRiscoController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-05");
                        break;
                }
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    getCriarNaoConformidadeObj: function (_fluxo) {

        var naoConformidadeObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                switch (form) {
                    case "gestaoderisco":
                        naoConformidadeObj = APP.controller.GestaoDeRiscoController.getObjFormCriarNaoConformidade(_fluxo);
                        break;
                    //case "acaoimediata":
                    //acaoimediataObj = APP.controller.GestaoDeRiscoController.getObjFormAcaoImediata();
                    //break;
                }
            }

        });

        return naoConformidadeObj;

    },

    saveFormCriarNaoConformidade: function (naoConformidadeObj, _fluxo) {
        var url = "";

        switch (_fluxo) {
            case "fluxo-00":
                url = "/GestaoDeRisco/SalvarPrimeiraEtapa";
                break;
            case "fluxo-02":
                url = "/GestaoDeRisco/SalvarSegundaEtapa";
                break;
            case "fluxo-03":
                url = "/GestaoDeRisco/SalvarSegundaEtapa";
                break;
            case "fluxo-04":
                url = "/GestaoDeRisco/SalvarSegundaEtapa";
                break;
            case "fluxo-05":
                url = "/GestaoDeRisco/SalvarSegundaEtapa";
                break;
        }

        $.ajax({
            type: "POST",
            data: naoConformidadeObj,
            dataType: 'json',
            url: url,
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/GestaoDeRisco/Index";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },


    HabilitaCamposGestaoRisco: function (perfil) {
       
        if (perfil == '4') {
            
            $('#main').find('input, textarea, button, select').removeAttr('disabled');
            $("#form-criar-nao-conformidade-processo").attr("disabled", true);
            $("#form-criar-nao-conformidade-emissor").attr("disabled", true);
            $("#form-criar-nao-conformidade-nm-registro").attr("disabled", true);
            $('.br-widget').removeClass('barRating-disabled');

     
        }
        else {
           
            $('#main').find('input, textarea, button, select').removeAttr('disabled');
            $("#form-criar-nao-conformidade-nm-registro").attr("disabled", true);
            $("#form-criar-nao-conformidade-dt-emissao").attr("disabled", true);            
            $('.br-widget').removeClass('barRating-disabled');

   

        }
    },


    DestravaDocumento: function () {

        var idGestaoDeRisco = $('[name=IdRegistroConformidade]').val();  // $('#form-criar-nao-conformidade-nm-registro').val();
        var data = { "idGestaoDeRisco": idGestaoDeRisco };

        $.ajax({
            type: "POST",
            dataType: 'json',
            data: data,
            url: "/GestaoDeRisco/DestravarDocumento",
            success: function (result) {
                //alert('foi');
                //if (result.StatusCode == 200) {
                //    window.location.reload([true]);
                //} else if (result.StatusCode == 505) {
                //    erro = APP.component.ResultErros.init(result.Erro);
                //    bootbox.alert(erro);
                //} else if (result.StatusCode == 500) {
                //    erro = APP.component.ResultErros.init(result.Erro);
                //    bootbox.alert(erro);
                //}

            },
            error: function (result) {
                //erro = APP.component.ResultErros.init(result.Erro);
                //bootbox.alert(erro);
            },
            //complete: function (result) {
            //    APP.component.Loading.hideLoading();
        });
    },


    setDestravarCamposGestaoRisco: function () {
    
        this.buttonDestravar.on('click', function () {
            
            
            if (perfil == '4') {
                
                $('#main').find('input, textarea, button, select').removeAttr('disabled');
                $("#form-criar-nao-conformidade-processo").attr("disabled", true);
                $("#form-criar-nao-conformidade-emissor").attr("disabled", true);
                $("#form-criar-nao-conformidade-nm-registro").attr("disabled", true);
                $('.br-widget').removeClass('barRating-disabled');

   

            }
            else {
            
                $('#main').find('input, textarea, button, select').removeAttr('disabled');
                $("#form-criar-nao-conformidade-nm-registro").attr("disabled", true);
                $("#form-criar-nao-conformidade-dt-emissao").attr("disabled", true); 
                $('.br-widget').removeClass('barRating-disabled');

            }

            var idGestaoDeRisco = $("[name=IdRegistroConformidade]").val();     
            var data = { "idGestaoDeRisco": idGestaoDeRisco };

            $.ajax({
                type: "POST",
                dataType: 'json',
                data: data,
                url: "/GestaoDeRisco/DestravarDocumento",
                success: function (result) {
                    //alert('foi');
                    //if (result.StatusCode == 200) {
                    //    window.location.reload([true]);
                    //} else if (result.StatusCode == 505) {
                    //    erro = APP.component.ResultErros.init(result.Erro);
                    //    bootbox.alert(erro);
                    //} else if (result.StatusCode == 500) {
                    //    erro = APP.component.ResultErros.init(result.Erro);
                    //    bootbox.alert(erro);
                    //}

                },
                error: function (result) {
                    //erro = APP.component.ResultErros.init(result.Erro);
                    //bootbox.alert(erro);
                },
                //complete: function (result) {
                //    APP.component.Loading.hideLoading();
            });




            //this.HabilitaCamposGestaoRisco(perfil);

            //this.DestravaDocumento();

        });
    },

}
/*
|--------------------------------------------------------------------------
| HomeController
|--------------------------------------------------------------------------
*/

APP.controller.HomeController = {

    init: function () {

        var page = APP.component.Util.getPage();

        if (page === "Administrador") {
            this.startAdmin();
        } else if (page === "Index") {
            this.indexProcessos();
        }
    },

    startAdmin: function () {
        APP.component.DataTable.init('#tbCliente');
    },

    setup: function () {

        //

    },

    indexProcessos: function () {

        this.setIdProcesso();
        this.setMenuBox();

    },

    setIdProcesso: function () {
        $('[name="modulos"]').on('click', function () {
            var idProcesso = $(this).closest('div').attr('id');
            var NmProcesso = $(this).closest('div').find('h3').text();
            APP.controller.HomeController.saveProcessoSelecionado(idProcesso, NmProcesso, true);
        });
    },

    setMenuBox: function () {
        $('[name="mini-menu"]').on('click', function () {

            // Remember the link href
            var href = $(this).attr("href");

            event.preventDefault();

            var idProcesso = $(this).data('idprocesso');
            var NmProcesso = $(this).data('nomeprocesso');
            APP.controller.HomeController.saveProcessoSelecionado(idProcesso, NmProcesso, false);

            window.location = href;

        });
    },

    saveProcessoSelecionado: function (idProcesso, nomeProcesso, assync) {

        var data = { 'idProcesso': idProcesso, 'nomeProcesso': nomeProcesso };

        $.ajax({
            type: "POST",
            url: "/Processo/EscolheProcesso",
            data: data,
            async: assync,
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
            },
            error: function (result) {
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });
    },
};
/*
|--------------------------------------------------------------------------
| Controlador Indicador
|--------------------------------------------------------------------------
*/

APP.controller.IndicadorController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "IndexIndicador") {
            this.indexIndicador();
        }
        if (page == "CriarIndicador") {
            this.acoesIndicador();
        }

    },

    setup: function () {

        //Index Indicador
        this.buttonDelIndicadore = $(".del-indicador");

        //Criar Indicador
        this.buttonSalvar = $(".btn-salvar");

        //Relatorios
        this.buttonGetRelatorioBarras = $('#relatorioBarras');
        this.buttonGetRelatorioColunas = $('#relatorioColunas');
        this.buttonDestravar = $("#btn-destravar");
       
    },

    //Models
    models: {

        //PerfilUsuarioModel: APP.model.PerfilUsuario,

    },

    //Index Padrao
    indexIndicador: function () {

        APP.component.DataTable.init('#tb-index-indicador');
        this.delIndicador();

    },

    delIndicador: function () {
        this.buttonDelIndicadore.on('click', function () {

            var msgIconeDeleteIndicador = $('[name=msgIconeDeleteIndicador]').val();

            bootbox.confirm(msgIconeDeleteIndicador, function (result) {
                if (result == true) {
                    APP.controller.IndicadorController.setDelIndicador();
                }
            });

        });

    },

    setDelIndicador: function () {

        var idIndicador = $('.del-indicador').data("id-indicador");
        var data = {
            "Id": idIndicador,
            "__RequestVerificationToken": $("[name=__RequestVerificationToken]").val()
        };

        var erro = "";

        $.ajax({
            type: "POST",
            dataType: 'json',
            data: data,
            url: "/Indicador/Excluir",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {

                if (result.StatusCode == 200) {
                    window.location.reload([true]);
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    //Acoes Padrao
    acoesIndicador: function () {

        APP.component.AtivaLobiPanel.init();
        this.setAndHide();

        this.setValidateForms();
        this.formCriarIndicador();
        this.sendFormCriarIndicador();

        if ($('[name=IdIndicador]').val() > 0) {
            this.formEditarIndicador();
        }


        this.setDestravarCamposIndicador();

        if (habilitaLoad == 'sim') {

            this.HabilitaCamposIndicador(perfil);
        }

    },

    setAndHide: function () {

        $('#panel-dashboard').hide();

    },

    setValidateForms: function () {

        var ObjFormCriarIndicadorValidate = APP.controller.IndicadorController.getObjObjFormCriarIndicadorValidate();
        APP.component.ValidateForm.init(ObjFormCriarIndicadorValidate, '#form-criar-indicador');
        APP.component.ValidateForm.init(ObjFormCriarIndicadorValidate, '#form-planodevoo');

    },

    //Formulario Criar Indicador
    formCriarIndicador: function () {

        this.setAndHideCriarIndicador();
        this.setDisableCriarIndicador();
        this.getProcessosPorSite();
        this.getResponsavel();
        this.getTotalPlanoDeVoo();
        this.setTotalPlanoDeVoo();

    },

    setAndHideCriarIndicador: function () {

        $('#tb-plano-de-voo tbody tr:nth-child(2)').hide();

    },

    setDisableCriarIndicador: function () {

        $('[name=formPlanoDeVooTotal]').prop('disabled', true);

    },

    getProcessosPorSite: function () {

        var idSite = $('[name=IdSite]').val();
        $.get('/Processo/ListaProcessosPorSite?idSite=' + idSite, function (result) {
            $.each(result.Lista, (key, val) => {
                var $option = $('<option></option>');
                $('[name=formCriarIndicadorProcesso]').append(
                    $option.val(val.IdProcesso).text(val.Nome)
                );
            });
        });
    },

    getResponsavel: function () {

        var idSite = $('[name=IdSite]').val();
        var idFuncao = 27; // Funcionalidade(Cadastrar) que permite usuario criar nc
        $.get('/Usuario/ObterUsuariosPorFuncao?idSite=' + idSite + '&idFuncao=' + idFuncao +'', (result) => {
            if (result.StatusCode == 200) {
                APP.component.SelectListCompare.selectList(result.Lista, $('[name=formCriarIndicadorResponsavel] option'), $('[name=formCriarIndicadorResponsavel]'), 'IdUsuario', 'NmCompleto');
            }
        });

    },

    getObjObjFormCriarIndicadorValidate: function () {

        var formCriarIndicadorObj = {
            formCriarIndicadorProcesso: { required: true },
            formCriarIndicadorResponsavel: { required: true },
            formCriarIndicadorPeriodicidade: { required: true },
            formCriarIndicadorSentido: { required: true },
            formCriarIndicadorAno: { required: true },
            formCriarIndicadorMeta: { required: true },
            formCriarIndicadorUnidade: { required: true },
            formCriarIndicadorObjetivo: { required: true },
            formCriarIndicadorIndicador: { required: true },

            //Tabela
            formPlanoDeVooMetaJan: { required: true },
            formPlanoDeVooMetaFev: { required: true },
            formPlanoDeVooMetaMar: { required: true },
            formPlanoDeVooMetaAbr: { required: true },
            formPlanoDeVooMetaMai: { required: true },
            formPlanoDeVooMetaJun: { required: true },
            formPlanoDeVooMetaJul: { required: true },
            formPlanoDeVooMetaAgo: { required: true },
            formPlanoDeVooMetaSet: { required: true },
            formPlanoDeVooMetaOut: { required: true },
            formPlanoDeVooMetaNov: { required: true },
            formPlanoDeVooMetaDez: { required: true },

            // formPlanoDeVooRealizadoJan: {required: true},
            // formPlanoDeVooRealizadoFev: {required: true},
            // formPlanoDeVooRealizadoMar: {required: true},
            // formPlanoDeVooRealizadoAbr: {required: true},
            // formPlanoDeVooRealizadoMai: {required: true},
            // formPlanoDeVooRealizadoJun: {required: true},
            // formPlanoDeVooRealizadoJul: {required: true},
            // formPlanoDeVooRealizadoAgo: {required: true},
            // formPlanoDeVooRealizadoSet: {required: true},
            // formPlanoDeVooRealizadoOut: {required: true},
            // formPlanoDeVooRealizadoNov: {required: true},
            // formPlanoDeVooRealizadoDez: {required: true},
        };

        return formCriarIndicadorObj;

    },

    getObjFormCriarIndicador: function () {

        var formCriarIndicadorObj = {
            IdSite: $('[name=IdSite]').val(),
            IdProcesso: $('[name=formCriarIndicadorProcesso] :selected').val(),
            Id: $('[name=IdIndicador]').val(),
            IdResponsavel: $('[name=formCriarIndicadorResponsavel] :selected').val(),
            Periodicidade: $('[name=formCriarIndicadorPeriodicidade] :selected').val(),
            Direcao: $('[name=formCriarIndicadorSentido] :selected').val(),
            Ano: $('[name=formCriarIndicadorAno]').val(),
            MetaAnual: $('[name=formCriarIndicadorMeta]').val(),
            Unidade: $('[name=formCriarIndicadorUnidade]').val(),
            Objetivo: $('[name=formCriarIndicadorObjetivo]').val(),
            Descricao: $('[name=formCriarIndicadorIndicador]').val(),

            PeriodicidadeDeAnalises: [{
                Id: $('[name=IdPeriodicidade]').val(),
                PlanoDeVoo: APP.controller.IndicadorController.getObjFormMetaArray(),
                MetasRealizadas: APP.controller.IndicadorController.getObjFormPlanoDeVooArray(),
            }],

        };

        return formCriarIndicadorObj;

    },

    getObjFormMetaArray: function () {

        var arrayFormMetaObj = [];
        var formMetaObj = {};

        $('[name^=formPlanoDeVooMeta]').each(function (i) {

            formMetaObj = {
                DataReferencia: APP.controller.IndicadorController.getDataProMes(i),
                Valor: $(this).val(),
            };
            arrayFormMetaObj.push(formMetaObj);

        });

        return arrayFormMetaObj;

    },

    getObjFormPlanoDeVooArray: function () {

        var arrayFormPlanoDeVooObj = [];
        var formPlanoDeVooObj = {};

        $('[name^=formPlanoDeVooRealizado]').each(function (i) {

            formPlanoDeVooObj = {
                Id: $(this).closest('div').find('[name^=IdPlanoDeVoo]').val(),
                DataReferencia: APP.controller.IndicadorController.getDataProMes(i),
                Realizado: $(this).val() != '' ? $(this).val() : null,
            };
            arrayFormPlanoDeVooObj.push(formPlanoDeVooObj);

        });

        return arrayFormPlanoDeVooObj;

    },

    getDataProMes: function (_mes) {

        var meses = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];
        var data = new Date();
        for (i = 0; i < meses.length; i++) {
            if (meses[i] == _mes) {
                return data = '01/' + (i + 1) + '/2018';
            }
        }
    },

    getTotalPlanoDeVoo: function () {

        $('[name=formCriarIndicadorMeta]').on('change', function () {
            var val = $(this).val();
            $('[name=formPlanoDeVooTotal]').val(val);
        });

    },

    setTotalPlanoDeVoo: function () {

        $('[name^=formPlanoDeVooMeta]').on('change', function () {

            var meta = parseInt($('[name=formCriarIndicadorMeta]').val());
            var total = parseInt(0);
            $('[name^=formPlanoDeVooMeta]').each(function () {
                var val = parseInt($(this).val());
                if (!isNaN(val)) {
                    total = total + val;
                }
            });
            var newTotal = meta - total;
            $('[name=formPlanoDeVooTotal]').val(newTotal);

        });

    },

    //Editar

    formEditarIndicador: function () {

        this.setShowAndHideEditar();
        this.setDisable();
        this.dashBoard();

    },

    setShowAndHideEditar: function () {

        $('#panel-dashboard').show();
        $('#tb-plano-de-voo tbody tr:nth-child(2)').show();
        $('[name^=formPlanoDeVooMeta]').trigger('change');

    },

    setDisable: function () {

        $('[name=formCriarIndicadorProcesso]').prop('disabled', true);
        $('[name=formCriarIndicadorResponsavel]').prop('disabled', true);
        $('[name=formCriarIndicadorPeriodicidade]').prop('disabled', true);
        $('[name=formCriarIndicadorSentido]').prop('disabled', true);
        $('[name=formCriarIndicadorAno]').prop('disabled', true);
        $('[name=formCriarIndicadorMeta]').prop('disabled', true);
        $('[name=formCriarIndicadorUnidade]').prop('disabled', true);
        $('[name=formCriarIndicadorObjetivo]').prop('disabled', true);
        $('[name=formCriarIndicadorIndicador]').prop('disabled', true);
        $('[name^=formPlanoDeVooMeta]').prop('disabled', true);
        $('[name=formPlanoDeVooTotal]').prop('disabled', true);
        this.setDisableMes();

    },

    setDisableMes: function () {

        var data = new Date();
        data = data.getMonth();

        $('[name^=formPlanoDeVooRealizado]').each(function (e) {
            if (e > data) {
                $(this).prop('disabled', true);
            }
        });

    },

    //Todos
    sendFormCriarIndicador: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = APP.controller.IndicadorController.validateForms();

            //var validate = true;
            if (validate == true) {
                APP.controller.IndicadorController.getindicadorObj();
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });


        if (parseInt($('#form-planodevoo-meta-total').val()) != parseInt($('#form-criar-indicador-meta').val()))
        {
            valid = false;
            bootbox.alert(_options.MsgMetaTotal);
        }

        return valid;

    },

    getindicadorObj: function () {

        var indicadorObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                switch (form) {
                    case "indicador":
                        indicadorObj = APP.controller.IndicadorController.getObjFormCriarIndicador();
                        APP.controller.IndicadorController.saveFormCriarIndicador(indicadorObj, "/Indicador/Salvar");
                        break;
                }
            }

        });

    },

    saveFormCriarIndicador: function (indicadorObj, url) {

        var erro = "";

        $.ajax({
            type: "POST",
            data: indicadorObj,
            dataType: 'json',
            url: url,
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                   var id = result.IdIndicador;
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/Indicador/Editar/" + id;
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    //Relatorios
    jsonGlobal: {},

    dashBoard: function () {

        this.setJsonGlobal();
        this.setPreencherQtdContainerPagina();
        this.setRelatorioPlanoDeVoo();
    },

    setJsonGlobal: function (idIndicador) {

        var jsonLocal = APP.controller.IndicadorController.jsonGlobal;

        if ($.isEmptyObject(jsonLocal)) {

            APP.controller.IndicadorController.jsonGlobal = this.getJSONRelatorios(idIndicador);
        }

    },

    getJSONRelatorios: function (idIndicador) {

        var jsonRelatorioBarras = '';

        $.ajax({
            type: "GET",
            dataType: 'json',
            async: false,
            url: '/Indicador/RelatorioBarrasJSON',
            data: { IdIndicador: $('[name=IdIndicador]').val() },
            success: function (result) {
                if (result.StatusCode == 200) {

                    jsonRelatorioBarras = result.Indicadores;
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            }
        });

        return jsonRelatorioBarras;
    },

    setPreencherQtdContainerPagina: function () {

        var qtdDiv = APP.controller.IndicadorController.jsonGlobal.length;

        for (i = 0; i < qtdDiv; i++) {
            $("#relatorios ul").append("<li class='col-md-12'><div id='container" + i + "'></div></li>");
        }
    },

    setRelatorioPlanoDeVoo: function () {

        APP.controller.IndicadorController.getRelatorioPlanoDeVoo();

    },

    getRelatorioPlanoDeVoo: function () {

        var jsonLocal = APP.controller.IndicadorController.jsonGlobal;

        for (i = 0; i < jsonLocal.length; i++) {
            var filtro = this.getFiltroRelatorioPlanoDeVoo(jsonLocal[i]);
            APP.component.Highcharts.colunas(filtro);
        }

    },

    getFiltroRelatorioPlanoDeVoo: function (dados) {

        var categorias = [];
        var valorMeta = [];
        var valorRealizado = [];
        var unidadeIndicador = dados.Unidade;
        var serie1 = "Realizado";
        var serie2 = "Meta";

        var seriesTotais = [
            {
                name: serie1,
                data: valorRealizado,
            }, {
                name: serie2,
                data: valorMeta,
            }];

        for (f = 0; f < dados.PeriodicidadeDeAnalises.length; f++) {

            for (j = 0; j < dados.PeriodicidadeDeAnalises[f].PlanoDeVoo.length; j++) {
                categorias.push(dados.PeriodicidadeDeAnalises[f].PlanoDeVoo[j].Mes);
                valorMeta.push(dados.PeriodicidadeDeAnalises[f].PlanoDeVoo[j].Valor);
            }

            for (var x = 0; x < dados.PeriodicidadeDeAnalises[f].MetasRealizadas.length; x++) {
                valorRealizado.push(dados.PeriodicidadeDeAnalises[f].MetasRealizadas[x].Realizado);
            }

        }


        var dataCheia = APP.component.Datatoday.init();

        var filtro = {
            Container: 'container' + i,
            Titulo: 'Metas X Realizados',
            Categorias: categorias,
            UnidadeIndicador: unidadeIndicador,
            SeriesTotais: seriesTotais,
            Chart: { type: 'bar' },
            SubTitulo: 'Atualizado dia: ' + dataCheia,
            TituloTextoLinha: 'Alguma Coisa',
            AlinhamentoTituloTextoLinha: 'high',
            Legenda: {
                layout: 'vertical',
                align: 'left',
                x: 50,
                verticalAlign: 'top',
                y: 50,
                floating: true,
                backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF',
                shadow: true,
            }
        };

        return filtro;
    },

    HabilitaCamposIndicador: function (perfil) {
        
        if (perfil == '4') {
        
            $('#main').find('input, textarea, button, select').removeAttr('disabled');
            $("#form-criar-nao-conformidade-processo").attr("disabled", true);
            $("#form-criar-nao-conformidade-emissor").attr("disabled", true);

        }
        else {
            $('#main').find('input, textarea, button, select').removeAttr('disabled');
        }
    },

  
    setDestravarCamposIndicador: function () {

        this.buttonDestravar.on('click', function () {
      

            if (perfil == '4') {
             
                $('#main').find('input, textarea, button, select').removeAttr('disabled');
                $("#form-criar-nao-conformidade-processo").attr("disabled", true);
                $("#form-criar-nao-conformidade-emissor").attr("disabled", true); 


            }
            else {
              
                $('#main').find('input, textarea, button, select').removeAttr('disabled');
            }


            var idIndicador = $('[name=IdIndicador]').val(); 
            var data = { "idIndicador": idIndicador };

            $.ajax({
                type: "POST",
                dataType: 'json',
                data: data,
                url: "/Indicador/DestravarDocumento",
                success: function (result) {
                    //alert('foi');
                    //if (result.StatusCode == 200) {
                    //    window.location.reload([true]);
                    //} else if (result.StatusCode == 505) {
                    //    erro = APP.component.ResultErros.init(result.Erro);
                    //    bootbox.alert(erro);
                    //} else if (result.StatusCode == 500) {
                    //    erro = APP.component.ResultErros.init(result.Erro);
                    //    bootbox.alert(erro);
                    //}

                },
                error: function (result) {
                    //erro = APP.component.ResultErros.init(result.Erro);
                    //bootbox.alert(erro);
                },
                //complete: function (result) {
                //    APP.component.Loading.hideLoading();
            });


        });
    },

};
/*
|--------------------------------------------------------------------------
| Controlador Instrumentos
|--------------------------------------------------------------------------
*/

APP.controller.InstrumentosController = {

    init: function () {

        var page = APP.component.Util.getPage();

        this.setup();
        if (page == "IndexInstrumentos") {
            this.IndexInstrumentos();
        } else if (page == "CriarInstrumentos") {
            this.CriarInstrumentos();
        }

    },

    setup: function () {

        //Instrumento Index

        //Instrumento Criar
        this.radioButton = $("input:radio[name='SistemaDefineStatus']");
        this.buttonAddCalibracao = $('.tb-calibracao-add');
        this.buttonDelCalibracao = $('.tb-calibracao-excluir');
        this.buttonDelParametroCalibracao = $('.form-pos-calibracao-parametros-icone-del');
        this.buttonAddParametrosCalibracao = $('.form-pos-calibracao-parametros-icone-add');
        this.buttoEditParametroCalibracao = $('.tb-calibracao-editar');
        this.buttonSaveForm = $(".form-save");
        this.buttonDelInstrumento = $('.tb-instrumento-excluir');
    },

    models: {
        ClienteModel: APP.model.Cliente,
        SiteModel: APP.model.Site,
        AnexoModel: APP.model.Anexo,
        ModuloModel: APP.model.Modulo,
        ProcessoModel: APP.model.Processo,
    },

    //Chamadas
    IndexInstrumentos: function () {

        APP.component.DataTable.init('#tb-instrumento');
        this.delInstrumento();


    },

    CriarInstrumentos: function () {

        //GETs
        this.getResponsavel();
        this.getResponsavelAprovadorCalibracao();
        //SETs
        this.setCalibracao();
        this.setCalculaDoSistema();
        this.setParametrosCalibracao();
        this.setResponsavelInstrumento();
        //DELs
        this.delCalibracao();
        this.delParametroCalibracao();
        //EDTs
        this.editPosCalibracao();
        //SENDs
        //this.sendFormParametroInstrumento();
        //this.sendFormPoscalibracao();
        this.saveForms();
        //OUTRAS
        this.viewArquivoCalibracao();
        this.calcCriterioAceitacao();
        this.bind();
        //INCLUDEs
        APP.component.AtivaLobiPanel.init();
        APP.component.FileUpload.init();
        APP.component.Datapicker.init();
        APP.component.DataTable.init('#tb-calibracao');
        // APP.controller.InstrumentosController.setupUploadArquivoCalibracao();
        //OUTRAS
        this.setCalibracaoVisivel();
        this.setValidateForms();

    },

    setValidateForms: function () {

        var ObjFormInstrumentoValidate = APP.controller.InstrumentosController.getObjObjFormInstrumentoValidate();
        APP.component.ValidateForm.init(ObjFormInstrumentoValidate, '#form-parametro-instrumento');

    },

    getObjObjFormInstrumentoValidate: function () {

        var acoesPadraoFormCriarPadraoObj = {
            //formCriaClienteLogo: {required: true, minFiles: 1},
            Equipamento: { required: true },
            Numero: { required: true },
            Marca: { required: true },
            Modelo: { required: true },
            IdResponsavel: { required: true },
            LocalDeUso: { required: true },
            Escala: { required: true },
            MenorDivisao: { required: true },
            valorAceitacao: { required: true, number: true },
            DescricaoCriterio: { required: false },

        };

        return acoesPadraoFormCriarPadraoObj;

    },

    //Funcoes Index Instrumentos
    delInstrumento: function () {

        var tabelaInstrumento = $('#tb-instrumento').DataTable();

        this.buttonDelInstrumento.on('click', function (event) {
            event.preventDefault();

            var IdInstrumento = $(this).data('id');
            var $rowAtual = $(this).parents('tr');

            bootbox.confirm(_options.MsgDesejaExcluirRegistro, function (result) {
                if (result) {
                    $.post('/Instrumento/Excluir/' + IdInstrumento, function (data, status) {
                    }).done(function (data) {
                        if (data.StatusCode == "200") {
                            tabelaInstrumento.row($rowAtual).remove().draw();
                            bootbox.alert(_options.MsgRegistroExcluidoSucesso);
                        }
                    });
                }
            });
        });

    },

    editIntrumento: function () {

        var IdInstrumento = $('#IdInstrumento');
        var instrumento = $('#form-parametro-instrumento').serialize();

        $.ajaxSetup({ async: false });

        $.post('/Instrumento/Editar/', instrumento, function (data, status) {
        })
            .success(function (data, status) {
                
            })
            .fail(function (data, status) {

            });

        $.ajaxSetup({ async: true });
    },

    getResponsavel: function () {
        var idSite = $('#IdSite').val();
        var idFuncao = $('#idFuncao').val();

        var url = '/Usuario/ObterUsuariosPorFuncao?idSite=' + idSite + '&idFuncao=' + idFuncao;
        $.ajax({
            type: "GET",
            async: false,
            dataType: 'json',
            url: url,
            success: function (result) {
                $.each(result.Lista, function (key, val) {
                    $('#dropdown-responsavel').append($("<option />").val(val.IdUsuario).text(val.NmCompleto));
                });
            }
        });
    },

    getResponsavelAprovadorCalibracao: function () {
        var idSite = $('#IdSite').val();
        var idFuIdAprovadorCalibracaoncao = $('#IdAprovadorCalibracao').val();
        var url = '/Usuario/ObterUsuariosPorFuncao?idSite=' + idSite + '&idFuncao=61';
        $.ajax({
            type: "GET",
            async: false,
            dataType: 'json',
            url: url,
            success: function (result) {
                $.each(result.Lista, function (key, val) {
                    $('.form-pos-calibracao-aprovado-por').append($("<option />").val(val.IdUsuario).text(val.NmCompleto));
                });
            }
        });
    },

    getObjPosCalibracao: function () {

        var PosCalibracao = {
            IdCalibracao: $("#IdCalibracao").val(),
            IdInstrumento: $('#IdInstrumento').val(),
            DataRegistro: $('#form-pos-calibracao').find('[name=DtRegistro]').val(),
            DataNotificacao: $('#form-pos-calibracao').find('[name=DtNotificacao]').val(),
            DataProximaCalibracao: $('#form-pos-calibracao').find('[name=DataProximaCalibracao]').val(),
            Certificado: $('#form-pos-calibracao').find('[name=Certificado]').val(),
            CriterioAceitacao: [],
            OrgaoCalibrador: $('#form-pos-calibracao').find('[name=OrgaoCalibrador]').val(),
            Aprovador: $('#form-pos-calibracao').find('[name=Aprovador]').val(),
            Aprovado: $('input[name="Aprovado"]:checked').val(),
            ArquivoCertificadoAux: APP.controller.InstrumentosController.getArquivoCertificadoAnexos(),
            Observacoes: $('#form-pos-calibracao').find('[name=Observacoes]').val(),
            NomeUsuarioAprovador: $('#form-pos-calibracao').find('[name=Aprovador] option:selected').text(),
        };

        var temCriterioAceitacao = $("[name=SistemaDefineStatus]:checked").val() == "true" ? true : false;

        if (temCriterioAceitacao) {

            PosCalibracao.Instrumento =
                {
                    SistemaDefineStatus: $("[name=SistemaDefineStatus]:checked").val(),
                    valorAceitacao: $("[name=valorAceitacao]").val(),
                    IdInstrumento: $("#IdInstrumento").val()
                };

            $('.campos-tabela').each(function (i) {

                CriteriosAceitacao = {
                    Erro: $(this).find('[name=Erro]').val(),
                    Incerteza: $(this).find('[name=Incerteza]').val(),
                    Resultado: $(this).find('[name=Resultado]').val(),
                    IdCriterioAceitacao: 0,// $(this).find('[name=IdCriterioAceitacao]').val(),
                    Periodicidade: $(this).find('[name=Periodicidade]').val(),
                    IdCalibracao: $("#IdCalibracao").val(),
                    Aceito: $(this).find('.ativo-color').length == 1 ? true : false,
                };

                PosCalibracao.CriterioAceitacao.push(CriteriosAceitacao);
            });
        }

        return PosCalibracao;
    },

    getArquivoCertificadoAnexos: function () {
        var anexoContratoModel = APP.controller.ClienteController.models.AnexoModel;
        var arrayAnexoArquivoCertificado = [];

        $('.dashed li a:first-child').each(function () {

            var nameImg = $(this).text();
            var anexoContratoCliente = anexoContratoModel.constructor(
                $(this).closest('li').find('[name=formCriaClienteContratoIdAnexo]').val(),//IdAnexo
                nameImg,//Nome
                $(this).data('b64')//B64
            );

            arrayAnexoArquivoCertificado.push(anexoContratoCliente);
        });

        return arrayAnexoArquivoCertificado;
    },

    getEditPosCalibracao: function (result) {

        APP.controller.InstrumentosController.showPosCalibracao();

        $('#form-pos-calibracao').find("[name=EdicaoCalibracao]").val("1");
        $('#IdInstrumento').val(result.IdInstrumento);
        $('#form-pos-calibracao').find('[name=DtRegistro]').val(result.DataRegistro);
        $('#form-pos-calibracao').find('[name=DtNotificacao]').val(result.DataNotificacao);
        $('#form-pos-calibracao').find('[name=DataProximaCalibracao]').val(result.DataProximaCalibracao);
        $('#form-pos-calibracao').find('[name=Certificado]').val(result.Certificado);

        $('#form-pos-calibracao').find('[name=OrgaoCalibrador]').val(result.OrgaoCalibrador);

        

        if (result.Aprovado == 0)
        {
            $('#form-pos-calibracao-nao-aprovado').prop('checked', true);
        }
        else if (result.Aprovado == 1)
        {
            $('#form-pos-calibracao-aprovado').prop('checked', true);
        }
        else if (result.Aprovado == 2)
        {
            $('#form-pos-calibracao-fora-uso').prop('checked', true);
        }
        else if (result.Aprovado == 3)
        {
            $('#form-pos-calibracao-em-calibracao').prop('checked', true);
        }
        
        
        

        $('.form-pos-calibracao-aprovado-por').val(result.Aprovador.IdUsuario);
        $('#form-pos-calibracao').find('.arquivo').val(result.ArquivoCertificado);

        
        for (var i = 0; i < result.CriteriosAceitacao.length; i++) {
            APP.controller.InstrumentosController.addCriterioAceitacao(result.CriteriosAceitacao[i]);
        }

        //Set Radio
        var $radios = $('input:radio[name=Aprovado]');
        if ($radios.is(':checked') === false) {
            $radios.filter('[value=' + result.Aprovado + ']').prop('checked', true);
        }

        // var tamanhoSplit = result.ArquivoCertificado.split("/").length - 1;
        // var nomeArquivo = result.ArquivoCertificado.split("/")[tamanhoSplit];

        // $('#form-pos-calibracao').find('.arquivo').attr("href", result.ArquivoCertificado).html(nomeArquivo);

        // $('#form-pos-calibracao').find('.arquivo').append('<a href="javascript:;" class="deletefile" target="_blank" data-tipo="undefined" data-arquivo="' + nomeArquivo + '" data-campo="ArquivoCertificado" data-id="1"><i class="fa fa-trash-o" aria-hidden="true"></i></a>');

        $('#form-pos-calibracao').find('[name=Observacoes]').val(result.Observacoes);
    },

    setCalibracao: function () {

        this.buttonAddCalibracao.bind('click', function () {
            event.preventDefault();
            APP.controller.InstrumentosController.showPosCalibracao();
        });

    },

    showPosCalibracao: function () {

        $('.tb-calibracao').slideUp(500);
        $('#form-pos-calibracao').removeClass('hide').addClass('show');
        $('#form-pos-calibracao').slideDown(500);
        $('.pills-parametros-pos-calibracao').removeClass('hide').addClass('show');
        $('.pills-tabela-calibracao').removeClass('show').addClass('hide');
        APP.controller.InstrumentosController.showTablePosCalibracaoParametros();

    },

    showTablePosCalibracaoParametros: function () {
        var nomeRadio = 'SistemaDefineStatus';
        var radio = APP.component.Radio.init(nomeRadio);
        if (radio == "true") {
            $('.form-pos-calibracao-parametros').removeClass('hide').addClass('show');
        } else {
            $('.form-pos-calibracao-parametros').removeClass('show').addClass('hide');
        }
    },

    setCalculaDoSistema: function () {

        this.radioButton.bind('click', function () {
            APP.controller.InstrumentosController.showTablePosCalibracaoParametros();
        });

    },

    setParametrosCalibracao: function () {



        this.buttonAddParametrosCalibracao.on('click', function (event) {
            event.preventDefault();
            var html = '';
            html += '<tr class="campos-tabela">';
            html += '<td align="center"><i class="fa fa-minus-circle blue-color form-pos-calibracao-parametros-icone-del" aria-hidden="true"></i></td>';
            html += '<td><input onkeyup="SubstituiVirgulaPorPonto(this)" style="width: 76px;" class="form-control form-pos-calibracao-parametros-periodicidade" name="Periodicidade" data-val="true" title="" type="text" value="" data-original-title="Range"  ></td>';
            html += '<td><input onkeyup="SubstituiVirgulaPorPonto(this)" style="width: 76px;" class="form-control form-pos-calibracao-parametros-erro" name="Erro" data-val="true" title="" type="text" value="" data-original-title="Erro"></td>';
            html += '<td align="center"><i class="fa fa-plus blue-color" aria-hidden="true"></i></td>';
            html += '<td><input onkeyup="SubstituiVirgulaPorPonto(this)" style="width: 76px;" class="form-control form-pos-calibracao-parametros-incerteza" name="Incerteza" data-val="true" title="" type="text" value="" data-original-title="Incerteza"></td>';
            html += '<td align="center"><i class="fa fa-equals blue-color" aria-hidden="true"></i></td>';
            html += '<td><input class="form-control form-pos-calibracao-parametros-resultado" style="width: 76px;" name="Resultado" data-val="true" title="" type="text" value="" data-original-title="Resultado" disabled=""></td>';
            html += '<td align="center" class="form-pos-calibracao-parametros-validacao"><i class="" aria-hidden="true"></i></a></td>';
            html += '</tr>';
            $(".tb-parametros-pos-calibracao > tbody:last-child").append(html);
            APP.controller.InstrumentosController.setup();
            APP.controller.InstrumentosController.setCalibracaoAprovado();
            APP.controller.InstrumentosController.delParametroCalibracao();
            APP.controller.InstrumentosController.bind();
        });

    },

    setResponsavelInstrumento: function () {
        var idResponsavel = $("#IdResponsavelHidden").val();
        $('#dropdown-responsavel').val(idResponsavel);
    },

    setCalibracaoAprovado: function () {
        //var sizeCheck = $('.tb-parametros-pos-calibracao').find('.form-pos-calibracao-parametros-validacao i').size();
        //var qntCheck = $('.tb-parametros-pos-calibracao').find('.form-pos-calibracao-parametros-validacao .fa-check').size();
        //if (sizeCheck == qntCheck) {
        //    $('.form-pos-calibracao-aprovado-sim').prop("checked", true);
        //} else {
        //    $('.form-pos-calibracao-aprovado-sim').prop("checked", false);
        //}
    },

    delCalibracao: function () {

        tabelaCalibracao = $('#tb-calibracao').DataTable();

        this.buttonDelCalibracao.unbind("click");
        this.buttonDelCalibracao.bind('click', function (event) {
            event.preventDefault();

            var IdCalibracao = $(this).data('id');
            var $rowAtual = $(this).closest('tr');

            bootbox.confirm(_options.MsgDesejaExcluirRegistro, function (result) {
                if (result) {
                    $.ajax({
                        url: "/Calibracao/Excluir/",
                        dataType: 'JSON',
                        type: 'POST',
                        data: { id: IdCalibracao },
                        success: function (data) {
                            if (data.StatusCode == 200) {
                                tabelaCalibracao.row($rowAtual).remove().draw();
                                bootbox.alert("Calibracao Excluida!");
                            }
                        },
                        beforeSend: function () {
                            APP.component.Loading.showLoading();
                        },
                        complete: function (result) {
                            APP.component.Loading.hideLoading();
                        },
                    });
                }
            });
        });
    },

    delParametroCalibracao: function () {
        this.buttonDelParametroCalibracao.unbind('click');

        this.buttonDelParametroCalibracao.bind('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });
    },

    editPosCalibracao: function () {
        this.buttoEditParametroCalibracao.unbind('click');
        this.buttoEditParametroCalibracao.bind('click', function (event) {

            //event.preventDefault();

            $("[name=EdicaoCalibracao]").val("1");

            var IdCalibracao = $(this).data("id");

            $("#IdCalibracao").val(IdCalibracao);


            $.ajax({
                type: "get",
                dataType: 'json',
                url: "/Calibracao/Editar",
                data: { id: IdCalibracao },
                beforeSend: function () {
                    APP.component.Loading.showLoading();
                },
                success: function (result) {
                    if (result.StatusCode == 200) {
                        APP.controller.InstrumentosController.getEditPosCalibracao(result.Calibracao);

                        
                    }
                },
                error: function (result) {
                    bootbox.alert(_options.MsgOcorreuErro);
                },
                complete: function (result) {
                    APP.component.Loading.hideLoading();
                },
            });
        });
    },

    calcCriterioAceitacao: function () {
        $('.form-pos-calibracao-parametros-erro, .form-pos-calibracao-parametros-incerteza, .form-parametro-instrumento-criterio-aceitacao').on('keyup change', function () {

            var erro, incerteza, criterioAceitacao;

            var $parametroErro = $(this).closest('tr').find('.form-pos-calibracao-parametros-erro');
            if (typeof ($parametroErro.val()) != "undefined")
                erro = Number($parametroErro.val().replace(",", "."));

            var $parametroIncerteza = $(this).closest('tr').find('.form-pos-calibracao-parametros-incerteza');
            if (typeof ($parametroIncerteza.val()) != "undefined")
                incerteza = Number($parametroIncerteza.val().replace(",", "."));

            var $parametroCriterioAceitacao = $('.form-parametro-instrumento-criterio-aceitacao');
            if (typeof ($parametroCriterioAceitacao.val()) != "undefined")
                criterioAceitacao = Number($parametroCriterioAceitacao.val().replace(",", "."));

            var valor = Number(erro + incerteza);
            if (Number.isNaN(valor)) { valor = 0; }
            if (Number.isNaN(criterioAceitacao)) { criterioAceitacao = 0; }

            if (criterioAceitacao != 0 && criterioAceitacao != 0 && valor != 0) {
                $(this).closest('.campos-tabela').find('.form-pos-calibracao-parametros-resultado').val(valor);
                if (valor <= criterioAceitacao) {
                    classIcone = 'fa fa-check ativo-color';
                    $(this).closest('.campos-tabela').find('.form-pos-calibracao-parametros-validacao i').removeClass().addClass(classIcone);
                } else {
                    classIcone = 'fa fa-close trash-color';
                    $(this).closest('.campos-tabela').find('.form-pos-calibracao-parametros-validacao i').removeClass().addClass(classIcone);
                }
                APP.controller.InstrumentosController.setCalibracaoAprovado();
            }
        });
    },

    sendFormParametroInstrumento: function () {

        $.ajaxSetup({ async: false });
        var idInstrumento = $("#IdInstrumento").val();
        var url = '/Instrumento/Criar';
        var validacao = true;

        if (idInstrumento != "0") {
            url = '/Instrumento/Editar';
        } else {
            validacao = $('#form-parametro-instrumento').valid();
        }

        if (validacao) {
            $.ajax({
                type: "POST",
                dataType: 'json',
                url: url,                
                data: $('#form-parametro-instrumento').serialize(),
                beforeSend: function () {
                    APP.component.Loading.showLoading();
                },
                success: function (result) {
                    if (result.StatusCode == 200) {

                        
                        if (idInstrumento == "0") { $("#IdInstrumento").val(result.IdInstrumento); }

                        APP.controller.InstrumentosController.setCalibracaoVisivel();
                        
                        var isHidden = $('#form-pos-calibracao').is(":hidden");
                        if (isHidden == false) {
                            APP.controller.InstrumentosController.sendFormPoscalibracao(idInstrumento, result.Success);
                        }

                       


                    } else if (result.StatusCode == 505) {
                        erro = APP.component.ResultErros.init(result.Erro);
                        bootbox.alert(erro);

                    } else if (result.StatusCode == 500) {
                        erro = APP.component.ResultErros.init(result.Erro);
                        bootbox.alert(erro);
                    }

                },
                error: function (result) {
                    bootbox.alert(_options.MsgOcorreuErro);
                },
                complete: function (result) {
                    APP.component.Loading.hideLoading();
                },
            });
        }

        $.ajaxSetup({ async: true });
    },

    sendFormPoscalibracao: function (idInstrumento, msgRetorno) {

        var objPosCalibracao = APP.controller.InstrumentosController.getObjPosCalibracao();
        
        var url = '/Calibracao/Criar';

        var EedicaoCalibracao = $("[name=EdicaoCalibracao]").val() == "1" ? true : false;

        if (EedicaoCalibracao) {
            url = '/Calibracao/Editar';
        }

        var retorno = false;

        $.ajax({
            url: url,
            dataType: 'JSON',
            type: 'POST',
            data: objPosCalibracao,
            success: function (data) {

                if (data.StatusCode == 200) {
                    APP.controller.InstrumentosController.setFormCalibracaoVazio();

                    if (!EedicaoCalibracao) {

                        objPosCalibracao.IdCalibracao = data.calibracao.IdCalibracao;
                        objPosCalibracao.ArquivoCertificado = data.calibracao.ArquivoCertificado;
                        objPosCalibracao.DataCalibracao = data.calibracao.DataCalibracao;
                        objPosCalibracao.Aprovador = data.calibracao.Aprovador;
                        objPosCalibracao.Aprovado = data.calibracao.Aprovado;

                        APP.controller.InstrumentosController.addCalibracaoTabela(objPosCalibracao);
                        APP.controller.InstrumentosController.setup();
                        APP.controller.InstrumentosController.editPosCalibracao();
                        APP.controller.InstrumentosController.delCalibracao();
                        
                    }
                    
                    if (idInstrumento != "0") {
                        bootbox.confirm(msgRetorno, function (result) {
                            if (result == true) {
                                window.location.href = "/Instrumento/Index";
                            }
                        });
                    }

                }
                else if (data.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(data.Erro);
                    bootbox.alert(erro);
                    retorno = false;

                } else if (data.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(data.Erro);
                    bootbox.alert(erro);
                    retorno = false;
                }
            },
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();                

            },
        });
        return retorno;
    },

    saveForms: function () {

        this.buttonSaveForm.click(function () {

            event.preventDefault();

            $("#form-pos-calibracao").validate();

            var formCalibracaoValido = $("#form-pos-calibracao").valid();

            var objPosCalibracao = APP.controller.InstrumentosController.getObjPosCalibracao();
            var valido = true;
            if (objPosCalibracao.DataRegistro > objPosCalibracao.DataNotificacao) {
                valido = false;
                APP.component.Loading.hideLoading();
                bootbox.alert(_options.labelValidaDataRegistro);


            }

            if (objPosCalibracao.DataNotificacao > objPosCalibracao.DataProximaCalibracao) {
                valido = false;
                APP.component.Loading.hideLoading();
                bootbox.alert(_options.labelValidaDataNotificacao);
            }

            if (valido) {


                if (formCalibracaoValido) {

                   
                        APP.controller.InstrumentosController.sendFormParametroInstrumento();

                   

                    $('#form-pos-calibracao').slideUp(500);
                    $('#form-pos-calibracao').removeClass('show').addClass('hide');
                    $('.tb-calibracao').slideDown(500);
                    $('.pills-parametros-pos-calibracao').removeClass('show').addClass('hide');
                    $('.pills-tabela-calibracao').removeClass('hide').addClass('show');
                }
            }
        });
    },

    addCalibracaoTabela: function (calibracao) {

        var tabelaCalibracao = $('#tb-calibracao').DataTable();

        var newRow =
            [
                calibracao.IdCalibracao,
                calibracao.Certificado,
                calibracao.DataCalibracao,
                calibracao.DataProximaCalibracao,
                calibracao.OrgaoCalibrador,
                calibracao.Aprovador,
                calibracao.Aprovado,
                calibracao.Observacoes,
                '<a href="#" class="edit icon-cliente editar-color tb-calibracao-editar" data-id="' + calibracao.IdCalibracao + '">' +

                '<i class="fa fa-pencil" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonEditar + '" data-original-title="' + _options.labelButtonEditar + '"></i>' +
                '</a>' +
                '<a href="' + calibracao.ArquivoCertificado + '" class="view-color icon-cliente" target="_blank">' +
                '<i class="fa fa-search" aria-hidden="true" data-toggle="tooltip" title="" data-original-title="Visualizar"></i>' +
                '</a>' +
                '<a href="#" class="tb-calibracao-excluir trash-color icon-cliente" data-id="' + calibracao.IdCalibracao + '">' +
                '<i class="fa fa-trash" aria-hidden="true" data-toggle="tooltip" title="" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>' +
                '</a>'
            ];

        var newrow = tabelaCalibracao.row.add(newRow).draw().node();

        $(newrow).find('td').eq(0).addClass('hidden');

        $(newrow).find('td').eq(8).addClass('text-nowrap');
    },

    //fazer
    viewArquivoCalibracao: function () {

    },

    setupUploadArquivoCalibracao: function () {

        var formJson = { "id": 0, "idSite": $("#IdSite").val() };
        UploadMultiplosArquivos(
            "/Calibracao/UploadArquivo",
            "dropPE",
            "uplPE",
            "ArquivoCertificado",
            30000000000,
            formJson,
            "form-pos-calibracao",
            $("#IdSite").val(),
            "/Calibracao/RemoverArquivo");
    },

    bind: function () {

        APP.controller.InstrumentosController.calcCriterioAceitacao();

    },

    setCalibracaoVisivel() {

        var idInstrumento = $("#IdInstrumento").val();

        if (idInstrumento != "0") {
            $(".tabs").removeClass("hide").fadeIn();
            $(".tb-calibracao").removeClass("hide").fadeIn();
        }
    },

    setFormCalibracaoVazio() {

        $('#form-pos-calibracao .arquivo').html("").addClass("hide");
        $('#form-pos-calibracao .deletefile').addClass("hide").attr('disabled', 'disabled');
        $("[name='CriteriosAceitacao'] tbody").html("");
        $('#form-pos-calibracao')[0].reset();
    },

    addCriterioAceitacao(criterioAceitacao) {

        var html = '';
        html += '<tr class="campos-tabela">';
        html += '<input type="hidden" name="IdCriterioAceitacao" value="' + criterioAceitacao.IdCriterioAceitacao + '">';
        html += '<td align="center"><i class="fa fa-minus-circle blue-color form-pos-calibracao-parametros-icone-del" aria-hidden="true"></i></td>';
        html += '<td><input class="form-control style="width: 76px;" form-pos-calibracao-parametros-periodicidade" name="Periodicidade" data-val="true" title="" type="text" value="' + criterioAceitacao.Periodicidade + ' " data-original-title="Range"></td>';
        html += '<td><input class="form-control style="width: 76px;" form-pos-calibracao-parametros-erro" name="Erro" data-val="true" title="" type="text" value="' + criterioAceitacao.Erro + '" data-original-title="Erro"></td>';
        html += '<td align="center"><i class="fa fa-plus blue-color" aria-hidden="true"></i></td>';
        html += '<td><input class="form-control style="width: 76px;" form-pos-calibracao-parametros-incerteza" name="Incerteza" data-val="true" title="" type="text" value="' + criterioAceitacao.Incerteza + '" data-original-title="Incerteza"></td>';
        html += '<td align="center"><i class="fa fa-equals blue-color" aria-hidden="true"></i></td>';
        html += '<td><input class="form-control style="width: 76px;" form-pos-calibracao-parametros-resultado" name="Resultado" data-val="true" title="" type="text" value="' + criterioAceitacao.Resultado + '" data-original-title="Resultado" disabled=""></td>';
        html += '<td align="center" class="form-pos-calibracao-parametros-validacao"><i class="' + (criterioAceitacao.Aceito == true ? "fa fa-check ativo-color" : "fa fa-close trash-color") + '" aria-hidden="true"></i></td>';
        html += '</tr>';
        $(".tb-parametros-pos-calibracao > tbody:last-child").append(html);
        APP.controller.InstrumentosController.setup();
        APP.controller.InstrumentosController.setCalibracaoAprovado();
        APP.controller.InstrumentosController.delParametroCalibracao();
        APP.controller.InstrumentosController.bind();
    },
};
/*
|--------------------------------------------------------------------------
| Login
|--------------------------------------------------------------------------
*/

APP.controller.LoginController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "Login") {
            this.indexLogin();
        }
        if (page == "RecuperarSenha") {
            this.recuperarSenha();
        }
        if (page == "AlterarSenhaLogin") {
            this.alterarSenha();
        }

    },

    setup: function () {

        //Index Login
        this.buttonLogin = $(".btn-login");

        //Recuperar Senha
        this.buttonRecuperarSenha = $(".btn-recuperar-senha");

        //Alterar Senha
        this.buttonAlterarSenha = $(".btn-alterar-senha");

    },

    //Index Login
    indexLogin: function () {

        this.setValidateForms();
        this.sendFormLogin();

    },

    setValidateForms: function () {

        var ObjFormLoginValidate = APP.controller.LoginController.getObjObjFormLoginValidate();
        APP.component.ValidateForm.init(ObjFormLoginValidate, '#form-login');

    },

    getObjObjFormLoginValidate: function () {

        var indexLoginFormLoginObj = {

            formLoginEmail: { required: true, email: true },
            formLoginSenha: 'required',
            hiddenRecaptcha: {
                required: function () {
                    if (grecaptcha.getResponse() == '') {
                        return true;
                    } else {
                        return false;
                    }
                }
            },
        };

        return indexLoginFormLoginObj;

    },

    getObjFormLogin: function () {

        var indexLoginFormLoginObj = {
            CdIdentificacao: $('[name=formLoginEmail]').val(),
            CdSenha: $('[name=formLoginSenha]').val(),
        };

        return indexLoginFormLoginObj;

    },

    //Formulario Recuperar Senha
    recuperarSenha: function () {

        this.setValidateFormsRecuperarSenha();
        this.sendFormRecuperarSenha();

    },

    setValidateFormsRecuperarSenha: function () {

        var ObjFormRecuperarSenhaValidate = APP.controller.LoginController.getObjObjFormRecuperarSenhaValidate();
        APP.component.ValidateForm.init(ObjFormRecuperarSenhaValidate, '#form-recuperar-senha');

    },

    getObjObjFormRecuperarSenhaValidate: function () {

        var recuperarSenhaFormLoginObj = {

            formRecuperarSenhaEmail: { required: true, email: true },

        };

        return recuperarSenhaFormLoginObj;

    },

    getObjFormRecuperarSenha: function () {

        var recuperarSenhaFormLoginObj = {
            __RequestVerificationToken: $('[name=__RequestVerificationToken]').val(),
            CdIdentificacao: $('[name=formRecuperarSenhaEmail]').val(),
        };

        return recuperarSenhaFormLoginObj;

    },

    //Formulario Alterar Senha
    alterarSenha: function () {

        this.setValidateFormsAlterarSenha();
        this.setStrongPassword();
        this.setSenhaNotEquals();
        this.sendFormAlterarSenha();

    },

    setValidateFormsAlterarSenha: function () {

        var ObjFormAlterarSenhaValidate = APP.controller.LoginController.getObjObjFormAlterarSenhaValidate();
        APP.component.ValidateForm.init(ObjFormAlterarSenhaValidate, '#form-alterar-senha');

    },

    setStrongPassword: function () {

        APP.component.StrongPassword.init('formAlterarSenhaNova');

    },

    setSenhaNotEquals: function () {

        $.validator.addMethod("notEqualsTo", function () {
            var senhaAtual = $('[name=formAlterarSenhaAtual]').val();
            return ($('[name=formAlterarSenhaNova]').val() != senhaAtual);
        });

    },

    getObjObjFormAlterarSenhaValidate: function () {

        var alterarSenhaFormLoginObj = {
            formAlterarSenhaAtual: { required: true },
            formAlterarSenhaNova: { required: true, minlength: 6, notEqualsTo: true, strongPassword: true },
            formAlterarSenhaConfirmar: { required: true, minlength: 6, notEqualsTo: true, equalTo: "[name=formAlterarSenhaNova]" },
        };

        return alterarSenhaFormLoginObj;

    },

    getObjFormAlterarSenha: function () {

        var alterarSenhaFormLoginObj = {
            __RequestVerificationToken: $('[name=__RequestVerificationToken]').val(),
            IdUsuario: $('[name=formAlterarSenhaIdUsuario]').val(),
            SenhaAtual: $('[name=formAlterarSenhaAtual]').val(),
            CdSenha: $('[name=formAlterarSenhaNova]').val(),
            ConfirmaSenha: $('[name=formAlterarSenhaConfirmar]').val(),

        };

        return alterarSenhaFormLoginObj;

    },

    //Todos
    sendFormLogin: function () {

        this.buttonLogin.unbind('click');
        this.buttonLogin.on('click', function () {

            var validate = APP.controller.LoginController.validateForms();

            //var validate = true;
            if (validate == true) {
                var loginObj = APP.controller.LoginController.getLoginObj();
                APP.controller.LoginController.saveFormLogin(loginObj);
            }

        });

    },

    sendFormRecuperarSenha: function () {

        this.buttonRecuperarSenha.unbind('click');
        this.buttonRecuperarSenha.on('click', function () {

            var validate = APP.controller.LoginController.validateForms();

            //var validate = true;
            if (validate == true) {
                var recuperarSenhaObj = APP.controller.LoginController.getLoginObj();
                APP.controller.LoginController.saveFormRecuperarSenha(recuperarSenhaObj);
            }

        });

    },

    sendFormAlterarSenha: function () {

        this.buttonAlterarSenha.unbind('click');
        this.buttonAlterarSenha.on('click', function () {

            var validate = APP.controller.LoginController.validateForms();

            //var validate = true;
            if (validate == true) {
                var alterarSenhaObj = APP.controller.LoginController.getLoginObj();
                APP.controller.LoginController.saveFormAlterarSenha(alterarSenhaObj);
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    getLoginObj: function () {

        var loginObj = {};

        $('[id^=form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[1];
                switch (form) {
                    case "login":
                        loginObj = APP.controller.LoginController.getObjFormLogin();
                        break;
                    case "recuperar":
                        loginObj = APP.controller.LoginController.getObjFormRecuperarSenha();
                        break;
                    case "alterar":
                        loginObj = APP.controller.LoginController.getObjFormAlterarSenha();
                        break;
                }
            }

        });

        return loginObj;

    },

    saveFormLogin: function (loginObj) {

        $.ajax({
            type: "GET",
            data: loginObj,
            dataType: 'json',
            async: false,
            url: "/Login/Acesso",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode === 200) {
                    window.location.href = "/Home/Index";
                } else if (result.StatusCode == 505) {
                    var erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    var erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                var erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    saveFormRecuperarSenha: function (recuperarSenhaObj) {

        $.ajax({
            type: "POST",
            data: recuperarSenhaObj,
            dataType: 'json',
            url: "/Login/RecuperarSenha",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode === 200) {
                    bootbox.alert(result.Success, function (result) {
                        //
                    });
                } else if (result.StatusCode == 505) {
                    var erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    var erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                var erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    saveFormAlterarSenha: function (usuario) {

        $.ajax({
            type: "POST",
            data: usuario,
            dataType: 'json',
            url: "/Login/AlterarSenha",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode === 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/";
                    });
                } else if (result.StatusCode == 505) {
                    var erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    var erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                var erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

};

/*
|--------------------------------------------------------------------------
| Controlador Nao Conformidade
|--------------------------------------------------------------------------
*/

APP.controller.NaoConformidadeController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "IndexNaoConformidade") {
            this.indexNaoConformidade();
        }
        if (page == "CriarNaoConformidade") {
            this.acoesNaoConformidade();
        }

    },

    setup: function () {
        //Index Nao Conformidade
        this.buttonDelNaoConformidade = $(".del-nao-conformidade");

        //Criar Nao Conformidade
        this.buttonSalvar = $(".btn-salvar");

        //Editar Nao Conformidade
        this.buttonAddAcaoImediata = $('.add-acao-imediata');

        this.buttonDestravar = $(".btn-destravar");
    },

    //Models
    models: {
        AnexoModel: APP.model.Anexo,
    },

    //Index Nao Conformidade
    indexNaoConformidade: function () {

        APP.component.DataTable.setDataTableParam('#tb-index-nao-conformidade', 0, "desc", "Tags");
        this.delNaoConformidade();

    },

    eventoAuditoria: function () {

        $('[name=formCriarNaoConformidadeEAuditoria]').on('change', function () {

            var EhAuditoria = $(this).val();

            if (EhAuditoria == "true")
            {  
                var idCategoria = $('[name=formCriarNaoConformidadeTipo] option:contains("Auditoria")').val();

                $('[name=formCriarNaoConformidadeTipo]').val(idCategoria);
            }

        });

    },

    delNaoConformidade: function () {
        this.buttonDelNaoConformidade.on('click', function () {

            var msgIconeDeleteNC = $('[name=msgIconeDeleteNC]').val();

            bootbox.confirm(msgIconeDeleteNC, function (result) {
                if (result == true) {
                    APP.controller.NaoConformidadeController.setDelNaoConformidade();
                }
            });

        });

    },

    setDelNaoConformidade: function () {

        var idNaoConformidade = $('.del-nao-conformidade').data("id-nao-conformidade");
        var data = {
            "idNaoConformidade": idNaoConformidade,
            "__RequestVerificationToken": $("[name=__RequestVerificationToken]").val()
        };

        var erro = "";

        $.ajax({
            type: "POST",
            dataType: 'json',
            data: data,
            url: "/NaoConformidade/RemoverComAcaoConformidade",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {

                if (result.StatusCode == 200) {
                    window.location.reload([true]);
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    //Acoes Nao Conformidade
    acoesNaoConformidade: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        APP.component.FileUpload.init();
        APP.component.Mascaras.init();
        this.setEProcedente();
        this.setECorrecao();
        this.setNecessitaAC();
        this.setAndHide();
        this.setValidateForms();
        this.eventoAuditoria();

        this.sendFormCriarNaoConformidade();

        this.setDestravarCamposNaoConformidade();

        if (habilitaLoad == 'sim') {

            this.HabilitaCamposNaoConformidade(perfil);
        }
    },

    setAndHide: function () {

        //Verifica Status Etapa
        var statusEtapa = parseInt($('[name=StatusEtapa]').val());
        switch (statusEtapa) {
            case 0:
                this.setShowAndHideStatusEtapa0();
                this.formCriarNaoConformidade();
                break;
            case 1:
                this.setShowAndHideStatusEtapa1();
                this.formAcaoImediata();
                this.setEProcedenteInicializacao();
                break;
            case 2:
                this.setShowAndHideStatusEtapa2();
                this.formAcaoImediata();
                break;
            case 3:
                this.setShowAndHideStatusEtapa3();
                this.formAcaoImediata();
                break;
            case 4:
                this.setShowAndHideStatusEtapa4();
                break;
        }

    },

    setValidateForms: function () {

        var ObjFormCriarNaoConformidadeValidate = APP.controller.NaoConformidadeController.getObjObjFormCriarNaoConformidadeValidate();
        APP.component.ValidateForm.init(ObjFormCriarNaoConformidadeValidate, '#form-criar-naoconformidade');
        var ObjFormAcaoImediataValidate = APP.controller.NaoConformidadeController.getObjObjFormAcaoImediataValidate();
        APP.component.ValidateForm.init(ObjFormAcaoImediataValidate, '#form-acaoimediata');

    },

    //Interacao de Tela - StatusEtapa 0
    setShowAndHideStatusEtapa0: function () {

        $('#panel-acaoimediata').hide();
        //$('[name=formCriarNaoConformidadeNmRegistro]').closest('div').hide();

    },

    //Interacao de Tela - StatusEtapa 1
    setShowAndHideStatusEtapa1: function () {

        this.setDisabledStatusEtapa1(true);
        this.setHideStatusEtapa1();
        var EAuditoria = this.getEAuditoria();
        this.setRulesEAuditoria(EAuditoria);

    },

    setDisabledStatusEtapa1: function (_disabled) {
        //Formulario Nao Conformidade
        $('[name=formCriarNaoConformidadeDsRegistro]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDsJustificativa]').prop('disabled', _disabled);        
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDtEmissao]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeProcesso]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEmissor]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEAuditoria]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTipo]').prop('disabled', _disabled);
        $('#add-tipo-nao-conformidade').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeResponsavel]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTags]').prop('disabled', _disabled);

    },

    setHideStatusEtapa1: function () {

        //Formulario Acao Imediata
        this.setHidePanelEProcedenteNao();
        this.setHidePanelEProcedenteSim();

    },

    setHidePanelEProcedenteNao: function () {

        $('[name=formAcaoImadiataJustificativa]').closest('[class^=col]').hide();

    },

    setHidePanelEProcedenteSim: function () {

        $('#tb-acao-imediata').closest('div').hide();
        $('[name=formAcaoImadiataECorrecao]').closest('[class^=col]').hide();
        $('[name=formAcaoImadiataNecessitaAC]').closest('[class^=col]').hide();
        $('[name=formAcaoImadiataResponsavelReverificacao]').closest('[class^=col]').hide();
        $('[name=formAcaoImadiataFoiEficaz]').closest('[class^=col]').hide();
        $('[name=formAcaoImadiataResponsavelTratativa]').closest('[class^=col]').hide();
        $('[name=formAcaoImadiataNumeroAC]').closest('[class^=col]').hide();
        $('[name=formAcaoImadiataAnaliseCausa]').closest('[class^=col]').hide();

    },

    setHideRowAcaoImediata: function () {

        $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').closest('div').hide();
        $('[name=formAcaoImadiataTbEvidencia]').closest('div').hide();

    },

    //Interacao de Tela - StatusEtapa 2
    setShowAndHideStatusEtapa2: function () {

        this.setHideStatusEtapa2();
        this.setTriggerRadioButtonsEtapa2('change');
        this.setDisabledStatusEtapa2(true);
        this.setShowInputsEtapa2();

    },

    setHideStatusEtapa2: function () {

        //Botoes Acoes
        $('#tb-acao-imediata tbody tr').each(function () {
            $(this).find('td').last().hide();
        });
        $('[name=formAcaoImadiataFoiEficaz]').closest('[class^=col]').hide();
        $('.add-acao-imediata').hide();

    },

    setDisabledStatusEtapa2: function (_disabled) {

        //Formulario Nao Conformidade
        $('[name=formCriarNaoConformidadeDsRegistro]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDsJustificativa]').prop('disabled', _disabled);
        
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDtEmissao]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeProcesso]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEmissor]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEAuditoria]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTipo]').prop('disabled', _disabled);
        $('#add-tipo-nao-conformidade').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeResponsavel]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTags]').prop('disabled', _disabled);

        //Formulario Acao Imediata
        $('[name=formAcaoImadiataEProcedente]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataDtDescricaoAcao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataJustificativa]').prop('disabled', _disabled);
        //Table Acao Imediata
        $('[name=formAcaoImadiataTbDescricao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtPrazoImplementacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbResponsavelImplementar]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').prop('disabled', _disabled);
        $('.upload-arq form-control').prop('disabled', _disabled);
        //Upload Changes
        $('[class^=btn-upload-form-acaoimediata-tb-evidencia]').closest('div').css('background-color', '#eee');
        $('[name=formAcaoImadiataTbEvidencia]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataECorrecao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataNecessitaAC]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelReverificacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelTratativa]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataAnaliseCausa]').prop('disabled', _disabled);

    },

    setTriggerRadioButtonsEtapa2: function (_change) {

        $('[name=formAcaoImadiataEProcedente]').trigger(_change);
        $('[name=formAcaoImadiataECorrecao]').trigger(_change);
        $('[name=formAcaoImadiataNecessitaAC]').trigger(_change);

    },

    setShowInputsEtapa2: function () {

        var idUsuarioLogado = $('[name=UsuarioLogado]').val();
        var idPerfil = $('[name=IdPerfil]').val();
        $('#tb-acao-imediata tbody tr').each(function () {
            var idResponsavelImplementar = $(this).find('[name=formAcaoImadiataTbResponsavelImplementar]').val();
            if ((idResponsavelImplementar == idUsuarioLogado) || idPerfil != 4) {
                $(this).find('[name=formAcaoImadiataTbDtEfetivaImplementacao]').prop('disabled', false);
                $(this).find('[name=formAcaoImadiataTbEvidencia]').prop('disabled', false);
                $(this).find('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', false);
                $(this).find('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', false);
                $(this).find('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', false);
                $(this).find('[class^=btn-upload-form-acaoimediata-tb-evidencia]').closest('div').css('background-color', '#fff');
            }
        });

    },

    //Interacao de Tela - StatusEtapa 3
    setShowAndHideStatusEtapa3: function () {

        this.setHideStatusEtapa3();
        this.setTriggerRadioButtonsEtapa3('change');
        this.setDisabledStatusEtapa3(true);
        this.setShowInputsEtapa3();
        this.setCheckAcaoImediataOk();
        this.setCheckAcaoImediataNotOk();
        this.setBackChecksOnPage();

    },

    setHideStatusEtapa3: function () {

        //Botoes Acoes
        $('#tb-acao-imediata tbody tr').each(function () {
            $(this).find('td').last().hide();
        });
        $('[name=formAcaoImadiataFoiEficaz]').closest('[class^=col]').hide();
        $('.add-acao-imediata').hide();

    },

    setDisabledStatusEtapa3: function (_disabled) {

        //Formulario Nao Conformidade
        $('[name=formCriarNaoConformidadeDsRegistro]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDsJustificativa]').prop('disabled', _disabled);
        
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDtEmissao]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeProcesso]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEmissor]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEAuditoria]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTipo]').prop('disabled', _disabled);
        $('#add-tipo-nao-conformidade').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeResponsavel]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTags]').prop('disabled', _disabled);

        //Formulario Acao Imediata
        $('[name=formAcaoImadiataEProcedente]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataDtDescricaoAcao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataJustificativa]').prop('disabled', _disabled);
        //Table Acao Imediata
        $('[name=formAcaoImadiataTbDescricao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtPrazoImplementacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbResponsavelImplementar]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').prop('disabled', _disabled);
        $('.upload-arq form-control').prop('disabled', _disabled);
        //Upload Changes
        $('[name^=formCriarNaoConformidadeEvidencia]').closest('div').css('background-color', '#eee');
        $('[name=formAcaoImadiataTbEvidencia]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataECorrecao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataNecessitaAC]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelReverificacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelTratativa]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataAnaliseCausa]').prop('disabled', _disabled);

    },

    setTriggerRadioButtonsEtapa3: function (_change) {

        $('[name=formAcaoImadiataEProcedente]').trigger(_change);
        $('[name=formAcaoImadiataECorrecao]').trigger(_change);
        $('[name=formAcaoImadiataNecessitaAC]').trigger(_change);

    },

    setShowInputsEtapa3: function () {

        var idUsuarioLogado = $('[name=UsuarioLogado]').val();
        var idPerfil = $('[name=IdPerfil]').val();

        var idResponsavelReverificacao = $('[name=formAcaoImadiataResponsavelReverificacao]').val();
        if ((idResponsavelReverificacao == idUsuarioLogado) || idPerfil != 4) {
            $('#tb-acao-imediata tbody tr').each(function () {
                $(this).find('td').last().show();
                $(this).find('.btn-delete-acao-imediata').hide();
            });

            $('[name=formAcaoImadiataFoiEficaz]').closest('[class^=col]').show();

        }

    },

    setCheckAcaoImediataOk: function () {

        $('.btn-confirm-acao-imediata').on('click', function () {
            $(this).closest('td').find('.btn-confirm-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-denied-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-ok-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('[name=formAcaoImadiataTbAprovado]').val(true);
            APP.controller.NaoConformidadeController.getChecksAcaoImediata();
        });

    },

    setCheckAcaoImediataNotOk: function () {

        $('.btn-denied-acao-imediata').on('click', function () {
            $(this).closest('td').find('.btn-confirm-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-denied-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-notok-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('[name=formAcaoImadiataTbAprovado]').val(false);
            APP.controller.NaoConformidadeController.getChecksAcaoImediata();
        });

    },

    getChecksAcaoImediata: function () {
        var checkSize = 0;
        var checkAcaoImediata = $('#tb-acao-imediata tbody tr').find('[name=formAcaoImadiataTbAprovado]');
        for (i = 0; i < checkAcaoImediata.size(); i++) {
            var valueAprovador = $(checkAcaoImediata[i]).val();
            if (valueAprovador == "true") {
                checkSize++;
            }
        }
        if (checkSize == checkAcaoImediata.size()) {
            $('[name=formAcaoImadiataFoiEficaz').filter('[value=true]').prop('checked', true);
        } else {
            $('[name=formAcaoImadiataFoiEficaz').filter('[value=false]').prop('checked', true);
        }

    },

    setBackChecksOnPage: function () {
        $('.fa-check-circle, .fa-times-circle').unbind('click');
        $('.fa-check-circle, .fa-times-circle').on('click', function () {
            $(this).closest('td').find('.btn-ok-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-notok-acao-imediata').fadeOut(300);
            $(this).closest('td').find('.btn-confirm-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('.btn-denied-acao-imediata').delay(400).fadeIn(300);
            $(this).closest('td').find('[name=formAcaoImadiataTbAprovado]').val('');
            APP.controller.NaoConformidadeController.getChecksAcaoImediata();

        });
    },

    //Interacao de Tela - StatusEtapa 4
    setShowAndHideStatusEtapa4: function () {

        this.setHideStatusEtapa4();
        this.setTriggerRadioButtonsEtapa4('change');
        this.setDisabledStatusEtapa4(true);
        this.setShowInputsEtapa4();

    },

    setHideStatusEtapa4: function () {

        //Botoes Acoes
        $('#tb-acao-imediata tbody tr').each(function () {
            $(this).find('.btn-delete-acao-imediata').hide();
            $(this).find('.btn-confirm-acao-imediata').hide();
            $(this).find('.btn-denied-acao-imediata').hide();
        });
        $('.add-acao-imediata').hide();

    },

    setTriggerRadioButtonsEtapa4: function (_change) {

        $('[name=formAcaoImadiataEProcedente]').trigger(_change);
        $('[name=formAcaoImadiataECorrecao]').trigger(_change);
        $('[name=formAcaoImadiataNecessitaAC]').trigger(_change);

    },

    setDisabledStatusEtapa4: function (_disabled) {

        //Formulario Nao Conformidade
        $('[name=formCriarNaoConformidadeDsRegistro]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDsJustificativa]').prop('disabled', _disabled);
        
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').closest('div').find('a').attr('disabled', 'disabled');
        $('[name=formCriarNaoConformidadeEvidencia]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeDtEmissao]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeProcesso]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEmissor]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeEAuditoria]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTipo]').prop('disabled', _disabled);
        $('#add-tipo-nao-conformidade').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeResponsavel]').prop('disabled', _disabled);
        $('[name=formCriarNaoConformidadeTags]').prop('disabled', _disabled);

        //Formulario Acao Imediata
        $('[name=formAcaoImadiataEProcedente]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataDtDescricaoAcao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataJustificativa]').prop('disabled', _disabled);
        //Table Acao Imediata
        $('[name=formAcaoImadiataTbDescricao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtPrazoImplementacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbResponsavelImplementar]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').prop('disabled', _disabled);
        $('.upload-arq form-control').prop('disabled', _disabled);
        //Upload Changes
        $('[name^=formCriarNaoConformidadeEvidencia]').closest('div').css('background-color', '#eee');
        $('[name=formAcaoImadiataTbEvidencia]').prop('disabled', _disabled);
        $('.btn-delete-acao-imediata').prop('disabled', _disabled);
        $('.btn-confirm-acao-imediata').prop('disabled', _disabled);
        $('.btn-denied-acao-imediata').prop('disabled', _disabled);
        $('.btn-ok-acao-imediata').prop('disabled', _disabled);
        $('.btn-notok-acao-imediata').prop('disabled', _disabled);
        $('[name=formAcaoImadiataECorrecao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataNecessitaAC]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelReverificacao]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataFoiEficaz]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataResponsavelTratativa]').prop('disabled', _disabled);
        $('[name=formAcaoImadiataAnaliseCausa]').prop('disabled', _disabled);

    },

    setShowInputsEtapa4: function () {


        $('#tb-acao-imediata tbody tr').each(function () {
            var aprovado = $(this).find('[name=formAcaoImadiataTbAprovado]');
            if (aprovado == "true") {
                $(this).find('.btn-ok-acao-imediata').show();
            } else {
                $(this).find('.btn-notok-acao-imediata').show();
            }

        });

    },

    //Rules
    setRulesEAuditoria: function (_EAuditoria) {

        if (_EAuditoria == "true") {
            $('#tb-acao-imediata').closest('div').show();
            $('#form-acaoimediata-e-procedente-sim').prop('checked', true);
            $('[name=formAcaoImadiataEProcedente]').prop('disabled', true);
            $('#form-acaoimediata-necessita-ac-sim').prop('checked', true);
            $('[name=formAcaoImadiataNecessitaAC]').prop('disabled', true);
        } else {

        }

    },

    setRulesEProcedente: function (_EProcedente, _checkTbAcaoCorretiva) {

        if (_EProcedente == "true" && _checkTbAcaoCorretiva > 0) {
            $('[name=formAcaoImadiataJustificativa]').closest('[class^=col]').hide();
            $('#tb-acao-imediata').closest('div').show();

            APP.controller.NaoConformidadeController.setShowPanelEProcedenteSim();

            $('[name=formAcaoImadiataECorrecao]').trigger("change");

            $('[name=formAcaoImadiataNecessitaAC]').trigger("change");
        } else if (_EProcedente == "true") {
            $('[name=formAcaoImadiataJustificativa]').closest('[class^=col]').hide();
            $('#tb-acao-imediata').closest('div').show();
        } else {
            $('[name=formAcaoImadiataJustificativa]').closest('[class^=col]').show();
            APP.controller.NaoConformidadeController.setHidePanelEProcedenteSim();
            APP.controller.NaoConformidadeController.setValidateEProcedente(_EProcedente);
        }

    },

    setRulesECorrecao: function (_ECorrecao) {

        if (_ECorrecao == "true") {
            $('[name=formAcaoImadiataResponsavelReverificacao]').closest('[class^=col]').show();
        } else {
            $('[name=formAcaoImadiataResponsavelReverificacao]').closest('[class^=col]').hide();
        }

    },

    setRulesNecessitaAC: function (_NecessitaAC) {

        if (_NecessitaAC == "true") {
            $('[name=formAcaoImadiataResponsavelTratativa]').closest('[class^=col]').show();
            $('[name=formAcaoImadiataAnaliseCausa]').closest('[class^=col]').show();
        } else if (_NecessitaAC == "false") {
            $('[name=formAcaoImadiataResponsavelTratativa]').closest('[class^=col]').hide();
            $('[name=formAcaoImadiataNumeroAC]').closest('[class^=col]').hide();
            $('[name=formAcaoImadiataAnaliseCausa]').closest('[class^=col]').hide();
        } else {
            $('[name=formAcaoImadiataResponsavelTratativa]').closest('[class^=col]').hide();
            $('[name=formAcaoImadiataNumeroAC]').closest('[class^=col]').hide();
            $('[name=formAcaoImadiataAnaliseCausa]').closest('[class^=col]').hide();
        }

    },

    setShowPanelEProcedenteSim: function () {

        $('[name=formAcaoImadiataECorrecao]').closest('[class^=col]').show();
        $('[name=formAcaoImadiataNecessitaAC]').closest('[class^=col]').show();
        $('[name=formAcaoImadiataResponsavelTratativa]').closest('[class^=col]').show();
        $('[name=formAcaoImadiataAnaliseCausa]').closest('[class^=col]').show();

        $('[name=formAcaoImadiataECorrecao]').trigger("change");
        $('[name=formAcaoImadiataNecessitaAC]').trigger("change");
        //APP.controller.NaoConformidadeController.setRulesNecessitaAC();

    },

    //Changes
    setEProcedente: function () {

        $('[name=formAcaoImadiataEProcedente]').on('change', function () {

            //Verifica se possui AC na tabela - Sim: libera panel AC - Nao: trava panel AC
            var checkTbAcaoCorretiva = $('#tb-acao-imediata tbody tr').size();

            var EProcedente = APP.controller.NaoConformidadeController.getEProcedente('formAcaoImadiataEProcedente');
            APP.controller.NaoConformidadeController.setRulesEProcedente(EProcedente, checkTbAcaoCorretiva);

        });

    },

    setEProcedenteInicializacao: function () {

        var checkTbAcaoCorretiva = $('#tb-acao-imediata tbody tr').size();

        var EProcedente = APP.controller.NaoConformidadeController.getEProcedente('formAcaoImadiataEProcedente');
        APP.controller.NaoConformidadeController.setRulesEProcedente(EProcedente, checkTbAcaoCorretiva);

    },

    setECorrecao: function () {

        $('[name=formAcaoImadiataECorrecao]').on('change', function () {

            var ECorrecao = APP.controller.NaoConformidadeController.getECorrecao('formAcaoImadiataECorrecao');
            APP.controller.NaoConformidadeController.setRulesECorrecao(ECorrecao);

        });

    },

    setNecessitaAC: function () {

        $('[name=formAcaoImadiataNecessitaAC]').on('change', function () {

            var NecessitaAC = APP.controller.NaoConformidadeController.getNecessitaAC('formAcaoImadiataNecessitaAC');
            APP.controller.NaoConformidadeController.setRulesNecessitaAC(NecessitaAC);

        });

    },

    //Auxiliares
    getEAuditoria: function () {

        var EAuditoria = APP.component.Radio.init('formCriarNaoConformidadeEAuditoria');
        return EAuditoria;

    },

    getEProcedente: function () {

        var EProcedente = APP.component.Radio.init('formAcaoImadiataEProcedente');
        return EProcedente;

    },

    getECorrecao: function () {

        var ECorrecao = APP.component.Radio.init('formAcaoImadiataECorrecao');
        return ECorrecao;

    },

    getNecessitaAC: function () {

        var NecessitaAC = APP.component.Radio.init('formAcaoImadiataNecessitaAC');
        return NecessitaAC;

    },

    getFoiEficaz: function () {

        var FoiEficaz = APP.component.Radio.init('formAcaoImadiataFoiEficaz');
        return FoiEficaz;

    },

    //Validates
    setValidateEProcedente: function (_EProcedente) {

        var ObjFormAcaoImediataEProcedenteValidate = {};
        if (_EProcedente == "true") {
            ObjFormAcaoImediataEProcedenteValidate = {
                formAcaoImadiataJustificativa: { 'required': false },
            };
            APP.component.ValidateForm.init(ObjFormAcaoImediataEProcedenteValidate, '#form-acaoimediata');
        } else {
            ObjFormAcaoImediataEProcedenteValidate = {
                formAcaoImadiataJustificativa: { 'required': true },
            };

            APP.component.ValidateForm.init(ObjFormAcaoImediataEProcedenteValidate, '#form-acaoimediata');
        }

    },

    //Formulario Criar Nao Conformidade
    formCriarNaoConformidade: function () {

        this.setAndHideCriarNaoConformidade();
        this.getformCriarNaoConformidadeDtEmissao();
        this.getProcessosPorSite();
        this.getEmissorPorSite();
        this.getTipoNaoConformidade();
        this.setAddTipoNaoConformidade();

        this.setResponsavelAnaliseDefinicaoAC();

    },

    setAndHideCriarNaoConformidade: function () {

        //

    },

    getformCriarNaoConformidadeDtEmissao: function () {

        $('[name=formCriarNaoConformidadeDtEmissao]').val(APP.component.Datatoday.init());

    },

    getProcessosPorSite: function () {

        var idSite = $('#nao-conformidade-site').val();
        $.get('/Processo/ListaProcessosPorSite?idSite=' + idSite, function (result) {
            $.each(result.Lista, (key, val) => {
                var $option = $('<option></option>');
                $('[name=formCriarNaoConformidadeProcesso]').append(
                    $option.val(val.IdProcesso).text(val.Nome)
                );
            });
        });

    },

    getEmissorPorSite: function () {

        var idSite = $('#nao-conformidade-site').val();
        var idFuncao = 12; // Funcionalidade(Cadastrar) que permite usuario criar nc
        $.get('/Usuario/ObterUsuariosPorFuncao?idSite=' + idSite + '&idFuncao=' + idFuncao +'', (result) => {
            if (result.StatusCode == 200) {
                APP.component.SelectListCompare.selectList(result.Lista, $('[name=formCriarNaoConformidadeEmissor] option'), $('[name=formCriarNaoConformidadeEmissor]'), 'IdUsuario', 'NmCompleto');
            }
        });

    },

    getTipoNaoConformidade: function () {

        var idSite = $('#nao-conformidade-site').val();
        $.get('/ControladorCategorias/ListaAtivos?tipo=tnc&site=' + idSite +'', function (result) {
            $.each(result.Lista, (key, val) => {
                if (result.StatusCode == 202) {
                    APP.component.SelectListCompare.selectList(result.Lista, $('[name=formCriarNaoConformidadeTipo] option'), $('[name=formCriarNaoConformidadeTipo]'), 'IdControladorCategorias', 'Descricao');
                }
            });
        });

    },

    setAddTipoNaoConformidade: function () {

        $('.add-tipo-nao-conformidade').on('click', function () {

            var idSite = $('#nao-conformidade-site').val();
            APP.controller.ControladorCategoriasController.init(idSite, 'tnc', APP.controller.NaoConformidadeController.getTipoNaoConformidade, ".add-tipo-nao-conformidade");

        });

    },

    setResponsavelAnaliseDefinicaoAC: function () {

        $('[name=formCriarNaoConformidadeProcesso]').on('change', function () {
            var idSite = $('#nao-conformidade-site').val();
            processoSelecionado = $(this).find(':selected').val();
            var idFuncao = 14; // Funcionalidade(Define aÃ§Ã£o)
            $.get('/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso=' + processoSelecionado + '&idSite=' + idSite + '&idFuncao=' + idFuncao +'', (result) => {
                if (result.StatusCode == 200) {
                    $('[name=formCriarNaoConformidadeResponsavel] option').not(':first-child').remove();
                    APP.component.SelectListCompare.selectList(result.Lista, $('[name="formCriarNaoConformidadeResponsavel"] option'), $('[name="formCriarNaoConformidadeResponsavel"]'), 'IdUsuario', 'NmCompleto');
                }
            });

        });

    },

    getUltimaDataEmissao: function (_fluxo) {

        var dtEmissao = $('[name=formCriarNaoConformidadeDtEmissao]').val();
        var idSite = $('#nao-conformidade-site').val();

        $.ajax({
            url: "/NaoConformidade/ObtemUltimaDataEmissao/",
            type: "GET",
            data: {
                "site": idSite
            },
            async: false,
            success: function (result) {
                if (result.StatusCode == 200) {
                    var dataCompare = APP.component.Datatoday.getCompareDate(dtEmissao, result.UltimaDataEmissao);
                    var labelDesejaCriarNcDtEmissaoAnteriorAUltima = $('[name=labelDesejaCriarNcDtEmissaoAnteriorAUltima]').val();
                    if (!true) {
                        bootbox.confirm(labelDesejaCriarNcDtEmissaoAnteriorAUltima, function (result) {
                            if (result) {
                                var naoConformidadeObj = APP.controller.NaoConformidadeController.getCriarNaoConformidadeObj(_fluxo);
                                APP.controller.NaoConformidadeController.saveFormCriarNaoConformidade(naoConformidadeObj, _fluxo);
                            }
                        });
                    } else {
                        var naoConformidadeObj = APP.controller.NaoConformidadeController.getCriarNaoConformidadeObj(_fluxo);
                        APP.controller.NaoConformidadeController.saveFormCriarNaoConformidade(naoConformidadeObj, _fluxo);
                    }
                }
            }
        });

    },

    getObjObjFormCriarNaoConformidadeValidate: function () {

        var acoesNaoConformidadeoFormCriarNaoConformidadeObj = {
            //formCriarNaoConformidadeNmRegistro: 'required',
            formCriarNaoConformidadeDsRegistro: {
                'required': true,
                'minlength': 4
            },
            formCriarNaoConformidadeDtEmissao: { 'required': true },
            formCriarNaoConformidadeProcesso: { 'required': true },
            formCriarNaoConformidadeEmissor: 'required',
            formCriarNaoConformidadeEAuditoria: 'required',
            formCriarNaoConformidadeTipo: 'required',
            formCriarNaoConformidadeResponsavel: 'required',
            //formCriarNaoConformidadeTags: 'required',

        };

        return acoesNaoConformidadeoFormCriarNaoConformidadeObj;

    },

    getObjFormCriarNaoConformidade: function (_fluxo) {

        var acoesNaoConformidadeFormCriarNaoConformidadeObj = {};

        switch (_fluxo) {
            case "fluxo-00":
                //Obj enviado no fluxo de criacao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    IdSite: $('[name=IdSite]').val(),
                    StatusEtapa: parseInt($('[name=StatusEtapa]').val()),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    ArquivosDeEvidenciaAux: APP.controller.NaoConformidadeController.getAnexosEvidencias(),
                    DtEmissao: $('[name=formCriarNaoConformidadeDtEmissao]').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    ENaoConformidadeAuditoria: APP.component.Radio.init('formCriarNaoConformidadeEAuditoria'),
                    IdTipoNaoConformidade: $('[name=formCriarNaoConformidadeTipo] :selected').val(),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    Causa: $('[name=formCausa]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val()
                };

                break;

            case "fluxo-01":
                //Obj enviado no fluxo 01 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: 4,
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    EProcedente: APP.component.Radio.init('formAcaoImadiataEProcedente'),
                    DtDescricaoAcao: $('[name=formAcaoImadiataDtDescricaoAcao]').val(),
                    DescricaoAcao: $('[name=formAcaoImadiataJustificativa]').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    ENaoConformidadeAuditoria: APP.component.Radio.init('formCriarNaoConformidadeEAuditoria'),
                    IdTipoNaoConformidade: $('[name=formCriarNaoConformidadeTipo] :selected').val(),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    Causa: $('[name=formCausa]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val()
                };

                break;

            case "fluxo-02":
                //Obj enviado no fluxo 02 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: 2,
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    EProcedente: APP.component.Radio.init('formAcaoImadiataEProcedente'),
                    DtDescricaoAcao: $('[name=formAcaoImadiataDtDescricaoAcao]').val(),
                    AcoesImediatas: APP.controller.NaoConformidadeController.getObjFormAcaoImediata(),
                    ECorrecao: APP.component.Radio.init('formAcaoImadiataECorrecao'),
                    NecessitaAcaoCorretiva: APP.component.Radio.init('formAcaoImadiataNecessitaAC'),
                    IdResponsavelReverificador: $('[name=formAcaoImadiataResponsavelReverificacao]').val(),
                    IdResponsavelPorIniciarTratativaAcaoCorretiva: $('[name=formAcaoImadiataResponsavelTratativa]').val(),
                    DescricaoAnaliseCausa: $('[name=formAcaoImadiataAnaliseCausa]').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    ENaoConformidadeAuditoria: APP.component.Radio.init('formCriarNaoConformidadeEAuditoria'),
                    IdTipoNaoConformidade: $('[name=formCriarNaoConformidadeTipo] :selected').val(),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    Causa: $('[name=formCausa]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val()
                };

                break;
            case "fluxo-03":
                //Obj enviado no fluxo 03 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: 2,
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    EProcedente: APP.component.Radio.init('formAcaoImadiataEProcedente'),
                    AcoesImediatas: APP.controller.NaoConformidadeController.getObjFormAcaoImediata(),
                    NumeroAcaoCorretiva: $('[name=formAcaoImadiataNumeroAC]').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    ENaoConformidadeAuditoria: APP.component.Radio.init('formCriarNaoConformidadeEAuditoria'),
                    IdTipoNaoConformidade: $('[name=formCriarNaoConformidadeTipo] :selected').val(),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    Causa: $('[name=formCausa]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val()
                };
                break;
            case "fluxo-04":
                //Obj enviado no fluxo 04 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: $('[name=StatusEtapa]').val(),
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    AcoesImediatas: APP.controller.GestaoDeRiscoController.getObjFormAcaoImediata(),
                    FlEficaz: APP.controller.GestaoDeRiscoController.getFoiEficaz(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    DtEmissao: $('[name=formCriarNaoConformidadeDtEmissao]').val(),
                    NecessitaAcaoCorretiva: APP.component.Radio.init('formAcaoImadiataNecessitaAC'),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    CriticidadeGestaoDeRisco: $('[name=formCriarNaoConformidadeCriticidade] :selected').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdResponsavelReverificador: $('[name=formAcaoImadiataResponsavelReverificacao]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    DtPrazoImplementacao: $('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    DsAcao: $('[name=formAcaoImadiataTbDescricao]').val(),
                    EProcedente: $('[name=formAcaoImadiataEProcedente]:checked').val(),
                    ArquivosDeEvidenciaAux: APP.controller.GestaoDeRiscoController.getAnexosEvidencias(),
                    Causa: $('[name=formCausa]').val(),
                };
            case "fluxo-05":
                //Obj enviado no fluxo 04 de edicao
                acoesNaoConformidadeFormCriarNaoConformidadeObj = {
                    StatusEtapa: $('[name=StatusEtapa]').val(),
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    AcoesImediatas: APP.controller.GestaoDeRiscoController.getObjFormAcaoImediata(),
                    FlEficaz: APP.controller.GestaoDeRiscoController.getFoiEficaz(),
                    Tags: $('[name=formCriarNaoConformidadeTags]').val(),
                    IdEmissor: $('[name=formCriarNaoConformidadeEmissor] :selected').val(),
                    IdProcesso: $('[name=formCriarNaoConformidadeProcesso] :selected').val(),
                    DtEmissao: $('[name=formCriarNaoConformidadeDtEmissao]').val(),
                    NecessitaAcaoCorretiva: APP.component.Radio.init('formAcaoImadiataNecessitaAC'),
                    IdResponsavelInicarAcaoImediata: $('[name=formCriarNaoConformidadeResponsavel] :selected').val(),
                    CriticidadeGestaoDeRisco: $('[name=formCriarNaoConformidadeCriticidade] :selected').val(),
                    DescricaoRegistro: $('[name=formCriarNaoConformidadeDsRegistro]').val(),
                    DsJustificativa: $('[name=formCriarNaoConformidadeDsJustificativa]').val(),
                    IdResponsavelReverificador: $('[name=formAcaoImadiataResponsavelReverificacao]').val(),
                    IdResponsavelImplementar: $('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    DtPrazoImplementacao: $('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    DsAcao: $('[name=formAcaoImadiataTbDescricao]').val(),
                    EProcedente: $('[name=formAcaoImadiataEProcedente]:checked').val(),
                    ArquivosDeEvidenciaAux: APP.controller.GestaoDeRiscoController.getAnexosEvidencias(),
                    Causa: $('[name=formCausa]').val(),
                };
                break;
        }

        return acoesNaoConformidadeFormCriarNaoConformidadeObj;

    },

    getAnexosEvidencias: function () {

        var anexoEvidenciaModel = APP.controller.ClienteController.models.AnexoModel;
        var arrayAnexoEvidencia = [];

        $('.dashed li a:first-child').each(function () {

            var nameImg = $(this).text();
            var anexoEvidenciaNC = anexoEvidenciaModel.constructor(
                $(this).closest('li').find('[name=formCriarNaoConformidadeEvidenciaIdAnexo]').val(),
                nameImg,
                $(this).data('b64')
            );

            arrayAnexoEvidencia.push(anexoEvidenciaNC);
        });

        return arrayAnexoEvidencia;

    },

    //Formulario Acao Imediata
    formAcaoImediata: function () {

        this.setAndHideAcaoImediata();
        this.getformCriarNaoConformidadeDtDescricaoAcao();
        this.setAcaoImediata();
        this.delAcaoImediata();
        this.getResponsavelReverificarAcaoImediata();
        this.getResponsavelTratativaAcaoImediata();

    },

    setAndHideAcaoImediata: function () {

        //

    },

    getformCriarNaoConformidadeDtDescricaoAcao: function () {

        $('[name=formAcaoImadiataDtDescricaoAcao]').val(APP.component.Datatoday.init());

    },

    setAcaoImediata: function () {

        this.buttonAddAcaoImediata.unbind('click');
        this.buttonAddAcaoImediata.bind('click', function () {
            
            var TraducaoDropNameSelect = 'Selecione';
            var index = $('#tb-acao-imediata tbody tr').size();

            var html = '';
            html += '<tr role="row" class="odd">';
            html += '<td>';
            html += '<textarea type="text" id="form-acaoimediata-tb-descricao' + _options.NumeroAcaoImediataGrid + '" name="formAcaoImadiataTbDescricao" class="form-control" ';
            html += 'placeholder="Descrição" ';
            html += 'data-msg-required="" ';
            html += 'value=""';
            html += 'rows="3"></textarea>';
            html += '<input type="hidden" name="formAcaoImadiataTbIdAcaoImediata" class="form-control input-data" value="0"/>';
            html += '<input type="hidden" name="formAcaoImadiataTbEstado" value="4"/>';
            html += '</td>';
            html += '<td>';
            html += '<div class="input-group">';
            html += '<input type="text" name="formAcaoImadiataTbDtPrazoImplementacao" id="form-acaoimediata-tb-dt-prazo-implementacao' + _options.NumeroAcaoImediataGrid + '" class="form-control data datepicker largura-calendario" ';
            html += 'data-msg-required="" ';
            html += 'value="" />';
            html += '<span class="input-group-addon">';
            html += '<i class="fa fa-calendar" onclick="AbreCalendario(this)" aria-hidden="true"></i>';
            html += '</span>';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<select id="form-acaoimediata-tb-responsavel-implementar" name="formAcaoImadiataTbResponsavelImplementar" class="form-control" ';
            html += 'data-msg-required="">';
            html += '<option value="">' + TraducaoDropNameSelect + '</option>';
            html += '</select>';
            html += '</td>';
            html += '<td>';
            html += '<div class="input-group">';
            html += '<input type="text" name="formAcaoImadiataTbDtEfetivaImplementacao" id="form-acaoimediata-tb-dt-efetiva-implementacao' + _options.NumeroAcaoImediataGrid + '" class="form-control data datepicker" ';
            html += 'data-msg-required="" ';
            html += 'value="" />';
            html += '<span class="input-group-addon">';
            html += '<i class="fa fa-calendar" aria-hidden="true"></i>';
            html += '</span>';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<div class="upload-arq form-control">';
            html += '<a class="btn-upload-form-acaoimediata-tb-evidencia-' + index + '">';
            html += '<i class="fa fa-paperclip fa-1x" aria-hidden="true"></i><br>Anexar';
            html += '</a>';
            html += '<input type="file" name="formAcaoImadiataTbEvidencia" id="form-acaoimediata-tb-evidencia-' + index + '" class="" data-msg-required="" data-b64="">';
            html += '</div>';
            html += '<ul></ul>';
            html += '</td>';
            html += '<td>';
            html += '<a href="#" class="btn-delete-acao-imediata icon-cliente trash-color">';
            html += '<i class="fa fa-trash" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</a>';
            html += '</td>';
            html += '</tr>';

            $('#tb-acao-imediata tbody').append(html);
            $('.add-acao-imediata').removeClass('show').addClass('hide');
            APP.controller.NaoConformidadeController.bind();

            _options.NumeroAcaoImediataGrid++;

        });

    },

    delAcaoImediata: function () {

        $('.btn-delete-acao-imediata').unbind('click');
        $('.btn-delete-acao-imediata').on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });

    },

    getResponsavelImplementarAcaoImediata: function () {
        var idSite = $('#nao-conformidade-site').val();
        var idFuncao = 15; // Funcionalidade(Implementar aÃ§Ã£o) que permite usuario Implementar aÃ§Ã£o NC
        var idProcesso = $('[name=IdProcesso]').val();
        $.ajax({
            type: "GET",
            dataType: 'json',
            url: '/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso=' + idProcesso + '&idSite=' + idSite + '&idFuncao=' + idFuncao +'',
            beforeSend: function () {
                $('.add-acao-imediata').removeClass('show').addClass('hide');
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    APP.component.SelectListCompare.selectList(result.Lista, $('#tb-acao-imediata tbody tr:last-child [name="formAcaoImadiataTbResponsavelImplementar"] option'), $('#tb-acao-imediata tbody tr:last-child [name="formAcaoImadiataTbResponsavelImplementar"]'), 'IdUsuario', 'NmCompleto');
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {
                $('.add-acao-imediata').removeClass('hide').addClass('show');
            }
        });

    },

    getResponsavelReverificarAcaoImediata: function () {
        var idSite = $('#nao-conformidade-site').val();
        var idProcesso = $('[name=IdProcesso]').val();
        var idFuncao = 16; // Funcionalidade(ReverificaÃ§Ã£o) que permite usuario Reverifique NC
        $.get('/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso= + idProcesso + ' & idSite=' + idSite + ' & idFuncao=' + idFuncao +'', function (result) {
            if (result.StatusCode == 200) {

                $(result.Lista).each(function (key, value) {
                    var $option = $('<option>');
                    $('[name=formAcaoImadiataResponsavelReverificacao]').append(
                        $option.val(value.IdUsuario).text(value.NmCompleto)
                    );
                });
            }
        });

    },

    getResponsavelTratativaAcaoImediata: function () {

        var idSite = $('#nao-conformidade-site').val();
        var idProcesso = $('[name=IdProcesso]').val();
        var idFuncao = 20; // Funcionalidade(AnÃ¡lise da Causa) que permite usuario Criar nova AC
        $.get('/Usuario/ObterUsuariosPorFuncaoSiteEProcesso?idProcesso= + idProcesso + ' & idSite=' + idSite + ' & idFuncao=' + idFuncao +'', function (result) {
            if (result.StatusCode == 200) {
                $(result.Lista).each(function (key, value) {
                    APP.component.SelectListCompare.selectList(result.Lista, $('[name="formAcaoImadiataResponsavelTratativa"] option'), $('[name="formAcaoImadiataResponsavelTratativa"]'), 'IdUsuario', 'NmCompleto');
                });
            }

        });

    },

    bind: function () {

        APP.component.Datapicker.init();
        APP.controller.NaoConformidadeController.setup();
        APP.controller.NaoConformidadeController.setAcaoImediata();
        APP.controller.NaoConformidadeController.getResponsavelImplementarAcaoImediata();
        APP.component.FileUpload.init();
        APP.controller.NaoConformidadeController.setShowPanelEProcedenteSim();
        APP.controller.NaoConformidadeController.setHideRowAcaoImediata();
        APP.controller.NaoConformidadeController.delAcaoImediata();

    },

    getObjObjFormAcaoImediataValidate: function () {

        var acoesNaoConformidadeoFormAcaoImediataObj = {

            //Form Acao Imediata
            formAcaoImadiataEProcedente: { 'required': true },
            formAcaoImadiataDtDescricaoAcao: { 'required': true },
            //formAcaoImadiataJustificativa: {'required': true},
            // formAcaoImadiataTbDescricao: {'required': true},
            // formAcaoImadiataTbDtPrazoImplementacao: {'required': true},
            // formAcaoImadiataTbResponsavelImplementar: {'required': true},
            // formAcaoImadiataTbDtEfetivaImplementacao: {'required': true},
            // formAcaoImadiataTbEvidencia: {'required': true},
            // formAcaoImadiataECorrecao: {'required': true},
            // formAcaoImadiataNecessitaAC: {'required': true},
            // formAcaoImadiataResponsavelReverificacao: {'required': true},
            // formAcaoImadiataFoiEficaz: {'required': true},
            // formAcaoImadiataResponsavelTratativa: {'required': true},
            // formAcaoImadiataNumeroAC: {'required': true},
            // formAcaoImadiataAnaliseCausa: {'required': true},

        };

        return acoesNaoConformidadeoFormAcaoImediataObj;

    },

    getObjFormAcaoImediata: function () {

        var idUsuarioLogado = $('[name=UsuarioLogado]').val();
        var statusEtapa = parseInt($('[name=StatusEtapa]').val());

        var getObjFormAcaoImediataArray = [];
        var acoesNaoConformidadeFormAcaoImediataObj = {};

        var anexoEvidenciaModel = APP.controller.ClienteController.models.AnexoModel;

        $('#tb-acao-imediata tbody tr').each(function (index, tr) {
            if (statusEtapa == 2) {
                acoesNaoConformidadeFormAcaoImediataObj = {
                    Descricao: $(tr).find('[name=formAcaoImadiataTbDescricao]').val(),
                    DtPrazoImplementacao: $(tr).find('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    IdResponsavelImplementar: $(tr).find('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $(tr).find('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    ArquivoEvidenciaAux: anexoEvidenciaModel.constructor(
                        $(tr).find('[name^=formCriarNaoConformidadeEvidencia]').closest('td').find('[name^=formCriarNaoConformidadeEvidenciaIdAnexo]').val(),
                        $(tr).find('[name^=formCriarNaoConformidadeEvidencia]').closest('td').find('i').text(),
                        $(tr).find('[id^=form-acaoimediata-tb-evidencia-]').data('b64')
                    ),
                    Estado: $(tr).find('[name=formAcaoImadiataTbEstado]').val() != 0 ? 16 : 0,
                    IdAcaoImediata: $(tr).find('[name=formAcaoImadiataTbIdAcaoImediata]').val(),
                };
            } else if (statusEtapa == 3) {
                acoesNaoConformidadeFormAcaoImediataObj = {
                    Aprovado: $(tr).find('[name=formAcaoImadiataTbAprovado]').val(),
                    IdAcaoImediata: $(tr).find('[name=formAcaoImadiataTbIdAcaoImediata]').val(),
                    Estado: $(tr).find('[name=formAcaoImadiataTbEstado]').val() != 0 ? 16 : 0,
                };
            } else {
                acoesNaoConformidadeFormAcaoImediataObj = {
                    Descricao: $(tr).find('[name=formAcaoImadiataTbDescricao]').val(),
                    DtPrazoImplementacao: $(tr).find('[name=formAcaoImadiataTbDtPrazoImplementacao]').val(),
                    IdResponsavelImplementar: $(tr).find('[name=formAcaoImadiataTbResponsavelImplementar]').val(),
                    DtEfetivaImplementacao: $(tr).find('[name=formAcaoImadiataTbDtEfetivaImplementacao]').val(),
                    Estado: $(tr).find('[name=formAcaoImadiataTbEstado]').val(),
                    IdRegistroConformidade: $('[name=IdRegistroConformidade]').val(),
                    IdAcaoImediata: $(tr).find('[name=formAcaoImadiataTbIdAcaoImediata]').val(),
                    ArquivoEvidenciaAux: anexoEvidenciaModel.constructor(
                        $(tr).find('[name^=formCriarNaoConformidadeEvidencia]').closest('td').find('[name^=formCriarNaoConformidadeEvidenciaIdAnexo]').val(),
                        $(tr).find('[name^=formCriarNaoConformidadeEvidencia]').closest('td').find('i').text(),
                        $(tr).find('[id^=form-acaoimediata-tb-evidencia-]').data('b64')
                    ),
                };
            }

            getObjFormAcaoImediataArray.push(acoesNaoConformidadeFormAcaoImediataObj);
        });

        return getObjFormAcaoImediataArray;

    },

    //Todos
    sendFormCriarNaoConformidade: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            //var validate = APP.controller.NaoConformidadeController.validateForms();
            var validate = true;

            //validate = true;
            if (validate == true) {

                var statusEtapa = parseInt($('[name=StatusEtapa]').val());
                var IdRegistroConformidade = $('[name=IdRegistroConformidade]').val();
                var eProcedente = $('[name=formAcaoImadiataEProcedente]:checked').val();

                var naoConformidade = {};

                var fluxos = {
                    //Criar Nao Conformidade
                    _000: ['fluxo-00'],
                    //Ã‰ Procedente = false
                    _001: ['fluxo-01'],
                    //Ã‰ Procedente = true
                    _002: ['fluxo-02'],
                    //Status 2 - ImplementaÃ§Ã£o
                    _003: ['fluxo-03'],
                    //Status 3 - ReverificaÃ§Ã£o
                    _004: ['fluxo-04'],
                    //Status 3 - Desbloquear
                    _005: ['fluxo-05']

                };

                switch (statusEtapa) {
                    case 0:
                        APP.controller.NaoConformidadeController.getUltimaDataEmissao('fluxo-00');
                        break;
                    case 1:
                        if (eProcedente == "false") {
                            naoConformidade = APP.controller.NaoConformidadeController.getCriarNaoConformidadeObj("fluxo-01");
                            APP.controller.NaoConformidadeController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-01");
                        } else {
                            naoConformidade = APP.controller.NaoConformidadeController.getCriarNaoConformidadeObj("fluxo-02");
                            APP.controller.NaoConformidadeController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-02");
                        }

                        break;
                    case 2:
                        naoConformidade = APP.controller.NaoConformidadeController.getCriarNaoConformidadeObj("fluxo-03");
                        APP.controller.NaoConformidadeController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-03");

                        break;
                    case 3:
                        naoConformidade = APP.controller.NaoConformidadeController.getCriarNaoConformidadeObj("fluxo-04");
                        APP.controller.NaoConformidadeController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-04");
                        break;
                    case 4:
                        naoConformidade = APP.controller.NaoConformidadeController.getCriarNaoConformidadeObj("fluxo-05");
                        APP.controller.NaoConformidadeController.saveFormCriarNaoConformidade(naoConformidade, "fluxo-05");
                        break;
                }
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    getCriarNaoConformidadeObj: function (_fluxo) {

        var naoConformidadeObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                switch (form) {
                    case "naoconformidade":
                        naoConformidadeObj = APP.controller.NaoConformidadeController.getObjFormCriarNaoConformidade(_fluxo);
                        break;
                    //case "acaoimediata":
                    //acaoimediataObj = APP.controller.NaoConformidadeController.getObjFormAcaoImediata();
                    //break;
                }
            }

        });

        return naoConformidadeObj;

    },

    saveFormCriarNaoConformidade: function (naoConformidadeObj, _fluxo) {
        var url = "";

        switch (_fluxo) {
            case "fluxo-00":
                url = "/NaoConformidade/SalvarPrimeiraEtapa";
                break;
            case "fluxo-01":
                url = "/NaoConformidade/SalvarSegundaEtapa";
                break;
            case "fluxo-02":
                url = "/NaoConformidade/SalvarSegundaEtapa";
                break;
            case "fluxo-03":
                url = "/NaoConformidade/SalvarSegundaEtapa";
                break;
            case "fluxo-04":
                url = "/NaoConformidade/SalvarSegundaEtapa";
                break;
            case "fluxo-05":
                url = "/NaoConformidade/SalvarSegundaEtapa";
                break;
        }

        $.ajax({
            type: "POST",
            data: naoConformidadeObj,
            dataType: 'json',
            url: url,
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/NaoConformidade/Index";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    HabilitaCamposNaoConformidade: function (perfil) {
        if (perfil == '4') {
         
            $('#main').find('input, textarea, button, select').removeAttr('disabled');
            $("#form-criar-nao-conformidade-nm-registro").attr("disabled", true);
            $("#form-criar-nao-conformidade-processo").attr("disabled", true);
            $("#form-criar-nao-conformidade-emissor").attr("disabled", true);

        }
        else {
          
            $('#main').find('input, textarea, button, select').removeAttr('disabled');
            $("#form-criar-nao-conformidade-nm-registro").attr("disabled", true);
            $("#form-criar-nao-conformidade-dt-emissao").attr("disabled", true); 
        }
    },


    DestravaDocumento: function () {

        var idNaoConformidade = $('[name=IdRegistroConformidade]').val();  // $('#form-criar-nao-conformidade-nm-registro').val();
        var data = { "idNaoConformidade": idNaoConformidade };

        $.ajax({
            type: "POST",
            dataType: 'json',
            data: data,
            url: "/NaoConformidade/DestravarDocumento",
            success: function (result) {
                //alert('foi');
                //if (result.StatusCode == 200) {
                //    window.location.reload([true]);
                //} else if (result.StatusCode == 505) {
                //    erro = APP.component.ResultErros.init(result.Erro);
                //    bootbox.alert(erro);
                //} else if (result.StatusCode == 500) {
                //    erro = APP.component.ResultErros.init(result.Erro);
                //    bootbox.alert(erro);
                //}

            },
            error: function (result) {
                //erro = APP.component.ResultErros.init(result.Erro);
                //bootbox.alert(erro);
            },
            //complete: function (result) {
            //    APP.component.Loading.hideLoading();
        });
    },


    setDestravarCamposNaoConformidade: function () {

        this.buttonDestravar.on('click', function () {


            if (perfil == '4') {

                $('#main').find('input, textarea, button, select').removeAttr('disabled');
                $("#form-criar-nao-conformidade-nm-registro").attr("disabled", true);
                $("#form-criar-nao-conformidade-processo").attr("disabled", true);
                $("#form-criar-nao-conformidade-emissor").attr("disabled", true);
            }
            else {
                
                $('#main').find('input, textarea, button, select').removeAttr('disabled');
                $("#form-criar-nao-conformidade-nm-registro").attr("disabled", true);
                $("#form-criar-nao-conformidade-dt-emissao").attr("disabled", true); 
                     
            }


            var idNaoConformidade = $('[name=IdRegistroConformidade]').val();  //$('#form-criar-nao-conformidade-nm-registro').val();
            var data = { "idNaoConformidade": idNaoConformidade };

            $.ajax({
                type: "POST",
                dataType: 'json',
                data: data,
                url: "/NaoConformidade/DestravarDocumento",
                success: function (result) {
                    //alert('foi');
                    //if (result.StatusCode == 200) {
                    //    window.location.reload([true]);
                    //} else if (result.StatusCode == 505) {
                    //    erro = APP.component.ResultErros.init(result.Erro);
                    //    bootbox.alert(erro);
                    //} else if (result.StatusCode == 500) {
                    //    erro = APP.component.ResultErros.init(result.Erro);
                    //    bootbox.alert(erro);
                    //}

                },
                error: function (result) {
                    //erro = APP.component.ResultErros.init(result.Erro);
                    //bootbox.alert(erro);
                },
                //complete: function (result) {
                //    APP.component.Loading.hideLoading();
            });




            //this.HabilitaCamposGestaoRisco(perfil);

            //this.DestravaDocumento();

        });
    },
};
/*
|--------------------------------------------------------------------------
| Controlador Nome
|--------------------------------------------------------------------------
*/

APP.controller.NormaController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "IndexNorma") {
            this.indexNorma();
        }

    },

    setup: function () {

        //Criar Pagina
        this.buttonSalvar = $(".btn-salvar");

        //Form Norma
        this.buttonAddNewNormaFormNorma = $('.novo');
        this.buttonSaveNewNormaFormNorma = $('.save-norma');
        this.buttonEditNewNormaFormNorma = $('.edit-norma');
        this.buttonDelNewNormaFormNorma = $('.del-norma');
        this.buttonActiveNewNormaFormNorma = $('.active-norma');

    },

    //Index
    indexNorma: function () {

        APP.component.DataTable.init('#tb-index-norma');
        this.acoesNorma();

    },

    //Acoes
    acoesNorma: function () {

        APP.component.AtivaLobiPanel.init();

        this.setAndHide();
        this.setValidateForms();
        this.formCriarNorma();

    },

    setAndHide: function () {

        $('#tb-index-norma tbody').find('input').prop('disabled', true);
        $('#tb-index-norma tbody').find('select').prop('disabled', true);

    },

    setValidateForms: function () {

        var ObjFormNormaValidate = APP.controller.NormaController.getObjObjFormNormaValidate();
        APP.component.ValidateForm.init(ObjFormNormaValidate, '#form-norma');

    },

    //Formulario Criar Norma
    formCriarNorma: function () {

        this.setAndHideCriarNorma();
        this.setNewNormaFormNorma();
        this.setSaveNormaFormNorma();
        this.setEditNormaFormNorma();
        this.setActiveNormaFormNorma();
        this.setDelNormaFormNorma();

    },

    setAndHideCriarNorma: function () {

        var empty = $('#tb-index-norma tbody tr td').hasClass('dataTables_empty');
        if (empty) {
            $('.odd').remove();
        }

    },

    setNewNormaFormNorma: function () {

        this.buttonAddNewNormaFormNorma.unbind('click');
        this.buttonAddNewNormaFormNorma.on('click', function () {
            event.preventDefault();

            var index = $('#tb-index-norma tbody tr').size();

            var html = '';
            html += '<!-- Norma -->';
            html += '<tr role="row">';
            //html += '<td>';
            //html += '<div class="form-group">';
            //html += '<input type="text" class="form-control" id="form-norma-item" name="formNormaItem" placeholder="Item" data-msg-required="" value="-" disabled/>';
            //html += '</div>';
            //html += '</td>';
            html += '<td>';
            html += '<div class="form-group">';
            html += '<input type="text" class="form-control" id="form-norma-codigo" name="formNormaCodigo" placeholder="Código" data-msg-required="" value="" />';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<div class="form-group" style="width: 100%;">';
            html += '<input type="text" class="form-control" id="form-norma-titulo" name="formNormaTitulo" placeholder="Título" data-msg-required="" value=""/>';
            html += '</div>';
            html += '</td>';
            html += '<td class="text-nowrap">';
            html += '<a href="#" class="save-norma ativo-color">';
            html += '<i class="fa fa-check" aria-hidden="true" data-toggle="tooltip" data-original-title="@Traducao.Resource.btn_lbl_salvar"></i>';
            html += '</a>';
            html += '<a href="#" class="edit-norma editar-color">';
            html += '<i class="fa fa-pencil" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonEditar + '" data-original-title="' + _options.labelButtonEditar + '"></i>';
            html += '</a>';
            html += '<a href="#" class="del-norma trash-color">';
            html += '<i class="fa fa-trash" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</a>';
            html += '<a href="#" class="active-norma ativo-color">';
            html += '<i class="fa fa-circle" aria-hidden="true" data-toggle="tooltip" data-original-title= '+_options.btn_lbl_desativar+' ></i>';
            html += '</a>';
            html += '</td>';
            html += '</tr>';


            $('#tb-index-norma tbody').append(html);

            APP.controller.NormaController.bindFormNorma();

        });

    },

    setSaveNormaFormNorma: function () {

        this.buttonSaveNewNormaFormNorma.unbind('click');
        this.buttonSaveNewNormaFormNorma.on('click', function () {
            event.preventDefault();

            APP.controller.NormaController.sendFormNorma(this, 'save');

        });

    },

    setEditNormaFormNorma: function () {

        this.buttonEditNewNormaFormNorma.unbind('click');
        this.buttonEditNewNormaFormNorma.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name^=formNormaItem]').prop('disabled', true);
            $(this).closest('tr').find('[name^=formNormaCodigo]').prop('disabled', false);
            $(this).closest('tr').find('[name^=formNormaTitulo]').prop('disabled', false);

        });

    },

    setDelNormaFormNorma: function () {

        $('.del-norma').unbind('click');
        $('.del-norma').on('click', function () {
            event.preventDefault();

            var idNorma = $(this).data('id-norma');
            var msgIconeExcluir = $('[name=msgIconeExcluir]').val();
            var _this = this;

            bootbox.confirm(msgIconeExcluir, function (result) {
                if (result == true) {

                    APP.controller.NormaController.sendFormNorma(_this, 'del');
                }
            });

        });

    },

    setActiveNormaFormNorma: function () {

        $('.active-norma').unbind('click');
        $('.active-norma').on('click', function () {
            event.preventDefault();

            var idNorma = $(this).data('id-norma');
            var AtivoInativo = $(this).find('i').attr("title");

            var msgIconeAtivoAtivar = $('[name=msgIconeAtivoAtivar]').val();
            var msgIconeAtivoInativar = $('[name=msgIconeAtivoInativar]').val();
            var _this = this;

            if (AtivoInativo != _options.labelButtonAtivar) {
                bootbox.confirm(msgIconeAtivoAtivar, function (result) {
                    if (result == true) {
                        APP.controller.NormaController.sendFormNorma(_this, 'active');
                    }
                });
            } else {
                bootbox.confirm(msgIconeAtivoInativar, function (result) {
                    if (result == true) {
                        APP.controller.NormaController.sendFormNorma(_this, 'active');
                    }
                });
            }

        });

    },

    bindFormNorma: function () {

        APP.controller.NormaController.setup();
        APP.controller.NormaController.setNewNormaFormNorma();
        APP.controller.NormaController.setSaveNormaFormNorma();
        APP.controller.NormaController.setEditNormaFormNorma();
        APP.controller.NormaController.setDelNormaFormNorma();
        APP.controller.NormaController.setActiveNormaFormNorma();
        APP.controller.NormaController.setValidateForms();

    },

    getObjObjFormNormaValidate: function () {

        var acoesNormaFormNormaObj = {
            formNormaCodigo: 'required',
            formNormaTitulo: 'required',
        };

        return acoesNormaFormNormaObj;

    },

    getObjFormNorma: function (e) {

        var acoesNormaFormNormaObj = {
            IdSite: $('[name=IdSite]').val(),
            IdNorma: $(e).closest('tr').find('[name^=formNormaItem]').val(),
            DataCadastro: $(e).closest('tr').find('[name^=formNormaDtCadastro]').val(),
            Codigo: $(e).closest('tr').find('[name^=formNormaCodigo]').val(),
            Titulo: $(e).closest('tr').find('[name^=formNormaTitulo]').val(),
            Ativo: $(e).closest('tr').find('[class^=active-norma]').val(),
        };

        return acoesNormaFormNormaObj;

    },

    //Todos
    sendFormNorma: function (e, _action) {

        var validate = APP.controller.NormaController.validateForms();

        //var validate = true;
        if (validate == true) {
            var normaObj = APP.controller.NormaController.getObjFormNorma(e);
            switch (_action) {
                case 'save':
                    APP.controller.NormaController.saveFormNorma(normaObj);
                    break;
                case 'del':
                    APP.controller.NormaController.delFormNorma(normaObj);
                    break;
                case 'active':
                    APP.controller.NormaController.activeFormNorma(normaObj);
                    break;
            }

        }

    },

    validateForms: function () {

        var valid = true;
        var validate = $('#form-norma').valid();
        if (validate != true) {
            valid = false;
        }

        return valid;

    },

    saveFormNorma: function (normaObj) {

        $.ajax({
            type: "POST",
            data: normaObj,
            dataType: 'json',
            url: "/Norma/Salvar",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.reload([true]);
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    delFormNorma: function (normaObj) {

        $.ajax({
            type: "POST",
            data: normaObj,
            url: "/Norma/Excluir",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    window.location.reload([true]);
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    activeFormNorma: function (normaObj) {

        $.ajax({
            type: "POST",
            data: normaObj,
            dataType: 'json',
            url: "/Norma/AtivaInativa",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    window.location.reload([true]);
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

};
/*
|--------------------------------------------------------------------------
| Controlador Nome
|--------------------------------------------------------------------------
*/

APP.controller.PadraoController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "IndexPadrao") {
            this.indexPadrao();
        }
        if (page == "CriarPadrao") {
            this.acoesPadrao();
        }

    },

    setup: function () {

        //Criar Pagina
        this.buttonSalvar = $(".btn-salvar");

    },

    //Models
    models: {

        //PerfilUsuarioModel: APP.model.PerfilUsuario,

    },

    //Index Padrao
    indexPadrao: function () {

        APP.component.DataTable.init('#tb-index-padrao');

    },

    //Acoes Padrao
    acoesPadrao: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        APP.component.FileUpload.init();
        APP.component.Mascaras.init();
        this.setAndHide();
        this.setValidateForms();
        this.formCriarPadrao();

        this.sendFormCriarPadrao();

    },

    setAndHide: function () {

        //

    },

    setValidateForms: function () {

        var ObjFormCriarPadraoValidate = APP.controller.PadraoController.getObjFormCriarPadraoValidate();
        APP.component.ValidateForm.init(ObjFormCriarPadraoValidate, '#form-criar-padrao');

    },

    //Formulario Criar Padrao
    formCriarPadrao: function () {

        this.setAndHideCriarPadrao();

    },

    setAndHideCriarPadrao: function () {

        //

    },

    getObjFormCriarPadraoValidate: function () {

        var acoesPadraoFormCriarPadraoObj = {
            //formCriaClienteLogo: {required: true, minFiles: 1},
            formCriaPadraoNome: 'required',
        };

        return acoesPadraoFormCriarPadraoObj;

    },

    getObjFormCriarPadrao: function () {

        var imgB64 = $('[name=formCriaClienteLogo]').prop('files').length != 0 ? $('[name=formCriaClienteLogo]').prop('files')[0].name : '';

        var acoesPadraoFormCriarPadraoObj = {
            TipoConteudo: imgB64,
            NomeArquivo: $('[name=formCriaUsuarioLogo]').data('b64'),
            Select: $('[name=formCriaPadraoSelect] :selected').val(),
            Checked: $('[name=formCriaPadraoChecked]:checked').val(),
            Input: $('[name=formCriaPadraoInput]').val(),
            Radio: APP.component.Radio.init('formCriaPadraoRadio'),
            Array: APP.controller.PadraoController.getObjFormCriarPadraoArray(),
        };

        return acoesPadraoFormCriarPadraoObj;

    },

    getObjFormCriarPadraoArray: function () {

        var arrayAcoesPadraoFormCriarPadraoObj = [];
        var acoesPadraoFormCriarPadraoObj = {
            TipoConteudo: $('[name=formCriaClienteLogo]').prop('files')[0].name,
            NmLogo: $('[name=formCriaClienteLogo]').data('b64'),
            Select: $('[name=formCriaPadraoSelect] :selected').val(),
            Checked: $('[name=formCriaPadraoChecked]:checked').val(),
        };

        arrayAcoesPadraoFormCriarPadraoObj.push(acoesPadraoFormCriarPadraoObj);

        return arrayAcoesPadraoFormCriarPadraoObj;

    },

    //Todos
    sendFormCriarPadrao: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = APP.controller.PadraoController.validateForms();

            //var validate = true;
            if (validate == true) {
                var padraoObj = APP.controller.PadraoController.getCriarPadraoObj();
                APP.controller.PadraoController.saveFormCriarPadrao(padraoObj);
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    getCriarPadraoObj: function () {

        var padraoObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                switch (form) {
                    case "padrao":
                        padraoObj = APP.controller.PadraoController.getObjFormCriarPadrao();
                        break;
                }
            }

        });

        return padraoObj;

    },

    saveFormCriarPadrao: function (padraoObj) {

        var erro = "";

        $.ajax({
            type: "POST",
            data: padraoObj,
            dataType: 'json',
            url: "/Padrao/SalvarPadrao",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        //window.location.href = "/Usuario/Index";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

};
/*
|--------------------------------------------------------------------------
| Controlador Plai
|--------------------------------------------------------------------------
*/

APP.controller.PlaiController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "AcoesPlai") {
            this.acoesPlai();
        }

    },

    setup: function () {

        //Criar Pagina
        this.buttonSalvar = $(".btn-salvar");
        this.buttonImprimir = $(".btn-imprimir");

    },

    //Models
    models: {

        //PerfilUsuarioModel: APP.model.PerfilUsuario,

    },

    //Acoes Plai
    acoesPlai: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        this.setAndHide();
        this.setValidateForms();
        this.formCriarPlai();
        this.eventoImprimir();
        this.sendFormCriarPlai();

    },

    eventoImprimir: function () {

        this.buttonImprimir.on('click', function () {

            var idPlai = $(".IdPlai").val();
            APP.controller.PlaiController.imprimir(idPlai);

        });

    },



    imprimir: function (idPlai) {


        if (idPlai != null) {

            APP.component.Loading.showLoading();
            
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/Plai/DownloadPdf?idPlai=' + idPlai, true);
            xhr.responseType = 'arraybuffer';
            xhr.onload = function (e) {
                if (this.status == 200) {
                    var blob = new Blob([this.response], { type: "application/pdf" });
                    var pdfUrl = URL.createObjectURL(blob);
                    printJS(pdfUrl);
                }

                APP.component.Loading.hideLoading();

            };

            xhr.send();

        }
    },

    setAndHide: function () {

        //

    },

    setValidateForms: function () {

        var ObjFormCriarPlaiValidate = APP.controller.PlaiController.getObjFormCriarPlaiValidate();
        APP.component.ValidateForm.init(ObjFormCriarPlaiValidate, '#form-criar-plai');

    },

    //Formulario Criar Plai
    formCriarPlai: function () {

        this.setAndHideCriarPlai();
        this.getElaborador();
        //this.getGestores();
        this.setRulesDateReuniaoEncerramento();

    },

    setAndHideCriarPlai: function () {

        //

    },
     
    getElaborador: function () {

        var idSite = $('[name=IdSite]').val();
        var idFuncao = 12; // Funcionalidade(Cadastrar) que permite usuario criar nc
        $.get('/Usuario/ObterUsuariosPorFuncao?idSite=' + idSite + '&idFuncao=' + idFuncao + '', (result) => {
            if (result.StatusCode == 200) {
                APP.component.SelectListCompare.selectList(result.Lista, $('[name=formCriarPlaiElaborador] option'), $('[name=formCriarPlaiElaborador]'), 'IdUsuario', 'NmCompleto');
            }
        });

    },

    //getGestores: function () {

    //    var idSite = $('[name=IdSite]').val();
    //    var idPerfil = 3; // Perfil Coordenador
    //    $.get('/Usuario/ObterUsuariosPorPerfilESite?idSite=' + idSite + '&idPerfil=${idPerfil}', (result) => {
    //        if (result.StatusCode == 200) {
    //            APP.component.SelectListCompare.selectList(result.Lista, $('[name=formCriarPlaiGerentes] option'), $('[name=formCriarPlaiGerentes]'), 'IdUsuario', 'NmCompleto');
    //        }
    //    });

    //},

    getObjFormCriarPlaiValidate: function () {

        var formCriarPlaioObj = {
            formCriarPlaiDtReuniaoAbertura: 'required',
            formCriarPlaiHrReuniaoAbertura: 'required',
            formCriarPlaiDtReuniaoEncerramento: 'required',
            formCriarPlaiHrReuniaoEncerramento: 'required',
            formCriarPlaiElaborador: 'required',
            formCriarPlaiProcessoDt: 'required',
            formCriarPlaiProcessoHr: 'required',
            //formCriarPlaiProcessoNormas: 'required',
        };

        return formCriarPlaioObj;

    },

    getObjFormCriarPlai: function () {

        var formCriarPlaiObj = {
            IdPlai: $('[name=IdPlai]').val(),
            DataReuniaoAbertura: $('[name=formCriarPlaiDtReuniaoAbertura]').val() + " " + $('[name=formCriarPlaiHrReuniaoAbertura]').val(),
            DataReuniaoEncerramento: $('[name=formCriarPlaiDtReuniaoEncerramento]').val() + " " + $('[name=formCriarPlaiHrReuniaoEncerramento]').val(),
            IdElaborador: $('[name=formCriarPlaiElaborador] :selected').val(),
            PlaiGerentes: APP.controller.PlaiController.getObjFormCriarPlaiGerentes(),
            PlaiProcessoNorma: APP.controller.PlaiController.getObjFormCriarPlaiProcessos(),

        };

        return formCriarPlaiObj;

    },

    getObjFormCriarPlaiProcessos: function () {

        var arrayFormCriarPlaiObj = [];
        var formCriarPlaiObj = {};

        $('.plai-processo').each(function () {
            
            var IdProcesso = $(this).find('[name=IdProcesso]').val();
            var IdPlai = $(this).find('[name=IdPlai]').val();
            var data = $(this).find('[name=formCriarPlaiProcessoDt]').val() + " " + $(this).find('[name=formCriarPlaiProcessoHr]').val();
            
            $(this).find('[name^=formCriarPlaiProcessoNormas]').each(function () {

                formCriarPlaiObj = {
                    IdPlai: IdPlai,
                    IdProcesso: IdProcesso,
                    Data: data,
                    IdNorma: $(this).val(),
                    Ativo: $(this).is(':checked'),
                };
                if (formCriarPlaiObj.Ativo == true)
                {
                    arrayFormCriarPlaiObj.push(formCriarPlaiObj);                
                }
                
            });

            
        });

        return arrayFormCriarPlaiObj;

    },

    getObjFormCriarPlaiGerentes: function () {

        var arrayFormCriarPlaiGerentesObj = [];
        var formCriarPlaiGerenteObj = {};

        $("#form-criar-plai-gerentes :selected").each(function () {

            formCriarPlaiGerenteObj = {
                IdPlai: $('[name=IdPlai]').val(),
                IdUsuario: $(this).val(),
            };

            arrayFormCriarPlaiGerentesObj.push(formCriarPlaiGerenteObj);
        });

        return arrayFormCriarPlaiGerentesObj;

    },
    

    setRulesDateReuniaoEncerramento: function () {

        $('[name=formCriarPlaiDtReuniaoAbertura]').on('change', function () {

            APP.component.Datapicker.setDataPicker(this, '[name=formCriarPlaiDtReuniaoEncerramento]');

        });

    },

    //Todos
    sendFormCriarPlai: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = APP.controller.PlaiController.validateForms();

            //var validate = true;
            if (validate == true) {
                var plaiObj = APP.controller.PlaiController.getCriarPlaiObj();
                APP.controller.PlaiController.saveFormCriarPlai(plaiObj);
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    getCriarPlaiObj: function () {

        var plaiObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                if(form == "plai")
                {
                    plaiObj = APP.controller.PlaiController.getObjFormCriarPlai();
                 
                }
            }

        });

        return plaiObj;

    },

    saveFormCriarPlai: function (plaiObj) {

        var erro = "";

        $.ajax({
            type: "POST",
            data: { Plai: plaiObj },
            dataType: 'json',
            url: "/Plai/Salvar",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        //window.location.href = "/Usuario/Index";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

};
/*
|--------------------------------------------------------------------------
| Relatorio Controller
|--------------------------------------------------------------------------
*/

APP.controller.RelatorioController = {

    init: function () {
        //var page = APP.component.Util.getPage();

        this.dashBoard();
    },


    dashBoard: function () {
        this.getRelatorioPizza();
        this.getRelatorioBarra();
        this.getRelatorioRosquinha();
        this.getRelatorioEmpilhado();
        this.getRelatorioEmpilhado();
        this.getRelatorioSpline();
        this.getRelatorioRange();
    },

    getNaoConformidades: function () {
        var json = '';
        $.ajax({
            type: "GET",
            dataType: 'json',
            async: false,
            url: '/Relatorio/NaoConformidade',
            success: function (result) {
                if (result.StatusCode == 200) {
                    json = result.Relatorio;
                }
            },
            error: function (result) {
                bootbox.alert(_options.TesteErro);
            }
        });
        return json;
    },

    getRelatorioPizza: function () {
        var jsonLocal = this.getNaoConformidades();

        var filtro = this.montarRelatorioPizza(jsonLocal[i], i);
        APP.component.Highcharts.pizza(filtro);
    },

    montarRelatorioPizza: function (dados, identificador) {

        var seriesTotais = { data: { valorMeta: [], valorRealizado: [] } };

        var objGrafico = {
            Container: "container" + identificador,
            Chart: {
                type: 'pie',
                options3d: {
                    enabled: true,
                    alpha: 45,
                    beta: 0
                }
            },
            Titulo: 'NÃ£o Conformidade',
            SeriesTotais: [{
                name: 'NÃ£o Conformidade',
                type: 'pie',
                yAxis: 1,
                data: seriesTotais.data,
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                }
            }],
        };

        return objGrafico;

    },

    getRelatorioBarra: function () {
        var filtro = "";
        APP.component.Highcharts.barra(filtro);
    },

    getRelatorioRosquinha: function () {
        var filtro = "";
        APP.component.Highcharts.rosquinha(filtro);
    },

    getRelatorioEmpilhado: function () {
        var filtro = "";
        APP.component.Highcharts.empilhado(filtro);
    },

    getRelatorioSpline: function () {
        var filtro = "";
        APP.component.Highcharts.spline(filtro);
    },

    getRelatorioRange: function () {
        var filtro = "";
        APP.component.Highcharts.range(filtro);
    },

};

/*
|--------------------------------------------------------------------------
| Controlador Site
|--------------------------------------------------------------------------
*/

APP.controller.SiteController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "IndexSite") {
            this.indexSite();
        }
        if (page == "CriarSite") {
            this.criarSite();
        }

    },

    setup: function () {

        //Criar Site
        this.buttonSalvar = $(".btn-salvar");

    },

    //Models
    models: {
        SiteModel: APP.model.Site,
        AnexoModel: APP.model.Anexo,
        ModuloModel: APP.model.Modulo,
        ProcessoModel: APP.model.Processo,
    },

    indexSite: function () {

        APP.component.DataTable.init('#tb-index-sites');
        APP.controller.SiteController.setMsgIconeAtivo();
        APP.controller.SiteController.setMsgIconeExcluir();

    },

    setMsgIconeAtivo: function () {
        

    },
    
    getMsgIconeAtivo: function (_idSite) {

        var erro = "";
        var idCliente = $('[name=IdCliente]').val();
        $.ajax({
            type: "POST",
            dataType: 'json',
            url: '/Site/AtivaInativa?idSite=' + _idSite'',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {

                if (result.StatusCode == 200) {
                    window.location.href = "/Site/Index/" + idCliente;
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    setMsgIconeExcluir: function () {
       

    },

    getMsgIconeExcluir: function (_idCliente) {

        var erro = "";
        $.ajax({
            type: "POST",
            dataType: 'json',
            url: '/Site/Excluir?id=' + _idCliente'',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    window.location.href = "/Site/Index";
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    criarSite: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        APP.component.FileUpload.init();
        APP.component.Mascaras.init();
        this.setValidateForms();
        this.formCriarSite();
        this.formModulos();
        this.formProcessos();

        this.sendFormCriarSite();

    },

    setValidateForms: function () {

        var ObjFormCriarSiteValidate = APP.controller.SiteController.getObjFormCriarSiteValidate();
        APP.component.ValidateForm.init(ObjFormCriarSiteValidate, '#form-criar-site');

        var ObjFormModulosValidate = APP.controller.SiteController.getObjFormModulosValidate();
        APP.component.ValidateForm.init(ObjFormModulosValidate, '#form-modulos-acesso');

        var ObjFormProcessosValidate = APP.controller.SiteController.getObjFormProcessosValidate();
        APP.component.ValidateForm.init(ObjFormProcessosValidate, '#form-processos');

    },

    //Formulario Criar Site
    formCriarSite: function () {

        this.setAndHideCriarSite();

    },

    setAndHideCriarSite: function () {

        //

    },

    getObjFormCriarSiteValidate: function () {
        var IdSite = $('[name=IdSite]').val();
        var criarClienteFormCriarSiteObj = {
            formCriaSiteLogo: $('[name=formCriaSiteLogo]').data('b64') != "" ? { required: false } : { required: true },
            formCriaSiteNome: { required: true, maxlength: 60 },
            formCriaSiteRazaoSocial: { required: true, maxlength: 60 },
            formCriaSiteCnpj: { required: true, cnpj: true },
            //formCriaSiteFrase: 'required',
            //formCriaSiteObservacoes: 'required',
        };

        return criarClienteFormCriarSiteObj;

    },

    getObjFormCriarSite: function () {

        var siteModel = APP.controller.SiteController.models.SiteModel;
        var anexoModel = APP.controller.SiteController.models.AnexoModel;

        var imgB64 = $('[name=formCriaSiteLogo]').prop('files').length != 0 ? $('[name=formCriaSiteLogo]').prop('files')[0].name : $('[name=formCriaSiteLogoNome]').val();
        var anexo = anexoModel.constructor(
            $('[name=formCriaSiteLogoIdAnexo]').val(),
            imgB64,
            $('[name=formCriaSiteLogo]').data('b64')
        );

        var site = siteModel.constructor(
            anexo,
            $('[name=IdSite]').val(),
            $('[name=formCriaSiteNome]').val(),
            $('[name=formCriaSiteRazaoSocial]').val(),
            $('[name=formCriaSiteCnpj]').val(),
            $('[name=formCriaSiteFrase]').val(),
            $('[name=formCriaSiteObservacoes]').val(),
            $('[name=formCriaSiteAtivo]').is(':checked'),
            APP.controller.SiteController.getObjFormModulos(site),
            APP.controller.SiteController.getObjFormProcessos(site),
            $('[name=IdCliente]').val()
        );


        return site;

    },

    //Formulario Modulos
    formModulos: function () {

        this.setAndHideModulos();

    },

    setAndHideModulos: function () {

        //

    },

    getObjFormModulosValidate: function () {

        var criarClienteFormModulosObj = {
            //formModulosAcessoEscolha: 'required',
        };

        return criarClienteFormModulosObj;

    },

    getObjFormModulos: function (site) {

        var modulo = APP.controller.SiteController.models.ModuloModel;
        var arrSiteFuncionalidades = [];
        $('[name=formModulosAcessoEscolha]:checked').each(function (i) {
            var constructor = modulo.constructor(
                $('[name=IdSiteFuncionalidade]').val(),
                $('[name=IdSite]').val(),
                $(this).val()
            );
            arrSiteFuncionalidades.push(constructor);
        });

        return arrSiteFuncionalidades;

    },

    //Formulario Processos
    formProcessos: function () {

        this.setAndHideProcessos();
        this.setProcesso();
        this.delProcesso();

    },

    setAndHideProcessos: function () {

        //

    },

    setProcesso: function () {

        $('.btn-add-processo').unbind('click');
        $('.btn-add-processo').on('click', function () {

            var msgProcessosNomeLabel = $('[name=msgProcessosNomeLabel]').val();
            var msgProcessosNomePlaceholder = $('[name=msgProcessosNomePlaceholder]').val();
            var msgProcessosNomeRequired = $('[name=msgProcessosNomeRequired]').val();
            var msgProcessosNomeRequiredMaxlength = $('[name=msgProcessosNomeRequiredMaxlength]').val();
            var msgProcessosAtivo = $('[name=msgProcessosAtivo]').val();
            var msgIconeExcluir = $('[name=msgIconeExcluir]').val();

            var index = $('#tb-processos tbody tr').size();

            var html = '';
            html += '<tr role="row" class="odd">';
            html += '<td>';
            html += '<div class="form-group">';
            html += '<input type="text" name="formProcessosNome" id="form-processos-nome-' + index + '" class="form-control"';
            html += 'placeholder="' + msgProcessosNomePlaceholder + '"';
            html += 'data-msg-required="' + msgProcessosNomeRequired + '"';
            html += 'data-msg-maxlength="' + msgProcessosNomeRequiredMaxlength + '"';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<div class="form-group checkbox">';
            html += '<input type="checkbox" name="formProcessosAtivo-' + index + '" id="form-processos-ativo-' + index + '" class="form-control" value="true">';
            html += '<label for="form-processos-ativo-' + index + '">' + msgProcessosAtivo + '</label>';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<a href="#" class="btn-delete-processo icon-cliente trash-color">';
            html += '<i class="fa fa-trash" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</a>';
            html += '</td>';
            html += '</tr>';

            $('#tb-processos tbody').append(html);
            APP.controller.ClienteController.bindProcesso();

        });

    },

    delProcesso: function () {

        $('.btn-delete-processo').on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });

    },

    getObjFormProcessosValidate: function () {

        var criarClienteFormProcessosObj = {
            formProcessosNome: 'required',
        };

        return criarClienteFormProcessosObj;

    },

    getObjFormProcessos: function (site) {

        var processo = APP.controller.SiteController.models.ProcessoModel;
        var arrProcessos = [];
        $('#tb-processos tbody tr').each(function (i) {
            var constructor = processo.constructor(
                $(this).find('[name=formProcessosId]').val(),
                $(this).find('[name=formProcessosNome]').val(),
                $('[name=IdSite]').val(),
                $(this).find('[name^=formProcessosAtivo]').is(':checked')
            );
            arrProcessos.push(constructor);
        });

        return arrProcessos;

    },

    bindProcesso: function () {

        APP.controller.SiteController.delProcesso();
        APP.controller.SiteController.setValidateForms();

    },

    //Todos
    sendFormCriarSite: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = APP.controller.SiteController.validateForms();

            //validate = true;
            if (validate == true) {
                APP.controller.SiteController.saveSiteObj();
            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    saveSiteObj: function (_getForm) {

        var siteObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                switch (form) {
                    case "criarsite":
                        siteObj = APP.controller.SiteController.getObjFormCriarSite();
                        APP.controller.SiteController.saveFormSite(siteObj, "/Site/Salvar/");
                        break;
                }
            }

        });

        return siteObj;

    },

    saveFormSite: function (siteObj, _urlAction) {

        $.ajax({
            type: "POST",
            data: siteObj,
            dataType: 'json',
            url: _urlAction,
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {

                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/Site/Index/" + $('[name=IdCliente]').val();
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

};
/*
|--------------------------------------------------------------------------
| Controlador Usuario
|--------------------------------------------------------------------------
*/

APP.controller.UsuarioController = {

    init: function () {

        var page = APP.component.Util.getPage();
        this.setup();

        if (page == "IndexUsuario") {
            this.indexUsuario();
        }
        if (page == "CriarUsuario") {
            this.acoesUsuario();
        }
        if (page == "MeusDados") {
            this.meusDados();
        }
        if (page == "AlterarSenha") {
            this.alterarSenha();
        }

    },

    setup: function () {

        //Criar Usuario
        this.buttonSalvar = $(".btn-salvar");

        //Usuario MeusDados
        this.buttonSaveForm = $("#btnSalvar");
        this.formSenha = $('#form-alterar-senha');
        this.formAlterarSenha = $("#form-alterar-senha");

        //Alterar Senha
        this.buttonAlterarSenha = $('.btn-alterar-senha');

    },

    //Models
    models: {
        UsuarioModel: APP.model.Usuario,
        PerfilUsuarioModel: APP.model.PerfilUsuario,
        UsuarioClienteSiteModel: APP.model.UsuarioClienteSite,
        UsuarioCargoModel: APP.model.UsuarioCargo,
        AnexoModel: APP.model.Anexo,
    },

    //Index Usuario
    indexUsuario: function () {

        APP.component.DataTable.init('#tb-index-usuario');
        APP.controller.UsuarioController.setMsgIconeAtivo();
        APP.controller.UsuarioController.setMsgIconeBloqueia();
        APP.controller.UsuarioController.setMsgIconeEmail();
        APP.controller.UsuarioController.setMsgIconeExcluir();

    },

    setMsgIconeAtivo: function () {
        

    },

    getMsgIconeAtivo: function (_idUsuario, _idCliente) {

        var erro = "";

        $.ajax({
            type: "POST",
            dataType: 'json',
            url: '/Usuario/AtivaInativa?idUsuario='+_idUsuario'',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {

                if (result.StatusCode == 200) {
                    window.location.href = "/Usuario/Index/" + _idCliente;
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    setMsgIconeBloqueia: function () {
        

    },

    getMsgIconeBloqueia: function (_idUsuario, _idCliente) {

        var erro = "";

        $.ajax({
            type: "POST",
            dataType: 'json',
            url: '/Usuario/BloqueiaDesbloqueia?idUsuario='+_idUsuario'',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {

                if (result.StatusCode == 200) {
                    window.location.href = "/Usuario/Index/" + _idCliente;
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    setMsgIconeEmail: function () {
        

    },

    getMsgIconeEmail: function (_idUsuario, _idCliente) {

        var erro = "";

        $.ajax({
            type: "POST",
            dataType: 'json',
            url: '/Usuario/RecebeNaoRecebeEmail?idUsuario='+ _idUsuario'',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {

                if (result.StatusCode == 200) {
                    window.location.href = "/Usuario/Index/" + _idCliente;
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    setMsgIconeExcluir: function () {
        

    },

    getMsgIconeExcluir: function (_idUsuario, _idCliente) {

        var erro = "";
        $.ajax({
            type: "POST",
            dataType: 'json',
            url: '/Usuario/Excluir?id=' + _idUsuario'',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    window.location.href = "/Usuario/Index/" + _idCliente;
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }

            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    //Criar Usuario
    acoesUsuario: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        APP.component.FileUpload.init();
        APP.component.Mascaras.init();
        this.setAndHide();
        this.setValidateForms();
        this.formCriarUsuario();

        this.sendFormCriarUsuario();

    },

    setAndHide: function () {

        //

    },

    setValidateForms: function () {

        var ObjFormCriarUsuarioValidate = APP.controller.UsuarioController.getObjFormCriarUsuarioValidate();
        APP.component.ValidateForm.init(ObjFormCriarUsuarioValidate, '#form-cria-usuario');

    },

    //Formulario Criar Usuario
    formCriarUsuario: function () {

        this.setAndHideCriarUsuario();
        this.setComboPerfilUsuario();
        this.getComboSiteCargo();

    },

    setAndHideCriarUsuario: function () {
        var idUsuario = $('[name=IdUsuario]').val();
        var idPerfilLogado = $('[name=IdPerfilLogado]').val();

        if (idUsuario == 0) {
            $('#panel-form-clientes').hide();
            $('[name=formClienteClientesEscolha]').prop('checked', false);
            $('#panel-form-sites').hide();
            $('#panel-form-cargos').hide();
        } else {
            if (idPerfilLogado != 1) {
                $('#panel-form-clientes').hide();
            }
        }

    },

    setComboPerfilUsuario: function () {

        var perfil = APP.controller.UsuarioController.models.PerfilUsuarioModel;

        $('[name=formCriaUsuarioPerfil]').on('change', function (e) {
            APP.controller.UsuarioController.setAndHideCriarUsuario();
            var codPerfil = $(this).val();
            var url = "";

            if (codPerfil == perfil.Coordenador || codPerfil == perfil.Colaborador) {

                $('#panel-form-sites').show();
                url = "/Site/ObterSitesPorCliente";
                APP.controller.UsuarioController.getComboPerfilUsuario(url, "Sites");

            } else if (codPerfil == perfil.Suporte) {

                $('#panel-form-clientes').show();
                url = "/Cliente/ObterClientes";
                APP.controller.UsuarioController.getComboPerfilUsuario(url, "Clientes");

            } else {

                APP.controller.UsuarioController.setAndHideCriarUsuario();

            }

        });

    },

    getComboPerfilUsuario: function (_url, _box) {

        var id = _box == "Sites" ? $('[name=idCliente]').val() : null;

        $.ajax({
            type: "GET",
            async: false,
            data: {
                idCliente: id
            },
            dataType: 'json',
            url: _url,
            beforeSend: function () { },
            success: function (result) {
                APP.controller.UsuarioController.setBoxClienteSites(result, _box);
            },
            error: function (result) { },
            complete: function (result) { }
        });

    },

    setBoxClienteSites: function (_result, _box) {

        var resultList = _box != "Clientes" ? _result : _result.Lista;
        var html = '';

        $.each(resultList, function (key, val) {
            var idSiteCliente = _box != "Clientes" ? val.IdSite : val.IdCliente;
            html += '<!-- ' + _box + '-' + idSiteCliente + '-->';
            html += '<div class="col-lg-2 col-md-3 col-sm-6 col-xs-12 checkbox">';
            html += '<input type="hidden" name="idSiteBox" value="' + val.IdSite + '">';
            html += '<input type="hidden" name="nameSiteBox" value="' + val.NmFantasia + '">';
            html += '<input type="checkbox" name="formCliente' + _box + 'Escolha" id="form-cliente-' + _box.toLowerCase() + '-escolha-' + idSiteCliente + '" class="form-control" value="' + idSiteCliente + '" data-idsite="' + val.IdSite + '">';
            html += '<label for="form-cliente-' + _box.toLowerCase() + '-escolha-' + idSiteCliente + '">' + val.NmFantasia + '</label>';
            html += '</div>';
        });

        var boxContent = $('#form-cliente-' + _box.toLowerCase() + '').find('.tabela-check');
        boxContent.html("");
        boxContent.append(html);

        APP.controller.UsuarioController.bind();

    },

    getComboSiteCargo: function () {

        $('[name^=formClienteSitesEscolha]').unbind('change');
        $('[name^=formClienteSitesEscolha]').on('change', function () {

            var idSite = $(this).closest('div').find('[name=idSiteBox]').val();
            var nmSite = $(this).closest('div').find('[name=nameSiteBox]').val();
            var checkedIs = $(this).is(':checked');
            var idPerfilSelecionado = $('[name=formCriaUsuarioPerfil] :selected').val();

            if (checkedIs && idPerfilSelecionado == 4) {
                $.ajax({
                    type: "GET",
                    async: false,
                    data: {
                        idSite: idSite
                    },
                    dataType: 'json',
                    url: "/Cargo/ObterPorSite",
                    beforeSend: function () { },
                    success: function (result) {
                        if (checkedIs) {
                            $('#panel-form-cargos').show();
                            APP.controller.UsuarioController.setBoxSiteCargo(result, idSite, nmSite);
                        }
                    },
                    error: function (result) { },
                    complete: function (result) { }
                });
            } else {
                var boxContentCargos = $('#form-site-cargos [name=idCargoSiteBox-' + idSite + ']').closest('.panel-body');
                boxContentCargos.remove();
                if ($('#form-site-cargos .panel-body').size() == 0) {
                    $('#panel-form-clientes').hide();
                    $('#panel-form-cargos').hide();
                }
            }

        });

    },

    setBoxSiteCargo: function (_result, _idSite, _nmSite) {

        var html = '';
        var idSite = _idSite;
        var nmSite = _nmSite;

        html += '<div class="panel-body">';
        html += '<div class="barra-busca">';
        html += '<input type="hidden" name="idCargoSiteBox-' + idSite + '" value="' + idSite + '">';
        html += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">';
        html += '<div class="form-group">';
        html += '<!-- Site -->';
        html += '<label for="form-cria-usuario-escolha">Escolha os Cargos para o site ' + nmSite + '</label>';
        html += '<div class="row tabela-check">';
        html += '<!-- Cargos -->';
        $.each(_result.Cargo, function (key, val) {
            html += '<div class="col-lg-2 col-md-3 col-sm-6 col-xs-12 checkbox">';
            html += '<input type="checkbox" name="formSiteCargos" id="form-site-cargos-' + val.IdCargo + '" class="form-control" value="' + val.IdCargo + '">';
            html += '<label for="form-site-cargos-' + val.IdCargo + '">' + val.NmNome + '</label>';
            html += '</div>';
        });
        html += '</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';
        html += '</div>';

        var boxContent = $("#form-site-cargos").find('.panel');
        boxContent.append(html);

        APP.controller.UsuarioController.bind();

    },

    bind: function () {

        APP.controller.UsuarioController.getComboSiteCargo();

    },

    getObjFormCriarUsuarioValidate: function () {

        var acoesUsuarioFormCriarUsuarioObj = {
            //formCriaUsuarioLogo: $('[name=formCriaUsuarioLogo]').data('b64') != "" ? {required: false} : {required: true},
            formCriaUsuarioResponsavel: { required: true, maxlength: 60 },
            //formCriaUsuarioSexo: 'required',
            formCriaUsuarioEmail: { required: true, maxlength: 60, email: true },
            formCriaUsuarioCpf: { cpf: true },
            //formCriaUsuarioDtExpiracao: 'required',
            //formCriaUsuarioEscolhaEmail: 'required',
            //formCriaUsuarioEscolhaCompartilhado: 'required',
            //formCriaUsuarioEscolhaAtivo: 'required',
            //formCriaUsuarioEscolhaBloqueado: 'required',
        };

        return acoesUsuarioFormCriarUsuarioObj;

    },

    getObjFormCriarUsuario: function () {

        var usuarioModel = APP.controller.UsuarioController.models.UsuarioModel;
        var anexoModel = APP.controller.SiteController.models.AnexoModel;

        var imgB64 = $('[name=formCriaUsuarioLogo]').prop('files').length != 0 ? $('[name=formCriaUsuarioLogo]').prop('files')[0].name : $('[name=formCriaUsuarioLogoNome]').val();

        var anexoUsuario = anexoModel.constructor(
            $('[name=formCriaUsuarioLogoIdAnexo]').val(),
            imgB64,
            $('[name=formCriaUsuarioLogo]').data('b64')
        );
        var usuario = usuarioModel.constructor(
            anexoUsuario,
            $('[name=formCriaUsuarioResponsavel]').val(),
            //$('[name=formCriaUsuarioSexo]:checked').val(),
            $('[name=formCriaUsuarioEmail]').val(),
            $('[name=formCriaUsuarioCpf]').val(),
            $('[name=formCriaUsuarioDtExpiracao]').val(),
            $('[name=formCriaUsuarioPerfil] :selected').val(),
            $('[name=formCriaUsuarioEscolhaEmail]').is(':checked'),
            $('[name=formCriaUsuarioEscolhaCompartilhado]').is(':checked'),
            $('[name=formCriaUsuarioEscolhaAtivo]').is(':checked'),
            $('[name=formCriaUsuarioEscolhaBloqueado]').is(':checked'),
            APP.controller.UsuarioController.getObjFormCriarUsuarioClienteSiteArray(),
            $('[name=IdUsuario]').val(),
            APP.controller.UsuarioController.getObjFormCriarSiteCargoseArray()
        );
        return usuario;

    },

    getObjFormCriarUsuarioClienteSiteArray: function () {

        var usuarioClienteSiteModel = APP.controller.UsuarioController.models.UsuarioClienteSiteModel;

        var arrayAcoesUsuarioFormCriarUsuarioClienteObj = [];
        var arrayAcoesUsuarioFormCriarUsuarioSitesObj = [];

        $("[name=formClienteClientesEscolha]:checked").each(function () {
            var usuarioClienteSite = usuarioClienteSiteModel.constructor($('[name=formClienteSitesEscolha]:checked').val(), $(this).val() != null ? $(this).val() : $('[name=idCliente]').val());

            arrayAcoesUsuarioFormCriarUsuarioClienteObj.push(usuarioClienteSite);

        });

        $("[name=formClienteSitesEscolha]:checked").each(function () {

            var _idSite = $(this).data('idsite');
            var usuarioClienteSite = usuarioClienteSiteModel.constructor(_idSite, $('[name=formClienteClientesEscolha]:checked').val() != null ? $('[name=formClienteClientesEscolha]:checked').val() : $('[name=idCliente]').val());

            arrayAcoesUsuarioFormCriarUsuarioSitesObj.push(usuarioClienteSite);

        });

        if (arrayAcoesUsuarioFormCriarUsuarioClienteObj.length > 0) {
            return arrayAcoesUsuarioFormCriarUsuarioClienteObj;
        } else {
            return arrayAcoesUsuarioFormCriarUsuarioSitesObj;
        }

    },

    getObjFormCriarSiteCargoseArray: function () {
        var usuarioCargoModel = APP.controller.UsuarioController.models.UsuarioCargoModel;

        var arrayAcoesUsuarioFormCriarUsuarioObj = [];

        var siteCargo = $('[name=formSiteCargos]:checked');

        $(siteCargo).each(function () {
            var usuarioCargo = usuarioCargoModel.constructor($(this).val());
            arrayAcoesUsuarioFormCriarUsuarioObj.push(usuarioCargo);

        });

        return arrayAcoesUsuarioFormCriarUsuarioObj;

    },

    //Meus Dados
    meusDados: function () {

        APP.component.FileUpload.init();
        APP.component.Mascaras.init();
        this.formEditarUsuario();
        this.sendFormCriarUsuario();

    },

    formEditarUsuario: function () {

        //

    },

    getObjObjFormEditarUsuarioValidate: function () {

        var meusDadosFormEditarUsuarioObj = {
            //formCriaUsuarioLogo: $('[name=formCriaUsuarioLogo]').data('b64') != "" ? {required: false} : {required: true},
            formCriaUsuarioResponsavel: { required: true, maxlength: 30 },
            //formCriaUsuarioSexo: 'required',
            formCriaUsuarioEmail: { required: true, maxlength: 60, email: true },
            //formCriaUsuarioCpf: 'required',
            //formCriaUsuarioDtExpiracao: 'required',
            //formCriaUsuarioEscolhaEmail: 'required',
            //formCriaUsuarioEscolhaCompartilhado: 'required',
            //formCriaUsuarioEscolhaAtivo: 'required',
            //formCriaUsuarioEscolhaBloqueado: 'required',
        };

        return meusDadosFormEditarUsuarioObj;

    },

    getObjFormEditarUsuario: function () {


        var anexoModel = APP.controller.SiteController.models.AnexoModel;

        var usuario = APP.controller.UsuarioController.models.UsuarioModel;
        var imgB64 = $('[name=formCriaUsuarioLogo]').prop('files').length != 0 ? $('[name=formCriaUsuarioLogo]').prop('files')[0].name : $('[name=formCriaUsuarioLogoNome]').val();

        var anexoUsuario = anexoModel.constructor(
            $('[name=formCriaUsuarioLogoIdAnexo]').val(),
            imgB64,
            $('[name=formCriaUsuarioLogo]').data('b64')
        );

        usuario.FotoPerfilAux = anexoUsuario;
        usuario.NmCompleto = $('[name=formCriaUsuarioResponsavel]').val();
        //usuario.FlSexo = $('[name=formCriaUsuarioSexo]:checked').val();
        usuario.CdIdentificacao = $('[name=formCriaUsuarioEmail]').val();
        usuario.NuCPF = $('[name=formCriaUsuarioCpf]').val();
        usuario.IdUsuario = $('[name=IdUsuario]').val();

        return usuario;

    },

    //Alterar Senha
    alterarSenha: function () {

        this.setValidateFormAleterarSenha();
        this.setSenhaNotEquals();
        this.setStrongPassword();
        this.sendFormAlterarSenha();

    },

    setValidateFormAleterarSenha: function () {

        var ObjFormAlterarSenhaValidate = APP.controller.UsuarioController.getObjObjFormAlterarSenhaValidate();
        APP.component.ValidateForm.init(ObjFormAlterarSenhaValidate, '#form-alterar-senha');

    },

    setStrongPassword: function () {

        APP.component.StrongPassword.init('formAlterarSenhaNova');

    },

    setSenhaNotEquals: function () {

        $.validator.addMethod("notEqualsTo", function () {

            var senhaAtual = $('[name=formAlterarSenhaAtual]').val();
            return ($('[name=formAlterarSenhaNova]').val() != senhaAtual);
        });

    },

    getObjObjFormAlterarSenhaValidate: function () {

        var formAlterarSenhaObj = {
            formAlterarSenhaAtual: { required: true },
            formAlterarSenhaNova: { required: true, minlength: 6, notEqualsTo: true, strongPassword: true },
            formAlterarSenhaConfirmar: { required: true, minlength: 6, notEqualsTo: true, equalTo: "[name=formAlterarSenhaNova]" },
        };

        return formAlterarSenhaObj;

    },

    getObjFormAlterarSenha: function () {

        var alterarSenhaFormLoginObj = {
            //__RequestVerificationToken: $('[name=__RequestVerificationToken]').val(),
            Usuario: APP.controller.UsuarioController.getObjFormAlterarSenhaUsuario(),
            NovaSenha: $('[name=formAlterarSenhaNova]').val(),
            ConfirmaSenha: $('[name=formAlterarSenhaConfirmar]').val(),

        };

        return alterarSenhaFormLoginObj;

    },

    getObjFormAlterarSenhaUsuario: function () {

        var formAlterarSenhaObj = {
            IdUsuario: $('[name=formAlterarSenhaIdUsuario]').val(),
            CdSenha: $('[name=formAlterarSenhaAtual]').val(),

        };

        return formAlterarSenhaObj;

    },

    sendFormAlterarSenha: function () {

        this.buttonAlterarSenha.unbind('click');
        this.buttonAlterarSenha.on('click', function () {
            var validate = APP.controller.LoginController.validateForms();

            //var validate = true;
            if (validate == true) {
                var alterarSenhaObj = APP.controller.UsuarioController.getObjFormAlterarSenha();
                APP.controller.UsuarioController.saveFormAlterarSenha(alterarSenhaObj);
            }

        });

    },

    saveFormAlterarSenha: function (alterarSenhaObj) {

        var erro = "";

        $.ajax({
            type: "POST",
            data: alterarSenhaObj,
            dataType: 'json',
            url: "/Usuario/AlterarSenha/",
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode === 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/";
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    //Todos
    sendFormCriarUsuario: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = APP.controller.UsuarioController.validateForms();

            //validate = true;
            if (validate == true) {

                APP.controller.UsuarioController.saveObjUsuario();

            }

        });

    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    saveObjUsuario: function () {

        var usuarioObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = idPanel[2];
                switch (form) {
                    case "cadastro":
                        usuarioObj = APP.controller.UsuarioController.getObjFormCriarUsuario();
                        APP.controller.UsuarioController.saveFormUsuario(usuarioObj, "/Usuario/Criar/");
                        break;
                    case "editar":
                        usuarioObj = APP.controller.UsuarioController.getObjFormCriarUsuario();
                        APP.controller.UsuarioController.saveFormUsuario(usuarioObj, "/Usuario/Editar/");
                        break;
                    case "meusdados":
                        usuarioObj = APP.controller.UsuarioController.getObjFormEditarUsuario();
                        APP.controller.UsuarioController.saveFormUsuario(usuarioObj, "/Usuario/AtualizarMeusDados/");
                        break;
                }
            }

        });

    },

    saveFormUsuario: function (usuarioObj, _urlAction) {

        var erro = "";
        var idCliente = $('[name=idCliente]').val();

        $.ajax({
            type: "POST",
            data: usuarioObj,
            dataType: 'json',
            url: _urlAction,
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    bootbox.alert(result.Success, function (result) {
                        window.location.href = "/Usuario/Index/" + idCliente;
                    });
                } else if (result.StatusCode == 505) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                } else if (result.StatusCode == 500) {
                    erro = APP.component.ResultErros.init(result.Erro);
                    bootbox.alert(erro);
                }
            },
            error: function (result) {
                erro = APP.component.ResultErros.init(result.Erro);
                bootbox.alert(erro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });
    },
};

/*
|--------------------------------------------------------------------------
| Fornecedores
|--------------------------------------------------------------------------
*/
APP.controller.FornecedoresController = {

    init: function () {

        var page = APP.component.Util.getPage();
        
        this.setup();
        if (page == 'IndexProdutos') {
            this.indexProdutos();
        }
        if (page == 'AcoesProdutos') {
            var _idProduto = $('[name=IdProduto]').val();
            if (_idProduto == '') {
                this.acoesProdutos();
            } else {
                this.editAcoesProdutos();
            }
        }
        if (page == 'IndexFornecedores') {
            this.indexFornecedores();
        }
        if (page == 'AcoesFornecedores') {
            this.acoesFornecedores();
        }

    },

    setup: function () {

        //Produtos - Acoes
        this.buttonSalvar = $('.btn-salvar');

        //Produtos - Criticidade
        this.buttonAddNovoCriterioAvaliacaoCriticidadeFormProdutos = $('.btn-add-produtos-criticidade');
        this.buttonEditNovoCriterioAvaliacaoCriticidadeFormProdutos = $('.btn-edit-produtos-criticidade');
        this.buttonSaveNovoCriterioAvaliacaoCriticidadeFormProdutos = $('.btn-confirm-produtos-criticidade');
        this.buttonDelNovoCriterioAvaliacaoCriticidadeFormProdutos = $('.btn-del-produtos-criticidade');

        //Produtos - Qualificacao Fornecedor
        this.buttonAddNovoCriterioFormQualificacaoFornecedor = $('.btn-add-qualificacao-fornecedor');
        this.buttonEditNovoCriterioFormQualificacaoFornecedor = $('.btn-edit-qualificacao-fornecedor');
        this.buttonSaveNovoCriterioFormQualificacaoFornecedor = $('.btn-confirm-qualificacao-fornecedor');
        this.buttonDelNovoCriterioFormQualificacaoFornecedor = $('.btn-del-qualificacao-fornecedor');
        this.radioFormQualificacaoFornecedorAtivo = $('[name^=formQualificaFornecedorAtivo]');
        this.radioFormQualificacaoFornecedorVencimento = $('[name^=formQualificaFornecedorVencimento');

        //Produtos - Criterios Avaliacao
        this.buttonAddNovoCriterioAvaliacaoFormCriteriosAvaliacao = $('.btn-add-criterios-avaliacao');
        this.buttonEditNovoCriterioAvaliacaoFormCriteriosAvaliacao = $('.btn-edit-criterios-avaliacao');
        this.buttonSaveNovoCriterioAvaliacaoFormCriteriosAvaliacao = $('.btn-confirm-criterios-avaliacao');
        this.buttonDelNovoCriterioAvaliacaoFormCriteriosAvaliacao = $('.btn-del-criterios-avaliacao');

    },

    models: {
        AnexoModel: APP.model.Anexo,
    },

    delProdutoFornecedor: function () {

        $(".excluirProduto").on('click', function (event) {

            event.preventDefault();

            var idProduto = $(this).attr('IdProduto');
            console.log("idProduto:= ", idProduto);

            bootbox.confirm(_options.DesejaRealmenteExcluirEsseRegistro, function (result) {
                if (result) {
                    $.get('/Fornecedor/ExcluirProduto?idProduto=' + idProduto, function (data, status) {
                    }).done(function (data) {
                        if (data.StatusCode == "200") {
                            bootbox.alert(data.Success, function (result) {
                                window.location.href = "/Fornecedor/Index";
                            });

                        }
                    });
                }
            });
        });


    },


    delFornecedor: function () {

        $(".excluirFornecedor").on('click', function (event) {

            event.preventDefault();

            var idFornecedor = $(this).attr('idFornecedor');
            var idProduto = $("#hdIdProduto").val();
            console.log("idFornecedor:= ", idFornecedor);

            bootbox.confirm(_options.DesejaRealmenteExcluirEsseRegistro, function (result) {
                if (result) {
                    $.get('/Fornecedor/Excluir?idFornecedor=' + idFornecedor, function (data, status) {
                    }).done(function (data) {
                        if (data.StatusCode == "200") {
                            bootbox.alert(data.Success, function (result) {
                                window.location.href = "/Fornecedor/IndexFornecedores?idProduto=" + idProduto;
                            });

                        }
                    });
                }
            });
        });


    },


    //Index Produtos
    indexProdutos: function () {
        APP.controller.FornecedoresController.delProdutoFornecedor();
        APP.component.DataTable.init('#tb-index-produtos');
    },

    //AÃ§oes Produtos
    acoesProdutos: function () {

        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        this.validateFormsProdutos();
        this.setHideAndShow();
        this.formProdutos();
        this.formCriticidade();
        this.formQualificacaoFornecedor();
        this.formCriterioAvaliacao();

        this.sendFormAcoesProdutos();

    },

    setHideAndShow: function () {

        var critico = false;
        $("input:checked").length;
        var criticos = $('[name^=formProdutosCriticidadeAtivo]:checked').length;

        if (criticos >= 1) {
            critico = true;
        }

        var Ancora = $("#Ancora").val();

        if (Ancora == "" || Ancora == null || Ancora == undefined)
        {
            if ($("#form-produtos-produto").val() != "" && $("#form-produto-responsavel").val() != "") {
                if (($("#form-criticidade").attr("style") == "display: block;" || $("#form-criticidade").attr("style") == undefined) && critico == true) {
                    $('#form-qualifica-fornecedor').show();
                    $('#form-criterios-avaliacao').show();
                }
                else {
                    $('#form-qualifica-fornecedor').hide();
                    $('#form-criterios-avaliacao').hide();
                }

                $('#form-criticidade').show();
            }
            else {
                $('#form-criticidade').hide();
                $('#form-qualifica-fornecedor').hide();
                $('#form-criterios-avaliacao').hide();
            }
        }



        //
        //$('#form-criterios-avaliacao').toggle();

    },

    sendFormAcoesProdutos: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {

            var validate = [];
            var ValidateOK = true;

            validate = APP.controller.FornecedoresController.validateForms();

            for (var i = 0; i < validate.length; i++) {
                if (validate[i].valid != true) {
                    ValidateOK = false;
                }
            }

            //var ValidateOK = true;
            if (ValidateOK == true) {
                var produto = APP.controller.FornecedoresController.getAcoesProdutosObj();
                if ($('[name=IdProduto]').val() > 0) {
                    produto.IdProduto = $('[name=IdProduto]').val();
                    APP.controller.FornecedoresController.saveFilhosProduto(produto);
                } else {
                    APP.controller.FornecedoresController.saveFormAcoesProdutos(produto);
                }

            }

        });

    },

    getAcoesProdutosObj: function () {

        var produtoObj = {};

        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            var form = idPanel[2];
            switch (form) {
                case 'protudos':
                    produtoObj = APP.controller.FornecedoresController.getObjFormProdutos();
                    break;
                case 'criticidade':
                    produtoObj.AvaliacoesCriticidade = APP.controller.FornecedoresController.getObjFormCriticidade();
                    break;
                case 'qualificacaofornecedor':
                    produtoObj.CriteriosQualificacao = APP.controller.FornecedoresController.getObjFormQualificacaoFornecedor();
                    break;
                case 'criteriosavaliacao':
                    produtoObj.CriteriosAvaliacao = APP.controller.FornecedoresController.getObjFormCriterioAvaliacao();
                    break;
            }

        });

        return produtoObj;

    },

    validateFormsProdutos: function () {

        var ObjFormProdutosValidate = APP.controller.FornecedoresController.getObjFormProdutosValidate();
        APP.component.ValidateForm.init(ObjFormProdutosValidate, '#form-fornecedores-produtos');

    },

    getAvaliacaoCriticidadePadrao: function () {

        $.ajax({
            type: 'GET',
            dataType: 'json',
            url: '/AvaliacaoCriticidade/ListaCriteriosPadroes/',
            beforeSend: function () { },
            success: function (result) {
                if (result.StatusCode == 200) {

                    if($('#tb-form-produtos-criterios tbody tr').length == 0)
                    {
                        $.each(result.AvaliacoesCriticidadePadrao, function (key, value) {

                            var trElements = $('<tr>');
                            var tdformProdutosCriticidadeCriterio = $('<td><textarea name="formProdutosCriticidadeCriterio" id="form-produtos-criticidade-criterio" class="form-control" placeholder="Critério" title="Critério" rows="5" >'+ value.Titulo +'</textarea></td>');
                            var tdCheck = $('<td><div class="checkbox"><input type="checkbox" name="formProdutosCriticidadeAtivo-' + key + '" id="form-produtos-criticidade-ativo-' + key + '" onclick="chkValue(this);"><label for="form-produtos-criticidade-ativo-' + key + '" style="padding-left: 25px !important;">Crítico</label></div></td>');
                            var tdbtns = $('<td><button type="button" class="btn btn-edit-produtos-criticidade editar-color"><i class="fa fa-pencil" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonEditar + '" data-original-title="' + _options.labelButtonEditar + '"></i><div class="tooltip fade top in" style="top: 22px; left: 1148.08px; display: block;"><div class="tooltip-arrow"></div></div></button><button type="button" class="btn btn-confirm-produtos-criticidade ativo-color"><i class="fa fa-check " aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonAtivar + '" data-original-title="' + _options.labelButtonAtivar + '"></i></button><button type="button" class="btn btn-del-produtos-criticidade trash-color"><i class="fa fa-trash " aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i></button></td>');

                            trElements.append(tdformProdutosCriticidadeCriterio).append(tdCheck).append(tdbtns);

                            $('#tb-form-produtos-criterios tbody').append(trElements);
                        });
                    }
                }
            },
            error: function (result) {

            },
            complete: function (result) {

            }
        });

    },


    getCriterioQualificacaoFornecedorPadrao: function () {

        $.ajax({
            type: 'GET',
            dataType: 'json',
            url: '/CriterioQualificacao/ListaCriteriosPadroes/',
            beforeSend: function () { },
            success: function (result) {
                if (result.StatusCode == 200) {
                    $.each(result.CriterioQualificacaoPadrao, function (key, value) {

                        var trElements = $('<tr>');
                        var tdformProdutosCriterioQualificacao = $('<td><textarea name="formQualificaFornecedorCriterio" id="form-qualifica-fornecedor-criterio" class="form-control" placeholder="Critério" title="Critério" rows="5" >'+ value.Titulo +'</textarea></td>');
                        var tdCheck = $('<td><div class="checkbox"><input type="checkbox" name="formQualificaFornecedorAtivo-' + key + '" id="form-qualifica-fornecedor-ativo-' + key + '" onclick="chkValue(this);"><label for="form-qualifica-fornecedor-ativo-' + key + '" style="padding-left: 25px !important;">Ativo</label></div></td>');
                        var tdbtns = $('<td><button type="button" class="btn btn-edit-produtos-qualificacao-fornecedor editar-color"><i class="fa fa-pencil" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonEditar + '" data-original-title="' + _options.labelButtonEditar + '"></i><div class="tooltip fade top in" style="top: 22px; left: 1148.08px; display: block;"><div class="tooltip-arrow"></div></div></button><button type="button" class="btn btn-confirm-produtos-qualificacao-fornecedor ativo-color"><i class="fa fa-check " aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonAtivar + '" data-original-title="' + _options.labelButtonAtivar + '"></i></button><button type="button" class="btn btn-del-produtos-qualidade-fornecedor trash-color"><i class="fa fa-trash " aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i></button></td>');

                        trElements.append(tdformProdutosCriterioQualificacao).append(tdCheck).append(tdbtns);

                        $('#tb-form-qualificacao-fornecedor tbody').append(trElements);
                    });
                }
            },
            error: function (result) {

            },
            complete: function (result) {

            }
        });

    },

    getCriterioAvaliacaoPadrao: function () {

        $.ajax({
            type: 'GET',
            dataType: 'json',
            url: '/CriterioAvaliacao/ListaCriteriosPadroes/',
            beforeSend: function () { },
            success: function (result) {
                if (result.StatusCode == 200) {
                    $.each(result.CriterioAvaliacaoPadrao, function (key, value) {

                        var trElements = $('<tr>');
                        var tdformProdutosCriterioAvaliacao = $('<td><textarea name="formCriteriosAvaliacaoDisponibilidade" id="form-criterios-avaliacao-disponibilidade" class="form-control" placeholder="Critério" title="Critério" rows="5" >' + value.Titulo + '</textarea></td>');
                        var tdCheck = $('<td><div class="checkbox"><input type="checkbox" name="formCriteriosAvaliacaoAtivo-' + key + '" id="form-criterios-avaliacao-ativo-' + key + '" onclick="chkValue(this);"><label for="form-criterios-avaliacao-ativo-' + key +'" style="padding-left: 25px !important;">Ativo</label></div></td>');
                        var tdbtns = $('<td><button type="button" class="btn btn-edit-produtos-criterios-avaliacao editar-color"><i class="fa fa-pencil" aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonEditar + '" data-original-title="' + _options.labelButtonEditar + '"></i><div class="tooltip fade top in" style="top: 22px; left: 1148.08px; display: block;"><div class="tooltip-arrow"></div></div></button><button type="button" class="btn btn-confirm-produtos-criterios-avaliacao ativo-color"><i class="fa fa-check " aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonAtivar + '" data-original-title="' + _options.labelButtonAtivar + '"></i></button><button type="button" class="btn btn-del-produtos-criterios-avaliacao trash-color"><i class="fa fa-trash " aria-hidden="true" data-toggle="tooltip" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i></button></td>');

                        trElements.append(tdformProdutosCriterioAvaliacao).append(tdCheck).append(tdbtns);

                        $('#tb-form-criterios-avaliacao tbody').append(trElements);
                    });
                }
            },
            error: function (result) {

            },
            complete: function (result) {

            }
        });

    },

    saveFilhosProduto: function (produto) {

        $.ajax({
            type: 'POST',
            data: produto,
            dataType: 'json',
            url: '/Fornecedor/SalvaAvaliacoesCriticidadeCriteriosQualificaoCriterioAvaliacao/',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {

                    var Ancora = $("#Ancora").val();

                    if ($("#form-criterios-avaliacao").attr("style") == "display: block;") {

                        window.location.href = "/Fornecedor/Produtos";
                    }
                    else if (Ancora != null && Ancora != undefined && Ancora != "") {
                        window.location.href = "/Fornecedor/Produtos";
                    }
                    else {
                        $('#form-criterios-avaliacao').show();
                        $('#form-qualifica-fornecedor').show();
                    }
                }

                if (result.StatusCode == 400) {
                    var texto = "";

                    $(result.Erros).each(function (item) {
                        texto = texto + item;
                    });
                    console.log(result.Erros);
                    bootbox.alert(texto);
                }
            },
            error: function (result) {

                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    saveFormAcoesProdutos: function (produto) {

        $.ajax({
            type: 'POST',
            data: produto,
            dataType: 'json',
            url: '/Fornecedor/SalvaProdutos/',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    $('[name=IdProduto]').val(result.IdProduto);
                    APP.controller.FornecedoresController.setHideAndShow();
                    //APP.controller.FornecedoresController.getAvaliacaoCriticidadePadrao();
                    //APP.controller.FornecedoresController.getCriterioQualificacaoFornecedorPadrao();
                    //APP.controller.FornecedoresController.getCriterioAvaliacaoPadrao();
                }

                if (result.StatusCode == 400) {
                    // var texto = "";

                    // $(result.Erros).each(function (item) {
                    //     texto = texto + item;
                    // });
                    console.log(result.Erros);
                    //bootbox.alert(texto);
                }
            },
            error: function (result) {
                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    //Form PRODUTO
    formProdutos: function () {

        this.setHideAndShowProdutos();
        this.setComboResponsavelProdutos();

    },

    setHideAndShowProdutos: function () {

        //

    },

    setComboResponsavelProdutos: function () {

        var idSite = $('#fornecedores-site').val();
        var idFuncao = $('#fornecedores-funcao').val();
        var data = {
            'idSite': idSite,
            'idFuncao': idFuncao
        };
        $.ajax({
            type: 'GET',
            dataType: 'JSON',
            data: data,
            url: '/Usuario/ObterUsuariosPorFuncao',
            beforeSend: function () {

            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    APP.component.SelectListCompare.init(result.Lista, $('[name=formProdutosResponsavel] option'), '#form-produto-responsavel', 'IdUsuario', 'NmCompleto');
                }
            },
            error: function (result) {
                //bootbox.alert("Ocorreu um erro!");
            },
            complete: function (result) {

            }
        });

    },

    getObjFormProdutosValidate: function () {

        var acoesProdutosFormProdutosObj = {
            formProdutosProduto: 'required',
            //formProdutosCodigo: 'required',
            formProdutosResponsavel: 'required',
            //formProdutosEspecificacao: 'required',
        };

        return acoesProdutosFormProdutosObj;

    },

    getObjFormProdutos: function () {

        var idSite = $('#fornecedores-site').val();

        var acoesProdutosFormProdutosObj = {
            IdSite: idSite,
            Nome: $('[name=formProdutosProduto]').val(),
            Tags: $('[name=formProdutosCodigo]').val(),
            IdResponsavel: $('[name=formProdutosResponsavel] :selected').val(),
            Especificacao: $('[name=formProdutosEspecificacao]').val(),
        };

        return acoesProdutosFormProdutosObj;

    },

    //Form CRITICIDADE
    formCriticidade: function () {

        this.setHideAndShowCriticidade();
        this.setNovoCriterioAvaliacaoCriticidadeFormCriticidade();
        this.setEditNovoCriterioAvaliacaoCriticidadeFormCriticidade();
        this.setSaveNovoCriterioAvaliacaoCriticidadeFormCriticidade();
        this.delNovoCriterioAvaliacaoCriticidadeFormCriticidade();

    },

    setHideAndShowCriticidade: function () {

        //

    },

    setNovoCriterioAvaliacaoCriticidadeFormCriticidade: function () {

        this.buttonAddNovoCriterioAvaliacaoCriticidadeFormProdutos.unbind('click');
        this.buttonAddNovoCriterioAvaliacaoCriticidadeFormProdutos.on('click', function () {
            event.preventDefault();

            var index = $('#tb-form-produtos-criterios tbody tr').size();

            var html = '';
            html += '<tr>';
            html += '<td>';
            html += '<textarea  name="formProdutosCriticidadeCriterio" id="form-produtos-criticidade-criterio" class="form-control" placeholder="Critério" rows="5" ></textarea>';
            html += '</td>';
            html += '<td>';
            html += '<div class="checkbox">';
            html += '<input type="checkbox" name="formProdutosCriticidadeAtivo-' + index + '" id="form-produtos-criticidade-ativo-' + index + '"  onclick="chkValue(this);">';
            html += '<label for="form-produtos-criticidade-ativo-' + index + '" style="padding-left: 25px !important;">';
            html += 'Crítico';
            html += '</label>';
            html += '<span class="field-validation-valid" data-valmsg-replace="true"></span>';
            html += '</div>';
            html += '</td>';
            html += '<td>';
            html += '<button type="button" class="btn btn-edit-produtos-criticidade editar-color">';
            html += '<i class="fa fa-pencil" aria-hidden="true" data-toggle="tooltip"  title="' + _options.labelButtonEditar + '" data-original-title="' + _options.labelButtonEditar + '"></i>';
            html += '</button>';
            html += '<button type="button" class="btn btn-confirm-produtos-criticidade ativo-color">';
            html += '<i class="fa fa-check " aria-hidden="true" data-toggle="tooltip"  title="' + _options.labelButtonAtivar + '" data-original-title="' + _options.labelButtonAtivar + '"></i>';
            html += '</button>';
            html += '<button type="button" class="btn btn-del-produtos-criticidade trash-color">';
            html += '<i class="fa fa-trash " aria-hidden="true" data-toggle="tooltip"  title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</button>';
            html += '</td>';
            html += '</tr>';


            $('#tb-form-produtos-criterios tbody').append(html);

            APP.controller.FornecedoresController.setup();
            APP.controller.FornecedoresController.bindFormCriticidade();

        });

    },

    setEditNovoCriterioAvaliacaoCriticidadeFormCriticidade: function () {

        this.buttonEditNovoCriterioAvaliacaoCriticidadeFormProdutos.unbind('click');
        this.buttonEditNovoCriterioAvaliacaoCriticidadeFormProdutos.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name^=formProdutosCriticidadeCriterio]').prop('disabled', false);
            $(this).closest('tr').find('[name^=formProdutosCriticidadeAtivo]').prop('disabled', false);
            $(this).closest('tr').find('[name^=formProdutosCriticidadeCritico]').prop('disabled', false);

        });

    },

    setSaveNovoCriterioAvaliacaoCriticidadeFormCriticidade: function () {

        this.buttonSaveNovoCriterioAvaliacaoCriticidadeFormProdutos.unbind('click');
        this.buttonSaveNovoCriterioAvaliacaoCriticidadeFormProdutos.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name^=formProdutosCriticidadeCriterio]').prop('disabled', true);
            $(this).closest('tr').find('[name^=formProdutosCriticidadeAtivo]').prop('disabled', true);
            $(this).closest('tr').find('[name^=formProdutosCriticidadeCritico]').prop('disabled', true);

        });

    },

    delNovoCriterioAvaliacaoCriticidadeFormCriticidade: function () {

        this.buttonDelNovoCriterioAvaliacaoCriticidadeFormProdutos.unbind('click');
        this.buttonDelNovoCriterioAvaliacaoCriticidadeFormProdutos.on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });

    },

    getObjFormCriticidade: function () {

        var table = $('#tb-form-produtos-criterios tbody');
        var arrayFormCriticidadeObj = [];
        var criticidade = {};

        table.find('tr').each(function () {
            var ativo = $(this).find('[name^=formProdutosCriticidadeAtivo]').is(':checked');

            ativo = ativo == undefined || ativo == null || ativo == "" ? "False" : ativo;

            criticidade = {
                IdAvaliacaoCriticidade: $(this).find('[name=IdAvaliacaoCriticidade]').val(),
                Titulo: $(this).find('[name=formProdutosCriticidadeCriterio]').val(),
                IdProduto: $('[name=IdProduto]').val(),
                Ativo: ativo
            };

            arrayFormCriticidadeObj.push(criticidade);
        });
        return arrayFormCriticidadeObj;

    },

    bindFormCriticidade: function () {

        APP.controller.FornecedoresController.setNovoCriterioAvaliacaoCriticidadeFormCriticidade();
        APP.controller.FornecedoresController.setEditNovoCriterioAvaliacaoCriticidadeFormCriticidade();
        APP.controller.FornecedoresController.setSaveNovoCriterioAvaliacaoCriticidadeFormCriticidade();
        APP.controller.FornecedoresController.delNovoCriterioAvaliacaoCriticidadeFormCriticidade();

    },

    //Form QUALIFICACAO FORNECEDOR
    formQualificacaoFornecedor: function () {

        this.setHideAndShowQualificacaoFornecedor();
        this.setNovoCriterioFormQualificacaoFornecedor();
        this.setEditNovoCriterioFormQualificacaoFornecedor();
        this.setSaveNovoCriterioFormQualificacaoFornecedor();
        this.delNovoCriterioFormQualificacaoFornecedor();
        this.getCheckboxAtivoFormQualificacaoFornecedor();
        this.getradioVencimentoFormQualificacaoFornecedor();

    },

    setHideAndShowQualificacaoFornecedor: function () {

        $('.form-qualifica-fornecedor-panel').hide();
        $('.form-qualifica-fornecedor-panel-dt-vencimento').hide();
        $('[name^=formQualificaFornecedorAtivo]').each(function () {
            var check = $(this).is(':checked');
            if (check == true) {
                $(this).closest('tr').find('.form-qualifica-fornecedor-panel').show();
            } else {
                $(this).closest('tr').find('.form-qualifica-fornecedor-panel').hide();
            }
        });

        $('.form-qualifica-fornecedor-panel').each(function () {
            var idFormQualificaFornecedorVencimento = $(this).find('[name^=formQualificaFornecedorVencimento]').attr('name');
            var check = APP.component.Radio.init(idFormQualificaFornecedorVencimento);
            if (check == 'true') {
                $(this).closest('tr').find('.form-qualifica-fornecedor-panel-dt-vencimento').show();
            } else {
                $(this).closest('tr').find('.form-qualifica-fornecedor-panel-dt-vencimento').hide();
            }
        });

    },

    setNovoCriterioFormQualificacaoFornecedor: function () {

        this.buttonAddNovoCriterioFormQualificacaoFornecedor.unbind('click');
        this.buttonAddNovoCriterioFormQualificacaoFornecedor.on('click', function () {
            event.preventDefault();

            var index = $('#tb-form-qualificacao-fornecedor tbody tr').size() + 1;

            var html = '';
            html += '';
            html += '<tr>';
            html += '<!-- Criterio -->';
            html += '<td>';
            html += '<textarea name="formQualificaFornecedorCriterio" id="form-qualifica-fornecedor-criterio" class="form-control" value="" placeholder="Critério"  rows="5" ></textarea>';
            html += '</td>';
            html += '<!-- Ativa Item -->';
            html += '<td>';
            html += '<div class="checkbox">';
            html += '<input type="checkbox" name="formQualificaFornecedorAtivo-' + index + '" id="form-qualifica-fornecedor-ativo-' + index + '" onclick="chkValue(this);" value="true">';
            html += '<label for="form-qualifica-fornecedor-ativo-' + index + '" style="padding-left: 25px !important;">'+_options.labelButtonAtivar+'</label>';
            html += '</div>';
            html += '</td>';

            html += '<td>';
            html += '<div class="checkbox">';
            html += '<input type="checkbox" name="formQualificaFornecedorTemControleVencimento-' + index + '" id="form-qualifica-fornecedor-ativo-' + index + '" onclick="chkValue(this);" value="true">';
            html += '<label for="form-qualifica-fornecedor-TemControleVencimento-' + index + '" style="padding-left: 25px !important;">' + _options.ControlaDataVencimento +'</label>';
            html += '</div>';
            html += '</td>';

            //html += '<!-- Vencimento -->';
            //html += '<td>';
            //html += '<div class="row form-qualifica-fornecedor-panel" style="margin-top: 5px;">';
            //html += '<label class="demo-list-radio mdl-radio mdl-js-radio mdl-js-ripple-effect" >';
            //html += '<input name="formQualificaFornecedorVencimento-' + index + '" id="form-qualifica-fornecedor-vencimento-sim" type="radio" value="true">';
            //html += ' Sim';
            //html += '</label>';
            //html += '<label class="demo-list-radio mdl-radio mdl-js-radio mdl-js-ripple-effect" >';
            //html += '<input type="radio" name="formQualificaFornecedorVencimento-' + index + '" id="form-qualifica-fornecedor-vencimento-nao" value="false">';
            //html += ' NÃ£o';
            //html += '</label>';
            //html += '</div>';
            //html += '</td>';
            //html += '<!-- Data Vencimento -->';
            //html += '<td>';
            //html += '<div class="input-group form-qualifica-fornecedor-panel-dt-vencimento date" id="datetimepicker2">';
            //html += '<input type="text" name="formQualificaFornecedorDtVencimento" id="form-qualifica-fornecedor-dt-vencimento" class="form-control data datepicker" data-msg-required="" value="" />';
            //html += '<span class="input-group-addon">';
            //html += '<i class="fa fa-calendar" aria-hidden="true"></i>';
            //html += '</span>';
            //html += '</div>';
            //html += '</td>';
            html += '<!-- Acoes -->';
            html += '<td>';
            html += '<button type="button" class="btn btn-edit-qualificacao-fornecedor editar-color">';
            html += '<i class="fa fa-pencil" aria-hidden="true" title="' + _options.labelButtonEditar + '" data-original-title="' + _options.labelButtonEditar + '"></i>';
            html += '</button>';
            html += '<button type="button" class="btn btn-confirm-qualificacao-fornecedor ativo-color">';
            html += '<i class="fa fa-check " aria-hidden="true" title="' + _options.labelButtonAtivar + '" data-original-title="' + _options.labelButtonAtivar + '"></i>';
            html += '</button>';
            html += '<button type="button" class="btn btn-del-qualificacao-fornecedor trash-color">';
            html += '<i class="fa fa-trash " aria-hidden="true" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</button>';
            html += '</td>';
            html += '</tr>';


            $('#tb-form-qualificacao-fornecedor tbody').append(html);

            APP.controller.FornecedoresController.setup();
            APP.controller.FornecedoresController.bindFormQualificacaoFornecedor();

        });

    },

    setEditNovoCriterioFormQualificacaoFornecedor: function () {

        this.buttonEditNovoCriterioFormQualificacaoFornecedor.unbind('click');
        this.buttonEditNovoCriterioFormQualificacaoFornecedor.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name^=formQualificaFornecedorCriterio]').prop('disabled', false);
            $(this).closest('tr').find('[name^=formQualificaFornecedorAtivo]').prop('disabled', false);
            $(this).closest('tr').find('[name^=formQualificaFornecedorVencimento]').prop('disabled', false);
            $(this).closest('tr').find('[name^=formQualificaFornecedorTemControleVencimento]').prop('disabled', false);

        });

    },

    setSaveNovoCriterioFormQualificacaoFornecedor: function () {

        this.buttonSaveNovoCriterioFormQualificacaoFornecedor.unbind('click');
        this.buttonSaveNovoCriterioFormQualificacaoFornecedor.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name^=formQualificaFornecedorCriterio]').prop('disabled', true);
            $(this).closest('tr').find('[name^=formQualificaFornecedorAtivo]').prop('disabled', true);
            $(this).closest('tr').find('[name^=formQualificaFornecedorVencimento]').prop('disabled', true);
            $(this).closest('tr').find('[name^=formQualificaFornecedorTemControleVencimento]').prop('disabled', false);

        });

    },

    delNovoCriterioFormQualificacaoFornecedor: function () {

        this.buttonDelNovoCriterioFormQualificacaoFornecedor.unbind('click');
        this.buttonDelNovoCriterioFormQualificacaoFornecedor.on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });

    },

    getCheckboxAtivoFormQualificacaoFornecedor: function () {

        this.radioFormQualificacaoFornecedorAtivo.unbind('click');
        this.radioFormQualificacaoFornecedorAtivo.on('click', function (event) {

            var checkboxAtivo = $(this).val();
            if (checkboxAtivo != 'False') {
                $(this).closest('tr').find('.form-qualifica-fornecedor-panel').show();
            } else {
                $(this).closest('tr').find('.form-qualifica-fornecedor-panel').hide();
            }

        });

    },
    
    getradioVencimentoFormQualificacaoFornecedor: function () {

        this.radioFormQualificacaoFornecedorVencimento.on('change', function (event) {

            var radioVencimento = APP.component.Radio.init($(this).attr('name'));
            if (radioVencimento == 'true') {
                $(this).closest('tr').find('.form-qualifica-fornecedor-panel-dt-vencimento').show();
            } else {
                $(this).closest('tr').find('.form-qualifica-fornecedor-panel-dt-vencimento').hide();
            }

        });

    },

    getObjFormQualificacaoFornecedor: function () {

        var table = $('#tb-form-qualificacao-fornecedor tbody');
        var arrayFormQualificacaoFornecedorObj = [];
        var qualificacaofornecedor = {};

        table.find('tr').each(function () {
            var ativo = $(this).find('[name^=formQualificaFornecedorAtivo]:checked').val();
            var TemControleVencimento = $(this).find('[name^=formQualificaFornecedorTemControleVencimento]:checked').val();

            ativo = ativo == undefined || ativo == null || ativo == "" ? "False" : ativo;

            qualificacaofornecedor = {
                IdCriterioQualificacao: $(this).find('[name=IdCriterioQualificacao]').val(),
                Titulo: $(this).find('[name=formQualificaFornecedorCriterio]').val(),
                TemControleVencimento: $(this).find('[name^=formQualificaFornecedorVencimento]:checked').val(),
                DtVencimento: $(this).find('[name=formQualificaFornecedorDtVencimento]').val(),
                IdProduto: $('[name=IdProduto]').val(),
                Ativo: ativo,
                TemControleVencimento: TemControleVencimento
            };
            arrayFormQualificacaoFornecedorObj.push(qualificacaofornecedor);
        });

        return arrayFormQualificacaoFornecedorObj;

    },

    bindFormQualificacaoFornecedor: function () {

        APP.controller.FornecedoresController.setNovoCriterioFormQualificacaoFornecedor();
        APP.controller.FornecedoresController.setEditNovoCriterioFormQualificacaoFornecedor();
        APP.controller.FornecedoresController.setSaveNovoCriterioFormQualificacaoFornecedor();
        APP.controller.FornecedoresController.delNovoCriterioFormQualificacaoFornecedor();
        APP.controller.FornecedoresController.getCheckboxAtivoFormQualificacaoFornecedor();
        APP.controller.FornecedoresController.getradioVencimentoFormQualificacaoFornecedor();
        APP.component.Datapicker.init();
        APP.controller.FornecedoresController.setHideAndShowQualificacaoFornecedor();

    },

    //Form CRITERIO AVALIACAO
    formCriterioAvaliacao: function () {

        this.setHideAndShowCriterioAvaliacao();
        this.setNovoCriterioAvaliacaoFormCriterioAvaliacao();
        this.setEditNovoCriterioAvaliacaoFormCriterioAvaliacao();
        this.setSaveNovoCriterioAvaliacaoFormCriterioAvaliacao();
        this.delNovoCriterioAvaliacaoFormCriterioAvaliacao();

    },

    setHideAndShowCriterioAvaliacao: function () {

        //

    },

    setNovoCriterioAvaliacaoFormCriterioAvaliacao: function () {
        this.buttonAddNovoCriterioAvaliacaoFormCriteriosAvaliacao.unbind('click');
        this.buttonAddNovoCriterioAvaliacaoFormCriteriosAvaliacao.on('click', function () {
            event.preventDefault();

            var index = $('#tb-form-criterios-avaliacao tbody tr').size();

            var html = '';
            html += '<tr>';
            html += '<!-- Disponibilidade -->';
            html += '<td>';
            html += '<textarea type="text" name="formCriteriosAvaliacaoDisponibilidade" id="form-criterios-avaliacao-disponibilidade" class="form-control" value="" placeholder="Critério" rows="5" ></textarea>';
            html += '</td>';
            html += '<!-- Ativo -->';
            html += '<td>';
            html += '<div class="checkbox">';
            html += '<input type="checkbox" name="formCriteriosAvaliacaoAtivo-' + index + '" id="form-criterios-avaliacao-ativo-' + index + '" onclick="chkValue(this);" value="true">';
            html += '<label for="form-criterios-avaliacao-ativo-' + index + '" style="padding-left: 25px !important;">Ativar</label>';
            html += '</div>';
            html += '</td>';
            html += '<!-- Acoes -->';
            html += '<td>';
            html += '<button type="button" class="btn btn-edit-criterios-avaliacao editar-color">';
            html += '<i class="fa fa-pencil" aria-hidden="true" title="' + _options.labelButtonEditar + '" data-original-title="' + _options.labelButtonEditar + '"></i>';
            html += '</button>';
            html += '<button type="button" class="btn btn-confirm-criterios-avaliacao ativo-color">';
            html += '<i class="fa fa-check " aria-hidden="true" title="' + _options.labelButtonAtivar + '" data-original-title="' + _options.labelButtonAtivar + '"></i>';
            html += '</button>';
            html += '<button type="button" class="btn btn-del-criterios-avaliacao trash-color">';
            html += '<i class="fa fa-trash " aria-hidden="true" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '"></i>';
            html += '</button>';
            html += '</td>';
            html += '</tr>';


            $('#tb-form-criterios-avaliacao tbody').append(html);

            APP.controller.FornecedoresController.setup();
            APP.controller.FornecedoresController.bindFormCriterioAvaliacao();

        });

    },

    setEditNovoCriterioAvaliacaoFormCriterioAvaliacao: function () {

        this.buttonEditNovoCriterioAvaliacaoFormCriteriosAvaliacao.unbind('click');
        this.buttonEditNovoCriterioAvaliacaoFormCriteriosAvaliacao.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name^=formCriteriosAvaliacaoDisponibilidade]').prop('disabled', false);
            $(this).closest('tr').find('[name^=formCriteriosAvaliacaoAtivo]').prop('disabled', false);

        });

    },

    setSaveNovoCriterioAvaliacaoFormCriterioAvaliacao: function () {

        this.buttonSaveNovoCriterioAvaliacaoFormCriteriosAvaliacao.unbind('click');
        this.buttonSaveNovoCriterioAvaliacaoFormCriteriosAvaliacao.on('click', function () {
            event.preventDefault();

            $(this).closest('tr').find('[name^=formCriteriosAvaliacaoDisponibilidade]').prop('disabled', true);
            $(this).closest('tr').find('[name^=formCriteriosAvaliacaoAtivo]').prop('disabled', true);

        });

    },

    delNovoCriterioAvaliacaoFormCriterioAvaliacao: function () {

        this.buttonDelNovoCriterioAvaliacaoFormCriteriosAvaliacao.unbind('click');
        this.buttonDelNovoCriterioAvaliacaoFormCriteriosAvaliacao.on('click', function (event) {
            event.preventDefault();
            $(this).closest('tr').remove();
        });

    },

    getObjFormCriterioAvaliacao: function () {

        var table = $('#tb-form-criterios-avaliacao tbody');
        var arrayFormCriterioAvaliacaoObj = [];
        var criterioAvaliacao = {};

        table.find('tr').each(function () {
            var ativo = $(this).find('[name^=formCriteriosAvaliacaoAtivo]:checked').val();

            ativo = ativo == undefined || ativo == null || ativo == "" ? "False" : ativo;

            criterioAvaliacao = {
                IdCriterioAvaliacao: $(this).find('[name=IdCriterioAvaliacao]').val(),
                Titulo: $(this).find('[name=formCriteriosAvaliacaoDisponibilidade]').val(),
                IdProduto: $('[name=IdProduto]').val(),
                Ativo: ativo
            };

            arrayFormCriterioAvaliacaoObj.push(criterioAvaliacao);

        });

        return arrayFormCriterioAvaliacaoObj;

    },

    bindFormCriterioAvaliacao: function () {

        APP.controller.FornecedoresController.setNovoCriterioAvaliacaoFormCriterioAvaliacao();
        APP.controller.FornecedoresController.setEditNovoCriterioAvaliacaoFormCriterioAvaliacao();
        APP.controller.FornecedoresController.setSaveNovoCriterioAvaliacaoFormCriterioAvaliacao();
        APP.controller.FornecedoresController.delNovoCriterioAvaliacaoFormCriterioAvaliacao();

    },

    //Edit Acoes Produtos
    editAcoesProdutos: function () {

        this.setHideAndShow();
        this.validateFormsProdutos();
        this.formProdutos();

        this.formCriticidade();
        this.formQualificacaoFornecedor();
        this.formCriterioAvaliacao();

        this.sendFormAcoesProdutos();

        //APP.controller.FornecedoresController.getCriterioQualificacaoFornecedorPadrao();
        //APP.controller.FornecedoresController.getCriterioAvaliacaoPadrao();
    },

    setHideAndShowEdit: function () {

        //

    },

    //Index Fornecedores
    indexFornecedores: function () {

        APP.controller.FornecedoresController.delFornecedor();
        APP.component.DataTable.init('#tb-index-fornecedores');

    },

    //AÃ§oes Fornecedores
    acoesFornecedores: function () {
        APP.component.AtivaLobiPanel.init();
        APP.component.Datapicker.init();
        APP.component.Mascaras.init();
        APP.component.FileUpload.init();

        this.setValidateFormsFornecedores();
        if ($('[name=IdFornecedor]').val() > 0) {
            $('.input-nome-fornecedor').val($('[name=formFornecedoresCadastroNome]').val());
            this.formQualificacaoFornecedores();
            this.formAvaliacaoFornecedores();
            //this.setHideAndShowFornecedores();

        } else {
            this.formCadastroFornecedores();
        }

        this.sendFormAcoesFornecedores();

    },

    setHideAndShowFornecedores: function () {

        $('[id^=form-fornecedores-qualificacao-]').toggle();
        $('#form-fornecedores-avaliacao').toggle();
        $('#form-fornecedores-historico').toggle();

    },

    setValidateFormsFornecedores: function () {

        //Regras Validacao dos FormulÃ¡rios
        var ObjFormCadastroFornecedoresValidate = APP.controller.FornecedoresController.getObjFormCadastroFornecedoresValidate();
        APP.component.ValidateForm.init(ObjFormCadastroFornecedoresValidate, '#form-fornecedores-cadastro');

        var ObjFormQualificacaoFornecedoresValidate = APP.controller.FornecedoresController.getObjFormQualificacaoFornecedoresValidate();
        $('form[id^=form-fornecedores-qualificacao-]').each(function () {
            APP.component.ValidateForm.init(ObjFormQualificacaoFornecedoresValidate, "#" + $(this).attr('id') + "");
        });

        var ObjFormAvaliacaoFornecedoresValidate = APP.controller.FornecedoresController.getObjFormAvaliacaoFornecedoresValidate();
        APP.component.ValidateForm.init(ObjFormAvaliacaoFornecedoresValidate, '#form-fornecedores-avaliacao');

    },

    sendFormAcoesFornecedores: function () {

        this.buttonSalvar.unbind('click');
        this.buttonSalvar.on('click', function () {
            var validate = APP.controller.FornecedoresController.validateForms();

            validate = true;
            if (validate == true) {
                var fornecedor = APP.controller.FornecedoresController.getAcoesFornecedoresObj('cadastro');
                var criteriosQualificacao = APP.controller.FornecedoresController.getAcoesFornecedoresObj('qualificacao');
                var avaliacoes = APP.controller.FornecedoresController.getAcoesFornecedoresObj('avaliacao');
                if ($('[name=IdFornecedor]').val() == 0) {

                    if (fornecedor != undefined) {
                        APP.controller.FornecedoresController.saveFormAcoesFornecedores(fornecedor);
                    }

                } else {
                    if (criteriosQualificacao != undefined && avaliacoes != undefined) {
                        var retornoQualificacao = APP.controller.FornecedoresController.saveFormAcoesQualificacoes(criteriosQualificacao);
                        var retornoAvaliacao = APP.controller.FornecedoresController.saveFormAcoesAvaliacoes(avaliacoes);
                        var retorno = false;
                        if (retornoQualificacao.StatusCode == 200)
                        {
                            retorno = true;
                        }
                        else
                        {
                            
                                erro = APP.component.ResultErros.init(retornoQualificacao.Erros);
                                bootbox.alert(erro);
                            
                        }

                        if (retorno == true) 
                        {
                            if (retornoAvaliacao.StatusCode == 200) 
                            {
                                retorno = true;
                            }
                            else 
                            {                                
                                erro = APP.component.ResultErros.init(retornoAvaliacao.Erros);
                                bootbox.alert(erro);
                              
                                retorno = false;
                            
                            }
                        }
                        if(retorno == true)
                        {
                            bootbox.confirm(_options.RegistroSalvoComSucesso, function (result) {
                                if (result == true) {
                                    window.location.href = "/Fornecedor/IndexFornecedores?idProduto=" + $("#fornecedores-produto").val();
                                }
                            });                            
                        }

                    }
                    //if (avaliacoes != undefined) {
                    //	APP.controller.FornecedoresController.saveFormAcoesAvaliacoes(avaliacoes);
                    //}
                }

            }

        });

    },

    saveFormAcoesAvaliacoes: function (avaliacoes) {
        
        var retorno = 0;
        $.ajax({
            async: false,
            type: 'POST',
            contentType: "application/json",
            dataType: 'json',
            data: JSON.stringify(avaliacoes),
            url: '/Fornecedor/SalvaAvaliacoes',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                retorno = result;
            },
            error: function (result) {
                APP.component.Loading.hideLoading();
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

        return retorno;
    },

    validateForms: function () {

        var valid = true;
        $('[id^=panel-form]').each(function () {
            var isVisible = $(this).is(':visible');
            if (isVisible) {
                var validate = $(this).closest('form').valid();
                if (validate != true) {
                    valid = false;
                }

            }
        });

        return valid;

    },

    getAcoesFornecedoresObj: function (_getForm) {

        var fornecedorObj = {};

        $('[id^=panel-form-fornecedores]').each(function () {
            var isVisible = $(this).is(':visible');
            var idPanel = $(this).attr('id').split('-');

            if (isVisible) {
                var form = _getForm;
                switch (form) {
                    case 'cadastro':
                        fornecedorObj = APP.controller.FornecedoresController.getObjFormCadastroFornecedores();
                        break;
                    case 'qualificacao':
                        fornecedorObj = APP.controller.FornecedoresController.getObjFormQualificacaoFornecedores();
                        break;
                    case 'avaliacao':
                        fornecedorObj = APP.controller.FornecedoresController.getObjFormAvaliacaoFornecedores();
                        break;
                }
            }
        });
        return fornecedorObj;

    },

    saveFormAcoesFornecedores: function (fornecedor) {

        $.ajax({
            type: 'POST',
            data: fornecedor,
            dataType: 'json',
            url: '/Fornecedor/SalvaFornecedor/',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    $('[name=IdFornecedor]').val(result.IdFornecedor);
                    var idProduto = $('[name=IdProduto]').val();
                    APP.controller.FornecedoresController.setHideAndShowFornecedores();
                    
                    $('.input-nome-fornecedor').val($('[name=formFornecedoresCadastroNome]').val());
                    APP.controller.FornecedoresController.setComboResponsavelControlarQualificacao();
                    APP.controller.FornecedoresController.setComboResponsavelQualificacao();

                    APP.controller.FornecedoresController.getAvaliacaoCriticidadePadrao();
                    //APP.controller.FornecedoresController.getCriterioQualificacaoFornecedorPadrao();
                    //APP.controller.FornecedoresController.getCriterioAvaliacaoPadrao();
                } else {
                    // var texto = "";

                    // $(result.Erros).each(function (item) {
                    //     texto = texto + item;
                    // });
                    console.log(result.Erros);
                    //bootbox.alert(texto);
                }
            },
            error: function (result) {

                bootbox.alert(_options.MsgOcorreuErro);
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

    },

    saveFormAcoesQualificacoes: function (criteriosQualificacao) {
        var myJSON = JSON.stringify(criteriosQualificacao);
        var retorno = 0;
        $.ajax({
            async: false,
            type: 'POST',
            contentType: "application/json",
            dataType: 'json',
            data: myJSON,
            url: '/Fornecedor/SalvaQualificacoes',
            beforeSend: function () {
                APP.component.Loading.showLoading();
            },
            success: function (result) {
                retorno = result;
            },
            error: function (result) {
                APP.component.Loading.hideLoading();                
            },
            complete: function (result) {
                APP.component.Loading.hideLoading();
            }
        });

        return retorno;

    },

    //Formulario CADASTRO FORNECEDORES
    formCadastroFornecedores: function () {

        this.setHideAndShowCadastroFornecedores();
        this.setComboDepartamento();

    },

    setHideAndShowCadastroFornecedores: function () {

        if ($('[name=IdFornecedor]').val() != '') {
            APP.controller.FornecedoresController.setHideAndShowFornecedores();
        }

    },

    setComboDepartamento: function () {

        var idSite = $('#fornecedores-site').val();
        // var idFuncao = $('#fornecedores-funcao').val();
        // var data = { "idSite": idSite, "idFuncao": idFuncao };
        $.ajax({
            type: 'GET',
            dataType: 'JSON',
            url: '/Processo/ListaProcessosPorSite?idSite=' + idSite +'',
            beforeSend: function () { },
            success: function (result) {
                if (result.StatusCode == 200) {
                    APP.component.SelectListCompare.init(result.Lista, $('[name=formFornecedoresCadastroDepartamento] option'), '#form-fornecedores-cadastro-departamento', 'IdProcesso', 'Nome');
                }
            },
            error: function (result) {
                //bootbox.alert("Ocorreu um erro!");
            },
            complete: function (result) {

            }
        });

    },

    getObjFormCadastroFornecedoresValidate: function () {

        var acoesFornecedoresFormCadastroFornecedoresObj = {
            formFornecedoresCadastroNome: 'required',
            formFornecedoresCadastroContato: 'required',
            formFornecedoresCadastroEmail: {
                'required': true,
                'email': true
            },
            formFornecedoresCadastroDepartamento: 'required',
        };

        return acoesFornecedoresFormCadastroFornecedoresObj;

    },

    getObjFormCadastroFornecedores: function () {

        var idSite = $('#fornecedores-site').val();

        var acoesFornecedoresFormCadastroFornecedoresObj = {
            IdSite: idSite,
            Nome: $('[name=formFornecedoresCadastroNome]').val(),
            Telefone: $('[name=formFornecedoresCadastroContato]').val(),
            Email: $('[name=formFornecedoresCadastroEmail]').val(),
            IdProcesso: $('[name=formFornecedoresCadastroDepartamento] :selected').val(),
            Produtos: [{
                IdProduto: $('[name=IdProduto]').val()
            }],
        };

        return acoesFornecedoresFormCadastroFornecedoresObj;

    },

    bindFormCadastroFornecedores: function () {

        //

    },

    //Formulario QUALIFICACAO FORNECEDORES
    formQualificacaoFornecedores: function () {

        this.setHideAndShowQualificacaoFornecedores();
        this.setComboResponsavelQualificacao();

        this.setComboResponsavelControlarQualificacao();
        this.setComboResponsavelAvaliarQualificacao();

    },

    setHideAndShowQualificacaoFornecedores: function () {

        //

    },

    setComboResponsavelQualificacao: function () {

        var idSite = $('#fornecedores-site').val();
        var idFuncao = $('#fornecedores-funcao').val();
        var data = {
            'idSite': idSite,
            'idFuncao': idFuncao
        };
        $.ajax({
            type: 'GET',
            dataType: 'JSON',
            data: data,
            url: '/Usuario/ObterUsuariosPorFuncao',
            beforeSend: function () {

            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    
                    $(".form-fornecedores-qualificacao").each(function () {
                    
                        APP.component.SelectListCompare.init(result.Lista, $(this).find('[name=formFornecedoresQualificacaoResponsavel] option'), ("#" + $(this).find('[name=formFornecedoresQualificacaoResponsavel]').attr("id")), 'IdUsuario', 'NmCompleto');

                    });

                    
                }
            },
            error: function (result) {
                //bootbox.alert("Ocorreu um erro!");
            },
            complete: function (result) {

            }
        });
},

    setComboResponsavelControlarQualificacao: function () {

        var idSite = $('#fornecedores-site').val();
        var idFuncao = $('#fornecedores-funcao').val();
        var data = {
            'idSite': idSite,
            'idFuncao': idFuncao
        };
        $.ajax({
            type: 'GET',
            dataType: 'JSON',
            data: data,
            url: '/Usuario/ObterUsuariosPorFuncao',
            beforeSend: function () {

            },
            success: function (result) {
                if (result.StatusCode == 200) {

                    $(".form-fornecedores-qualificacao").each(function () {

                        APP.component.SelectListCompare.init(result.Lista, $(this).find('[name=formFornecedoresQualificacaoResponsavelControlar] option'), ("#" + $(this).find('[name=formFornecedoresQualificacaoResponsavelControlar]').attr("id")), 'IdUsuario', 'NmCompleto');

                    });                    
                
                }
            },
            error: function (result) {
                //bootbox.alert("Ocorreu um erro!");
            },
            complete: function (result) {

            }
        });

    },

    setComboResponsavelAvaliarQualificacao: function () {

        var idSite = $('#fornecedores-site').val();
        var idFuncao = $('#fornecedores-funcao').val();
        var data = {
            'idSite': idSite,
            'idFuncao': idFuncao
        };
        $.ajax({
            type: 'GET',
            dataType: 'JSON',
            data: data,
            url: '/Usuario/ObterUsuariosPorFuncao',
            beforeSend: function () {

            },
            success: function (result) {
                if (result.StatusCode == 200) {
                    APP.component.SelectListCompare.init(result.Lista, $('[name=formFornecedoresQualificacaoResponsavelAvaliar] option'), '#form-fornecedores-qualificacao-responsavel-avaliar', 'IdUsuario', 'NmCompleto');
                }
            },
            error: function (result) {
                //bootbox.alert("Ocorreu um erro!");
            },
            complete: function (result) {

            }
        });

    },

    getObjFormQualificacaoFornecedoresValidate: function () {

        var acoesFornecedoresFormQualificacaoFornecedoresObj = {
            formFornecedoresQualificacaoProduto: 'required',
            formFornecedoresQualificacaoFornecedor: 'required',
            formFornecedoresQualificacaoResponsavel: 'required',
            formFornecedoresQualificacaoDtQualificacao: 'required',
            arquivoEvidencia: 'required',
            formFornecedoresQualificacaoAprovado: 'required',
            formFornecedoresQualificacaoObservacoes: 'required',
            formFornecedoresQualificacaoResponsavelControlar: 'required',
            formFornecedoresQualificacaoDtEmissao: 'required',
            formFornecedoresQualificacaoNmDocumento: 'required',
            formFornecedoresQualificacaoOrgaoExpeditor: 'required',
            formFornecedoresQualificacaoDtVencimento: 'required',
            formFornecedoresQualificacaoObservacoesControlar: 'required',
            formFornecedoresQualificacaoResponsavelAvaliar: 'required',
            formFornecedoresQualificacaoDtEstimativa: 'required',
        };

        return acoesFornecedoresFormQualificacaoFornecedoresObj;

    },

    getObjFormQualificacaoFornecedores: function () {

        var idSite = $('#fornecedores-site').val();

        
        var acoesFornecedoresFormQualificacaoFornecedoresObj = [];
        $('form[id^=form-fornecedores-qualificacao-]').each(function (key, val) {
            var obj = {
                IdAvaliaCriterioQualificacao: $(this).find('[name=IdAvaliaCriterioQualificacao]').val(),
                IdCriterioQualificacao: $(this).find('[name=IdCriterioQualificacao]').val(),
                IdFornecedor: $('[name=IdFornecedor]').val(),
                DtVencimento: $(this).find('[name=formFornecedoresQualificacaoDtVencimento]').val(),
                IdResponsavelPorQualificar: $(this).find('[name=formFornecedoresQualificacaoResponsavel] :selected').val(),
                DtQualificacaoVencimento: $(this).find('[name=formFornecedoresQualificacaoDtQualificacao]').val(),
                ArquivosDeEvidenciaAux: APP.controller.FornecedoresController.getAnexosContratos(this),
                Aprovado: APP.component.Radio.init('formFornecedoresQualificacaoAprovado'),
                Observacoes: $(this).find('[name=formFornecedoresQualificacaoObservacoes]').val(),
                IdResponsavelPorControlarVencimento: $(this).find('[name=formFornecedoresQualificacaoResponsavelControlar] :selected').val(),

                DtEmissao: $(this).find('[name=formFornecedoresQualificacaoDtEmissao]').val(),
                NumeroDocumento: $(this).find('[name=formFornecedoresQualificacaoNmDocumento]').val(),
                OrgaoExpedidor: $(this).find('[name=formFornecedoresQualificacaoOrgaoExpeditor]').val(),
                ObservacoesDocumento: $(this).find('[name=formFornecedoresQualificacaoObservacoesControlar]').val(),

            };
            //obj.IdSite = idSite;




            acoesFornecedoresFormQualificacaoFornecedoresObj.push(obj);
        });

        return acoesFornecedoresFormQualificacaoFornecedoresObj;

    },


    getAnexosContratos: function (_this) {

        var anexoContratoModel = APP.controller.FornecedoresController.models.AnexoModel;
        var arrayAnexoContrato = [];

        $(_this).find('.dashed li a:first-child').each(function () {

            var nameImg = $(this).text();
            var id = $(this).closest('li').find('[name=c]').val() != undefined && $(this).closest('li').find('[name=formCriarFornecedorEvidenciaIdAnexo]').val() != null && $(this).closest('li').find('[name=formCriarFornecedorEvidenciaIdAnexo]').val() != "" ? $(this).closest('li').find('[name=formCriarFornecedorEvidenciaIdAnexo]').val() : "0";
            var anexoContratoCliente = anexoContratoModel.constructor(
                id,
                nameImg,
                $(this).data('b64'),
            );

            arrayAnexoContrato.push(anexoContratoCliente);
        });

        return arrayAnexoContrato;

    },


    bindFormQualificacaoFornecedores: function () {

        //

    },

    //Formulario AVALIACAO FORNECEDORES
    formAvaliacaoFornecedores: function () {

        this.setHideAndShowAvaliacaoFornecedores();

    },

    setHideAndShowAvaliacaoFornecedores: function () {

        //

    },

    getObjFormAvaliacaoFornecedoresValidate: function () {

        var acoesFornecedoresFormAvaliacaoFornecedoresObj = {
            formFornecedoresAvaliacaoNome: 'required',
            formFornecedoresAvaliacaoCriterio: 'required',
            formFornecedoresAvaliacaoNota: {
                'required': true,
                'max': 100,
                'min': 1
            },
        };

        return acoesFornecedoresFormAvaliacaoFornecedoresObj;

    },

    getObjFormAvaliacaoFornecedores: function () {
        
        var dataProximaAvaliacao = $('[name=formFornecedoresDtProximaAvaliacao]').val();

        var avaliacoes = [];
        $('#tb-fornecedores-avaliacao tbody tr').each(function () {

            var avaliacao = {
                IdCriterioAvaliacao: $(this).find('[name=formFornecedoresAvaliacaoCriterioId]').val(),
                IdFornecedor: $('[name=IdFornecedor]').val(),
                NotaAvaliacao: $(this).find('[name=formFornecedoresAvaliacaoNota]').val(),
                DtProximaAvaliacao: dataProximaAvaliacao,
            };
            avaliacoes.push(avaliacao);
        });

        return avaliacoes;

    },

    bindFormAvaliacaoFornecedores: function () {

        //

    },

    //Formulario HISTORICO FORNECEDORES
    formHistoricoFornecedores: function () {

        this.setHideAndShowHistoricoFornecedores();

    },

    setHideAndShowHistoricoFornecedores: function () {

        //

    },

};
/*
|--------------------------------------------------------------------------
| Controlador Funcionario
|--------------------------------------------------------------------------
*/

function AbreCalendario(componente)
{
    if ($(componente).parent().parent().find("input").attr("disabled") == undefined)
    {
        $(componente).parent().parent().find("input").datepicker("show");
    }
    
}

function DeleteAnexoAcaoImediata(componente)
{
    var idInput = $($(componente).parent()[0]).find('input[type=file]').attr('id');
    var srcImg = $(".btn-upload-file-evidencia");
    srcImg.html('<i class="fa fa-paperclip fa-1x" aria-hidden="true"></i><br>Anexar');
    
    srcImg.parent().find(".DivExcluirAnexoEvidencia").remove();
    $('#' + idInput + '').data('b64', '');
}

function ExcluirProcessoAuditoria(componente) {

    $(componente).parent().parent().remove();

}

function UploadArquivoRai(componente)
{
    $(componente).closest('div').find('input[type=file]').trigger("click");

    //Variaveis de auxilio
    var idInput = $(componente).closest('div').find('input[type=file]').attr('id');
    var NomeAnexo = $(componente).closest('div').find('.NomeAnexo');
    var srcImg = $(componente);
    var base64 = "";

    $('#' + idInput + '').unbind('change');
    $('#' + idInput + '').on('change', function () {

        var _files = this.files;

        if (_files && _files[0]) {

            var reader = new FileReader();
            var name = "";

            reader.onload = function (e) {

                name = $('#' + idInput + '').prop('files')[0].name;
                base64 = e.target.result.split(',');

                NomeAnexo.val(name);
                srcImg.text('R.A.I');

                var html = '';
                html += '<a href="#" class="btn-delete-rai">';
                html += '<i class="fa fa-trash fa-1" aria-hidden="true" title="' + _options.labelButtonExcluir + '" data-original-title="' + _options.labelButtonExcluir + '">';
                html += '</i>';
                html += '</a>';

                srcImg.parent().append(html);

                //Pega somente a String Base64 e coloca da tag data-b64
                $('#' + idInput + '').data('b64', '' + base64[1] + '');

                APP.component.FileUpload.bind();

            };

            reader.readAsDataURL(_files[0]);

        }

    });
}



